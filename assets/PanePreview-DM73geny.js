import{d as S,w as U,y as G,f as a,u as p,h as o,t as L,o as s,n as R,A as ne,F as $,E as W,k as j,b as he,e as ge,G as je,H as Ce,l as y,I as Le,a as ce,x as ue,B as Te,v as de,J as ke,g as z,p as _,m as k,c as H}from"./index-CMF_CePX.js";import{u as se,j as te,y as Pe,n as Ie,z as Fe,A as Ee,B as oe,F as Re,C as $e,D as Ue,G as pe}from"./Header-ZV7lvmHH.js";import{K as I,P as F,_ as fe,f as Z,N as ve,O as me,Q as Se,R as Ae,S as we,T as P,g as be}from"./util-BCUUeTU2.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./xterm-CbIsyoms.js";/* empty css                                                                  */const Be=["co-label"],Me=["progress-anim"],Ft=S({__name:"SaveHeaderButton",setup(h){const f=se();function v(){te()}function n(){return f.project!=null&&f.project?.canEdit}return(g,C)=>U((s(),a("div",{onClick:v,class:"b-save icon-div co-item","co-label":"Save "+(p(I)==p(F).lesson?"Lesson":"Project")},[o("div",{class:"material-symbols-outlined","progress-anim":p(fe)},L(p(fe)?"progress_activity":"save"),9,Me)],8,Be)),[[G,n()]])}}),We=["co-label"],xe=["progress-anim"],Et=S({__name:"CompileHeaderButton",setup(h){function f(){let n=v.project;n&&Pe(n)}const v=se();return(n,g)=>U((s(),a("div",{onClick:f,class:"b-compile icon-div co-item","co-label":"Compile "+(p(I)==p(F).lesson?"Lesson":"Project")},[o("div",{class:"material-symbols-outlined","progress-anim":p(v).project?.isCompiling?.value},L(p(v).project?.isCompiling?.value?"progress_activity":"handyman"),9,xe)],8,We)),[[G,p(v).project?.usesCompiling?.value]])}}),Ne={class:"material-symbols-outlined"},Oe={class:"icon-btn-label"},ee=S({__name:"IconButton",props:{icon:{},type:{}},setup(h){const f=h;return(v,n)=>(s(),a("button",{class:R(["icon-btn",f.type])},[o("div",Ne,L(v.icon),1),o("div",Oe,[ne(v.$slots,"default")])],2))}}),De={class:"tabbed-area"},Ve={class:"tab"},ze=S({__name:"TabbedArea",props:{activeTab:{},tabAmt:{}},setup(h){return(f,v)=>(s(),a("div",De,[(s(!0),a($,null,W(f.tabAmt,n=>U((s(),a("div",Ve,[ne(f.$slots,"tab-"+(n-1),{showTab:n-1==f.activeTab},()=>[o("div",null,"Tab "+L(n-1),1)],!0)],512)),[[G,n-1==f.activeTab]])),256))]))}}),He=q(ze,[["__scopeId","data-v-ac0fcada"]]),Ge={key:0,style:{padding:"4px",margin:"20px"},class:"flx-c flx-v"},qe={class:"terminal-tab"},Ke={key:0,class:"button-list"},Ye={class:"terminal-tabs"},Je=["onClick"],Qe=S({__name:"TerminalTab",props:{visible:{type:Boolean},p:{},instI:{}},emits:["requestSwitchTab"],setup(h,{emit:f}){const v=se(),n=Ie(),g=j("save-btn"),C=j("upload-btn"),K=j("terminal-frame"),d=h,Y=f;async function x(r,c){if(!r.terminalCW){console.warn("couldn't boot, there was no terminal frame found");return}console.warn("posted boot message...",r.terminalCW),r.post("boot");let u="350px";g.value&&me(g.value,i=>{i.innerHTML=`
            <h3 class="flx-al" style="margin-block:4px">Files <span class="material-symbols-outlined">arrow_right_alt</span> Terminal</h3>
            <div>Save and Merge all files from your Code Otter project into the Terminal</div>
        `,i.style.minWidth=u,i.classList.add("sync-files-callout")}),C.value&&me(C.value,i=>{i.innerHTML=`
            <h3 class="flx-al" style="margin-block:4px">Files <span class="material-symbols-outlined">arrow_left_alt</span> Terminal</h3>
            <div>Upload and Merge all files from the Terminal into your Code Otter project</div>
        `,i.style.minWidth=u,i.classList.add("sync-files-callout")})}let T=d.p.wc.instances.map(r=>new Promise(c=>{r.terminalCW.onload=function(){console.log("******* LOADED TERMINAL CW"),c()},r.terminalCW.onerror=function(){console.log("******* ERROR LOADING TERMINAL CW"),c()}}));async function m(){let r=d.p.wc,c=r.createInst(),u=r.instances.indexOf(c);await Z(5),r.activeTerminalTab=u,await Z(500),c.terminalCW=Le(K.value[u].contentWindow),await T[u],await Z(1),await x(c)}async function N(r){let c=d.p.wc,u=c.instances.find(i=>i.terminalCW==r.source);u?.onMessage(r,async(i,b)=>{if(i=="exit")c.exitInst(u);else if(i=="booted")c.loadFilesIntoTerminal(d.p);else if(i=="file-ops"){console.log(":::::: file ops:",b.ops);for(let A=0;A<b.ops.length;A++){let O=b.ops[A],e=O.data,t=O.id;if(t=="create-file"||t=="change-file"){let l=d.p.getFileByPath2(e.path);l?(l.buf=e.buf,l.editor&&l.editor.setValue(l.p.textDecoder.decode(e.buf)),l.setSaved(!1)):d.p.createFileFromPath(e.path,e.buf)}else if(t=="create-folder")d.p.createFolderFromPath(e.path);else if(t=="delete-item"){let l=d.p.getItemByPath2(e.path);console.log(":: delete file",l),l&&l.p.deleteFItem(l,!0,[u.id])}else if(t=="move-file"||t=="move-folder"){console.warn("::: MOVE: ",t,e);let{parentPath:l,name:B}=ve(e.from),{parentPath:re,name:M}=ve(e.to),E=d.p.getItemByPath(l,B);if(!E){alert("Failed syncing move file/folder after it was done in the terminal, I would save and refresh because they may be out of sync"),console.warn("Failed syncing move file/folder after it was done in the terminal, I would save and refresh because they may be out of sync");return}let ye=e.from.split("/").pop(),_e=e.to.split("/").pop();if(ye!=_e){if(console.log("...was a rename, not a move (but if it's a move too we'll continue on)"),await new Promise(V=>{Fe(E.p.pid,l,B,M,void 0,le=>{if(le!=0)return;let w=E,ae=Se(w.name).replace(/\s/g,"_");w._fi.classList.remove("lang-"+ae),w.name=M,w instanceof Re?(w.link&&(w.link.children[0].textContent=M),w._fi&&(w._fi.children[0].textContent=M),w.updateLang()):w._fi&&(w._fi.children[0].children[2].textContent=M),w._fi.classList.add("lang-"+ae),close&&close(),V(le)})})!=0){alert("there was a problem renaming the file, aborting, the terminal may not be in sync with your files anymore");return}await te(!0,{ignoreInsts:[u.id]})}let D=d.p.createFolderFromPath(re);if(!D){alert("Failed to find destination folder for syncing move file/folder after it was done in the terminal, I would save and refresh because they may be out of sync"),console.warn("Failed to find destination folder for syncing move file/folder after it was done in the terminal, I would save and refresh because they may be out of sync");return}E.folder!=D?(console.log("::::::: MOVING PATHS:",E.folder.getSelfPath(),D.getSelfPath()),Ee(E,D,!0,[u.id]).then(ie=>{if(!ie){let V="Failed to move file/folder after it was done in the terminal, I would save and refresh because they may be out of sync";alert(V),console.warn(V)}})):console.warn("not moving, was just a rename and not moving anywhere different")}}te(!0,{ignoreInsts:[u.id]})}else i=="update-preview-urls"?(console.warn("update preview urls:",b.urls),c.previewURLs=b.urls):i=="new-preview-url"&&(console.log("NEW PREVIEW URL:",b),d.p.previewURL="localhost:"+b.port,I==F.editor?v.triggerProject():I==F.lesson&&n.triggerLesson(),Y("requestSwitchTab",0),oe(d.p))})}he(()=>{window.addEventListener("message",N)}),ge(()=>{window.removeEventListener("message",N)}),je(()=>{console.log("LEAVE TERMINAL TAB"),d.p.wc?.$reset()}),Ce(()=>d.visible,r=>{r&&setTimeout(()=>{d.p.wc.refit()},0)});async function J(){let r=d.p;if(!r)return;console.log(":: started save...");let c=[];r.loopAllFiles({forFile:(u,i)=>{},forFolder:(u,i)=>{}},(u,i)=>u==null?"":u+i.name+"/"),await Promise.all(c),console.log(":: finished saving")}async function Q(){}window.saveAllFiles=J,window.uploadAllFiles=Q;function X(){d.p.wc.previewURLs.splice(0,d.p.wc.previewURLs.length)}return window.resetURLs=X,(r,c)=>(s(),a($,null,[r.p.wc.instances.length==0?(s(),a("div",Ge,[c[3]||(c[3]=o("h2",{style:{"text-align":"center"}},"This is a terminal which can be used to run custom build servers such as Vite, install and use node modules, and run backend servers with Node.js.",-1)),c[4]||(c[4]=o("ul",{style:{"margin-left":"2em","margin-top":"2em"}},[o("li",null,"The preview URL will automatically change to a server you open on whatever port"),o("br"),o("li",null,"The terminal is automatically loaded with all the files from your project, but changes within the terminal require using the buttons above"),o("br"),o("li",null,'For npm packages, the node_modules folder is not saved, running "npm i" on your project that contains a package.json file will auto install the libraries again')],-1)),o("button",{class:"icon-btn accent",onClick:m,style:{"margin-top":"2em"}},[c[2]||(c[2]=o("div",{class:"material-symbols-outlined"},"mode_off_on",-1)),o("div",null,L(r.p.wc.instances[r.instI]?.booting?"Booting...":"Boot Terminal"),1)])])):y("",!0),o("div",qe,[r.p.wc.booted?(s(),a("div",Ke,[y("",!0),y("",!0),o("button",{ref:"upload-btn",class:"icon-btn low-contrast",onClick:m},c[7]||(c[7]=[o("div",{class:"material-symbols-outlined"},"add",-1),o("div",null,"New Tab (Experimental)",-1)]),512),y("",!0),y("",!0),y("",!0)])):y("",!0),o("div",Ye,[(s(!0),a($,null,W(r.p.wc.instances,(u,i)=>(s(),a("button",{onClick:b=>r.p.wc.activeTerminalTab=i,class:R([r.p.wc.activeTerminalTab==i?"accent":"low-contrast"])},"Tab "+L(i),11,Je))),256))]),(s(!0),a($,null,W(r.p.wc.instances,(u,i)=>U((s(),a("iframe",{src:"/terminal",frameborder:"0",ref_for:!0,ref:"terminal-frame",key:u.id,class:"terminal-frame"})),[[G,r.p.wc.activeTerminalTab==i]])),128))])],64))}}),Xe=q(Qe,[["__scopeId","data-v-cde4f552"]]),Ze={},et={class:"highlight-item"};function tt(h,f){return s(),a("div",et,[ne(h.$slots,"default",{},void 0,!0)])}const ot=q(Ze,[["render",tt],["__scopeId","data-v-9b18b55d"]]),nt=["resize"],st={class:"d-preview-controls header flx",style:{gap:"20px"}},rt={class:"preview-url-cont"},it={style:{"margin-left":"auto",gap:"10px"},class:"flx-h flx-al"},lt={class:"preview-grid vertical"},at=["src"],ct={key:1},ut=["src"],dt={key:1,class:"multi-iframe-cont"},pt=["src"],ft={class:"tab-header"},vt={key:0,style:{margin:"20px"}},mt={class:"tab-live-lesson"},wt={class:"tab-header"},bt={key:0,class:"tab-option-list"},ht={class:"tab-line-item"},gt={key:0,class:"current-code-cont"},yt={key:1,class:"tab-live-lesson"},_t={class:"preview-tabs"},jt=S({__name:"PanePreview",props:{project:{},resize:{}},setup(h,{expose:f}){function v(){return n.project.wc.booted&&n.project.previewURL.startsWith("localhost")}const n=h,g=j("iframe"),C=j("preview-url");j("multi-iframe");const K=j("preview-pane"),d=j("b-refresh"),Y=j("icon-refresh");function x(e){e.data.type=="-co-p-refresh"&&oe(n.project)}const T=ce(0),m=ce({name:"",currentCode:""});function N(){be.emit("start-live-lesson",n.project.pid,{name:m.value.name||void 0},e=>{if(typeof e=="number"){let t=`Unexpected error trying to start live lesson: ${e}`;console.warn(t),alert(t);return}else if("err"in e){let t=e.err;alert({"-3":"Couldn't start live lesson, please reload the page (not logged in)","-10":"Couldn't start live lesson, you don't have edit rights over this project","-11":"Couldn't start live lesson, couldn't find the project to start it on"}[t]??"An unknown error occurred while trying to start the live lesson: "+t);return}m.value.currentCode=e.code,n.project.live={code:e.code}})}function J(){be.emit("unload-live-lesson",m.value.currentCode,e=>{if("err"in e){let t=e.err;alert({"-3":"Couldn't unload live lesson, please reload the page (not logged in)",1:"Couldn't unload live lesson, live lesson with that code didn't exist",2:"Couldn't unload live lesson, you are not the owner"}[t]??"An unknown error occurred while trying to unload the live lesson: "+t);return}m.value.currentCode="",n.project.live=void 0})}function Q(){n.project.wc.booted&&v(),Ue(n.project)}function X(){if(!n.project)return;let e=open(n.project.getExternalURL(),"_blank");e&&(console.log("W:",e),e.addEventListener("load",t=>{console.log("------------LOADED WINDOW PROXY")}),e.postMessage("hi there"))}function r(){let e=P.invertContrast.v;P.invertContrast.set(!e)}function c(){oe(n.project)}function u(){g.value&&(g.value.src=""),n.project&&n.project.previewURL&&(n.project.previewURL="")}f({unload:u});let i=new Ae("stop_resize").with(e=>{e.infinite=!0,e.callback=()=>{console.log("stopped resize!!!"),n.project.wc.refit()}});he(()=>{C.value?$e(C.value,n.project):console.error("there was no"),we.subEvt(i);let e=n.project;e.refs.iframe=g.value,e.refs.previewUrl=C.value,e.refs.preview=K.value,e.refs.b_refresh=d.value,e.refs.icon_refresh=Y.value,window.addEventListener("message",x)}),ge(()=>{let e=C.value;e&&e.replaceWith(e.cloneNode(!0)),we.cancelEvt(i);let t=n.project;t.refs.iframe=void 0,t.refs.previewUrl=void 0,t.refs.preview=void 0,t.refs.b_refresh=void 0,t.refs.icon_refresh=void 0,window.removeEventListener("message",x)});const b=ue(()=>[{icon:"photo_frame",label:"Preview",enable:!0},{icon:"terminal",label:"Terminal",enable:!0},{icon:"videocam",label:"Start Live Lesson",enable:I==F.editor}].filter(e=>e!=null)),A=ue(()=>n.project.refreshedOnce?n.project.getURL():"about:blank");function O(e){return 0}return(e,t)=>(s(),a("div",{class:R(["pane-preview","pane",{"pane-your-preview":!e.project.isTutor,"pane-tutor-preview":e.project.isTutor}]),ref:"preview-pane",onMouseenter:t[3]||(t[3]=l=>e.project.refs.overPreview=!0),onMouseleave:t[4]||(t[4]=l=>e.project.refs.overPreview=!1),resize:e.resize},[o("div",st,[t[6]||(t[6]=o("div",null,"Preview",-1)),o("button",{onClick:Q,class:"b-refresh icon-btn",ref:"b-refresh"},[o("div",{class:"icon-refresh material-symbols-outlined",ref:"icon-refresh",style:Te({rotate:e.project.refreshState.value?"360deg":"0deg"})},"sync",4),t[5]||(t[5]=o("div",{class:"label"},"Refresh",-1))],512),o("div",rt,[U(o("input",{type:"text",class:"i-preview-url",ref:"preview-url","onUpdate:modelValue":t[0]||(t[0]=l=>e.project.previewURL=l),autocomplete:"none",onKeydown:ke(c,["enter"])},null,544),[[de,e.project.previewURL]])]),o("div",it,[o("div",{onClick:r,class:R([{invert:p(P).invertContrast.v},"material-symbols-outlined b-invert-colors co-item"]),"co-label":"Invert contrast"},"invert_colors",2),e.project.isTutor?y("",!0):(s(),a("div",{key:0,onClick:X,class:"material-symbols-outlined b-open-in-new co-item","co-label":"Open in new tab"},"open_in_new"))])]),o("div",lt,[z(He,{"tab-amt":b.value.length,"active-tab":T.value},{"tab-0":_(()=>[p(P).useMultiPreview.v?p(P).useMultiPreview.v?(s(),a("div",ct,[v()?(s(),a("div",dt,[(s(!0),a($,null,W(e.project.wc.previewURLs,l=>(s(),a("iframe",{src:l,frameborder:"0",ref_for:!0,ref:"multi-iframe",class:"iframe multi-iframe"},null,8,pt))),256))])):(s(),a("iframe",{key:0,frameborder:"0",ref_key:"iframe",ref:g,src:e.project.refreshedOnce?e.project.getURL():"",class:R({iframe:!0,invert:p(P).invertContrast.v})},null,10,ut))])):y("",!0):(s(),a("iframe",{key:0,frameborder:"0",ref_key:"iframe",ref:g,src:A.value,class:R({iframe:!0,invert:p(P).invertContrast.v})},null,10,at))]),"tab-1":_(()=>[o("h2",ft,[t[8]||(t[8]=o("div",null,null,-1)),z(pe,null,{default:_(()=>t[7]||(t[7]=[k("BETA")])),_:1,__:[7]})]),p(I)!=p(F).editor?(s(),a("div",vt,t[9]||(t[9]=[o("h4",null,"Sorry, the Terminal is currently only available in editor projects, not lessons.",-1)]))):(s(),H(Xe,{key:1,"inst-i":O(e.project),visible:T.value==1,p:e.project,onRequestSwitchTab:t[1]||(t[1]=l=>{T.value=l})},null,8,["inst-i","visible","p"]))]),"tab-2":_(()=>[o("div",mt,[o("h2",wt,[t[11]||(t[11]=o("div",null,"Start Live Lesson",-1)),z(pe,null,{default:_(()=>t[10]||(t[10]=[k("BETA")])),_:1,__:[10]})]),t[17]||(t[17]=o("br",null,null,-1)),t[18]||(t[18]=o("br",null,null,-1)),p(I)==p(F).editor?(s(),a("div",bt,[o("div",ht,[t[12]||(t[12]=o("label",{for:"live-lesson-name"},"Display Name",-1)),U(o("input",{type:"text",name:"",id:"live-lesson-name","onUpdate:modelValue":t[2]||(t[2]=l=>m.value.name=l)},null,512),[[de,m.value.name]])]),o("div",null,[m.value.currentCode?(s(),H(ee,{key:1,icon:"stop_circle",type:"inherit-accent",onClick:J},{default:_(()=>t[14]||(t[14]=[k("Stop")])),_:1,__:[14]})):(s(),H(ee,{key:0,icon:"rocket_launch",type:"inherit-accent",onClick:N},{default:_(()=>t[13]||(t[13]=[k("Start")])),_:1,__:[13]}))]),m.value.currentCode?(s(),a("div",gt,[t[15]||(t[15]=k(" You are currently hosting this project as a Live Lesson with the code ")),z(ot,{style:{"font-size":"2em"}},{default:_(()=>[k(L(m.value.currentCode),1)]),_:1})])):y("",!0)])):(s(),a("div",yt,t[16]||(t[16]=[o("h4",null,"Live Lessons are only hostable from editor projects, not lessons.",-1)])))])]),_:1},8,["tab-amt","active-tab"]),o("div",_t,[(s(!0),a($,null,W(b.value,(l,B)=>(s(),H(ee,{icon:l.icon,type:B==T.value?"accent":"no-bg",onClick:re=>T.value=B},{default:_(()=>[k(L(l.label),1)]),_:2},1032,["icon","type","onClick"]))),256))])])],42,nt))}}),Rt=q(jt,[["__scopeId","data-v-ee2be36f"]]);export{Rt as P,Ft as _,Et as a};
