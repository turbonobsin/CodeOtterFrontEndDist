import{d as Sr,s as Er,c as ft,u as At,o as Xe,I as Cr,U as Hl,k as jt,V as Vl,C as Zd,W as Do,l as Yl,q as Zl,X as Kd,z as Kl,a as De,y as Ei,G as Ci,i as Vn,t as ki,j as Gl,A as Si,x as is,E as Gd,w as Qr,p as Xd,D as Jr,b as Bs,Y as Qd,F as jo,r as Ro}from"./vue-BJ2jqJ1-.js";import{u as fn,W as wi,X as Lr,S as Se,M as Es,Y as Xl,Z as bs,$ as ea,g as le,H as pn,q as Jd,r as eh,e as en,z as th,a0 as tn,a1 as sn,a2 as Bo,v as ih,P as Jt,w as Ql,n as Ua,a3 as ma,t as sh,f as w,a4 as Jl,c as ec,a5 as nh,a6 as Fr,a7 as rh,a8 as Ye,m as ps,C as qi,a9 as tc,aa as Vt,ab as Na,ac as rr,ad as ms,ae as Ys,af as gs,ag as as,ah as ic,L as bt,ai as Cs,aj as li,_ as vs,ak as sc,K as ci,al as ah,am as oh,an as lh,ao as ch,ap as uh,aq as nc,J as rc,ar as dh,as as ji,at as hh,au as fh,av as ac,aw as ri,ax as wt,R as Gt,ay as tt,x as fi,j as za,i as ph,az as Pr,aA as oc,U as Yn,aB as mh,aC as gh,aD as vh,aE as wh,aF as Ii,aG as Oi,o as $a,d as Wi,aH as Mo,Q as Zs,aI as yh,aJ as bh,aK as Uo,k as lc,aL as _h,aM as cc,aN as xh,aO as kh,aP as Sh,aQ as Eh,aR as Ch,aS as Lh,aT as Fh,aU as Ph}from"./util-BOdJUwkE.js";import{r as Tr,s as os,t as Th,c as uc,m as Ih,l as Oh,a as Ah}from"./index-CW6-FViY.js";import{_ as mn}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./xterm-CbIsyoms.js";import{U as dc}from"./monaco-D2fC6ZYY.js";const Dh=["logged-in"],jh=["src"],Rh={key:1,class:"material-symbols-outlined"},Bh=Sr({__name:"ProfileIcon",setup(i){const e=fn(),{g_user:t}=Er(e);return(s,n)=>(Xe(),ft("a",{class:"h-profile","logged-in":At(t)!=null},[At(t)!=null?(Xe(),ft("img",{key:0,referrerpolicy:"no-referrer",draggable:"false",src:At(t).data.picture,crossorigin:""},null,8,jh)):(Xe(),ft("span",Rh,"person"))],8,Dh))}}),Mh=mn(Bh,[["__scopeId","data-v-4c494c0f"]]);function Rn(i){document.body.style.cursor=i}function Uh(...i){i.includes(document.body.style.cursor)&&(document.body.style.cursor="default")}let Oe,Ns="",hc=0,fc=0,zs=0,$s=0;function Nh(){let i=document.querySelectorAll(".resize");for(const e of i)e.hasAttribute("resize")&&ar(e)}function pc(i){if(Oe){let e=i.clientX-hc,t=i.clientY-fc;Ns=="r"?(Rn("ew-resize"),Oe.elm.style.width=zs+e+"px",Oe.call&&Oe.call(Oe.elm.offsetWidth,zs+e)):Ns=="l"&&(Rn("ew-resize"),Oe.elm.style.width=zs-e+"px",Oe.call&&Oe.call(Oe.elm.offsetWidth,zs-e)),Ns=="d"?(Rn("ns-resize"),Oe.elm.style.height=$s+t+"px",Oe.call&&Oe.call(Oe.elm.offsetHeight,$s+t)):Ns=="u"&&(Rn("ns-resize"),Oe.elm.style.height=$s-t+"px",Oe.call&&Oe.call(Oe.elm.offsetHeight,$s-t))}}function mc(i){if(Oe){Se.exec("stop_resize",void 0),Oe=null,Uh("ew-resize","ns-resize");let e=document.querySelectorAll("iframe");for(const t of e)t.style.pointerEvents="revert"}}function gc(i){if(Oe||wi)return i.preventDefault(),!1}function vc(i){(Oe||wi?.drag)&&(i.preventDefault(),getSelection().removeAllRanges())}function wc(i){"dragging"in window&&Oe&&i.preventDefault()}function Ww(){Nh(),document.addEventListener("mousemove",pc),document.addEventListener("mouseup",mc),document.addEventListener("dragstart",gc),document.addEventListener("selectionchange",vc),document.addEventListener("selectstart",wc)}function yc(){return{"*":(i,e)=>{Lr()}}}let nn=yc();function ar(i){if(!i)return;let e=i.getAttribute("resize").split(" ");for(const t of e){i.style.position="relative";let s=document.createElement("div");s.className="resize "+t,i.appendChild(s),i.style.position="relative",i.style.minWidth="150px",i.style.minHeight="150px";let n=7;s.setAttribute("style",{r:`
                right:-${n}px; 
                width:10px;
                height:100%;
                cursor:ew-resize;
                top:0px;
            `,l:`
                left:-${n}px;
                width:10px;
                height:100%;
                cursor:ew-resize;
                top:0px;
            `,d:`
                bottom:-${n}px;
                height:10px;
                width:100%;
                cursor:ns-resize;
                left:0px;
            `,u:`
                top:-${n}px;
                height:10px;
                width:100%;
                cursor:ns-resize;
                left:0px;
            `}[t]),s.style.position="absolute",s.style.opacity="0",s.style.zIndex="6",s.onmousedown=function(r){Oe={elm:i,call:nn[i.id]||nn["*"]},Ns=t,hc=r.clientX,fc=r.clientY,zs=i.offsetWidth,$s=i.offsetHeight;let a=document.querySelectorAll("iframe");for(const o of a)o.style.pointerEvents="none"}}}function Hw(){nn=yc(),document.removeEventListener("mousemove",pc),document.removeEventListener("mouseup",mc),document.removeEventListener("dragstart",gc),document.removeEventListener("selectionchange",vc),document.removeEventListener("selectstart",wc)}function zh(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var ta={exports:{}},No;function $h(){return No||(No=1,function(i){(e=>{var t=Object.defineProperty,s=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,r=Object.prototype.hasOwnProperty,a=(h,v)=>{for(var y in v)t(h,y,{get:v[y],enumerable:!0})},o=(h,v,y,P)=>{if(v&&typeof v=="object"||typeof v=="function")for(let N of n(v))!r.call(h,N)&&N!==y&&t(h,N,{get:()=>v[N],enumerable:!(P=s(v,N))||P.enumerable});return h},c=h=>o(t({},"__esModule",{value:!0}),h),l=(h,v,y)=>new Promise((P,N)=>{var $=T=>{try{G(y.next(T))}catch(de){N(de)}},B=T=>{try{G(y.throw(T))}catch(de){N(de)}},G=T=>T.done?P(T.value):Promise.resolve(T.value).then($,B);G((y=y.apply(h,v)).next())}),u={};a(u,{analyzeMetafile:()=>Rd,analyzeMetafileSync:()=>Nd,build:()=>Od,buildSync:()=>Bd,context:()=>Ad,default:()=>Wd,formatMessages:()=>jd,formatMessagesSync:()=>Ud,initialize:()=>$d,stop:()=>zd,transform:()=>Dd,transformSync:()=>Md,version:()=>Id}),e.exports=c(u);function m(h){let v=P=>{if(P===null)y.write8(0);else if(typeof P=="boolean")y.write8(1),y.write8(+P);else if(typeof P=="number")y.write8(2),y.write32(P|0);else if(typeof P=="string")y.write8(3),y.write(k(P));else if(P instanceof Uint8Array)y.write8(4),y.write(P);else if(P instanceof Array){y.write8(5),y.write32(P.length);for(let N of P)v(N)}else{let N=Object.keys(P);y.write8(6),y.write32(N.length);for(let $ of N)y.write(k($)),v(P[$])}},y=new p;return y.write32(0),y.write32(h.id<<1|+!h.isRequest),v(h.value),U(y.buf,y.len-4,0),y.buf.subarray(0,y.len)}function g(h){let v=()=>{switch(y.read8()){case 0:return null;case 1:return!!y.read8();case 2:return y.read32();case 3:return D(y.read());case 4:return y.read();case 5:{let B=y.read32(),G=[];for(let T=0;T<B;T++)G.push(v());return G}case 6:{let B=y.read32(),G={};for(let T=0;T<B;T++)G[D(y.read())]=v();return G}default:throw new Error("Invalid packet")}},y=new p(h),P=y.read32(),N=(P&1)===0;P>>>=1;let $=v();if(y.ptr!==h.length)throw new Error("Invalid packet");return{id:P,isRequest:N,value:$}}var p=class{constructor(h=new Uint8Array(1024)){this.buf=h,this.len=0,this.ptr=0}_write(h){if(this.len+h>this.buf.length){let v=new Uint8Array((this.len+h)*2);v.set(this.buf),this.buf=v}return this.len+=h,this.len-h}write8(h){let v=this._write(1);this.buf[v]=h}write32(h){let v=this._write(4);U(this.buf,h,v)}write(h){let v=this._write(4+h.length);U(this.buf,h.length,v),this.buf.set(h,v+4)}_read(h){if(this.ptr+h>this.buf.length)throw new Error("Invalid packet");return this.ptr+=h,this.ptr-h}read8(){return this.buf[this._read(1)]}read32(){return C(this.buf,this._read(4))}read(){let h=this.read32(),v=new Uint8Array(h),y=this._read(v.length);return v.set(this.buf.subarray(y,y+h)),v}},k,D,E;if(typeof TextEncoder<"u"&&typeof TextDecoder<"u"){let h=new TextEncoder,v=new TextDecoder;k=y=>h.encode(y),D=y=>v.decode(y),E='new TextEncoder().encode("")'}else if(typeof Buffer<"u")k=h=>Buffer.from(h),D=h=>{let{buffer:v,byteOffset:y,byteLength:P}=h;return Buffer.from(v,y,P).toString()},E='Buffer.from("")';else throw new Error("No UTF-8 codec found");if(!(k("")instanceof Uint8Array))throw new Error(`Invariant violation: "${E} instanceof Uint8Array" is incorrectly false

This indicates that your JavaScript environment is broken. You cannot use
esbuild in this environment because esbuild relies on this invariant. This
is not a problem with esbuild. You need to fix your environment instead.
`);function C(h,v){return h[v++]|h[v++]<<8|h[v++]<<16|h[v++]<<24}function U(h,v,y){h[y++]=v,h[y++]=v>>8,h[y++]=v>>16,h[y++]=v>>24}var A=JSON.stringify,R="warning",re="silent";function me(h){if(Pe(h,"target"),h.indexOf(",")>=0)throw new Error(`Invalid target: ${h}`);return h}var Y=()=>null,O=h=>typeof h=="boolean"?null:"a boolean",x=h=>typeof h=="string"?null:"a string",te=h=>h instanceof RegExp?null:"a RegExp object",se=h=>typeof h=="number"&&h===(h|0)?null:"an integer",st=h=>typeof h=="function"?null:"a function",fe=h=>Array.isArray(h)?null:"an array",xe=h=>typeof h=="object"&&h!==null&&!Array.isArray(h)?null:"an object",dt=h=>typeof h=="object"&&h!==null?null:"an array or an object",Nt=h=>h instanceof WebAssembly.Module?null:"a WebAssembly.Module",Me=h=>typeof h=="object"&&!Array.isArray(h)?null:"an object or null",gt=h=>typeof h=="string"||typeof h=="boolean"?null:"a string or a boolean",Ot=h=>typeof h=="string"||typeof h=="object"&&h!==null&&!Array.isArray(h)?null:"a string or an object",vt=h=>typeof h=="string"||Array.isArray(h)?null:"a string or an array",Os=h=>typeof h=="string"||h instanceof Uint8Array?null:"a string or a Uint8Array",Ki=h=>typeof h=="string"||h instanceof URL?null:"a string or a URL";function _(h,v,y,P){let N=h[y];if(v[y+""]=!0,N===void 0)return;let $=P(N);if($!==null)throw new Error(`${A(y)} must be ${$}`);return N}function Ae(h,v,y){for(let P in h)if(!(P in v))throw new Error(`Invalid option ${y}: ${A(P)}`)}function ht(h){let v=Object.create(null),y=_(h,v,"wasmURL",Ki),P=_(h,v,"wasmModule",Nt),N=_(h,v,"worker",O);return Ae(h,v,"in initialize() call"),{wasmURL:y,wasmModule:P,worker:N}}function Ce(h){let v;if(h!==void 0){v=Object.create(null);for(let y in h){let P=h[y];if(typeof P=="string"||P===!1)v[y]=P;else throw new Error(`Expected ${A(y)} in mangle cache to map to either a string or false`)}}return v}function nt(h,v,y,P,N){let $=_(v,y,"color",O),B=_(v,y,"logLevel",x),G=_(v,y,"logLimit",se);$!==void 0?h.push(`--color=${$}`):P&&h.push("--color=true"),h.push(`--log-level=${B||N}`),h.push(`--log-limit=${G||0}`)}function Pe(h,v,y){if(typeof h!="string")throw new Error(`Expected value for ${v}${y!==void 0?" "+A(y):""} to be a string, got ${typeof h} instead`);return h}function As(h,v,y){let P=_(v,y,"legalComments",x),N=_(v,y,"sourceRoot",x),$=_(v,y,"sourcesContent",O),B=_(v,y,"target",vt),G=_(v,y,"format",x),T=_(v,y,"globalName",x),de=_(v,y,"mangleProps",te),he=_(v,y,"reserveProps",te),ie=_(v,y,"mangleQuoted",O),ke=_(v,y,"minify",O),ce=_(v,y,"minifySyntax",O),ge=_(v,y,"minifyWhitespace",O),ve=_(v,y,"minifyIdentifiers",O),ee=_(v,y,"lineLimit",se),We=_(v,y,"drop",fe),Q=_(v,y,"dropLabels",fe),X=_(v,y,"charset",x),z=_(v,y,"treeShaking",O),I=_(v,y,"ignoreAnnotations",O),b=_(v,y,"jsx",x),L=_(v,y,"jsxFactory",x),j=_(v,y,"jsxFragment",x),V=_(v,y,"jsxImportSource",x),Z=_(v,y,"jsxDev",O),F=_(v,y,"jsxSideEffects",O),M=_(v,y,"define",xe),f=_(v,y,"logOverride",xe),S=_(v,y,"supported",xe),W=_(v,y,"pure",fe),H=_(v,y,"keepNames",O),J=_(v,y,"platform",x),ue=_(v,y,"tsconfigRaw",Ot);if(P&&h.push(`--legal-comments=${P}`),N!==void 0&&h.push(`--source-root=${N}`),$!==void 0&&h.push(`--sources-content=${$}`),B&&(Array.isArray(B)?h.push(`--target=${Array.from(B).map(me).join(",")}`):h.push(`--target=${me(B)}`)),G&&h.push(`--format=${G}`),T&&h.push(`--global-name=${T}`),J&&h.push(`--platform=${J}`),ue&&h.push(`--tsconfig-raw=${typeof ue=="string"?ue:JSON.stringify(ue)}`),ke&&h.push("--minify"),ce&&h.push("--minify-syntax"),ge&&h.push("--minify-whitespace"),ve&&h.push("--minify-identifiers"),ee&&h.push(`--line-limit=${ee}`),X&&h.push(`--charset=${X}`),z!==void 0&&h.push(`--tree-shaking=${z}`),I&&h.push("--ignore-annotations"),We)for(let oe of We)h.push(`--drop:${Pe(oe,"drop")}`);if(Q&&h.push(`--drop-labels=${Array.from(Q).map(oe=>Pe(oe,"dropLabels")).join(",")}`),de&&h.push(`--mangle-props=${de.source}`),he&&h.push(`--reserve-props=${he.source}`),ie!==void 0&&h.push(`--mangle-quoted=${ie}`),b&&h.push(`--jsx=${b}`),L&&h.push(`--jsx-factory=${L}`),j&&h.push(`--jsx-fragment=${j}`),V&&h.push(`--jsx-import-source=${V}`),Z&&h.push("--jsx-dev"),F&&h.push("--jsx-side-effects"),M)for(let oe in M){if(oe.indexOf("=")>=0)throw new Error(`Invalid define: ${oe}`);h.push(`--define:${oe}=${Pe(M[oe],"define",oe)}`)}if(f)for(let oe in f){if(oe.indexOf("=")>=0)throw new Error(`Invalid log override: ${oe}`);h.push(`--log-override:${oe}=${Pe(f[oe],"log override",oe)}`)}if(S)for(let oe in S){if(oe.indexOf("=")>=0)throw new Error(`Invalid supported: ${oe}`);const ne=S[oe];if(typeof ne!="boolean")throw new Error(`Expected value for supported ${A(oe)} to be a boolean, got ${typeof ne} instead`);h.push(`--supported:${oe}=${ne}`)}if(W)for(let oe of W)h.push(`--pure:${Pe(oe,"pure")}`);H&&h.push("--keep-names")}function Lt(h,v,y,P,N){var $;let B=[],G=[],T=Object.create(null),de=null,he=null;nt(B,v,T,y,P),As(B,v,T);let ie=_(v,T,"sourcemap",gt),ke=_(v,T,"bundle",O),ce=_(v,T,"splitting",O),ge=_(v,T,"preserveSymlinks",O),ve=_(v,T,"metafile",O),ee=_(v,T,"outfile",x),We=_(v,T,"outdir",x),Q=_(v,T,"outbase",x),X=_(v,T,"tsconfig",x),z=_(v,T,"resolveExtensions",fe),I=_(v,T,"nodePaths",fe),b=_(v,T,"mainFields",fe),L=_(v,T,"conditions",fe),j=_(v,T,"external",fe),V=_(v,T,"packages",x),Z=_(v,T,"alias",xe),F=_(v,T,"loader",xe),M=_(v,T,"outExtension",xe),f=_(v,T,"publicPath",x),S=_(v,T,"entryNames",x),W=_(v,T,"chunkNames",x),H=_(v,T,"assetNames",x),J=_(v,T,"inject",fe),ue=_(v,T,"banner",xe),oe=_(v,T,"footer",xe),ne=_(v,T,"entryPoints",dt),Le=_(v,T,"absWorkingDir",x),pe=_(v,T,"stdin",xe),_e=($=_(v,T,"write",O))!=null?$:N,Ft=_(v,T,"allowOverwrite",O),Ve=_(v,T,"mangleCache",xe);if(T.plugins=!0,Ae(v,T,`in ${h}() call`),ie&&B.push(`--sourcemap${ie===!0?"":`=${ie}`}`),ke&&B.push("--bundle"),Ft&&B.push("--allow-overwrite"),ce&&B.push("--splitting"),ge&&B.push("--preserve-symlinks"),ve&&B.push("--metafile"),ee&&B.push(`--outfile=${ee}`),We&&B.push(`--outdir=${We}`),Q&&B.push(`--outbase=${Q}`),X&&B.push(`--tsconfig=${X}`),V&&B.push(`--packages=${V}`),z){let K=[];for(let Ue of z){if(Pe(Ue,"resolve extension"),Ue.indexOf(",")>=0)throw new Error(`Invalid resolve extension: ${Ue}`);K.push(Ue)}B.push(`--resolve-extensions=${K.join(",")}`)}if(f&&B.push(`--public-path=${f}`),S&&B.push(`--entry-names=${S}`),W&&B.push(`--chunk-names=${W}`),H&&B.push(`--asset-names=${H}`),b){let K=[];for(let Ue of b){if(Pe(Ue,"main field"),Ue.indexOf(",")>=0)throw new Error(`Invalid main field: ${Ue}`);K.push(Ue)}B.push(`--main-fields=${K.join(",")}`)}if(L){let K=[];for(let Ue of L){if(Pe(Ue,"condition"),Ue.indexOf(",")>=0)throw new Error(`Invalid condition: ${Ue}`);K.push(Ue)}B.push(`--conditions=${K.join(",")}`)}if(j)for(let K of j)B.push(`--external:${Pe(K,"external")}`);if(Z)for(let K in Z){if(K.indexOf("=")>=0)throw new Error(`Invalid package name in alias: ${K}`);B.push(`--alias:${K}=${Pe(Z[K],"alias",K)}`)}if(ue)for(let K in ue){if(K.indexOf("=")>=0)throw new Error(`Invalid banner file type: ${K}`);B.push(`--banner:${K}=${Pe(ue[K],"banner",K)}`)}if(oe)for(let K in oe){if(K.indexOf("=")>=0)throw new Error(`Invalid footer file type: ${K}`);B.push(`--footer:${K}=${Pe(oe[K],"footer",K)}`)}if(J)for(let K of J)B.push(`--inject:${Pe(K,"inject")}`);if(F)for(let K in F){if(K.indexOf("=")>=0)throw new Error(`Invalid loader extension: ${K}`);B.push(`--loader:${K}=${Pe(F[K],"loader",K)}`)}if(M)for(let K in M){if(K.indexOf("=")>=0)throw new Error(`Invalid out extension: ${K}`);B.push(`--out-extension:${K}=${Pe(M[K],"out extension",K)}`)}if(ne)if(Array.isArray(ne))for(let K=0,Ue=ne.length;K<Ue;K++){let Pt=ne[K];if(typeof Pt=="object"&&Pt!==null){let zt=Object.create(null),St=_(Pt,zt,"in",x),Rs=_(Pt,zt,"out",x);if(Ae(Pt,zt,"in entry point at index "+K),St===void 0)throw new Error('Missing property "in" for entry point at index '+K);if(Rs===void 0)throw new Error('Missing property "out" for entry point at index '+K);G.push([Rs,St])}else G.push(["",Pe(Pt,"entry point at index "+K)])}else for(let K in ne)G.push([K,Pe(ne[K],"entry point",K)]);if(pe){let K=Object.create(null),Ue=_(pe,K,"contents",Os),Pt=_(pe,K,"resolveDir",x),zt=_(pe,K,"sourcefile",x),St=_(pe,K,"loader",x);Ae(pe,K,'in "stdin" object'),zt&&B.push(`--sourcefile=${zt}`),St&&B.push(`--loader=${St}`),Pt&&(he=Pt),typeof Ue=="string"?de=k(Ue):Ue instanceof Uint8Array&&(de=Ue)}let Xi=[];if(I)for(let K of I)K+="",Xi.push(K);return{entries:G,flags:B,write:_e,stdinContents:de,stdinResolveDir:he,absWorkingDir:Le,nodePaths:Xi,mangleCache:Ce(Ve)}}function In(h,v,y,P){let N=[],$=Object.create(null);nt(N,v,$,y,P),As(N,v,$);let B=_(v,$,"sourcemap",gt),G=_(v,$,"sourcefile",x),T=_(v,$,"loader",x),de=_(v,$,"banner",x),he=_(v,$,"footer",x),ie=_(v,$,"mangleCache",xe);return Ae(v,$,`in ${h}() call`),B&&N.push(`--sourcemap=${B===!0?"external":B}`),G&&N.push(`--sourcefile=${G}`),T&&N.push(`--loader=${T}`),de&&N.push(`--banner=${de}`),he&&N.push(`--footer=${he}`),{flags:N,mangleCache:Ce(ie)}}function Cd(h){const v={},y={didClose:!1,reason:""};let P={},N=0,$=0,B=new Uint8Array(16*1024),G=0,T=X=>{let z=G+X.length;if(z>B.length){let b=new Uint8Array(z*2);b.set(B),B=b}B.set(X,G),G+=X.length;let I=0;for(;I+4<=G;){let b=C(B,I);if(I+4+b>G)break;I+=4,ge(B.subarray(I,I+b)),I+=b}I>0&&(B.copyWithin(0,I,G),G-=I)},de=X=>{y.didClose=!0,X&&(y.reason=": "+(X.message||X));const z="The service was stopped"+y.reason;for(let I in P)P[I](z,null);P={}},he=(X,z,I)=>{if(y.didClose)return I("The service is no longer running"+y.reason,null);let b=N++;P[b]=(L,j)=>{try{I(L,j)}finally{X&&X.unref()}},X&&X.ref(),h.writeToStdin(m({id:b,isRequest:!0,value:z}))},ie=(X,z)=>{if(y.didClose)throw new Error("The service is no longer running"+y.reason);h.writeToStdin(m({id:X,isRequest:!1,value:z}))},ke=(X,z)=>l(this,null,function*(){try{if(z.command==="ping"){ie(X,{});return}if(typeof z.key=="number"){const I=v[z.key];if(!I)return;const b=I[z.command];if(b){yield b(X,z);return}}throw new Error("Invalid command: "+z.command)}catch(I){const b=[_i(I,h,null,void 0,"")];try{ie(X,{errors:b})}catch{}}}),ce=!0,ge=X=>{if(ce){ce=!1;let I=String.fromCharCode(...X);if(I!=="0.24.2")throw new Error(`Cannot start service: Host version "0.24.2" does not match binary version ${A(I)}`);return}let z=g(X);if(z.isRequest)ke(z.id,z.value);else{let I=P[z.id];delete P[z.id],z.value.error?I(z.value.error,{}):I(null,z.value)}};return{readFromStdout:T,afterClose:de,service:{buildOrContext:({callName:X,refs:z,options:I,isTTY:b,defaultWD:L,callback:j})=>{let V=0;const Z=$++,F={},M={ref(){++V===1&&z&&z.ref()},unref(){--V===0&&(delete v[Z],z&&z.unref())}};v[Z]=F,M.ref(),Ld(X,Z,he,ie,M,h,F,I,b,L,(f,S)=>{try{j(f,S)}finally{M.unref()}})},transform:({callName:X,refs:z,input:I,options:b,isTTY:L,fs:j,callback:V})=>{const Z=Io();let F=M=>{try{if(typeof I!="string"&&!(I instanceof Uint8Array))throw new Error('The input to "transform" must be a string or a Uint8Array');let{flags:f,mangleCache:S}=In(X,b,L,re),W={command:"transform",flags:f,inputFS:M!==null,input:M!==null?k(M):typeof I=="string"?k(I):I};S&&(W.mangleCache=S),he(z,W,(H,J)=>{if(H)return V(new Error(H),null);let ue=Gi(J.errors,Z),oe=Gi(J.warnings,Z),ne=1,Le=()=>{if(--ne===0){let pe={warnings:oe,code:J.code,map:J.map,mangleCache:void 0,legalComments:void 0};"legalComments"in J&&(pe.legalComments=J?.legalComments),J.mangleCache&&(pe.mangleCache=J?.mangleCache),V(null,pe)}};if(ue.length>0)return V(Ds("Transform failed",ue,oe),null);J.codeFS&&(ne++,j.readFile(J.code,(pe,_e)=>{pe!==null?V(pe,null):(J.code=_e,Le())})),J.mapFS&&(ne++,j.readFile(J.map,(pe,_e)=>{pe!==null?V(pe,null):(J.map=_e,Le())})),Le()})}catch(f){let S=[];try{nt(S,b,{},L,re)}catch{}const W=_i(f,h,Z,void 0,"");he(z,{command:"error",flags:S,error:W},()=>{W.detail=Z.load(W.detail),V(Ds("Transform failed",[W],[]),null)})}};if((typeof I=="string"||I instanceof Uint8Array)&&I.length>1024*1024){let M=F;F=()=>j.writeFile(I,M)}F(null)},formatMessages:({callName:X,refs:z,messages:I,options:b,callback:L})=>{if(!b)throw new Error(`Missing second argument in ${X}() call`);let j={},V=_(b,j,"kind",x),Z=_(b,j,"color",O),F=_(b,j,"terminalWidth",se);if(Ae(b,j,`in ${X}() call`),V===void 0)throw new Error(`Missing "kind" in ${X}() call`);if(V!=="error"&&V!=="warning")throw new Error(`Expected "kind" to be "error" or "warning" in ${X}() call`);let M={command:"format-msgs",messages:ii(I,"messages",null,"",F),isWarning:V==="warning"};Z!==void 0&&(M.color=Z),F!==void 0&&(M.terminalWidth=F),he(z,M,(f,S)=>{if(f)return L(new Error(f),null);L(null,S.messages)})},analyzeMetafile:({callName:X,refs:z,metafile:I,options:b,callback:L})=>{b===void 0&&(b={});let j={},V=_(b,j,"color",O),Z=_(b,j,"verbose",O);Ae(b,j,`in ${X}() call`);let F={command:"analyze-metafile",metafile:I};V!==void 0&&(F.color=V),Z!==void 0&&(F.verbose=Z),he(z,F,(M,f)=>{if(M)return L(new Error(M),null);L(null,f.result)})}}}}function Ld(h,v,y,P,N,$,B,G,T,de,he){const ie=Io(),ke=h==="context",ce=(ee,We)=>{const Q=[];try{nt(Q,G,{},T,R)}catch{}const X=_i(ee,$,ie,void 0,We);y(N,{command:"error",flags:Q,error:X},()=>{X.detail=ie.load(X.detail),he(Ds(ke?"Context failed":"Build failed",[X],[]),null)})};let ge;if(typeof G=="object"){const ee=G.plugins;if(ee!==void 0){if(!Array.isArray(ee))return ce(new Error('"plugins" must be an array'),"");ge=ee}}if(ge&&ge.length>0){if($.isSync)return ce(new Error("Cannot use plugins in synchronous API calls"),"");Fd(v,y,P,N,$,B,G,ge,ie).then(ee=>{if(!ee.ok)return ce(ee.error,ee.pluginName);try{ve(ee.requestPlugins,ee.runOnEndCallbacks,ee.scheduleOnDisposeCallbacks)}catch(We){ce(We,"")}},ee=>ce(ee,""));return}try{ve(null,(ee,We)=>We([],[]),()=>{})}catch(ee){ce(ee,"")}function ve(ee,We,Q){const X=$.hasFS,{entries:z,flags:I,write:b,stdinContents:L,stdinResolveDir:j,absWorkingDir:V,nodePaths:Z,mangleCache:F}=Lt(h,G,T,R,X);if(b&&!$.hasFS)throw new Error('The "write" option is unavailable in this environment');const M={command:"build",key:v,entries:z,flags:I,write:b,stdinContents:L,stdinResolveDir:j,absWorkingDir:V||de,nodePaths:Z,context:ke};ee&&(M.plugins=ee),F&&(M.mangleCache=F);const f=(H,J)=>{const ue={errors:Gi(H.errors,ie),warnings:Gi(H.warnings,ie),outputFiles:void 0,metafile:void 0,mangleCache:void 0},oe=ue.errors.slice(),ne=ue.warnings.slice();H.outputFiles&&(ue.outputFiles=H.outputFiles.map(Td)),H.metafile&&(ue.metafile=JSON.parse(H.metafile)),H.mangleCache&&(ue.mangleCache=H.mangleCache),H.writeToStdout!==void 0&&console.log(D(H.writeToStdout).replace(/\n$/,"")),We(ue,(Le,pe)=>{if(oe.length>0||Le.length>0){const _e=Ds("Build failed",oe.concat(Le),ne.concat(pe));return J(_e,null,Le,pe)}J(null,ue,Le,pe)})};let S,W;ke&&(B["on-end"]=(H,J)=>new Promise(ue=>{f(J,(oe,ne,Le,pe)=>{const _e={errors:Le,warnings:pe};W&&W(oe,ne),S=void 0,W=void 0,P(H,_e),ue()})})),y(N,M,(H,J)=>{if(H)return he(new Error(H),null);if(!ke)return f(J,(ne,Le)=>(Q(),he(ne,Le)));if(J.errors.length>0)return he(Ds("Context failed",J.errors,J.warnings),null);let ue=!1;const oe={rebuild:()=>(S||(S=new Promise((ne,Le)=>{let pe;W=(Ft,Ve)=>{pe||(pe=()=>Ft?Le(Ft):ne(Ve))};const _e=()=>{y(N,{command:"rebuild",key:v},(Ve,Xi)=>{Ve?Le(new Error(Ve)):pe?pe():_e()})};_e()})),S),watch:(ne={})=>new Promise((Le,pe)=>{if(!$.hasFS)throw new Error('Cannot use the "watch" API in this environment');Ae(ne,{},"in watch() call"),y(N,{command:"watch",key:v},Ve=>{Ve?pe(new Error(Ve)):Le(void 0)})}),serve:(ne={})=>new Promise((Le,pe)=>{if(!$.hasFS)throw new Error('Cannot use the "serve" API in this environment');const _e={},Ft=_(ne,_e,"port",se),Ve=_(ne,_e,"host",x),Xi=_(ne,_e,"servedir",x),K=_(ne,_e,"keyfile",x),Ue=_(ne,_e,"certfile",x),Pt=_(ne,_e,"fallback",x),zt=_(ne,_e,"onRequest",st);Ae(ne,_e,"in serve() call");const St={command:"serve",key:v,onRequest:!!zt};Ft!==void 0&&(St.port=Ft),Ve!==void 0&&(St.host=Ve),Xi!==void 0&&(St.servedir=Xi),K!==void 0&&(St.keyfile=K),Ue!==void 0&&(St.certfile=Ue),Pt!==void 0&&(St.fallback=Pt),y(N,St,(Rs,Hd)=>{if(Rs)return pe(new Error(Rs));zt&&(B["serve-request"]=(Vd,Yd)=>{zt(Yd.args),P(Vd,{})}),Le(Hd)})}),cancel:()=>new Promise(ne=>{if(ue)return ne();y(N,{command:"cancel",key:v},()=>{ne()})}),dispose:()=>new Promise(ne=>{if(ue)return ne();ue=!0,y(N,{command:"dispose",key:v},()=>{ne(),Q(),N.unref()})})};N.ref(),he(null,oe)})}}var Fd=(h,v,y,P,N,$,B,G,T)=>l(void 0,null,function*(){let de=[],he=[],ie={},ke={},ce=[],ge=0,ve=0,ee=[],We=!1;G=[...G];for(let z of G){let I={};if(typeof z!="object")throw new Error(`Plugin at index ${ve} must be an object`);const b=_(z,I,"name",x);if(typeof b!="string"||b==="")throw new Error(`Plugin at index ${ve} is missing a name`);try{let L=_(z,I,"setup",st);if(typeof L!="function")throw new Error("Plugin is missing a setup function");Ae(z,I,`on plugin ${A(b)}`);let j={name:b,onStart:!1,onEnd:!1,onResolve:[],onLoad:[]};ve++;let Z=L({initialOptions:B,resolve:(F,M={})=>{if(!We)throw new Error('Cannot call "resolve" before plugin setup has completed');if(typeof F!="string")throw new Error("The path to resolve must be a string");let f=Object.create(null),S=_(M,f,"pluginName",x),W=_(M,f,"importer",x),H=_(M,f,"namespace",x),J=_(M,f,"resolveDir",x),ue=_(M,f,"kind",x),oe=_(M,f,"pluginData",Y),ne=_(M,f,"with",xe);return Ae(M,f,"in resolve() call"),new Promise((Le,pe)=>{const _e={command:"resolve",path:F,key:h,pluginName:b};if(S!=null&&(_e.pluginName=S),W!=null&&(_e.importer=W),H!=null&&(_e.namespace=H),J!=null&&(_e.resolveDir=J),ue!=null)_e.kind=ue;else throw new Error('Must specify "kind" when calling "resolve"');oe!=null&&(_e.pluginData=T.store(oe)),ne!=null&&(_e.with=Pd(ne,"with")),v(P,_e,(Ft,Ve)=>{Ft!==null?pe(new Error(Ft)):Le({errors:Gi(Ve.errors,T),warnings:Gi(Ve.warnings,T),path:Ve.path,external:Ve.external,sideEffects:Ve.sideEffects,namespace:Ve.namespace,suffix:Ve.suffix,pluginData:T.load(Ve.pluginData)})})})},onStart(F){let M='This error came from the "onStart" callback registered here:',f=On(new Error(M),N,"onStart");de.push({name:b,callback:F,note:f}),j.onStart=!0},onEnd(F){let M='This error came from the "onEnd" callback registered here:',f=On(new Error(M),N,"onEnd");he.push({name:b,callback:F,note:f}),j.onEnd=!0},onResolve(F,M){let f='This error came from the "onResolve" callback registered here:',S=On(new Error(f),N,"onResolve"),W={},H=_(F,W,"filter",te),J=_(F,W,"namespace",x);if(Ae(F,W,`in onResolve() call for plugin ${A(b)}`),H==null)throw new Error("onResolve() call is missing a filter");let ue=ge++;ie[ue]={name:b,callback:M,note:S},j.onResolve.push({id:ue,filter:H.source,namespace:J||""})},onLoad(F,M){let f='This error came from the "onLoad" callback registered here:',S=On(new Error(f),N,"onLoad"),W={},H=_(F,W,"filter",te),J=_(F,W,"namespace",x);if(Ae(F,W,`in onLoad() call for plugin ${A(b)}`),H==null)throw new Error("onLoad() call is missing a filter");let ue=ge++;ke[ue]={name:b,callback:M,note:S},j.onLoad.push({id:ue,filter:H.source,namespace:J||""})},onDispose(F){ce.push(F)},esbuild:N.esbuild});Z&&(yield Z),ee.push(j)}catch(L){return{ok:!1,error:L,pluginName:b}}}$["on-start"]=(z,I)=>l(void 0,null,function*(){T.clear();let b={errors:[],warnings:[]};yield Promise.all(de.map(L=>l(void 0,[L],function*({name:j,callback:V,note:Z}){try{let F=yield V();if(F!=null){if(typeof F!="object")throw new Error(`Expected onStart() callback in plugin ${A(j)} to return an object`);let M={},f=_(F,M,"errors",fe),S=_(F,M,"warnings",fe);Ae(F,M,`from onStart() callback in plugin ${A(j)}`),f!=null&&b.errors.push(...ii(f,"errors",T,j,void 0)),S!=null&&b.warnings.push(...ii(S,"warnings",T,j,void 0))}}catch(F){b.errors.push(_i(F,N,T,Z&&Z(),j))}}))),y(z,b)}),$["on-resolve"]=(z,I)=>l(void 0,null,function*(){let b={},L="",j,V;for(let Z of I.ids)try{({name:L,callback:j,note:V}=ie[Z]);let F=yield j({path:I.path,importer:I.importer,namespace:I.namespace,resolveDir:I.resolveDir,kind:I.kind,pluginData:T.load(I.pluginData),with:I.with});if(F!=null){if(typeof F!="object")throw new Error(`Expected onResolve() callback in plugin ${A(L)} to return an object`);let M={},f=_(F,M,"pluginName",x),S=_(F,M,"path",x),W=_(F,M,"namespace",x),H=_(F,M,"suffix",x),J=_(F,M,"external",O),ue=_(F,M,"sideEffects",O),oe=_(F,M,"pluginData",Y),ne=_(F,M,"errors",fe),Le=_(F,M,"warnings",fe),pe=_(F,M,"watchFiles",fe),_e=_(F,M,"watchDirs",fe);Ae(F,M,`from onResolve() callback in plugin ${A(L)}`),b.id=Z,f!=null&&(b.pluginName=f),S!=null&&(b.path=S),W!=null&&(b.namespace=W),H!=null&&(b.suffix=H),J!=null&&(b.external=J),ue!=null&&(b.sideEffects=ue),oe!=null&&(b.pluginData=T.store(oe)),ne!=null&&(b.errors=ii(ne,"errors",T,L,void 0)),Le!=null&&(b.warnings=ii(Le,"warnings",T,L,void 0)),pe!=null&&(b.watchFiles=An(pe,"watchFiles")),_e!=null&&(b.watchDirs=An(_e,"watchDirs"));break}}catch(F){b={id:Z,errors:[_i(F,N,T,V&&V(),L)]};break}y(z,b)}),$["on-load"]=(z,I)=>l(void 0,null,function*(){let b={},L="",j,V;for(let Z of I.ids)try{({name:L,callback:j,note:V}=ke[Z]);let F=yield j({path:I.path,namespace:I.namespace,suffix:I.suffix,pluginData:T.load(I.pluginData),with:I.with});if(F!=null){if(typeof F!="object")throw new Error(`Expected onLoad() callback in plugin ${A(L)} to return an object`);let M={},f=_(F,M,"pluginName",x),S=_(F,M,"contents",Os),W=_(F,M,"resolveDir",x),H=_(F,M,"pluginData",Y),J=_(F,M,"loader",x),ue=_(F,M,"errors",fe),oe=_(F,M,"warnings",fe),ne=_(F,M,"watchFiles",fe),Le=_(F,M,"watchDirs",fe);Ae(F,M,`from onLoad() callback in plugin ${A(L)}`),b.id=Z,f!=null&&(b.pluginName=f),S instanceof Uint8Array?b.contents=S:S!=null&&(b.contents=k(S)),W!=null&&(b.resolveDir=W),H!=null&&(b.pluginData=T.store(H)),J!=null&&(b.loader=J),ue!=null&&(b.errors=ii(ue,"errors",T,L,void 0)),oe!=null&&(b.warnings=ii(oe,"warnings",T,L,void 0)),ne!=null&&(b.watchFiles=An(ne,"watchFiles")),Le!=null&&(b.watchDirs=An(Le,"watchDirs"));break}}catch(F){b={id:Z,errors:[_i(F,N,T,V&&V(),L)]};break}y(z,b)});let Q=(z,I)=>I([],[]);he.length>0&&(Q=(z,I)=>{l(void 0,null,function*(){const b=[],L=[];for(const{name:j,callback:V,note:Z}of he){let F,M;try{const f=yield V(z);if(f!=null){if(typeof f!="object")throw new Error(`Expected onEnd() callback in plugin ${A(j)} to return an object`);let S={},W=_(f,S,"errors",fe),H=_(f,S,"warnings",fe);Ae(f,S,`from onEnd() callback in plugin ${A(j)}`),W!=null&&(F=ii(W,"errors",T,j,void 0)),H!=null&&(M=ii(H,"warnings",T,j,void 0))}}catch(f){F=[_i(f,N,T,Z&&Z(),j)]}if(F){b.push(...F);try{z.errors.push(...F)}catch{}}if(M){L.push(...M);try{z.warnings.push(...M)}catch{}}}I(b,L)})});let X=()=>{for(const z of ce)setTimeout(()=>z(),0)};return We=!0,{ok:!0,requestPlugins:ee,runOnEndCallbacks:Q,scheduleOnDisposeCallbacks:X}});function Io(){const h=new Map;let v=0;return{clear(){h.clear()},load(y){return h.get(y)},store(y){if(y===void 0)return-1;const P=v++;return h.set(P,y),P}}}function On(h,v,y){let P,N=!1;return()=>{if(N)return P;N=!0;try{let $=(h.stack+"").split(`
`);$.splice(1,1);let B=Oo(v,$,y);if(B)return P={text:h.message,location:B},P}catch{}}}function _i(h,v,y,P,N){let $="Internal error",B=null;try{$=(h&&h.message||h)+""}catch{}try{B=Oo(v,(h.stack+"").split(`
`),"")}catch{}return{id:"",pluginName:N,text:$,location:B,notes:P?[P]:[],detail:y?y.store(h):-1}}function Oo(h,v,y){let P="    at ";if(h.readFileSync&&!v[0].startsWith(P)&&v[1].startsWith(P))for(let N=1;N<v.length;N++){let $=v[N];if($.startsWith(P))for($=$.slice(P.length);;){let B=/^(?:new |async )?\S+ \((.*)\)$/.exec($);if(B){$=B[1];continue}if(B=/^eval at \S+ \((.*)\)(?:, \S+:\d+:\d+)?$/.exec($),B){$=B[1];continue}if(B=/^(\S+):(\d+):(\d+)$/.exec($),B){let G;try{G=h.readFileSync(B[1],"utf8")}catch{break}let T=G.split(/\r\n|\r|\n|\u2028|\u2029/)[+B[2]-1]||"",de=+B[3]-1,he=T.slice(de,de+y.length)===y?y.length:0;return{file:B[1],namespace:"file",line:+B[2],column:k(T.slice(0,de)).length,length:k(T.slice(de,de+he)).length,lineText:T+`
`+v.slice(1).join(`
`),suggestion:""}}break}}return null}function Ds(h,v,y){let P=5;h+=v.length<1?"":` with ${v.length} error${v.length<2?"":"s"}:`+v.slice(0,P+1).map(($,B)=>{if(B===P)return`
...`;if(!$.location)return`
error: ${$.text}`;let{file:G,line:T,column:de}=$.location,he=$.pluginName?`[plugin: ${$.pluginName}] `:"";return`
${G}:${T}:${de}: ERROR: ${he}${$.text}`}).join("");let N=new Error(h);for(const[$,B]of[["errors",v],["warnings",y]])Object.defineProperty(N,$,{configurable:!0,enumerable:!0,get:()=>B,set:G=>Object.defineProperty(N,$,{configurable:!0,enumerable:!0,value:G})});return N}function Gi(h,v){for(const y of h)y.detail=v.load(y.detail);return h}function Ao(h,v,y){if(h==null)return null;let P={},N=_(h,P,"file",x),$=_(h,P,"namespace",x),B=_(h,P,"line",se),G=_(h,P,"column",se),T=_(h,P,"length",se),de=_(h,P,"lineText",x),he=_(h,P,"suggestion",x);if(Ae(h,P,v),de){const ie=de.slice(0,(G&&G>0?G:0)+(T&&T>0?T:0)+(y&&y>0?y:80));!/[\x7F-\uFFFF]/.test(ie)&&!/\n/.test(de)&&(de=ie)}return{file:N||"",namespace:$||"",line:B||0,column:G||0,length:T||0,lineText:de||"",suggestion:he||""}}function ii(h,v,y,P,N){let $=[],B=0;for(const G of h){let T={},de=_(G,T,"id",x),he=_(G,T,"pluginName",x),ie=_(G,T,"text",x),ke=_(G,T,"location",Me),ce=_(G,T,"notes",fe),ge=_(G,T,"detail",Y),ve=`in element ${B} of "${v}"`;Ae(G,T,ve);let ee=[];if(ce)for(const We of ce){let Q={},X=_(We,Q,"text",x),z=_(We,Q,"location",Me);Ae(We,Q,ve),ee.push({text:X||"",location:Ao(z,ve,N)})}$.push({id:de||"",pluginName:he||P,text:ie||"",location:Ao(ke,ve,N),notes:ee,detail:y?y.store(ge):-1}),B++}return $}function An(h,v){const y=[];for(const P of h){if(typeof P!="string")throw new Error(`${A(v)} must be an array of strings`);y.push(P)}return y}function Pd(h,v){const y=Object.create(null);for(const P in h){const N=h[P];if(typeof N!="string")throw new Error(`key ${A(P)} in object ${A(v)} must be a string`);y[P]=N}return y}function Td({path:h,contents:v,hash:y}){let P=null;return{path:h,contents:v,hash:y,get text(){const N=this.contents;return(P===null||N!==v)&&(v=N,P=D(N)),P}}}var Id="0.24.2",Od=h=>js().build(h),Ad=h=>js().context(h),Dd=(h,v)=>js().transform(h,v),jd=(h,v)=>js().formatMessages(h,v),Rd=(h,v)=>js().analyzeMetafile(h,v),Bd=()=>{throw new Error('The "buildSync" API only works in node')},Md=()=>{throw new Error('The "transformSync" API only works in node')},Ud=()=>{throw new Error('The "formatMessagesSync" API only works in node')},Nd=()=>{throw new Error('The "analyzeMetafileSync" API only works in node')},zd=()=>(Dn&&Dn(),Promise.resolve()),xi,Dn,jn,js=()=>{if(jn)return jn;throw xi?new Error('You need to wait for the promise returned from "initialize" to be resolved before calling this'):new Error('You need to call "initialize" before calling this')},$d=h=>{h=ht(h||{});let v=h.wasmURL,y=h.wasmModule,P=h.worker!==!1;if(!v&&!y)throw new Error('Must provide either the "wasmURL" option or the "wasmModule" option');if(xi)throw new Error('Cannot call "initialize" more than once');return xi=qd(v||"",y,P),xi.catch(()=>{xi=void 0}),xi},qd=(h,v,y)=>l(void 0,null,function*(){let P,N;const $=new Promise(ie=>N=ie);if(y){let ie=new Blob([`onmessage=((postMessage) => {
      // Copyright 2018 The Go Authors. All rights reserved.
      // Use of this source code is governed by a BSD-style
      // license that can be found in the LICENSE file.
      var __async = (__this, __arguments, generator) => {
        return new Promise((resolve, reject) => {
          var fulfilled = (value) => {
            try {
              step(generator.next(value));
            } catch (e) {
              reject(e);
            }
          };
          var rejected = (value) => {
            try {
              step(generator.throw(value));
            } catch (e) {
              reject(e);
            }
          };
          var step = (x) => x.done ? resolve(x.value) : Promise.resolve(x.value).then(fulfilled, rejected);
          step((generator = generator.apply(__this, __arguments)).next());
        });
      };
      let onmessage;
      let globalThis = {};
      for (let o = self; o; o = Object.getPrototypeOf(o))
        for (let k of Object.getOwnPropertyNames(o))
          if (!(k in globalThis))
            Object.defineProperty(globalThis, k, { get: () => self[k] });
      "use strict";
      (() => {
        const enosys = () => {
          const err = new Error("not implemented");
          err.code = "ENOSYS";
          return err;
        };
        if (!globalThis.fs) {
          let outputBuf = "";
          globalThis.fs = {
            constants: { O_WRONLY: -1, O_RDWR: -1, O_CREAT: -1, O_TRUNC: -1, O_APPEND: -1, O_EXCL: -1 },
            // unused
            writeSync(fd, buf) {
              outputBuf += decoder.decode(buf);
              const nl = outputBuf.lastIndexOf("\\n");
              if (nl != -1) {
                console.log(outputBuf.substring(0, nl));
                outputBuf = outputBuf.substring(nl + 1);
              }
              return buf.length;
            },
            write(fd, buf, offset, length, position, callback) {
              if (offset !== 0 || length !== buf.length || position !== null) {
                callback(enosys());
                return;
              }
              const n = this.writeSync(fd, buf);
              callback(null, n);
            },
            chmod(path, mode, callback) {
              callback(enosys());
            },
            chown(path, uid, gid, callback) {
              callback(enosys());
            },
            close(fd, callback) {
              callback(enosys());
            },
            fchmod(fd, mode, callback) {
              callback(enosys());
            },
            fchown(fd, uid, gid, callback) {
              callback(enosys());
            },
            fstat(fd, callback) {
              callback(enosys());
            },
            fsync(fd, callback) {
              callback(null);
            },
            ftruncate(fd, length, callback) {
              callback(enosys());
            },
            lchown(path, uid, gid, callback) {
              callback(enosys());
            },
            link(path, link, callback) {
              callback(enosys());
            },
            lstat(path, callback) {
              callback(enosys());
            },
            mkdir(path, perm, callback) {
              callback(enosys());
            },
            open(path, flags, mode, callback) {
              callback(enosys());
            },
            read(fd, buffer, offset, length, position, callback) {
              callback(enosys());
            },
            readdir(path, callback) {
              callback(enosys());
            },
            readlink(path, callback) {
              callback(enosys());
            },
            rename(from, to, callback) {
              callback(enosys());
            },
            rmdir(path, callback) {
              callback(enosys());
            },
            stat(path, callback) {
              callback(enosys());
            },
            symlink(path, link, callback) {
              callback(enosys());
            },
            truncate(path, length, callback) {
              callback(enosys());
            },
            unlink(path, callback) {
              callback(enosys());
            },
            utimes(path, atime, mtime, callback) {
              callback(enosys());
            }
          };
        }
        if (!globalThis.process) {
          globalThis.process = {
            getuid() {
              return -1;
            },
            getgid() {
              return -1;
            },
            geteuid() {
              return -1;
            },
            getegid() {
              return -1;
            },
            getgroups() {
              throw enosys();
            },
            pid: -1,
            ppid: -1,
            umask() {
              throw enosys();
            },
            cwd() {
              throw enosys();
            },
            chdir() {
              throw enosys();
            }
          };
        }
        if (!globalThis.crypto) {
          throw new Error("globalThis.crypto is not available, polyfill required (crypto.getRandomValues only)");
        }
        if (!globalThis.performance) {
          throw new Error("globalThis.performance is not available, polyfill required (performance.now only)");
        }
        if (!globalThis.TextEncoder) {
          throw new Error("globalThis.TextEncoder is not available, polyfill required");
        }
        if (!globalThis.TextDecoder) {
          throw new Error("globalThis.TextDecoder is not available, polyfill required");
        }
        const encoder = new TextEncoder("utf-8");
        const decoder = new TextDecoder("utf-8");
        globalThis.Go = class {
          constructor() {
            this.argv = ["js"];
            this.env = {};
            this.exit = (code) => {
              if (code !== 0) {
                console.warn("exit code:", code);
              }
            };
            this._exitPromise = new Promise((resolve) => {
              this._resolveExitPromise = resolve;
            });
            this._pendingEvent = null;
            this._scheduledTimeouts = /* @__PURE__ */ new Map();
            this._nextCallbackTimeoutID = 1;
            const setInt64 = (addr, v) => {
              this.mem.setUint32(addr + 0, v, true);
              this.mem.setUint32(addr + 4, Math.floor(v / 4294967296), true);
            };
            const setInt32 = (addr, v) => {
              this.mem.setUint32(addr + 0, v, true);
            };
            const getInt64 = (addr) => {
              const low = this.mem.getUint32(addr + 0, true);
              const high = this.mem.getInt32(addr + 4, true);
              return low + high * 4294967296;
            };
            const loadValue = (addr) => {
              const f = this.mem.getFloat64(addr, true);
              if (f === 0) {
                return void 0;
              }
              if (!isNaN(f)) {
                return f;
              }
              const id = this.mem.getUint32(addr, true);
              return this._values[id];
            };
            const storeValue = (addr, v) => {
              const nanHead = 2146959360;
              if (typeof v === "number" && v !== 0) {
                if (isNaN(v)) {
                  this.mem.setUint32(addr + 4, nanHead, true);
                  this.mem.setUint32(addr, 0, true);
                  return;
                }
                this.mem.setFloat64(addr, v, true);
                return;
              }
              if (v === void 0) {
                this.mem.setFloat64(addr, 0, true);
                return;
              }
              let id = this._ids.get(v);
              if (id === void 0) {
                id = this._idPool.pop();
                if (id === void 0) {
                  id = this._values.length;
                }
                this._values[id] = v;
                this._goRefCounts[id] = 0;
                this._ids.set(v, id);
              }
              this._goRefCounts[id]++;
              let typeFlag = 0;
              switch (typeof v) {
                case "object":
                  if (v !== null) {
                    typeFlag = 1;
                  }
                  break;
                case "string":
                  typeFlag = 2;
                  break;
                case "symbol":
                  typeFlag = 3;
                  break;
                case "function":
                  typeFlag = 4;
                  break;
              }
              this.mem.setUint32(addr + 4, nanHead | typeFlag, true);
              this.mem.setUint32(addr, id, true);
            };
            const loadSlice = (addr) => {
              const array = getInt64(addr + 0);
              const len = getInt64(addr + 8);
              return new Uint8Array(this._inst.exports.mem.buffer, array, len);
            };
            const loadSliceOfValues = (addr) => {
              const array = getInt64(addr + 0);
              const len = getInt64(addr + 8);
              const a = new Array(len);
              for (let i = 0; i < len; i++) {
                a[i] = loadValue(array + i * 8);
              }
              return a;
            };
            const loadString = (addr) => {
              const saddr = getInt64(addr + 0);
              const len = getInt64(addr + 8);
              return decoder.decode(new DataView(this._inst.exports.mem.buffer, saddr, len));
            };
            const timeOrigin = Date.now() - performance.now();
            this.importObject = {
              _gotest: {
                add: (a, b) => a + b
              },
              gojs: {
                // Go's SP does not change as long as no Go code is running. Some operations (e.g. calls, getters and setters)
                // may synchronously trigger a Go event handler. This makes Go code get executed in the middle of the imported
                // function. A goroutine can switch to a new stack if the current stack is too small (see morestack function).
                // This changes the SP, thus we have to update the SP used by the imported function.
                // func wasmExit(code int32)
                "runtime.wasmExit": (sp) => {
                  sp >>>= 0;
                  const code = this.mem.getInt32(sp + 8, true);
                  this.exited = true;
                  delete this._inst;
                  delete this._values;
                  delete this._goRefCounts;
                  delete this._ids;
                  delete this._idPool;
                  this.exit(code);
                },
                // func wasmWrite(fd uintptr, p unsafe.Pointer, n int32)
                "runtime.wasmWrite": (sp) => {
                  sp >>>= 0;
                  const fd = getInt64(sp + 8);
                  const p = getInt64(sp + 16);
                  const n = this.mem.getInt32(sp + 24, true);
                  globalThis.fs.writeSync(fd, new Uint8Array(this._inst.exports.mem.buffer, p, n));
                },
                // func resetMemoryDataView()
                "runtime.resetMemoryDataView": (sp) => {
                  sp >>>= 0;
                  this.mem = new DataView(this._inst.exports.mem.buffer);
                },
                // func nanotime1() int64
                "runtime.nanotime1": (sp) => {
                  sp >>>= 0;
                  setInt64(sp + 8, (timeOrigin + performance.now()) * 1e6);
                },
                // func walltime() (sec int64, nsec int32)
                "runtime.walltime": (sp) => {
                  sp >>>= 0;
                  const msec = (/* @__PURE__ */ new Date()).getTime();
                  setInt64(sp + 8, msec / 1e3);
                  this.mem.setInt32(sp + 16, msec % 1e3 * 1e6, true);
                },
                // func scheduleTimeoutEvent(delay int64) int32
                "runtime.scheduleTimeoutEvent": (sp) => {
                  sp >>>= 0;
                  const id = this._nextCallbackTimeoutID;
                  this._nextCallbackTimeoutID++;
                  this._scheduledTimeouts.set(id, setTimeout(
                    () => {
                      this._resume();
                      while (this._scheduledTimeouts.has(id)) {
                        console.warn("scheduleTimeoutEvent: missed timeout event");
                        this._resume();
                      }
                    },
                    getInt64(sp + 8)
                  ));
                  this.mem.setInt32(sp + 16, id, true);
                },
                // func clearTimeoutEvent(id int32)
                "runtime.clearTimeoutEvent": (sp) => {
                  sp >>>= 0;
                  const id = this.mem.getInt32(sp + 8, true);
                  clearTimeout(this._scheduledTimeouts.get(id));
                  this._scheduledTimeouts.delete(id);
                },
                // func getRandomData(r []byte)
                "runtime.getRandomData": (sp) => {
                  sp >>>= 0;
                  crypto.getRandomValues(loadSlice(sp + 8));
                },
                // func finalizeRef(v ref)
                "syscall/js.finalizeRef": (sp) => {
                  sp >>>= 0;
                  const id = this.mem.getUint32(sp + 8, true);
                  this._goRefCounts[id]--;
                  if (this._goRefCounts[id] === 0) {
                    const v = this._values[id];
                    this._values[id] = null;
                    this._ids.delete(v);
                    this._idPool.push(id);
                  }
                },
                // func stringVal(value string) ref
                "syscall/js.stringVal": (sp) => {
                  sp >>>= 0;
                  storeValue(sp + 24, loadString(sp + 8));
                },
                // func valueGet(v ref, p string) ref
                "syscall/js.valueGet": (sp) => {
                  sp >>>= 0;
                  const result = Reflect.get(loadValue(sp + 8), loadString(sp + 16));
                  sp = this._inst.exports.getsp() >>> 0;
                  storeValue(sp + 32, result);
                },
                // func valueSet(v ref, p string, x ref)
                "syscall/js.valueSet": (sp) => {
                  sp >>>= 0;
                  Reflect.set(loadValue(sp + 8), loadString(sp + 16), loadValue(sp + 32));
                },
                // func valueDelete(v ref, p string)
                "syscall/js.valueDelete": (sp) => {
                  sp >>>= 0;
                  Reflect.deleteProperty(loadValue(sp + 8), loadString(sp + 16));
                },
                // func valueIndex(v ref, i int) ref
                "syscall/js.valueIndex": (sp) => {
                  sp >>>= 0;
                  storeValue(sp + 24, Reflect.get(loadValue(sp + 8), getInt64(sp + 16)));
                },
                // valueSetIndex(v ref, i int, x ref)
                "syscall/js.valueSetIndex": (sp) => {
                  sp >>>= 0;
                  Reflect.set(loadValue(sp + 8), getInt64(sp + 16), loadValue(sp + 24));
                },
                // func valueCall(v ref, m string, args []ref) (ref, bool)
                "syscall/js.valueCall": (sp) => {
                  sp >>>= 0;
                  try {
                    const v = loadValue(sp + 8);
                    const m = Reflect.get(v, loadString(sp + 16));
                    const args = loadSliceOfValues(sp + 32);
                    const result = Reflect.apply(m, v, args);
                    sp = this._inst.exports.getsp() >>> 0;
                    storeValue(sp + 56, result);
                    this.mem.setUint8(sp + 64, 1);
                  } catch (err) {
                    sp = this._inst.exports.getsp() >>> 0;
                    storeValue(sp + 56, err);
                    this.mem.setUint8(sp + 64, 0);
                  }
                },
                // func valueInvoke(v ref, args []ref) (ref, bool)
                "syscall/js.valueInvoke": (sp) => {
                  sp >>>= 0;
                  try {
                    const v = loadValue(sp + 8);
                    const args = loadSliceOfValues(sp + 16);
                    const result = Reflect.apply(v, void 0, args);
                    sp = this._inst.exports.getsp() >>> 0;
                    storeValue(sp + 40, result);
                    this.mem.setUint8(sp + 48, 1);
                  } catch (err) {
                    sp = this._inst.exports.getsp() >>> 0;
                    storeValue(sp + 40, err);
                    this.mem.setUint8(sp + 48, 0);
                  }
                },
                // func valueNew(v ref, args []ref) (ref, bool)
                "syscall/js.valueNew": (sp) => {
                  sp >>>= 0;
                  try {
                    const v = loadValue(sp + 8);
                    const args = loadSliceOfValues(sp + 16);
                    const result = Reflect.construct(v, args);
                    sp = this._inst.exports.getsp() >>> 0;
                    storeValue(sp + 40, result);
                    this.mem.setUint8(sp + 48, 1);
                  } catch (err) {
                    sp = this._inst.exports.getsp() >>> 0;
                    storeValue(sp + 40, err);
                    this.mem.setUint8(sp + 48, 0);
                  }
                },
                // func valueLength(v ref) int
                "syscall/js.valueLength": (sp) => {
                  sp >>>= 0;
                  setInt64(sp + 16, parseInt(loadValue(sp + 8).length));
                },
                // valuePrepareString(v ref) (ref, int)
                "syscall/js.valuePrepareString": (sp) => {
                  sp >>>= 0;
                  const str = encoder.encode(String(loadValue(sp + 8)));
                  storeValue(sp + 16, str);
                  setInt64(sp + 24, str.length);
                },
                // valueLoadString(v ref, b []byte)
                "syscall/js.valueLoadString": (sp) => {
                  sp >>>= 0;
                  const str = loadValue(sp + 8);
                  loadSlice(sp + 16).set(str);
                },
                // func valueInstanceOf(v ref, t ref) bool
                "syscall/js.valueInstanceOf": (sp) => {
                  sp >>>= 0;
                  this.mem.setUint8(sp + 24, loadValue(sp + 8) instanceof loadValue(sp + 16) ? 1 : 0);
                },
                // func copyBytesToGo(dst []byte, src ref) (int, bool)
                "syscall/js.copyBytesToGo": (sp) => {
                  sp >>>= 0;
                  const dst = loadSlice(sp + 8);
                  const src = loadValue(sp + 32);
                  if (!(src instanceof Uint8Array || src instanceof Uint8ClampedArray)) {
                    this.mem.setUint8(sp + 48, 0);
                    return;
                  }
                  const toCopy = src.subarray(0, dst.length);
                  dst.set(toCopy);
                  setInt64(sp + 40, toCopy.length);
                  this.mem.setUint8(sp + 48, 1);
                },
                // func copyBytesToJS(dst ref, src []byte) (int, bool)
                "syscall/js.copyBytesToJS": (sp) => {
                  sp >>>= 0;
                  const dst = loadValue(sp + 8);
                  const src = loadSlice(sp + 16);
                  if (!(dst instanceof Uint8Array || dst instanceof Uint8ClampedArray)) {
                    this.mem.setUint8(sp + 48, 0);
                    return;
                  }
                  const toCopy = src.subarray(0, dst.length);
                  dst.set(toCopy);
                  setInt64(sp + 40, toCopy.length);
                  this.mem.setUint8(sp + 48, 1);
                },
                "debug": (value) => {
                  console.log(value);
                }
              }
            };
          }
          run(instance) {
            return __async(this, null, function* () {
              if (!(instance instanceof WebAssembly.Instance)) {
                throw new Error("Go.run: WebAssembly.Instance expected");
              }
              this._inst = instance;
              this.mem = new DataView(this._inst.exports.mem.buffer);
              this._values = [
                // JS values that Go currently has references to, indexed by reference id
                NaN,
                0,
                null,
                true,
                false,
                globalThis,
                this
              ];
              this._goRefCounts = new Array(this._values.length).fill(Infinity);
              this._ids = /* @__PURE__ */ new Map([
                // mapping from JS values to reference ids
                [0, 1],
                [null, 2],
                [true, 3],
                [false, 4],
                [globalThis, 5],
                [this, 6]
              ]);
              this._idPool = [];
              this.exited = false;
              let offset = 4096;
              const strPtr = (str) => {
                const ptr = offset;
                const bytes = encoder.encode(str + "\\0");
                new Uint8Array(this.mem.buffer, offset, bytes.length).set(bytes);
                offset += bytes.length;
                if (offset % 8 !== 0) {
                  offset += 8 - offset % 8;
                }
                return ptr;
              };
              const argc = this.argv.length;
              const argvPtrs = [];
              this.argv.forEach((arg) => {
                argvPtrs.push(strPtr(arg));
              });
              argvPtrs.push(0);
              const keys = Object.keys(this.env).sort();
              keys.forEach((key) => {
                argvPtrs.push(strPtr(\`\${key}=\${this.env[key]}\`));
              });
              argvPtrs.push(0);
              const argv = offset;
              argvPtrs.forEach((ptr) => {
                this.mem.setUint32(offset, ptr, true);
                this.mem.setUint32(offset + 4, 0, true);
                offset += 8;
              });
              const wasmMinDataAddr = 4096 + 8192;
              if (offset >= wasmMinDataAddr) {
                throw new Error("total length of command line and environment variables exceeds limit");
              }
              this._inst.exports.run(argc, argv);
              if (this.exited) {
                this._resolveExitPromise();
              }
              yield this._exitPromise;
            });
          }
          _resume() {
            if (this.exited) {
              throw new Error("Go program has already exited");
            }
            this._inst.exports.resume();
            if (this.exited) {
              this._resolveExitPromise();
            }
          }
          _makeFuncWrapper(id) {
            const go = this;
            return function() {
              const event = { id, this: this, args: arguments };
              go._pendingEvent = event;
              go._resume();
              return event.result;
            };
          }
        };
      })();
      onmessage = ({ data: wasm }) => {
        let decoder = new TextDecoder();
        let fs = globalThis.fs;
        let stderr = "";
        fs.writeSync = (fd, buffer) => {
          if (fd === 1) {
            postMessage(buffer);
          } else if (fd === 2) {
            stderr += decoder.decode(buffer);
            let parts = stderr.split("\\n");
            if (parts.length > 1) console.log(parts.slice(0, -1).join("\\n"));
            stderr = parts[parts.length - 1];
          } else {
            throw new Error("Bad write");
          }
          return buffer.length;
        };
        let stdin = [];
        let resumeStdin;
        let stdinPos = 0;
        onmessage = ({ data }) => {
          if (data.length > 0) {
            stdin.push(data);
            if (resumeStdin) resumeStdin();
          }
          return go;
        };
        fs.read = (fd, buffer, offset, length, position, callback) => {
          if (fd !== 0 || offset !== 0 || length !== buffer.length || position !== null) {
            throw new Error("Bad read");
          }
          if (stdin.length === 0) {
            resumeStdin = () => fs.read(fd, buffer, offset, length, position, callback);
            return;
          }
          let first = stdin[0];
          let count = Math.max(0, Math.min(length, first.length - stdinPos));
          buffer.set(first.subarray(stdinPos, stdinPos + count), offset);
          stdinPos += count;
          if (stdinPos === first.length) {
            stdin.shift();
            stdinPos = 0;
          }
          callback(null, count);
        };
        let go = new globalThis.Go();
        go.argv = ["", \`--service=\${"0.24.2"}\`];
        tryToInstantiateModule(wasm, go).then(
          (instance) => {
            postMessage(null);
            go.run(instance);
          },
          (error) => {
            postMessage(error);
          }
        );
        return go;
      };
      function tryToInstantiateModule(wasm, go) {
        return __async(this, null, function* () {
          if (wasm instanceof WebAssembly.Module) {
            return WebAssembly.instantiate(wasm, go.importObject);
          }
          const res = yield fetch(wasm);
          if (!res.ok) throw new Error(\`Failed to download \${JSON.stringify(wasm)}\`);
          if ("instantiateStreaming" in WebAssembly && /^application\\/wasm($|;)/i.test(res.headers.get("Content-Type") || "")) {
            const result2 = yield WebAssembly.instantiateStreaming(res, go.importObject);
            return result2.instance;
          }
          const bytes = yield res.arrayBuffer();
          const result = yield WebAssembly.instantiate(bytes, go.importObject);
          return result.instance;
        });
      }
      return (m) => onmessage(m);
    })(postMessage)`],{type:"text/javascript"});P=new Worker(URL.createObjectURL(ie))}else{let ie=(ce=>{var ge=(Q,X,z)=>new Promise((I,b)=>{var L=Z=>{try{V(z.next(Z))}catch(F){b(F)}},j=Z=>{try{V(z.throw(Z))}catch(F){b(F)}},V=Z=>Z.done?I(Z.value):Promise.resolve(Z.value).then(L,j);V((z=z.apply(Q,X)).next())});let ve,ee={};for(let Q=self;Q;Q=Object.getPrototypeOf(Q))for(let X of Object.getOwnPropertyNames(Q))X in ee||Object.defineProperty(ee,X,{get:()=>self[X]});(()=>{const Q=()=>{const I=new Error("not implemented");return I.code="ENOSYS",I};if(!ee.fs){let I="";ee.fs={constants:{O_WRONLY:-1,O_RDWR:-1,O_CREAT:-1,O_TRUNC:-1,O_APPEND:-1,O_EXCL:-1},writeSync(b,L){I+=z.decode(L);const j=I.lastIndexOf(`
`);return j!=-1&&(console.log(I.substring(0,j)),I=I.substring(j+1)),L.length},write(b,L,j,V,Z,F){if(j!==0||V!==L.length||Z!==null){F(Q());return}const M=this.writeSync(b,L);F(null,M)},chmod(b,L,j){j(Q())},chown(b,L,j,V){V(Q())},close(b,L){L(Q())},fchmod(b,L,j){j(Q())},fchown(b,L,j,V){V(Q())},fstat(b,L){L(Q())},fsync(b,L){L(null)},ftruncate(b,L,j){j(Q())},lchown(b,L,j,V){V(Q())},link(b,L,j){j(Q())},lstat(b,L){L(Q())},mkdir(b,L,j){j(Q())},open(b,L,j,V){V(Q())},read(b,L,j,V,Z,F){F(Q())},readdir(b,L){L(Q())},readlink(b,L){L(Q())},rename(b,L,j){j(Q())},rmdir(b,L){L(Q())},stat(b,L){L(Q())},symlink(b,L,j){j(Q())},truncate(b,L,j){j(Q())},unlink(b,L){L(Q())},utimes(b,L,j,V){V(Q())}}}if(ee.process||(ee.process={getuid(){return-1},getgid(){return-1},geteuid(){return-1},getegid(){return-1},getgroups(){throw Q()},pid:-1,ppid:-1,umask(){throw Q()},cwd(){throw Q()},chdir(){throw Q()}}),!ee.crypto)throw new Error("globalThis.crypto is not available, polyfill required (crypto.getRandomValues only)");if(!ee.performance)throw new Error("globalThis.performance is not available, polyfill required (performance.now only)");if(!ee.TextEncoder)throw new Error("globalThis.TextEncoder is not available, polyfill required");if(!ee.TextDecoder)throw new Error("globalThis.TextDecoder is not available, polyfill required");const X=new TextEncoder("utf-8"),z=new TextDecoder("utf-8");ee.Go=class{constructor(){this.argv=["js"],this.env={},this.exit=f=>{f!==0&&console.warn("exit code:",f)},this._exitPromise=new Promise(f=>{this._resolveExitPromise=f}),this._pendingEvent=null,this._scheduledTimeouts=new Map,this._nextCallbackTimeoutID=1;const I=(f,S)=>{this.mem.setUint32(f+0,S,!0),this.mem.setUint32(f+4,Math.floor(S/4294967296),!0)},b=f=>{const S=this.mem.getUint32(f+0,!0),W=this.mem.getInt32(f+4,!0);return S+W*4294967296},L=f=>{const S=this.mem.getFloat64(f,!0);if(S===0)return;if(!isNaN(S))return S;const W=this.mem.getUint32(f,!0);return this._values[W]},j=(f,S)=>{if(typeof S=="number"&&S!==0){if(isNaN(S)){this.mem.setUint32(f+4,2146959360,!0),this.mem.setUint32(f,0,!0);return}this.mem.setFloat64(f,S,!0);return}if(S===void 0){this.mem.setFloat64(f,0,!0);return}let H=this._ids.get(S);H===void 0&&(H=this._idPool.pop(),H===void 0&&(H=this._values.length),this._values[H]=S,this._goRefCounts[H]=0,this._ids.set(S,H)),this._goRefCounts[H]++;let J=0;switch(typeof S){case"object":S!==null&&(J=1);break;case"string":J=2;break;case"symbol":J=3;break;case"function":J=4;break}this.mem.setUint32(f+4,2146959360|J,!0),this.mem.setUint32(f,H,!0)},V=f=>{const S=b(f+0),W=b(f+8);return new Uint8Array(this._inst.exports.mem.buffer,S,W)},Z=f=>{const S=b(f+0),W=b(f+8),H=new Array(W);for(let J=0;J<W;J++)H[J]=L(S+J*8);return H},F=f=>{const S=b(f+0),W=b(f+8);return z.decode(new DataView(this._inst.exports.mem.buffer,S,W))},M=Date.now()-performance.now();this.importObject={_gotest:{add:(f,S)=>f+S},gojs:{"runtime.wasmExit":f=>{f>>>=0;const S=this.mem.getInt32(f+8,!0);this.exited=!0,delete this._inst,delete this._values,delete this._goRefCounts,delete this._ids,delete this._idPool,this.exit(S)},"runtime.wasmWrite":f=>{f>>>=0;const S=b(f+8),W=b(f+16),H=this.mem.getInt32(f+24,!0);ee.fs.writeSync(S,new Uint8Array(this._inst.exports.mem.buffer,W,H))},"runtime.resetMemoryDataView":f=>{this.mem=new DataView(this._inst.exports.mem.buffer)},"runtime.nanotime1":f=>{f>>>=0,I(f+8,(M+performance.now())*1e6)},"runtime.walltime":f=>{f>>>=0;const S=new Date().getTime();I(f+8,S/1e3),this.mem.setInt32(f+16,S%1e3*1e6,!0)},"runtime.scheduleTimeoutEvent":f=>{f>>>=0;const S=this._nextCallbackTimeoutID;this._nextCallbackTimeoutID++,this._scheduledTimeouts.set(S,setTimeout(()=>{for(this._resume();this._scheduledTimeouts.has(S);)console.warn("scheduleTimeoutEvent: missed timeout event"),this._resume()},b(f+8))),this.mem.setInt32(f+16,S,!0)},"runtime.clearTimeoutEvent":f=>{f>>>=0;const S=this.mem.getInt32(f+8,!0);clearTimeout(this._scheduledTimeouts.get(S)),this._scheduledTimeouts.delete(S)},"runtime.getRandomData":f=>{f>>>=0,crypto.getRandomValues(V(f+8))},"syscall/js.finalizeRef":f=>{f>>>=0;const S=this.mem.getUint32(f+8,!0);if(this._goRefCounts[S]--,this._goRefCounts[S]===0){const W=this._values[S];this._values[S]=null,this._ids.delete(W),this._idPool.push(S)}},"syscall/js.stringVal":f=>{f>>>=0,j(f+24,F(f+8))},"syscall/js.valueGet":f=>{f>>>=0;const S=Reflect.get(L(f+8),F(f+16));f=this._inst.exports.getsp()>>>0,j(f+32,S)},"syscall/js.valueSet":f=>{f>>>=0,Reflect.set(L(f+8),F(f+16),L(f+32))},"syscall/js.valueDelete":f=>{f>>>=0,Reflect.deleteProperty(L(f+8),F(f+16))},"syscall/js.valueIndex":f=>{f>>>=0,j(f+24,Reflect.get(L(f+8),b(f+16)))},"syscall/js.valueSetIndex":f=>{f>>>=0,Reflect.set(L(f+8),b(f+16),L(f+24))},"syscall/js.valueCall":f=>{f>>>=0;try{const S=L(f+8),W=Reflect.get(S,F(f+16)),H=Z(f+32),J=Reflect.apply(W,S,H);f=this._inst.exports.getsp()>>>0,j(f+56,J),this.mem.setUint8(f+64,1)}catch(S){f=this._inst.exports.getsp()>>>0,j(f+56,S),this.mem.setUint8(f+64,0)}},"syscall/js.valueInvoke":f=>{f>>>=0;try{const S=L(f+8),W=Z(f+16),H=Reflect.apply(S,void 0,W);f=this._inst.exports.getsp()>>>0,j(f+40,H),this.mem.setUint8(f+48,1)}catch(S){f=this._inst.exports.getsp()>>>0,j(f+40,S),this.mem.setUint8(f+48,0)}},"syscall/js.valueNew":f=>{f>>>=0;try{const S=L(f+8),W=Z(f+16),H=Reflect.construct(S,W);f=this._inst.exports.getsp()>>>0,j(f+40,H),this.mem.setUint8(f+48,1)}catch(S){f=this._inst.exports.getsp()>>>0,j(f+40,S),this.mem.setUint8(f+48,0)}},"syscall/js.valueLength":f=>{f>>>=0,I(f+16,parseInt(L(f+8).length))},"syscall/js.valuePrepareString":f=>{f>>>=0;const S=X.encode(String(L(f+8)));j(f+16,S),I(f+24,S.length)},"syscall/js.valueLoadString":f=>{f>>>=0;const S=L(f+8);V(f+16).set(S)},"syscall/js.valueInstanceOf":f=>{f>>>=0,this.mem.setUint8(f+24,L(f+8)instanceof L(f+16)?1:0)},"syscall/js.copyBytesToGo":f=>{f>>>=0;const S=V(f+8),W=L(f+32);if(!(W instanceof Uint8Array||W instanceof Uint8ClampedArray)){this.mem.setUint8(f+48,0);return}const H=W.subarray(0,S.length);S.set(H),I(f+40,H.length),this.mem.setUint8(f+48,1)},"syscall/js.copyBytesToJS":f=>{f>>>=0;const S=L(f+8),W=V(f+16);if(!(S instanceof Uint8Array||S instanceof Uint8ClampedArray)){this.mem.setUint8(f+48,0);return}const H=W.subarray(0,S.length);S.set(H),I(f+40,H.length),this.mem.setUint8(f+48,1)},debug:f=>{console.log(f)}}}}run(I){return ge(this,null,function*(){if(!(I instanceof WebAssembly.Instance))throw new Error("Go.run: WebAssembly.Instance expected");this._inst=I,this.mem=new DataView(this._inst.exports.mem.buffer),this._values=[NaN,0,null,!0,!1,ee,this],this._goRefCounts=new Array(this._values.length).fill(1/0),this._ids=new Map([[0,1],[null,2],[!0,3],[!1,4],[ee,5],[this,6]]),this._idPool=[],this.exited=!1;let b=4096;const L=f=>{const S=b,W=X.encode(f+"\0");return new Uint8Array(this.mem.buffer,b,W.length).set(W),b+=W.length,b%8!==0&&(b+=8-b%8),S},j=this.argv.length,V=[];this.argv.forEach(f=>{V.push(L(f))}),V.push(0),Object.keys(this.env).sort().forEach(f=>{V.push(L(`${f}=${this.env[f]}`))}),V.push(0);const F=b;if(V.forEach(f=>{this.mem.setUint32(b,f,!0),this.mem.setUint32(b+4,0,!0),b+=8}),b>=12288)throw new Error("total length of command line and environment variables exceeds limit");this._inst.exports.run(j,F),this.exited&&this._resolveExitPromise(),yield this._exitPromise})}_resume(){if(this.exited)throw new Error("Go program has already exited");this._inst.exports.resume(),this.exited&&this._resolveExitPromise()}_makeFuncWrapper(I){const b=this;return function(){const L={id:I,this:this,args:arguments};return b._pendingEvent=L,b._resume(),L.result}}}})(),ve=({data:Q})=>{let X=new TextDecoder,z=ee.fs,I="";z.writeSync=(Z,F)=>{if(Z===1)ce(F);else if(Z===2){I+=X.decode(F);let M=I.split(`
`);M.length>1&&console.log(M.slice(0,-1).join(`
`)),I=M[M.length-1]}else throw new Error("Bad write");return F.length};let b=[],L,j=0;ve=({data:Z})=>(Z.length>0&&(b.push(Z),L&&L()),V),z.read=(Z,F,M,f,S,W)=>{if(Z!==0||M!==0||f!==F.length||S!==null)throw new Error("Bad read");if(b.length===0){L=()=>z.read(Z,F,M,f,S,W);return}let H=b[0],J=Math.max(0,Math.min(f,H.length-j));F.set(H.subarray(j,j+J),M),j+=J,j===H.length&&(b.shift(),j=0),W(null,J)};let V=new ee.Go;return V.argv=["","--service=0.24.2"],We(Q,V).then(Z=>{ce(null),V.run(Z)},Z=>{ce(Z)}),V};function We(Q,X){return ge(this,null,function*(){if(Q instanceof WebAssembly.Module)return WebAssembly.instantiate(Q,X.importObject);const z=yield fetch(Q);if(!z.ok)throw new Error(`Failed to download ${JSON.stringify(Q)}`);if("instantiateStreaming"in WebAssembly&&/^application\/wasm($|;)/i.test(z.headers.get("Content-Type")||""))return(yield WebAssembly.instantiateStreaming(z,X.importObject)).instance;const I=yield z.arrayBuffer();return(yield WebAssembly.instantiate(I,X.importObject)).instance})}return Q=>ve(Q)})(ce=>P.onmessage({data:ce})),ke;P={onmessage:null,postMessage:ce=>setTimeout(()=>{try{ke=ie({data:ce})}catch(ge){N(ge)}}),terminate(){if(ke)for(let ce of ke._scheduledTimeouts.values())clearTimeout(ce)}}}let B,G;const T=new Promise((ie,ke)=>{B=ie,G=ke});P.onmessage=({data:ie})=>{P.onmessage=({data:ke})=>de(ke),ie?G(ie):B()},P.postMessage(v||new URL(h,location.href).toString());let{readFromStdout:de,service:he}=Cd({writeToStdin(ie){P.postMessage(ie)},isSync:!1,hasFS:!1,esbuild:u});yield T,Dn=()=>{P.terminate(),xi=void 0,Dn=void 0,jn=void 0},jn={build:ie=>new Promise((ke,ce)=>{$.then(ce),he.buildOrContext({callName:"build",refs:null,options:ie,isTTY:!1,defaultWD:"/",callback:(ge,ve)=>ge?ce(ge):ke(ve)})}),context:ie=>new Promise((ke,ce)=>{$.then(ce),he.buildOrContext({callName:"context",refs:null,options:ie,isTTY:!1,defaultWD:"/",callback:(ge,ve)=>ge?ce(ge):ke(ve)})}),transform:(ie,ke)=>new Promise((ce,ge)=>{$.then(ge),he.transform({callName:"transform",refs:null,input:ie,options:ke||{},isTTY:!1,fs:{readFile(ve,ee){ee(new Error("Internal error"),null)},writeFile(ve,ee){ee(null)}},callback:(ve,ee)=>ve?ge(ve):ce(ee)})}),formatMessages:(ie,ke)=>new Promise((ce,ge)=>{$.then(ge),he.formatMessages({callName:"formatMessages",refs:null,messages:ie,options:ke,callback:(ve,ee)=>ve?ge(ve):ce(ee)})}),analyzeMetafile:(ie,ke)=>new Promise((ce,ge)=>{$.then(ge),he.analyzeMetafile({callName:"analyzeMetafile",refs:null,metafile:typeof ie=="string"?ie:JSON.stringify(ie),options:ke,callback:(ve,ee)=>ve?ge(ve):ce(ee)})})}}),Wd=u})(i)}(ta)),ta.exports}var qh=$h();const zo=zh(qh),Ir=Cr("editor",()=>{const i=Hl(null),e=jt(!0),t=jt("");function s(){Vl(i)}function n(){i.value=null,e.value=!0,t.value&&URL.revokeObjectURL(t.value),t.value=""}return{project:i,overPage:e,lastDownloadZIPURL:t,triggerProject:s,$reset:n}});let Wh=0;class Hh{constructor(){this.id=Wh++}booting=!1;booted=!1;id=0;terminalCW=void 0;onMessage(e,t){let s=e.data;if(!s||typeof s!="object"||!s.id?.startsWith("-co-t-"))return;let n=s.id.replace("-co-t-","");n=="booting"?this.booting=!0:n=="booted"&&(this.booting=!1,this.booted=!0),t&&t(n,s)}refit(){this.post("refit")}post(e,t){this.terminalCW.postMessage({id:"-co-"+e,...t??{}})}writeFile(e,t){this.post("write-file",{path:e,buf:t})}writeFolder(e,t){this.post("write-folder",{path:e,recursive:t})}deleteFile(e){this.post("delete-file",{path:e})}deleteFolder(e){this.post("delete-folder",{path:e})}moveItem(e,t){this.post("move-item",{from:e,to:t})}}function bc(){return()=>{const i=jt([]),e=jt(0),t=jt([]),s=Zd(()=>i.value.some(E=>E.booted));function n(){let E=new Hh;return i.value.push(E),E}function r(E,C,U){if(!(U&&U.length!=0))for(const A of i.value)U&&U.includes(A.id)||A.writeFile(E,C)}function a(E,C,U){for(const A of i.value)U&&U.includes(A.id)||A.writeFolder(E,C)}function o(E,C){if(!(C&&C.length!=0))for(const U of i.value)C&&C.includes(U.id)||U.deleteFile(E)}function c(E,C){if(!(C&&C.length!=0))for(const U of i.value)C&&C.includes(U.id)||U.deleteFolder(E)}function l(E,C,U){if(!(U&&U.length!=0))for(const A of i.value)U&&U.includes(A.id)||A.moveItem(E,C)}async function u(E){if(!E)return;let C=Date.now(),U={};E.loopAllFiles({forFile:(A,R)=>{R[A.name]={file:{contents:A.buf}}},forFolder:(A,R)=>{A.items.length==0&&(R[A.name]={directory:{}})}},(A,R)=>{if(A==null)return U;let re={directory:{}};return A[R.name]=re,re.directory});for(const A of i.value)A.post("load-tree",{tree:U,start:C})}async function m(E){E&&E.loopAllFiles({forFile(C,U){for(const A of i.value)A.writeFile(U+C.name,C.buf)},forFolder(C,U){if(C.items.length==0)for(const A of i.value)A.writeFolder(U+C.name,!0)}},(C,U)=>C==null?"":C+U.name+"/")}function g(){for(const E of i.value)E.refit()}function p(E){let C=i.value.indexOf(E);if(C==-1){console.warn("wasn't in the list of instances, aborting");return}i.value.splice(C,1),e.value==C&&(e.value--,e.value<0&&(e.value=0))}function k(){for(const E of i.value)E.post("reset");t.value=[],i.value=[]}function D(E){for(const C of i.value)E(C)}return{booted:s,instances:i,createInst:n,activeTerminalTab:e,exitInst:p,previewURLs:t,saveFile:r,saveFolder:a,deleteFile:o,deleteFolder:c,moveItem:l,transferAllFiles:m,loadFilesIntoTerminal:u,refit:g,forAll:D,$reset:k}}}const Vh=Cr("web-container",bc()),Yh=Cr("web-container-tutor",bc()),Zh=fn(),{g_user:or}=Er(Zh),_t=Ir();let qa;function Wa(i){qa=i}async function _c(i,e){wr(null);let{meta:t,canEdit:s}=await Yv(i,e);if(!t){console.warn(`selected project ${e}: doesn't exist`),ps.some(o=>o instanceof qo)||new qo().load();return}pn(e,i,!1),Ye||(console.warn("there was no pane_code loaded yet, waiting for a sec"),await w(500),Fr(document.querySelector(".pane-code"))),wr(new ja(t.name,Ye));let n=_t.project;if(n.meta=t,n.pid=e,n.desc=t.desc,n.isPublic=t.isPublic,n.meta.isOwner=n.meta.owner==or.value.data.uid,n.meta.canEdit=s,e||(n.pid="tmp_project"),Ra(Ye,_r.self),yd(n),ar(Vt),Ai.textContent=n.title,t.cid!=null){console.log("** found Challenge Project"),document.body.classList.add("is-challenge");let o=document.querySelector("a.nav-link.practice-link");o&&(o.classList.add("active"),o.nextElementSibling.classList.remove("active"))}async function r(o,c){Tn(o);let l=[];for(const u of o)if(u.items==null){let m=await n.createFile(u.name,u.buf,null,c);l.push(m)}else if(u.items!=null){let m=n.createFolder(u.name,c,!1);l.push(m),m.items=await r(u.items,m)}return l}if(await r(t.items,null),t.items.length&&(n.hasSavedOnce=!0),n.files.length==0)return console.warn(":: no files found"),!0;n.hasSavedOnce=!0,n.files.forEach(o=>o.setSaved(!0)),n.curFile&&n.curFile.open();let a=n.items.find(o=>o.name=="index.html");return a&&a.open(),!0}function xc(i){_t.project&&(_t.project.canLeave()||(le.disconnect(),i.stopPropagation(),i.preventDefault(),le.connect()))}async function Kh(){await Jl,await ec(),Wa(document.querySelector(".main")),nh(document.querySelector(".pane-files")),Fr(document.querySelector(".pane-code")),Na(function(s=!1,n){let r=document.querySelector(".pane-preview");r||console.warn("no pane preview when resizing)");let a=innerWidth-(Vt?.offsetWidth??0)-15;if(s)Ye.style.width=a/2+"px",r&&(r.style.width=a/2+"px"),rr(Vt.getBoundingClientRect().width),ms(Ye.getBoundingClientRect().width),r&&Ys(r.getBoundingClientRect().width);else if(Oe){if(Oe.elm==Vt){let c=Vt.getBoundingClientRect().width-ic;ms(gs-c/2),Ye.style.width=gs+"px",Ys(as-c/2),r&&(r.style.width=as+"px"),rr(Vt.getBoundingClientRect().width)}else if(Oe.elm==Ye){let c=Ye.getBoundingClientRect().width-gs;Ys(as-c),r&&(r.style.width=as+"px"),ms(Ye.getBoundingClientRect().width)}}qa.style.height=innerHeight-60+"px",_t.project?.hasEditor()&&_t.project.getCurEditor().layout()}),Ai=document.querySelector(".d-current-project"),Ai.onclick=s=>{_t.project&&new Sc(_t.project.meta).load()},window.addEventListener("beforeunload",xc);let i=Tr.currentRoute.value,e=i.params.uid,t=i.params.pid;Array.isArray(e)&&(e=e[0]),Array.isArray(t)&&(t=t[0]),await _c(e,t),Lr(!0)}console.log("loading editor...");async function kc(i){if(!i.key)return;let e=i.key.toLowerCase(),t=_t.project;if(i.ctrlKey){if(e=="r")i.stopImmediatePropagation(),i.preventDefault(),i.stopPropagation(),Po(t);else if(e=="s"){if(i.stopImmediatePropagation(),i.preventDefault(),i.stopPropagation(),t.isCompiling.value)return;t.usesCompiling.value&&!t.wc.booted?Or(t):lt()}}else if(e=="delete"||e=="backspace"){let s=t.hlItems.length?t.hlItems:[t.curFile];if(s.length){let n=document.activeElement;if(n&&(n.tagName=="INPUT"||n.tagName=="TEXTAREA"))return;t.deleteFItem(s[0])}}}async function Vw(){if(ih(Jt.editor),!await Ql()){console.warn("you aren't logged in, aborting loading editor");return}console.log("loaded editor (loader)"),Kh(),document.addEventListener("keydown",kc)}class $o{constructor(e){let t=Object.keys(e);for(const s of t)this[s]=e[s]}name;itemCount;parent;fid;folder;moveToFolder(e){return new Promise(t=>{le.emit("moveFolderToFolder",this.fid,e,s=>{if(!ma(s,"while trying to move project to folder")){t(!1);return}t(!0)})})}}class qo extends Es{constructor(){super("Project Dashboard","list")}navCont;content;_sectionI;path=[];i_searchQuery;lastSearchQuery;load(e){super.load(e),this.menu.classList.add("fullpage"),this.body.innerHTML=`
            <div class="flx edb-body">
                <div class="edb-nav">
                    <div class="edb-cont">
                        <div>
                            <input type="text" placeholder="Search..." class="i-search-query">
                        </div>
                        <div class="edb-nav-cont">
                            <button class="icon-btn regular sel">
                                <div class="material-symbols-outlined">face</div>
                                <div>Personal</div>
                            </button>
                            <button class="icon-btn regular sel">
                                <div class="material-symbols-outlined">experiment</div>
                                <div>Projects</div>
                            </button>
                            <button class="icon-btn regular">
                                <div class="material-symbols-outlined">fitness_center</div>
                                <div>Challenges</div>
                            </button>
                            <button class="icon-btn regular">
                                <div class="material-symbols-outlined">schedule</div>
                                <div>Recent</div>
                            </button>
                            <button class="icon-btn regular">
                                <div class="material-symbols-outlined">star_rate</div>
                                <div>Starred</div>
                            </button>
                        </div>
                    </div>
                    <div class="edb-cont">
                        <button class="b-new-folder icon-btn regular">
                            <div class="material-symbols-outlined">create_new_folder</div>
                            <div>New Folder</div>
                        </button>
                        <button class="b-new-project icon-btn accent">
                            <div class="material-symbols-outlined">add</div>
                            <div>New Project</div>
                        </button>
                    </div>
                </div>
                <div class="edb-content">
                    <div class="edb-content-list"></div>
                </div>
            </div>
        `,this.path=[{name:"",fid:or.value.data.rootFolder,isRoot:!0}],this.i_searchQuery=this.body.querySelector(".i-search-query"),Xl(this.i_searchQuery,a=>{this.i_searchQuery.value!=this.lastSearchQuery&&this.reloadSection()}),this.i_searchQuery.focus(),this.body.querySelector(".b-new-project").addEventListener("click",a=>{let o="New Project",c=new bs("New Project","Project Name",l=>{o=l,o&&Gh(o,void 0,this.getCurFolderFID())},()=>{console.log("Canceled new project creation")},void 0,void 0,"Choose a name to identify your project with.<br><br>","<br>");c._newLayer=!0,c.load()}),this.body.querySelector(".b-new-folder").addEventListener("click",a=>{let o=new bs("New Folder","Folder Name",async c=>{!c||!await or.value.createNewFolder(c,this.getCurFolderFID())||await this.reloadSection()},()=>{},void 0,void 0,"Choose a name for your new folder.<br><br>","<br>");o._newLayer=!0,o.load()});let n=this.body.querySelector(".edb-nav-cont"),r=this.body.querySelector(".edb-content-list");this.navCont=n,this.content=r;for(let a=0;a<n.children.length;a++)n.children[a].addEventListener("mousedown",c=>{this.loadSection(a)});return this.loadSection(_t.project&&_t.project.meta?.cid!=null?2:0),this}async reloadSection(){let e=this.content.parentElement.scrollTop;await this.loadSection(this._sectionI),this.content.parentElement.scrollTop=e}_isLoadingSection=!1;startLoadingSection(){return this._isLoadingSection?!1:(this._isLoadingSection=!0,!0)}endLoadingSection(){this._isLoadingSection=!1}async loadSection(e){if(!this.startLoadingSection())return;this.lastSearchQuery=this.i_searchQuery.value,this._sectionI=e;let t=this.navCont,s=t.children[e];for(const r of t.children)r.classList.remove("sel");if(s.classList.add("sel"),this.content.textContent="",e>0){let r=this;async function a(){return new Promise(l=>{le.emit("user-getProjectList",r.i_searchQuery.value,e,null,u=>{typeof u=="number"&&(u=[]),l(u||[])})})}let c=(await a()).map(l=>l);c=c.sort((l,u)=>{let m=l.wls?new Date(l.wls).getTime():0,g=u.wls?new Date(u.wls).getTime():0;return m-g});for(const l of c)this.loadProjectItem(new ea(l));this.endLoadingSection();return}let n=await new Promise(r=>{le.emit("user-getFilesList",this.i_searchQuery.value,this.path.length>0?this.path[this.path.length-1].fid:null,a=>{!a||a?.err?(alert(`Error ${a?.err} while trying to get personal files`),r(null)):r(a)})});if(!n){this.endLoadingSection();return}if(this.loadCurrentPathItem(),this.path.length){let r=this.getCurFolder();r&&!r.isRoot&&this.loadGoUpLevelItem()}if(n.folders){n.folders.sort((r,a)=>r.name.localeCompare(a.name));for(const r of n.folders)this.loadFolderItem(new $o(r))}if(n.projects){n.projects.sort((r,a)=>r.name.localeCompare(a.name));for(const r of n.projects)this.loadProjectItem(new ea(r))}this.endLoadingSection()}getCurFolderFID(){return this.path.length==0?null:this.path[this.path.length-1].fid}getCurFolder(){return this.path[this.path.length-1]}getLastFolderFID(){return this.path[this.path.length-2]?.fid}async goUpFolder(){this.path.pop(),await this.reloadSection()}async openFolder(e){this.path.push(e),await this.reloadSection()}scrollToItem(e){let t;e instanceof ea?t=this.body.querySelector(".pi-"+e.pid):e instanceof $o&&(t=this.body.querySelector(".fi-"+e.fid)),t&&(console.log("...scrolling to..."),t.scrollIntoView({behavior:"smooth"}),t.classList.add("highlight"),setTimeout(()=>{t.classList.remove("highlight")},1500))}loadProjectItem(e){let t=document.createElement("div");t.className="project-item",t.classList.add("pi-"+e.pid),t.innerHTML=`
            <div class="project-info">
                <div class="l-project-name">
                    <div class="star">star</div>
                    <div class="l-project-name-label">${e.name}</div>
                    <div co-label="${e.sub?"Submitted":"In Progress"}" class="p-icon ic-submitted ${e.cid!=null?"":"hide"}">${e.sub?"cloud_done":"fitness_center"}</div>
                    <div co-label="${e.isPublic?"Public":"Private"}" class="p-icon ic-vis ${e.isPublic?"":"hide"}">${e.isPublic?"public":"lock"}</div>
                    <!--<div co-label="${e.isPublic?"Public":"Private"}" class="p-icon ic-vis ${e.isPublic&&!e.sub?"":"hide"}">${e.isPublic?"public":"lock"}</div>-->
                    <div style="margin-right:10px"></div>
                </div>
                <div class="l-project-desc">${e.desc}</div>
            </div>
            <div class="flx-sb" style="gap:5px">
                <button class="icon-btn accent smaller b-open-project">
                    <div class="material-symbols-outlined">edit</div>
                    <div>Tinker</div>
                </button>
                <button class="icon-btn-single accent smaller b-ops">
                    <div class="material-symbols-outlined">discover_tune</div>
                </button>
            </div>
        `,this.content.appendChild(t),t.querySelector(".l-project-name-label");let s=t.querySelector(".b-open-project");s.addEventListener("click",c=>{Tr.currentRoute.value.params.pid?Xh(e.pid,e.owner):pn(e.pid,e.owner)}),e.cid!=null&&(s.classList.add("challenge"),s.children[1].textContent="Practice"),t.querySelector(".b-ops").addEventListener("click",c=>{new Sc(e,this,t).load()}),t.querySelector(".star").addEventListener("click",async c=>{e.starred?await eh(e.pid,e.owner)&&(t.classList.remove("starred"),e.starred=!1):await Jd(e.pid,e.owner)&&(t.classList.add("starred"),e.starred=!0)}),e.starred&&t.classList.add("starred");let a=t.querySelector(".ic-submitted"),o=t.querySelector(".ic-vis");en(a,null),en(o,null),a.addEventListener("click",c=>{open("/practice?cid="+e.cid,"_blank")}),o.addEventListener("click",c=>{open(th(e.owner,e.pid),"_blank")}),this._sectionI==0&&t.addEventListener("mousedown",c=>{tn(new sn(c,l=>t.cloneNode(!0),l=>{},t,{className:""})),wi.down=e})}loadFolderItem(e){let t=document.createElement("div");t.className="project-item folder-item",t.classList.add("fi-"+e.fid),t.tabIndex=0,t.innerHTML=`
            <div class="project-info">
                <div class="l-project-name">
                    <div class="main-icon material-symbols-outlined">folder</div>
                    <div class="l-project-name-label">${e.name} (${e.itemCount})</div>
                    <div style="margin-right:10px"></div>
                </div>
            </div>
            <div class="flx-sb" style="gap:5px">
                <button class="icon-btn-single accent smaller b-ops">
                    <div class="material-symbols-outlined">discover_tune</div>
                </button>
            </div>
        `,this.content.appendChild(t),t.children[0].addEventListener("click",n=>{wi&&this.openFolder(e)}),t.addEventListener("mousedown",n=>{tn(new sn(n,r=>t.cloneNode(!0),r=>{},t,{className:""})),wi.down=e}),Bo(t,async n=>{n&&n.moveToFolder&&await n.moveToFolder(e.fid)&&(await this.openFolder(e),this.scrollToItem(n))}),t.querySelector(".b-ops").addEventListener("click",n=>{new ef(e,this).load(void 0,!0)})}loadCurrentPathItem(){let e=document.createElement("div");e.className="current-path-item",e.innerHTML=`
            <div class="project-info">
                <div class="l-project-name">
                    <div class="l-project-name-label d-list"></div>
                    <div style="margin-right:10px"></div>
                </div>
            </div>
        `;let t=e.querySelector(".d-list");for(let s=0;s<this.path.length;s++){let n=this.path[s],r=document.createElement("div");r.textContent=n.name,t.appendChild(r)}if(this.content.appendChild(e),this.menu.classList.contains("fullpage")){let s=document.createElement("div");this.content.appendChild(s)}}loadGoUpLevelItem(){let e=document.createElement("div");e.className="project-item folder-item",e.innerHTML=`
            <div class="project-info">
                <div class="l-project-name">
                    <!--<div class="main-icon material-symbols-outlined">folder</div>-->
                    <div class="l-project-name-label">[Go Up Level]</div>
                    <div style="margin-right:10px"></div>
                </div>
            </div>
        `,this.content.appendChild(e),e.addEventListener("click",t=>{this.goUpFolder()}),Bo(e,async t=>{if(!t)return;let s=this.getLastFolderFID();s&&await t.moveToFolder(s)&&(await this.goUpFolder(),this.scrollToItem(t))})}}let Ai;async function Gh(i,e="A project for experiments.",t){let s=await new Promise(n=>{console.log("...creating project"),le.emit("createProject",i,e,t,r=>{if(r==null){alert("Error creating project"),n(null);return}console.log(":: successfully created project: ",i),n(r)})});s!=null&&(console.log("succesfully created"),Ar(),pn(s,or.value.data.uid),Ua())}async function Xh(i,e){if(Ar(),_t.project)pn(i,e);else if(!await _c(e,i))return;Ua()}async function Qh(i,e){return new Promise(t=>{new qi("Delete Project",'Are you sure you want to delete project:<br>"'+i.name+'" ?<br><br>There is no reversing this option.',()=>{le.emit("deleteProject",i.pid,s=>{if(s!=0){t(!1),alert("There was an error deleting the project, error code: "+s);return}document.querySelector(".pi-"+i.pid),t(!0),_t.project?.pid==i.pid&&tc()})},()=>{}).load()})}async function Jh(i){return new Promise(e=>{new qi("Unlink Project",'Are you sure you want to unlink the challenge with this project:<br>"'+i.name+'" ?<br><br>There is no reversing this option.',()=>{le.emit("unlinkProject",i.pid,t=>{if(t!=0){e(!1),alert("There was an error unlinking the project, error code: "+t);return}e(!0),_t.project?.pid==i.pid&&location.reload()})},()=>{}).load()})}class ef extends Es{constructor(e,t){super("Folder Settings","settings"),this.meta=e,this.dash=t}meta;dash;i_name;b_save;b_delete;load(e,t){super.load(e,t),this.menu.style.height="max-content",this.menu.style.width="420px",this.body.innerHTML=`
            <div>
                <div class="i-name">
                    <div class="title">Name</div>
                    <input type="text" class="i-name">
                </div>
            </div>
            <br><br>
            <div style="display:flex;gap:20px;justify-content:space-between">
                <button class="b-save-changes load-btn icon-btn normal" disabled>
                    <div class="material-symbols-outlined">save</div>
                    <div>Save Changes</div>
                </button>

                <button class="b-delete-folder icon-btn warn">
                    <div class="material-symbols-outlined">delete</div>
                    <div>Delete Folder</div>
                </button>
            </div>
        `;let s=this.setupTextInput(".i-name",{label:"Name"});return this.i_name=s.inp,s.div.style.width="max-content",s.inp.focus(),s.inp.placeholder=this.meta.name,s.inp.value=this.meta.name,s.inp.addEventListener("input",n=>{s.inp.value!=this.meta.name&&s.inp.value!=""?this.b_save.disabled=!1:this.b_save.disabled=!0}),Xl(s.inp,n=>{this.saveChanges()},!0),this.b_save=this.body.querySelector(".b-save-changes"),this.b_save.addEventListener("click",n=>{this.saveChanges()}),this.b_delete=this.body.querySelector(".b-delete-folder"),this.b_delete.addEventListener("click",n=>{this.deleteFolder()}),this}saveChanges(){this.b_save.classList.add("loading"),le.emit("updateFolderMeta",this.meta.fid,this.i_name.value,async e=>{ma(e,"while trying to update folder meta")&&(await this.dash.reloadSection(),this.close())})}deleteFolder(){confirm(`Are you sure you want to delete the folder: "${this.meta.name}"?

If this folder contains other folders or projects they will be deleted as well!

This is not reversable!`)&&(this.b_save.classList.add("loading"),le.emit("deleteFolder",this.meta.fid,async e=>{ma(e,"while trying to delete folder")&&(await this.dash.reloadSection(),this.close())}))}}class Sc extends Es{constructor(e,t,s){super("Project Settings","settings"),this.meta=e,this.dash=t,this.divItem=s}meta;dash;divItem;load(e){if(!this.meta){console.warn("Failed to open project settings menu, no project specified");return}super.load(e,!0),this.meta.cid==null?this.menu.classList.add("experiment-menu"):this.menu.classList.add("practice-menu"),this.body.innerHTML=`
            <div class="op-div">General</div>
            <div class="op-cont ps-general">
                <div>
                    <div>
                        <div class="title">Name</div>
                        <input type="text" class="i-name">
                    </div>
                    <button class="b-save-changes load-btn icon-btn normal" disabled>
                        <div class="material-symbols-outlined">save</div>
                        <div>Save Changes</div>
                    </button>
                </div>
                <div>
                    <div class="title">Description</div>
                    <textarea class="i-desc" style="resize:none"></textarea>
                </div>
            </div>

            <div class="op-div">Info</div>
            <div class="op-cont ps-info">
                <div>
                    <div>
                        <div class="title"><span class="text">Time Spent: </span><span class="l-h">${sh(this.meta.meta.time)}</span></div>
                        <div class="text">The total time you've spent working on this project.</div>
                    </div>
                </div>
            </div>

            <div class="op-div">Privacy</div>
            <div class="op-cont">
                <div>
                    <div class="title">Visibility</div>
                    <div class="text">Whether or not other users are allowed to view your project.</div>
                </div>
                <button class="b-toggle-privacy icon-btn-v load-btn left">
                    <div class="material-symbols-outlined">lock</div>
                    <div>Private</div>
                </button>
            </div>

            <div class="op-div full-width">
                <span>Dangerous</span>
                <span class="text">These options are irreversible.</span>
            </div>
            <div class="op-cont">
                <button class="b-delete-project icon-btn warn">
                    <div class="material-symbols-outlined">delete</div>
                    <div>Delete Project</div>
                </button>
                ${this.meta.cid!=null?`
                    <button class="b-unlink-project icon-btn warn">
                        <div class="material-symbols-outlined">link_off</div>
                        <div>Unlink From Challenge</div>
                    </button>
                    `:""}
            </div>
        `;let t=this.body.querySelector(".i-name"),s=this.body.querySelector(".i-desc"),n=this.body.querySelector(".b-save-changes"),r=this.body.querySelector(".b-toggle-privacy"),a=this.body.querySelector(".b-delete-project"),o=this.body.querySelector(".b-unlink-project");t.value=this.meta.name,s.value=this.meta.desc,t.addEventListener("input",l=>{t.value==""||t.value==this.meta.name?n.disabled=!0:n.disabled=!1}),s.addEventListener("input",l=>{s.value==this.meta.desc?n.disabled=!0:n.disabled=!1});let c=()=>{r.children[0].textContent=this.meta.isPublic?"public":"lock",r.children[1].textContent=this.meta.isPublic?"Public":"Private",this.dash&&this.dash.reloadSection()};return c(),n.addEventListener("click",l=>{n.classList.add("loading");let u=performance.now();le.emit("updatePMeta",this.meta.pid,{name:t.value||null,desc:s.value||null},async(m,g,p)=>{let k=performance.now()-u,D=300;if(k<D&&await w(D-k),n.classList.remove("loading"),m!=0){alert(`Error ${m} while trying to save changes to project info`);return}if(Ai.textContent=g,n.disabled=!0,this.divItem){let E=this.divItem.querySelector(".l-project-name-label"),C=this.divItem.querySelector(".l-project-desc");E&&(E.textContent=g),C&&(C.textContent=p)}this.meta.name=g,this.meta.desc=p,this.dash&&this.dash.reloadSection()})}),r.addEventListener("click",l=>{r.classList.add("loading");let u=performance.now();le.emit("setProjVisibility",this.meta.pid,!this.meta.isPublic,async(m,g)=>{let p=performance.now()-u,k=300;if(p<k&&await w(k-p),r.classList.remove("loading"),m!=0){alert(`Error ${m} while trying to change project visibility`);return}this.meta.isPublic=g,c()})}),a.addEventListener("click",async l=>{await Qh(this.meta,this.divItem),this.dash&&this.dash.reloadSection(),this.close()}),o&&o.addEventListener("click",async l=>{await Jh(this.meta),this.dash&&this.dash.reloadSection(),this.close()}),this.meta.canEdit||(r.disabled=!0,a.disabled=!0,o&&(o.disabled=!0),t.disabled=!0,s.disabled=!0),this}}class tf{constructor(e,t){this.f=e,this.res=t}f;res}let Wo=jt(!1);async function sf(i){console.log("...started TS compile"),await lt(!0),Wo.value||await zo.initialize({wasmURL:"https://unpkg.com/esbuild-wasm@0.24.2/esbuild.wasm"}),Wo.value=!0;let e=!1,t=[],s=[];for(const a of i.files){if(!a.name.endsWith(".ts"))continue;let o=i.textDecoder.decode(a.buf),c=new Promise(l=>{zo.transform(o,{loader:"ts",format:"esm",target:"ES2022"}).then(u=>{l(u)}).catch(u=>{console.log("-- Error while compiling: ",u),l(null),e=!0})});t.push(c),s.push(new tf(a,c))}if(await Promise.all(t),e){alert("There was an error while compiling, aborted.");return}let n=i.items.find(a=>a.name=="out"&&a instanceof Ie),r=[];for(const a of s){let o=a.f,l=(await a.res).code;o.folder!=null&&!n&&(n=i.createFolder("out",void 0,!0));let m=n?n.items:i.items,g=o.name.lastIndexOf("."),p=o.name.substring(0,g)+".js",k=m.find(D=>D.name==p&&D instanceof ze);if(k)k.editor&&k.editor.setValue(l),k.buf=i.textEncoder.encode(l),k.setSaved(!1);else{let D=i.createFile(p,i.textEncoder.encode(l),void 0,n,!0,!0);r.push(D)}}await Promise.all(r),await lt(!0),console.log("$ finished TS compile")}async function Or(i,e=!1){if(i.wc.booted||i.isCompiling.value||!i.canEdit)return;i.isCompiling.value=!0,yr();let t=performance.now();console.log("starting compile..."),await sf(i),console.log("compile time: ",performance.now()-t),e||await w(300),i.isCompiling.value=!1,yr()}function Ar(){rh(),Vt&&(Vt.textContent=""),Ye&&(Ye.textContent=""),Ai&&(Ai.textContent=Ai.getAttribute("default-text")??""),_t.$reset()}function Yw(){Ar(),document.removeEventListener("keydown",kc),window.removeEventListener("beforeunload",xc)}window.UNLOAD_EDITOR=Ar;const gn=Cr("lesson",()=>{let i=jt(1),e=jt(0),t=Hl(void 0);const s=jt(!1);function n(){Vl(t)}function r(o){console.log("set lesson value",o),t.value=o}function a(){i.value=1,e.value=0}return{_tmpLessonGlobalSpeed:i,_tmpCurLessonSpeedI:e,lesson:t,usingAltLayout:s,setLesson:r,triggerLesson:n,$reset:a}}),Ha=Ir(),Ze=gn();function Zw(){of(),ah(()=>Ze.lesson&&Ze.lesson.isResuming||lh?!0:ch>0),setTimeout(()=>{Ya()},500),rf()}function Va(i){Ze.setLesson(i)}async function ga(i){if(Ze.lesson.isResuming)return;let e=new su;return e.start(),sc(i,e),await e._prom}function nf(i,e){if(i.info)return e||(e="Lesson: "+i.info.name),new Promise(t=>{le.emit("copyFilesIntoNewProject",e,Ze.lesson.getFilesAsFolder(),"Cloned from lesson: "+i.info.name+".",s=>{if(typeof s=="number"&&s!=0){alert(`Error ${s} while trying to copy files into new project`),t(!1);return}pn(s),t(!0)})})}function Ec(i){if(!Ze.lesson?.hasLoaded)return;let e=i.data?.id;if(!e)return;let t=Ze.lesson.p;e=="refresh"?ls(t):e=="load"&&va(t)}function Cc(i){Ze.lesson?.p,Ha.overPage=!0}function Lc(i){Ze.lesson?.p,Ha.overPage=!1}async function ls(i){if(i==Ze.lesson.p){let e=Ze.lesson.p;if((e.files.some(s=>!s._saved)||!e.hasSavedOnce||e.files.some(s=>!s.beenUploaded))&&(Ze.lesson.p.usesCompiling.value?await Or(Ze.lesson.p,!0):await Ri(!0)),!e.files.find(s=>s.name=="index.html")||!e.hasSavedOnce){alert("No index.html file found! Please create a new file called index.html, this file will be used in the lesson preview."),console.log("no index.html file found",i);return}}if(Ze.lesson.useLocalRefresh())console.log("...local refresh..."),await Ma(i),va(i);else if(i.isTutor)await Ma(i),va(i);else{let e=Ha.project.getURL();i.refs.iframe.contentWindow.postMessage({id:"setURL",url:e},"*")}}function va(i){i==Ze.lesson.p&&Cs(li.refresh,null)}async function Fc(i=0){console.trace("--- refresh lesson:",i);let e=Ze.lesson;e&&(i==0?(await ls(e.p),e.info.type!=bt.review&&await ls(e.tut)):i==1?await ls(e.p):i==2&&await ls(e.tut))}async function Ri(i=!1,e={}){let t=Ze.lesson;t&&(vs.value||(vs.value=!0,await t.uploadLessonFiles(e),t.p.hasSavedOnce=!0,t.p.files.forEach(s=>s.setSaved(!0)),t.tut.hasSavedOnce=!0,t.tut.files.forEach(s=>s.setSaved(!0)),i||await w(300),vs.value=!1,t.needsSave=!1))}function Pc(i){let e=i.key.toLowerCase();if(e=="alt"&&i.preventDefault(),i.altKey&&!i.shiftKey&&!i.ctrlKey&&!i.metaKey&&e=="enter"){let t=!1;if(ps.length==0&&on&&(Dt.click(),t=!0),!t&&Ge.some(s=>s.clickRes)){let s;for(let n=Ge.length-1;n>=0;n--){let r=Ge[n];if(r.clickRes){s=r;break}}s&&(s.clickRes(),t=!0)}if(!t){let s=ps[ps.length-1];s&&s.canClose()&&s.close()}}if(e=="z"&&i.altKey){let t=Ze.lesson;if(!t)return;let s=t?.p?.getCurEditor();s&&(t.p.wordWrap=!t.p.wordWrap,s.updateOptions({wordWrap:t.p.wordWrap?"on":"off"}),console.log("toggle word wrap"))}}function rf(){document.addEventListener("keydown",Pc)}let af=125.075;async function Tc(i,e,t,s=!1){let n={column:t,lineNumber:e},r=i.getScrolledVisiblePosition(n);ye.style.left=r.left+3+"px",ye.style.top=r.top+af-3+"px",s||await w(500)}async function ws(i,e=!1,t=!1){if(ba||ye.style.opacity=="1"||ci!=Jt.lesson||Ze.lesson.disableSyncPos>0||on||(Ks(),!i))return;let s=i.getPosition();if(await Tc(i,s.lineNumber,s.column,e),!on){let n=i.getPosition();n&&i.revealPositionInCenterIfOutsideViewport(n)}}let cs=null;function Ks(){let i=document.querySelectorAll(".custom-cursor");for(const e of i)e.classList.add("hide");Ya()}function Ya(){cs!=null&&(clearTimeout(cs),cs=null);let i=500,e=document.querySelectorAll(".custom-cursor");try{if(Ze.lesson?.currentSubTask instanceof Bi)for(const t of e)t.classList.add("hide");else for(const t of e)t.classList.toggle("hide")}catch{for(const s of e)s.classList.toggle("hide")}cs=setTimeout(Ya,i)}function of(){window.addEventListener("message",Ec),document.addEventListener("mouseenter",Cc),document.addEventListener("mouseleave",Lc)}function Kw(){cs!=null&&clearTimeout(cs),document.removeEventListener("keydown",Pc),window.removeEventListener("message",Ec),document.removeEventListener("mouseenter",Cc),document.removeEventListener("mouseleave",Lc),oh()}const Rt=Ir(),ys=fn(),d=gn();let Ic,Za,us,Ka,lr,ai,Dt,Oc,Ac,wa,rn,Di,Gs,ya,ss,qt;function ui(i){let e=oc;return i<5&&(e=2),Math.ceil((30+Math.random()*100)*e)}async function Dc(i){if(!i.key)return;let e=i.key.toLowerCase();if(e=="enter"||e=="return"){let t=document.activeElement?.tagName.toLowerCase();if((i.shiftKey&&!i.ctrlKey||(!t||t!="textarea"&&t!="input"))&&Ge.length){i.preventDefault(),i.stopImmediatePropagation(),i.stopPropagation();let s=Ge[Ge.length-1],n=s.e.querySelector(".b-confirm");n?n.click():s.clickRes&&s.clickRes()}}if(i.shiftKey&&i.ctrlKey&&wt(.05),i.ctrlKey||i.metaKey)if(e=="r")i.preventDefault(),bi(d.lesson.p);else if(e=="s"){if(i.preventDefault(),Rt.project.isCompiling.value)return;Rt.project.usesCompiling.value?Or(Rt.project):Ri()}else e=="g"?(i.preventDefault(),Za.classList.toggle("closed")):e=="j"&&ys.g_user?.data.roles?.includes(0)&&(i.preventDefault(),us.classList.toggle("closed"),us.classList.contains("closed")||Qo());e=="f3"&&ys.g_user?.data.roles?.includes(0)&&(i.preventDefault(),us.classList.toggle("closed"),us.classList.contains("closed")||Qo()),e=="escape"&&(d.lesson.p.getFilesPane()?.classList.contains("hide")||d.lesson.p.deselectSelFolder())}function jc(i){if(!i.key)return;let e=i.key.toLowerCase();wt(1),e=="control"&&wh()}function lf(){console.log("loaded lesson keybinds"),document.addEventListener("keydown",Dc),document.addEventListener("keyup",jc)}function cf(){document.removeEventListener("keydown",Dc),document.removeEventListener("keyup",jc)}let an,uf=[.5,1,2,3,4,8],Rc,ye,ot;function Gw(){let i=localStorage.getItem("altLayout");d.usingAltLayout=i=="true"||i==null;const e=document.querySelector(".tip"),t=["Did you know that Java and JavaScript are not the same programming languages?","Some elements like <br> and <img> don't have closing tags...because they don't display text!","Did you know the text editor we use in Code Otter is from VSCode?","Who knows what secrets lie beyond, the only thing stopping you is...practice.","Code Otter's roots are in challenging each other and sharing implementions! ...what we used to call JS Challenges!","A huge new feature is coming. When?...Eventually, so get ready.","Like Code Otter? Or hate it? Let us know "];e.textContent=t[Math.floor(Math.random()*t.length)],ot=document.querySelector(".d-lesson-confirm"),ot.classList.remove("none"),an=document.querySelector(".b-alt-layout"),d._tmpLessonGlobalSpeed=localStorage.getItem("lessonGlobalSpeed")?parseFloat(localStorage.getItem("lessonGlobalSpeed")):1,d._tmpCurLessonSpeedI=uf.indexOf(d._tmpLessonGlobalSpeed),Rc=document.querySelector(".global-bubble-overlay"),ye=document.createElement("div"),ye.className="tut-mouse",document.body.appendChild(ye),Ic=document.querySelector(".load-cont.lesson"),Za=document.querySelector(".d-current-tasks"),us=document.querySelector(".debug-jump-progress"),Ka=document.querySelector(".debug-prog-cont"),lr=document.querySelector(".d-task"),ai=document.querySelector(".d-sub-tasks"),Gs=document.querySelector(".extra-lesson-confirm-btns"),ya=document.querySelector(".l-progress"),ss=document.querySelector(".d-section-list"),qt=document.querySelector(".l-cur-section"),Dt=ot.querySelector(".b-im-done"),Oc=ot.querySelector(".lesson-confirm-text"),Ac=ot.querySelector(".lesson-confirm-submit"),wa=Dt.children[0],rn=ot.querySelector(".b-replay"),Di=ot.querySelector(".b-go-back-step"),Wa(document.querySelector(".main")),uh(document.querySelector(".pane-lesson")),nc(document.querySelector(".pane-tutor-code")),Fr(document.querySelector(".pane-code")),an.onclick=s=>{vu()},d._tmpLessonGlobalSpeed!=1&&rc(d._tmpLessonGlobalSpeed),Dt.onclick=async s=>{if(!Mn)return;Mn=!1;let n=Dr;if(n==1)Zn(0);else if(n==2)d.lesson.currentSubTask._resFinish(),Dt.disabled=!0;else if(d.lesson.currentSubTask)if(d.lesson.currentSubTask instanceof Bi){let r=await d.lesson.currentSubTask.checkValidation(!0);if(r?(d.lesson.tut.getCurEditor(),Zn(2),s.stopImmediatePropagation(),s.stopPropagation()):(Zn(1),d.lesson.currentSubTask.hasMissed||(d.lesson.progress.misses++,d.lesson.needsSave=!0,d.lesson.currentSubTask.hasMissed=!0)),!r){Mn=!0,Xo();return}}else d.lesson.currentSubTask._resFinish(),Dt.disabled=!0;Mn=!0,Xo()},rn.onclick=s=>{d.lesson.currentSubTask&&d.lesson.currentSubTask.replay(d.lesson.tut.getCurEditor())},Di.onclick=s=>{if(d.lesson.currentSubTask){let n=function(){if(console.log("...check",r,a),r<0)return;if(a<=0){c=!0,ku(r,-1);return}let l=d.lesson.events[r].tasks[a],u=!1;if(l instanceof eo&&(u=!0),l instanceof Jc&&(u=!0),l instanceof iu&&(u=!0),l.skipsRewind()&&(u=!0),u)return a--,n();o=l},r=d.lesson.events.indexOf(d.lesson.currentEvent),a=d.lesson.currentEvent.tasks.indexOf(d.lesson.currentSubTask)-1,o;console.log("...start",r,a);let c=!1;if(n(),c)return;if(!o){alert("Err: couldn't find task to go back to");return}o.replay(d.lesson.tut.getCurEditor())}},ut(),dh((s,n)=>{if(!d.lesson.hasLoaded||d.lesson.isResuming)return!1}),Wv(()=>d.lesson?.lid),$e.onOpenFile=s=>{s.actions||(s.actions=it(s.editor))},$e.getURLRoot=(s,n,r)=>(console.trace("GET:",s,r),os+"/lesson/"+ys.g_user.data.uid+"/"+le.id+"/"+ys.g_user.data.uid+"/"+d.lesson.lid+"/"+(s?"":r)),$e.getExternalURL=(s,n,r)=>location.origin+`/viewer/?t=l&a=${ys.g_user.data.uid}&b=${le.id}&c=${d.lesson.lid}/`+(s?"":r),$e.onRefresh=(s,n)=>(Po(s).then(()=>{n()}),!1),$e.setupTutorEditor=s=>{let n=s.editor;if(!n){console.warn("an editor was undefined for file (aborting): ",s);return}n.onDidFocusEditorText(a=>{if(s.p.fileList.parentElement.classList.contains("hide")||s.p.parent.querySelector(".b-show-files")?.click(),document.activeElement instanceof HTMLElement){document.activeElement.blur();let o=s.cont.querySelector(".inputarea.monaco-mouse-cursor-text");o.style.backgroundColor="var(--col)",o.style.zIndex="1",o.style.width="2px",o.style.height="19px",o.style.border="solid 1px var(--col)",o.classList.add("custom-cursor")}}),n.onDidChangeCursorPosition(a=>{s.blockPosChange?n.setPosition({column:s.curCol,lineNumber:s.curRow}):(d.lesson.tut.curFile.curCol=a.position.column,d.lesson.tut.curFile.curRow=a.position.lineNumber),d.lesson&&(d.lesson.isResuming||ws(n))}),n.onDidContentSizeChange(a=>{ws(n)}),n.onDidScrollChange(a=>{ws(n)}),n.onDidScrollChange(function(){s.scrollOffset=n.getScrollTop(),s.scrollOffsetX=n.getScrollLeft(),xu()});let r=document.createElement("div");r.className="bubbles-overlay",s.bubbles_ov=r,s.cont.appendChild(r),s.setSaved(!0),setTimeout(()=>{n.focus()},100)},$e.onOpenCreateFileMenu=s=>{if(Ge[0]){let n=d.lesson.currentSubTask;if(n instanceof Li){let r=Ge[0].e.cloneNode(!0);r.classList.add("no-callout"),ps[0].body.appendChild(r),r.children[1].innerHTML=`<div>Add a file named: ${n.name}</div>`,r.style.top="calc(100% + 55px)",r.style.left="50%",r.style.translate="-50% 0px",r.style.transform="none"}}},$e.onOpenCreateFolderMenu=s=>{if(Ge[0]&&d.lesson.currentSubTask instanceof Kc){let r=Ge[0].e.cloneNode(!0);r.classList.add("no-callout"),ps[0].body.appendChild(r),r.style.top="calc(100% + 55px)",r.style.left="50%",r.style.translate="-50% 0px",r.style.transform="none"}},lf(),window.addEventListener("beforeunload",Bc),wm()}function Bc(i){d.lesson&&(d.lesson.canLeave()||(i.stopPropagation(),i.preventDefault()))}async function Mc(i=!1){i||await w(50),ot.style.opacity="0",ot.style.pointerEvents="none",on=!1,i||await w(1500)}function Bn(i){i.text&&(Oc.textContent=i.text),i.submit&&(Ac.textContent=i.submit),i.icon?wa.textContent=i.icon:wa.textContent="done"}let Mn=!0,on=!1,Dr=0;function Zn(i){Dr=i,ot.style.opacity=="1"&&Uc()}function Ho(){let i=document.createElement("button");i.classList.add("icon-btn","b-help"),i.innerHTML="<div>lightbulb_2</div>",i.style.padding="2px 5px",i.addEventListener("click",e=>{d.lesson.showHelp()}),Gs.appendChild(i),en(i,"Ask the tutor how to solve this question.")}async function Uc(){let i=d.lesson.currentEvent,e=d.lesson.currentSubTask,t=!0,s=!0;if(ot.className="d-lesson-confirm",Gs.textContent="",e instanceof Bi){t=!1,s=!1;let n=Dr;if(n==0)Bn({text:`Press "Submit" to let the Tutor know when you're finished.`,submit:"Submit (Alt+Enter)"}),Ho();else if(n==1){Bn({text:"Sorry, that's incorrect.",submit:"Retry (Alt+Enter)",icon:"restart_alt"}),ot.classList.add("incorrect");let r=document.createElement("button");r.textContent="Skip (Replay Later)",r.style.padding="6px 12px",r.addEventListener("click",a=>{d.lesson.replayLater()}),Gs.appendChild(r),en(r,"Skip and try this question again later."),Ho(),ka(),await w(100),Dt.focus()}else if(n==2){Bn({text:"Correct!",submit:"Continue (Alt+Enter)"}),ot.classList.add("correct");let r=document.createElement("button");r.textContent="(Replay Again Later)",r.style.padding="6px 12px",r.addEventListener("click",a=>{d.lesson.replayLater()}),Gs.appendChild(r),en(r,"Practice this one again later before finishing the review."),ka(),await w(100),Dt.focus()}}else Bn({text:`Press "I'm Done" to let the Tutor know when you're done with this step.`,submit:"I'm Done (Alt+Enter)"});if(await w(1e3),d.lesson?.currentEvent!=i||d.lesson?.currentSubTask!=e){console.warn("Canceled opening LessonConfirm, task/subtask changed in the middle of opening");return}ot.style.opacity="1",ot.style.pointerEvents=null,on=!0,t&&d.lesson._subTaskNum>1?Di.classList.remove("hide"):Di.classList.add("hide"),rn.classList.toggle("hide",!s),await w(500)}class Ga{}class df extends Ga{constructor(e){super(),this.text=e}text;get(){return this.text}}class Nc extends Ga{constructor(e,t){super(),this.code=e,this.lang=t}code;lang;get(){return`
            <pre class="code"><code class="language-${this.lang}">${ph(this.code)}</code></pre>
            <div class="sub-task-btns">
                <button class="b-mark-done">Mark Done</button>
                <button class="b-replay"><div class="material-symbols-outlined">replay</div></button>
            </div>
        `}}class be{constructor(e){this.title=e}_i=-1;supertask;title;hasStarted=!1;isFinished=!1;_preVal;_preCol;_preLine;_prePFile;_preTutFile;taskRef;canBeFinished=!1;_resFinish;_prom;finalDelay=0;requiresDoneConfirm=!0;instantFinish=!1;exitLEventAfter=!1;noNextTask=!1;state;willShowLessonConfirm(){return d.lesson.overrideDisableLessonConfirm>0?!1:this.requiresDoneConfirm}addToHook(e){sc(e,this)}preventContinueIfFail(){return!1}getSections(){return[]}check(e){return!0}skipsRewind(){return!1}getCompleteness(){return 0}async endTask(){this._resFinish=null,this._prom=null,this.canBeFinished=!1,this.hasStarted=!1,this.cleanup();let e=this.supertask;if(!e)return;let t=e.tasks.indexOf(this);d.lesson.finishSubTask(this);let s=!1;this instanceof Bi&&this.correct&&this.nextSceneWhenCorrect&&(await w(300),await d.lesson.goToNextScene(),s=!0),!this.noNextTask&&!s&&(this.exitLEventAfter?e.startTask(null):e.startTask(e.tasks[t+1])),d.lesson.updateCurrentProgress()}async start(){d.lesson.updateCurrentProgress(),await d.lesson.goToActiveFile();let e=this;if(this._prom=new Promise(t=>{this._resFinish=function(s){if(e.canBeFinished)return t(s),1}}),d.lesson.isResuming&&this.supertask){if(d.lesson.resume.eventI==d.lesson.events.indexOf(this.supertask)&&d.lesson.resume.taskI==this.supertask.tasks.indexOf(this)){await d.lesson.finishResume();return}this.canBeFinished=!0,this._resFinish&&this._resFinish()}}async finish(){this.instantFinish&&(this.canBeFinished=!0,this._resFinish()),this.requiresDoneConfirm&&(d.lesson.isResuming||bi(d.lesson.tut)),this.canBeFinished=!0;let e=null;return this.willShowLessonConfirm()?Uc():d.lesson.overrideDisableLessonConfirm>0?this._resFinish():this.skipsRewind()&&this._resFinish(),this._prom&&(e=await this._prom),d.lesson.finishSubTask(this),this.isFinished=!0,ut(),this.cleanup(),this.finalDelay&&await w(this.finalDelay),this.endTask(),this.cleanupDelayed(),e}cleanup(){}cleanupDelayed(){}async play(){}async replay(e){if(await ut(),d.lesson.currentSubTask){d.lesson.isQuitting=!0,ho(),ac(),d.lesson.currentSubTask._resFinish(),await ri(100),d.lesson.isQuitting=!1;let t=this.supertask,s=this.supertask.tasks.indexOf(this);t.tasks[s],await d.lesson.restoreFromState(this.state);let n=[...ai.children];for(let r=s;r<n.length;r++)ai.removeChild(n[r]),t.tasks[r].taskRef=null;console.error("...start again"),t.startTask(this)}}static parse(e){let t=e.id;if(t==null)return;let s;switch(t){case"addFile":s=new Li(e.name,e.required);break;case"addCode":s=new Qc(e.text,e.lang);break;case"refresh":s=new eu(e.text,e.com);break;case"sideText":s=new eo(e.text,e.com);break;case"board":s=new tu(e.bid,e.text);break}return s}}class hf extends be{constructor(e,t,s=!1,n){super("Switch to file: "+e),this.name=e,this.comment=t,this.requiresDoneConfirm=s,this.ops=n??{},this.ops.path||(this.ops.path="")}skipsRewind(){return!this.requiresDoneConfirm}name;comment;ops;async start(){if(await super.start(),d.lesson.tut.curFile?.isSame(this.name,this.ops.path)){this.comment&&await Hi(d.lesson.tut.curFile.editor,this.comment,"left").clickProm,await this.finish();return}await d.lesson.switchFile(d.lesson.tut.getFileByPath(this.ops.path,this.name),this.comment,this),await this.finish()}}class Li extends be{constructor(e,t=!1,s,n){super("Add a file named: "+e),this.name=e,this.isRequired=t,this.requiresDoneConfirm=!1,this.customText=s,this.ops=n??{},this.ops.path||(this.ops.path="")}ops;name;isRequired;b;alreadyHas=!1;file;customText;preventContinueIfFail(){return this.isRequired}async start(){super.start(),this.alreadyHas=!1;let e=d.lesson.tut.parent.querySelector(".b-add-file"),t=e.getBoundingClientRect(),s=e;await Ke();let n=Se.subEvt(new Gt("createFile",g=>!(!this.check(g.name)&&this.preventContinueIfFail()||tt(g.getPath())!=tt(this.ops.path)||g.name!=this.name))),r=ye.getBoundingClientRect(),a=this.customText??"Let's create "+this.name,o=d.lesson.tut.getFileByPath(this.ops.path,this.name),c=!1,l=!1;if(o&&o==d.lesson.tut.curFile)a="Let's get back to "+this.name,l=!0;else if(o){a="Let's go back to "+this.name;let g=o.link;t=g.getBoundingClientRect(),s=g,c=!0}if(a!=""){let g=Te(4,a,"top",{x:r.x+r.width/2+17,y:r.y+r.height/2-22,click:!0});await Promise.any([g.clickProm,Se.waitFor(n)]),qe(g)}if(l)return await w(300),this.canBeFinished=!0,this._resFinish(),this.finish();d.lesson.toggleDisableSyncPos(!0),await Ke(),await Yt(t.x+t.width/2,t.y+t.height/2),await Xt(async()=>{},async()=>{o&&(d.lesson.startActiveFileUnlock(),o.open(),d.lesson.endActiveFileUnlock(),d.lesson.tut.curFile=o),d.lesson.tut.lastFolder=this.ops.path?d.lesson.tut.getFolderByPath(this.ops.path):null,c||(this.file=await d.lesson.tut.createFile(this.name,new Uint8Array,void 0,d.lesson.tut.lastFolder)),d.lesson.startActiveFileUnlock(),this.file.open(),d.lesson.endActiveFileUnlock(),c||await w(500)},s),await ut(),d.lesson.toggleDisableSyncPos(!1);let u=d.lesson.p.getFileByPath(this.ops.path,this.name);if(d.lesson.p.hasFileWrongPath(this.ops.path,this.name)){let g=Te(2,`You have the right file already but it's not in the right folder.
i[You can drag and drop your file in the Files menu to move it into the folder: h[${this.ops.path.split("/").pop()}]]`,void 0,{click:!1});await w(300);let p=!0;for(;;){p||(await Te(2,`Wrong spot, please try again. 
i[You can drag and drop your file in the Files menu to move it to the ${this.ops.path!=""?`path: h[${this.ops.path}]].`:"root path."}`,void 0,{click:!0}).clickProm,d.lesson.p.deselectSelFolder()),p&&(p=!1);let k=Se.subEvt(new Gt("moveFile")),D=await Se.waitFor(k);if(D&&tt(D.getPath())==this.ops.path&&D.name==this.name)break}qe(g),this.canBeFinished=!0,this._resFinish()}else if(!u&&!this.ops.onlyTutor){let g=d.lesson.p.lastFolder;if(this.ops.path==""?g!=null:!g||!g.isSame(this.ops.path,"")){d.lesson.p.toggleShowFilesBtn(!0);let p=Te(2,`Make sure you have the correct folder selected before creating the file, so the new file will go there.
i[The tutor wants you to ${this.ops.path==""?"press the h[escape] key to deselect your folders.":`select the h[${this.ops.path}] folder.`}`);if(this.ops.path==""){let k=Se.subEvt(new Gt("deselectFolders",D=>d.lesson.p.lastFolder==null));await Se.waitFor(k)}else{let k=Se.subEvt(new Gt("selectFolder",D=>{let E=D.getPath();return E.length==0?E=D.name:E+="/"+D.name,E==tt(this.ops.path)}));await Se.waitFor(k)}qe(p),await w(500)}this.b=Te(1,this.title),await Se.waitFor(n),qe(this.b),this.canBeFinished=!0,this._resFinish()}else if(!c&&!this.ops.onlyTutor){if(u&&u!=d.lesson.p.curFile){if(!u||!u?.link)this.b=Te(2,"Oh! I see you already have a "+this.name+" file! I'll switch you to it.","top",{click:!0});else{let g=u.link.getBoundingClientRect();this.b=Te(4,"Oh! I see you already have a "+this.name+" file! I'll switch you to it.","top",{click:!0,x:g.x+g.width/2+17,y:g.y+g.height/2-22})}await this.b.clickProm,await w(100),u.open(!1),await w(300)}this.canBeFinished=!0,this._resFinish()}else await w(300),this.canBeFinished=!0,this._resFinish();return await this.finish()}check(e){return e!=this.name&&e.toLowerCase()==this.name.toLowerCase()&&setTimeout(()=>{Te(2,`<div style="display:flex;align-items:center;gap:10px"><div class="material-symbols-outlined">warning</div>Hold on there.</div>
File names are "case sensitive" which means that:
<pre>h[${e}  ${this.name}]</pre>
i[File names are typically all lowercase.]`,void 0,{click:!0})},50),e==this.name}cleanup(){qe(this.b)}}const _s=19,Vo=7.7;let zc=!1,cr=!1;function mt(i){if(cr){i.updateOptions({readOnly:!1}),i.focus();return}d.lesson.goToActiveFileInstant();let e=d.lesson.activeFile??d.lesson.tut.curFile;if(e&&(e.blockPosChange=!1),i||(i=e.editor),i){i.updateOptions({readOnly:!1});let t=d.lesson.p.curFile;t?.editor&&(zc=t.editor.hasTextFocus())}}function ct(i){if(cr){i.updateOptions({readOnly:!0});return}d.lesson.goToActiveFileInstant();let e=d.lesson.activeFile??d.lesson.tut.curFile;e&&(e.blockPosChange=!0,i||(i=e.editor)),i&&i.updateOptions({readOnly:!0});let t=d.lesson.p.curFile;t&&zc&&t.editor.focus()}async function Ls(i,e,t=!1){}async function Fi(i,e,t=1,s=!1){let n=d.lesson.tut.curFile.editor==i;n&&d.lesson.startEditing(),n&&await d.lesson.goToActiveFile(),n&&Qa(i);let r;if(Pr==0)n&&mt(),i.updateOptions({readOnly:!1}),i.trigger("keyboard","type",{text:e}),r=i.getPosition().clone(),i.setValue(i.getValue()),i.setPosition(r),i.updateOptions({readOnly:!0}),n&&(d.lesson.tut.curFile.curRow=r.lineNumber,d.lesson.tut.curFile.curCol=r.column),n&&ct();else for(let a=0;a<e.length;a++){let o=e.substring(a,a+1);n&&mt(),i.updateOptions({readOnly:!1}),i.trigger("keyboard","type",{text:o}),i.updateOptions({readOnly:!0}),r=i.getPosition(),n&&(d.lesson.tut.curFile.curRow=r.lineNumber,d.lesson.tut.curFile.curCol=r.column),n&&ct(),await w(ui(e?.length??5)*t)}s&&await Ls(r.column,r.lineNumber,!0),n&&d.lesson.endEditing()}async function $c(i,e,t,s=!1){let n=i.getPosition();if(s){await oi(n.column+e,n.lineNumber+t,!0);return}await w(200);let r=it(i);r.setDelay(ui(5)),e&&await r.moveByX(e),t&&await r.moveByY(t),await w(wu),await ut()}let ba=!1,Un;async function Xt(i,e,t){await w(wu);let s=t?.classList.contains("f-hover");ye.classList.add("click"),Un!=null&&clearTimeout(Un),Un=setTimeout(()=>{ye?.classList.remove("click"),Un=null},2e3),ye.classList.add("clicking"),ye.style.transitionDuration="0.02s",ye.style.scale="0.75",await w(50),i&&await i(),t?.classList.add("f-hover"),await w(50),await w(40),ye.classList.remove("clicking"),s||t?.classList.remove("f-hover"),ye.style.scale="1",await w(250),ye.style.transitionDuration=null,e&&await e()}async function qc(i,e,t,s=!1){i||(i=d.lesson.tut.getCurEditor());let n=i.getPosition();if(s){await oi(e,t),mt(),i.setPosition(n.with(t,e)),ct();return}ba=!0,await Ke(!0),await w(200),await Tc(i,t,e),await Xt(async()=>{mt(),i.setPosition(n.with(t,e)),ct(),Ks()}),await ut(),ba=!1}class ae{constructor(){}noRush=!1;isRush(){return this.noRush?!1:d.lesson.currentSubTask instanceof Xc||d.lesson.info?.type==bt.rush}async run(e,t){}waitS(){return w(d.lesson.getStandardDelay())}async rushCheck(e,t){}rushable(){return!1}}class Wc extends ae{constructor(e=1){super(),this.amt=e}amt;async run(e,t){await t.makeLineBelow(this.amt),await w(350)}}class ff extends ae{constructor(e=1){super(),this.amt=e}amt;async run(e,t){await t.makeLineAbove(this.amt),await w(350)}}class pf extends ae{constructor(e=1){super(),this.amt=e}amt;async run(e,t){await t.deleteLines(this.amt),await this.waitS()}}class mf extends ae{constructor(e,t){super(),this.f=e,this.params=t}f;params;async run(e){if(this.f){let t=it(e),s=this.f(t);t[s](...this.params)}}}class gf extends ae{constructor(e="show"){super(),this.type=e}type;async run(e){let t=it(e);this.type=="show"?t.showSuggestions():this.type=="next"?t.nextSuggestion():this.type=="prev"?t.prevSuggestion():this.type=="accept"?t.acceptSuggestion():this.type=="hide"&&t.hideSuggestions()}}class vf extends ae{constructor(e=!1){super(),this.select=e}select;async run(e,t){t.home(this.select),await w(50)}}class wf extends ae{constructor(e=!1){super(),this.select=e}select;async run(e,t){t.end(this.select),await w(50)}}class yf extends ae{constructor(e,t={}){super(),this.tabDif=-e,this.ops=t,this.ops.dir||(this.ops.dir=1)}tabDif;ops;async run(e,t){let s=t.getTabSize(),n=e.getModel().getLineCount(),a=t.getCurLine().match(/^\s*/)[0].length,o=Math.ceil(a/s),c=!1;for(;;){await t.moveByY(this.ops.dir);let u=t.getCurLine().match(/^\s*/)[0].length,g=Math.ceil(u/s)-o;if(this.tabDif<0?g<=this.tabDif:g>=this.tabDif)if(this.ops.checks!=null){if(g==this.tabDif&&(this.ops.checks--,this.ops.checks<=0)){c=!0;break}}else{c=!0;break}let p=e.getPosition();if(p.lineNumber==1||p.lineNumber==n)break;await w(150)}c&&(this.ops.newLine&&(await t.makeLineEither(this.ops.newLine),await w(350)),this.ops.finalNewLine&&(await t.makeLineEither(this.ops.finalNewLine),await w(350))),await w(350)}async run_old(e){let t=Math.abs(this.tabDif),s=this.tabDif/t,n=it(e);for(let r=0;r<t;r++)n.end(),await n.moveByY(s),await w(50);this.ops.newLine&&n.makeLineBelow(1),await w(350)}}class bf extends ae{constructor(e,t,s=!1){super(),this.x=e,this.y=t,this.noShow=s}x;y;noShow;async run(e){await $c(e,this.x,this.y,this.noShow),await w(350)}}class _f extends ae{constructor(e,t,s=!1){super(),this.col=e,this.row=t,this.noShow=s}col;row;noShow;async run(e){await qc(e,this.col,this.row,this.noShow),await this.waitS()}}class xf extends ae{constructor(e){super(),this.code=e}code;async run(e){await Fi(e,this.code);let t=e.getPosition();d.lesson.tut.curFile.curRow=t.lineNumber,d.lesson.tut.curFile.curCol=t.column,await Ls(t.column,t.lineNumber,!0),await w(350)}}class kf extends ae{constructor(e){super(),this.amt=e}amt;async run(e){let t=e.getPosition(),s=it(e),n=s.getLine(t.lineNumber),r=s.getTabSize(),a=mh(n," "),o=Math.floor(a/r);mt(),s.indent(this.amt-o),ct()}}class Sf extends ae{constructor(){super()}async run(e){mt(),e.trigger("comment","editor.action.commentLine",null),ct(),await w(350)}}class Ef extends ae{constructor(e,t={}){super(),this.pat=e,this.ops=t??{}}pat;ops;async run(e,t){let s=this.ops.n??1,n=this.ops.offX??0,r=this.ops.offY??0;this.ops.end&&(n+=this.pat.length),this.ops.below&&r++;let a=0;for(let o=0;o<s;o++){let l=e.getValue().indexOf(this.pat,a);if(a=l,l==-1)break}if(a!=-1){let o=e.getModel().getPositionAt(a),c=e.getPosition(),l=o.lineNumber+r-c.lineNumber,u=o.column+n-c.column;(this.ops.useMouse==null?!Yc(u,l):!this.ops.useMouse)?(await t.moveByY(l),c=e.getPosition(),u=o.column+n-c.column,await t.moveByX(u)):(await Ke(),await w(d.lesson.getStandardDelay()),await qc(e,o.column+n,o.lineNumber+r),await ut())}this.ops.below&&t.end(),await w(350)}}class Kn extends ae{constructor(e,t,s,n,r={}){super(),this.tag=e,this.endAtCenter=t,this.open=s,this.text=n,this.ops=r}tag;endAtCenter;open;text;ops;async run(e,t){let s=this.text??"";this.isRush()&&(this.tag="".repeat(this.tag.length));let n=[];if(this.ops.attr){let a=Object.keys(this.ops.attr);for(const o of a){let c=this.ops.attr[o];n.push(o+`="${c}"`)}}n.length?await t.type(`<${this.tag} ${n.join(" ")}>`):await t.type(`<${this.tag}>`),s?.length&&(await w(150),await t.type(`${s}`),await w(100)),this.ops.noClosingTag||await t.type(`</${this.tag}>`);let r=e.getPosition();if(await Ls(r.column,r.lineNumber,!0),this.endAtCenter){await w(150);for(let a=0;a<3+this.tag.length;a++)Ii(),await $c(e,-1,0,!0),Oi(),await w(ui(3+this.tag.length)*.75);await w(300)}this.open&&await t.open()}rushable(){return!0}async rushCheck(e,t){let s=e._back.actions,n=it(t.editor);await s.waitUntilMatching(r=>this.open&&this.endAtCenter?[r-1,r,r+1]:this.open?[r-1,r]:[r],n)}}class Cf extends ae{constructor(e,t={}){super(),this.name=e,this.ops=t}name;ops;async run(e){let t=it(e);await Fi(e,`class ${this.name}`+(this.ops.extends?` extends ${this.ops.extends}`:"")),await t.openSymbols("{}")}}class Lf extends ae{constructor(){super()}}class Ff extends ae{constructor(e,t="top"){super(),this.text=e,this.dir=t}text;dir;async run(e){let s=vn().getBoundingClientRect(),n=Te(4,this.text,this.dir,{x:s.x+s.width/2+17+ye.getBoundingClientRect().width/2,y:s.y+s.height/2-22-_s/2+2,click:!0,inEditor:d.lesson.tut.getCurEditor()});await n.clickProm,qe(n),await w(350)}}class Pf extends ae{constructor(){super()}async run(e){await w(250),it(e).showDebugHover(),await w(250)}}class Tf extends ae{constructor(){super()}async run(e){await w(250),it(e).hideSuggestions(),await w(250)}}class If extends be{constructor(){super("Show Hover")}async start(){await super.start(),await Ke();let e=d.lesson.tut.getCurEditor(),t=it(e);e&&(await w(250),t.showDebugHover(),await w(250)),await this.finish(),t.editor&&t.simulateMouseEnterAndLeave(),await ut()}}class Of extends ae{constructor(e=1,t=!1){super(),this.amt=e,this.toRight=t}amt;toRight;async run(e){let t=this.toRight?"deleteRight":"deleteLeft",s=ui(this.amt);for(let n=0;n<this.amt;n++)mt(),e.trigger("keyboard",t,null),ct(),await w(s);await w(200)}}class Af extends ae{constructor(e=1,t=!1,s=!1){super(),this.amt=e,this.right=t,this.word=s}amt;right;word;async run(e,t){await t.deleteText(this.amt,this.right,this.word),await this.waitS()}}class Df extends ae{constructor(e=1,t,s){super(),this.amt=e,this.select=t,this.word=s}amt;select;word;async run(e){await it(e).moveByX(this.amt,this.select,this.word),await w(350)}}class Hc extends ae{constructor(e=1,t){super(),this.amt=e,this.select=t}amt;select;async run(e){await it(e).moveByY(this.amt,this.select),await w(350)}}class jf extends ae{constructor(){super()}async run(e){it(e).cancelSelection(),await w(350)}}class Rf extends be{constructor(){super("Cancel Selection"),this.requiresDoneConfirm=!1}async start(){await super.start(),it(d.lesson.activeFile.editor).cancelSelection(),this.canBeFinished=!0,this._resFinish(),await this.finish()}}class Bf extends ae{constructor(e,t,s,n,r=!1){super(),this.row1=e,this.col1=t,this.row2=s,this.col2=n,this.isInstant=r}row1;col1;row2;col2;isInstant;async run(e){if(this.isInstant){mt();let t=new monaco.Range(this.row1,this.col1,this.row2,this.col2);e.setSelection(t),ct()}else{let t=350,s=10,n=t/s,r=this.col1,a=this.row1,o=this.col2-this.col1,c=this.row2-this.row1;o/=s,c/=s,await Ke(),await w(250),await oi(this.col1,this.row1),await w(250);let l=new monaco.Range(this.row1,this.col1,this.row1,this.col1);oi(this.col2,this.row2);for(let u=0;u<s;u++){r+=o,a+=c;let m=Math.round(a),g=Math.round(r);l=new monaco.Range(this.row1,this.col1,m,g),mt(),e.setSelection(l),ct(),await w(n*(.01+s/(u+1)))}await w(500),await ut()}await w(350)}}class Vc extends ae{constructor(e){super(),this.time=e}time;async run(e){await w(this.time)}}class Mf extends ae{constructor(){super()}async run(e,t){t.copy(),await this.waitS()}}class Uf extends ae{constructor(){super()}async run(e,t){t.paste(),await this.waitS()}}class Nf extends ae{constructor(){super()}async run(e,t){t.cut(),await this.waitS()}}class zf extends ae{constructor(e){super(),this.amt=e}amt;async run(e,t){t.copyLinesDown(this.amt),await this.waitS()}}class $f extends ae{constructor(e){super(),this.amt=e}amt;async run(e,t){t.copyLinesUp(this.amt),await this.waitS()}}class qf extends ae{constructor(e,t){super(),this.name=e,this.ops??={},this.ops.path||(this.ops.path="")}name;ops;async run(){if(d.lesson.tut.curFile?.isSame(this.name,this.ops.path)){this.ops?.comment&&await Hi(d.lesson.tut.curFile.editor,this.ops.comment,"left").clickProm;return}await d.lesson.switchFile(d.lesson.tut.getFileByPath(this.ops.path,this.name),this.ops?.comment),await this.waitS()}}class Wf extends ae{constructor(e=!1){super(),this.select=e}select;async run(e,t){t.startOfFile(this.select),await this.waitS()}}class Hf extends ae{constructor(e=!1){super(),this.select=e}select;async run(e,t){t.endOfFile(this.select),await this.waitS()}}function Gn(){return" "}class Xa{constructor(e){this.editor=e,this.useStandardDelay()}editor;_listeners=[];startInputListener(e){let t=this.editor.onDidChangeModelContent(e);this._listeners.push(t)}endListener(){this._listeners.pop().dispose()}compareTo(e,t){for(const s of e){let n=this.getLine(s),r=t.getLine(s),a=n.replace(/(["'`])\s*\{/g,"$1{"),o=r.replace(/(["'`])\s*\{/g,"$1{");if(a!=o)return!1}return!0}compareTo_details(e,t){let s=!0,n=[];for(const r of e){let a=this.getLine(r),o=t.getLine(r),c=a.replace(/(["'`])\s*\{/g,"$1{"),l=o.replace(/(["'`])\s*\{/g,"$1{"),u=[],m=Math.max(a.length,o.length);for(let g=0;g<m;g++)a[g]!=o[g]&&u.push(g);c!=l&&(s=!1,n.push({line:r,markedCols:u}))}return{res:s,details:n}}async waitUntilMatching(e,t){let s=e(this.editor.getPosition().lineNumber),n,r=new Promise(a=>n=a);t.startInputListener(a=>{this.compareTo_details(s,t).res&&(n(),t.endListener())}),await r}delay=0;lastDelay=0;_speed=1;async wait(){this.delay&&await w(this.delay*this.getSpeed())}setDelay(e){this.lastDelay=this.delay,this.delay=e}getDelay(){return this.delay}clearDelay(){this.lastDelay=this.delay,this.delay=0}revertDelay(){let e=this.lastDelay;this.lastDelay=this.delay,this.delay=e}useTypeDelay(e){this.setDelay(ui(e))}useStandardDelay(){this.setDelay(50)}_start(){mt(this.editor)}_end(){ct(this.editor)}cancelSelection(){this._trigger("cancelSelection")}minSpeed=0;maxSpeed=9999;setSpeed(e){e<this.minSpeed?e=this.minSpeed:e>this.maxSpeed&&(e=this.maxSpeed),this._speed=e}resetSpeed(){this._speed=1,this.speedVelFunc=null,this.minSpeed=0,this.maxSpeed=9999}speedVelFunc;setSpeedVelFunc(e){this.speedVelFunc=e}getSpeed(){return this.speedVelFunc&&this.setSpeed(this.speedVelFunc(this._speed)),this._speed*oc}setMinSpeed(e){this.minSpeed=e}setMaxSpeed(e){this.maxSpeed=e}async type(e){for(const t of e)this._trigger("type",{text:t}),await w(ui(e.length)*this.getSpeed())}typeInstant(e){mt(this.editor);let t=this.editor.getScrollTop(),s=this.editor.getValue(),n=this.editor.getModel().getOffsetAt(this.editor.getPosition());s=s.substring(0,n)+e+s.substring(n),this.editor.setValue(s),this.editor.setScrollTop(t);let r=this.editor.getModel().getPositionAt(n+e.length);this.editor.setPosition(r),ct(this.editor)}async openSymbols(e,t=250){let s=Pr,n=this.editor.getPosition(),r=this.getLine(n.lineNumber);await Fi(this.editor,(r[n.column-2]==" "?"":Gn())+e,0),this.clearDelay(),await this.moveByX(-1),this.revertDelay(),this.setDelay(t),await this.wait(),this.revertDelay(),this._start(),await this.open(),this._end(),wt(s)}async open(){await this.type(`
`);let e=this.editor.getPosition(),s=this.getLine(e.lineNumber)[e.column-1];s!=null&&s!=" "&&(await this.makeLineAbove(1),await this.indent(1))}_trigger(e,t){this._start(),this.editor.trigger("keyboard",e,t),this._end()}showSuggestions(){this._trigger("editor.action.triggerSuggest")}hideSuggestions(){let e=this.editor.getDomNode().querySelector(".suggest-widget");e?(e.classList.remove("visible"),e.classList.add("hidden"),e.style.display="none"):console.warn("failed to hide suggestions, couldn't find suggest dom widget")}nextSuggestion(){this._trigger("selectNextSuggestion")}prevSuggestion(){this._trigger("selectPrevSuggestion")}acceptSuggestion(){this._trigger("acceptSelectedSuggestion")}toggleSuggestionDetails(){this._trigger("toggleSuggestionDetails")}getLine(e){if(!e||e<0)return"";let t=this.editor.getModel().getLineCount();return e>t?"":this.editor.getModel().getLineContent(e)}getCurLine(){let e=this.editor.getPosition().lineNumber;return this.editor.getModel().getLineContent(e)}async indent(e){for(let t=0;t<Math.abs(e);t++)this._start(),this.editor.trigger("indent",e>0?"editor.action.indentLines":"editor.action.outdentLines",null),this._end(),await this.wait()}getCurLineTabAmt(){return this.getLineTabAmt(this.getCurLine())}getLineTabAmt(e){let t=this.getTabSize(),s=e.match(/^\s*/)[0].length;return Math.ceil(s/t)}async clearLine(){this.deleteLines(),await this.makeLineAbove()}getTabSize(){return this.editor.getModel().getOptions().tabSize}copy(){d.lesson._clipboardText=this.getCurLine()}paste(){this._start(),this.editor.trigger("keyboard","type",{text:d.lesson._clipboardText}),this._end()}cut(){d.lesson._clipboardText=this.getCurLine(),this.deleteLinesInstant()}async copyLinesDown(e=1){for(let t=0;t<e;t++)this._trigger("editor.action.copyLinesDownAction"),await this.wait()}async copyLinesUp(e=1){for(let t=0;t<e;t++)this._trigger("editor.action.copyLinesUpAction"),await this.wait()}home(e=!1){this._start(),e?this.editor.trigger("keyboard","cursorHomeSelect",null):this.editor.trigger("keyboard","cursorHome",null),this._end()}end(e=!1){this._start(),e&&this.editor.trigger("keyboard","cursorEndSelect",null),this.editor.trigger("keyboard","cursorEnd",null),this._end()}startOfFile(e=!1){this._start(),e&&this.editor.trigger("keyboard","cursorTopSelect",null),this.editor.trigger("keyboard","cursorTop",null),this._end()}endOfFile(e=!1){this._start(),e&&this.editor.trigger("keyboard","cursorBottomSelect",null),this.editor.trigger("keyboard","cursorBottom",null),this._end()}async makeLineAbove(e=1){for(let t=0;t<e;t++)this._start(),this.editor.trigger("keyboard","editor.action.insertLineBefore",null),this._end(),await this.wait()}async makeLineBelow(e=1){for(let t=0;t<e;t++)this._start(),this.editor.trigger("keyboard","editor.action.insertLineAfter",null),this._end(),await this.wait()}async makeLineEither(e=1){e>=0?await this.makeLineBelow(e):await this.makeLineAbove(-e)}async deleteText(e=1,t=!1,s=!1){for(let n=0;n<e;n++)this._start(),t?s?this.editor.trigger("keyboard","deleteWordRight",null):this.editor.trigger("keyboard","deleteRight",null):s?this.editor.trigger("keyboard","deleteWordLeft",null):this.editor.trigger("keyboard","deleteLeft",null),Ks(),this._end(),await this.wait()}async moveByX(e,t=!1,s=!1){let n="Left",r="",a="";e>0&&(n="Right"),t&&(r="Select"),s&&(a="Word");let o="cursor"+a+n+r;for(let c=0;c<Math.abs(e);c++)this._start(),this.editor.trigger("keyboard",o,null),this._end(),Ks(),await this.wait()}async moveByY(e,t=!1){let s="Up",n="";e>0&&(s="Down"),t&&(n="Select");let r="cursor"+s+n;for(let a=0;a<Math.abs(e);a++)this._start(),this.editor.trigger("keyboard",r,null),this._end(),Ks(),await this.wait()}async goToNextFree(e){let t=this.editor.getPosition(),s=this.editor.getModel().getLineCount(),n=this.getTabSize();for(let r=t.lineNumber;r<=s;r++){let a=this.getLine(r);if(!a)continue;let o=0;for(let c=0;c<a.length&&a[c]==" ";c++)o++;if(o<=e*n)return;await this.moveByY(1),await this.wait()}await this.clearLine(),await this.indent(e)}async deleteLines(e=1){for(let t=0;t<e;t++)this._trigger("editor.action.deleteLines"),await this.wait()}deleteLinesInstant(){this._trigger("editor.action.deleteLines")}showDebugHover(){this._start(),this.editor.trigger("hover_info","editor.action.showHover",null),this._end()}simulateMouseEnterAndLeave(){this._start();let e=this.editor.getDomNode(),t=new MouseEvent("mouseenter",{bubbles:!0,cancelable:!1,view:window});e.dispatchEvent(t);let s=new MouseEvent("mouseleave",{bubbles:!0,cancelable:!1,view:window});e.dispatchEvent(s),this._end()}async cssSet(e,t,s={afterDelay:50}){let n=1;await Fi(this.editor,`${e}`,n),await this.openSymbols("{}"),await w(350);let r=0,a=Object.keys(t);for(const o of a){let c=t[o];await Fi(this.editor,Yo(o)+":"+Gn(),n),await w(150),await Fi(this.editor,c+";"+(r!=a.length-1?`
`:""),n),r++}await w(s.afterDelay)}async cssRule(e,t={afterDelay:50}){let s=0,n=Object.keys(e);for(const r of n){let a=e[r];await this.type(Yo(r)+":"+Gn()),await w(150),await this.type(a+";"+(s!=n.length-1?`
`:"")),s++}await w(t.afterDelay)}}function Yo(i){return i.replace(/[A-Z]/g,"-$&").toLowerCase()}function it(i){return new Xa(i)}function vn(){return d.lesson.tut.parent.querySelector(".cursor")}function Qa(i){let e=i.getPosition().clone();i.setValue(i.getValue()),i.setPosition(e)}class Vf extends ae{constructor(e,t){super(),this.rule=e,this.value=t}rule;value;async run(e){await Fi(e,this.rule+":"+Gn()+this.value+";"),await w(350)}}class Yf extends ae{constructor(e,t){super(),this.selector=e,this.styles=t}selector;styles;async run(e,t){await t.cssSet(this.selector,this.styles)}}class Zf extends ae{constructor(e){super(),this.styles=e}styles;async run(e,t){await t.cssRule(this.styles),await this.waitS()}}class Kf extends ae{constructor(e,t){super(),this.text=e,this.ops=t??{}}text;ops;async run(e,t){await t.type(this.text),await w(700),t.acceptSuggestion(),await w(500),this.ops.open&&(await w(150),await t.type(`
`)),this.ops.txt&&(await w(150),await t.type(this.ops.txt)),this.ops.newLine!=null&&(await w(150),await t.makeLineEither(this.ops.newLine)),await w(350)}}class Zo{constructor(e){this.elm=e,this.parts=[]}elm;parts}const Ko={"!":{lines:["<!DOCTYPE html>",'<html lang="en">',"<head>",'	<meta charset="UTF-8">','	<meta name="viewport" content="width=device-width, initial-scale=1.0">',"	<title>Document</title>","</head>","<body>","","</body>","</html>"]},"!!!":{lines:["<!DOCTYPE html>"]},_lorem:{lines:[],type:i=>{let e=parseInt(i.replace("lorem",""));return Gf.slice(0,e).join(" ")}}},Gf="Lorem ipsum dolor sit amet consectetur, adipisicing elit. Magni repudiandae, odit esse sed dolore error voluptatibus numquam at quisquam, exercitationem saepe. Nihil at voluptatem eius aspernatur facere numquam quam architecto aut consequuntur quos sit soluta nobis incidunt molestias adipisci ex odio repellat amet ipsam nam nisi sapiente, eum dolore! Nobis sint animi dolores mollitia, ullam sapiente ipsum, quae consequatur quos hic odit accusantium perferendis qui nemo facilis necessitatibus, dolorum enim veritatis! Nam sunt a laborum consectetur dicta optio repudiandae culpa eum eveniet architecto eos itaque perspiciatis maxime mollitia, maiores cupiditate rem, laboriosam suscipit reprehenderit vero. Quasi accusantium velit placeat sit sed, laboriosam voluptatibus qui veritatis! Labore qui debitis maxime quisquam ipsa accusamus ratione non nesciunt inventore nihil iure, beatae voluptate incidunt vero odio illo quis, amet adipisci nostrum assumenda! Nostrum ad eaque, nihil inventore doloremque cumque nesciunt eveniet harum deserunt iure, consectetur soluta ullam quasi dolore deleniti numquam earum provident aliquid magnam architecto. Blanditiis non voluptates minima sequi autem. Eum culpa optio porro? Inventore quasi quaerat, neque libero quae labore optio ex et qui non deserunt, nemo, atque animi iusto eius. Sed assumenda ducimus quam illo, cum illum aliquid repellat commodi neque nostrum fuga labore molestias dolorem libero, laudantium rerum sit nulla ex, hic consequatur perspiciatis accusamus? Magnam natus, eum mollitia a sed, non vero culpa tempore officiis, nulla pariatur iure consequatur. Quasi, tempore aut voluptatem veniam esse recusandae excepturi temporibus? Odit necessitatibus natus fugiat harum mollitia consequuntur, amet asperiores reiciendis eaque aperiam tempore voluptate. Impedit blanditiis perspiciatis hic? Quibusdam corrupti repudiandae quia officia vero autem ipsam consequatur nisi laudantium est sapiente, veniam doloribus reiciendis adipisci saepe debitis libero iusto ullam vitae! Exercitationem totam natus laudantium quaerat consequatur necessitatibus veritatis quibusdam nam corrupti. Error enim reiciendis laboriosam hic corporis id eos recusandae eum autem alias expedita nisi, provident fugit! Ipsam reiciendis doloribus molestias repellendus hic dolores sapiente aliquid! Nulla autem nostrum neque est sunt necessitatibus, odit impedit. Labore voluptate pariatur vitae accusantium doloribus eos optio eum nobis sequi vel, minima ex corrupti assumenda dolor repellat eligendi rem. Vel facere impedit expedita velit quibusdam dignissimos rerum natus temporibus nam quos enim quas odit deleniti minima, autem possimus ipsam, minus consectetur ipsum aperiam unde perspiciatis saepe inventore! Commodi itaque, voluptatem corporis tempora necessitatibus qui ratione animi? Ipsam quidem ipsa incidunt ad veritatis corrupti sunt. Pariatur non eveniet vero? Saepe impedit praesentium quam, laborum asperiores distinctio nemo aperiam expedita sequi laboriosam cupiditate, reprehenderit ad, quae suscipit odit enim voluptate sint. Vero beatae consequatur accusamus voluptatibus fugit ratione necessitatibus, culpa, a asperiores animi similique magnam iure qui error aliquid? Fuga quo illo quidem voluptatem expedita quas, quod blanditiis ipsum facere ad officiis consectetur vel? Sit ea similique possimus, praesentium quod illo temporibus ullam assumenda dignissimos, ab expedita officia est, obcaecati reprehenderit harum eveniet veritatis itaque iure nihil dicta! Repellat quis dicta in! Sequi, numquam dignissimos sapiente beatae nihil repellat sed earum neque! Cumque minima veniam quo obcaecati aspernatur, eveniet nulla et eius ut rem quaerat mollitia. Aut, repellat. Obcaecati aut dicta repellat odio sint?".split(" "),Xf={a:{attr:{href:""}},link:{attr:{rel:"stylesheet",href:""}}};async function Qf(i,e,t){let s=i.editor,n=Object.keys(Ko),r=-1;for(let O=0;O<n.length;O++){let x=n[O];if(x.startsWith("_")){if(e.startsWith(x.substring(1))){r=O;break}}else if(x==e){r=O;break}}let a=Ko[n[r]];if(a){i.clearDelay(),wt(0),i.home(),s.getPosition().column==1&&i.home(),i.clearDelay(),await i.deleteText(e.length,!0),i.revertDelay();let O=s.getPosition().column;for(let x=0;x<a.lines.length;x++){let te=a.lines[x];if(i.typeInstant(te),x!=a.lines.length-1){await i.makeLineBelow(1);let se=s.getPosition();mt(),s.setPosition({column:O,lineNumber:se.lineNumber}),ct()}}if(a.type){let x=a.type(e);i.typeInstant(x)}i.revertDelay(),wt(1);return}let o=["#","^",".","*","[","{",">","+"],c=["!","@","?","&","'",'"',"~","`","<","	",`
`,"="," "];i.home(),s.getPosition().column==1&&i.home();let u=s.getPosition().column,m=i.getCurLine();for(i.clearDelay(),await i.deleteText(e.length,!0),i.revertDelay();u>0;){let O=m[u-1];if(c.includes(O))break;u--}let g=m.substring(u);if(!g)return;let p=[],k=[],D=0,E=g,C="";for(let O=0;O<g.length;O++){let x=g[O];(x=='"'||x=="'")&&C==""?C=x:x==C&&(C=C=="'"?'"':"'"),!C&&o.includes(x)&&(p.push(g.substring(D,O)),k.push(x),D=O+1,E=g.substring(D))}E&&p.push(E);let U=document.createElement("div"),A="",R=(O,x,te,se,st=1)=>{let fe=Me=>(Me||console.error("invalid text to format for emmet parse: ",`[${Me}]`),Me=Me?.replace(/(?<!\\)\$/g,st?.toString()),Me),xe=(Me,gt,Ot)=>{if(!Ot)return fe(Me.splice(0,1)[0]);let vt=gt.indexOf(Ot);return vt==-1?(console.error("SOMETHING VERY WRONG HAPPENED WHEN PARSING EMMET [1]",Me,Ot),""):fe(Me.splice(vt,1)[0])},dt=(Me,gt)=>{if(!gt)return Me.splice(0,1)[0];let Ot=Me.indexOf(gt);return Ot==-1?(console.error("SOMETHING VERY WRONG HAPPENED WHEN PARSING EMMET [2]"),""):Me.splice(Ot,1)[0]};[...O],[...x];let Nt=()=>{if(!O.length)return;let Me=[...O],gt=[...x],Ot=xe(O,x,null),vt=document.createElement(Ot),Os=new Zo(vt),Ki=Xf[Ot];if(Ki&&Ki.attr){let ht=Object.keys(Ki.attr);for(const Ce of ht)vt.setAttribute(Ce,Ki.attr[Ce])}let _=x.length,Ae=[...x];for(let ht=0;ht<_;ht++){let Ce=Ae[ht];if(Ce==">"||Ce=="+"||Ce=="^")break;if(Ce==".")vt.classList.add(xe(O,x,Ce)),dt(x,Ce);else if(Ce=="#")vt.id=xe(O,x,Ce),dt(x,Ce);else if(Ce=="{"){let nt=xe(O,x,Ce);dt(x,Ce),vt.textContent=nt.substring(0,nt.length-1)}else if(Ce=="["){let nt=xe(O,x,Ce);if(dt(x,Ce),console.log("ATTR TEXT: ",nt),nt=nt.substring(0,nt.length-1),nt.includes("=")){let Pe=nt.split("=");Pe[1].startsWith("'")&&(Pe[1]=Pe[1].substring(1,Pe[1].length-1)),vt.setAttribute(Pe[0],Pe[1])}else vt.setAttribute(nt,"")}}Ae=[...x];for(let ht=0;ht<Ae.length;ht++){let Ce=Ae[ht];if(Ce=="*"){let nt=parseInt(xe(O,x,Ce));dt(x,Ce);let Pe=gt.indexOf("*");Me.splice(Pe+1,1),gt.splice(Pe,1);let As=!1;for(let Lt=Pe;Lt<gt.length;Lt++){let In=gt[Lt];(In=="+"||In=="^"||As)&&(Me.splice(Lt+1,1),gt.splice(Lt,1),Lt--,As=!0)}for(let Lt=0;Lt<nt;Lt++)R([...Me],[...gt],te,se,Lt+1);dt(x,x[Pe]);return}}se.parts.push(Os),A+=vt.outerHTML,Ae=[...x];for(let ht=0;ht<Ae.length;ht++){let Ce=Ae[ht];if(Ce=="+"||Ce=="^"){dt(x,Ce),Nt();return}else if(Ce==">"){dt(x,Ce),te=vt,se=Os,Nt();return}}};Nt(),U.innerHTML="",U.remove()},re=new Zo(U);R(p,k,U,re);function me(O){if(t.forceNoInline)return!1;document.body.appendChild(O);let x=getComputedStyle(O).display.includes("inline");return O.remove(),x}async function Y(O,x,te){let se=!1,st=me(O.elm);for(const xe of O.parts)if((!me(xe.elm)||xe.parts.length!=0)&&O.parts.length!=0){se=!0;break}!st&&te&&me(te.elm)&&await i.makeLineBelow(1);let fe=O.elm.outerHTML;if(i.typeInstant(fe),fe.includes("/")&&O.parts.length!=0){let xe=fe.indexOf(">")+1;await i.moveByX(-(fe.length-xe)),se&&await i.open()}for(let xe=0;xe<O.parts.length;xe++){let dt=O.parts[xe];await Y(dt,O,O.parts[xe-1])}se&&await i.moveByY(1),st||x.parts.indexOf(O)!=x.parts.length-1&&await i.makeLineBelow(1)}i.clearDelay(),i.setSpeed(0),wt(0),Ii();for(const O of re.parts)await Y(O,re,null);i.revertDelay(),i.resetSpeed(),wt(1),Oi()}class Jf extends ae{constructor(e,t){super(),this.text=e,this.ops=t??{};let s=this.ops.newLine==null;this.ops.open&&s&&(this.ops.newLine=0)}text;ops;async run(e,t){if(this.ops.resolveOnly||(await t.type(this.text),await w(300),t.hideSuggestions()),await Qf(t,this.text,this.ops),this.ops.open){await w(150);let s=t.getCurLine(),n=s.indexOf(">")+1;await t.moveByX(-(s.length-n)),await w(250),await t.open()}else if(this.ops.endAtCenter){await w(150);let s=t.getCurLine(),n=s.indexOf(">")+1;await t.moveByX(-(s.length-n))}this.ops.txt&&(await w(150),await t.type(this.ops.txt)),this.ops.newLine!=null&&(await w(150),await t.makeLineEither(this.ops.newLine)),await w(350)}}class ep extends ae{constructor(e){super(),e==null&&(e=1),this.amt=e}amt;async run(e,t){for(let s=0;s<this.amt;s++)t._start(),e.trigger("keyboard","jumpToNextSnippetPlaceholder",null),t._end(),await w(350)}}class tp extends ae{constructor(){super()}async run(e,t){await t.open(),await w(350)}}class ip extends ae{constructor(e){super(),this.ops=e??{}}ops;async run(e,t){let s=this.ops.x??0,n=this.ops.y??0;this.ops.relative&&(s+=e.getScrollLeft(),n+=e.getScrollTop()),e.setScrollPosition({scrollLeft:s,scrollTop:n}),await this.waitS()}}class sp extends ae{constructor(){super()}async run(e,t){let s=e.getPosition();d.lesson.cursorHistory.history.push([s.column,s.lineNumber])}}function Yc(i,e){return Math.abs(i)>10||Math.abs(e)>3}class np extends ae{constructor(){super()}async run(e,t){let s=e.getPosition(),n=d.lesson.cursorHistory.history.pop(),r=0,a=0;if(Yc(n[0]-s.column,n[1]-s.lineNumber))await Ke(),await w(d.lesson.getStandardDelay()),mt(),e.setPosition({column:n[0]+r,lineNumber:n[1]+a}),ct(),await w(d.lesson.getStandardDelay()),await ws(e),await ut();else{let o=e.getPosition(),c=n[1]+a-o.lineNumber;await t.moveByY(c),o=e.getPosition();let l=n[0]+r-o.column;await t.moveByX(l)}}}class Zc extends be{constructor(e){super("Prompt Open Files"),this.ops=e??{},this.requiresDoneConfirm=!1,this.instantFinish=!0}ops;async start(){await super.start();let e=d.lesson.tut.getCurEditor();this.ops.preText!=null&&(await Hi(e,this.ops.preText??"Let's open the Files Pane.","top").clickProm,await w(500));let t=this.ops.promptText??"Open yours too.",s=d.lesson.tut.d_files.querySelector(".b-show-files-pane"),n=d.lesson.p.d_files.querySelector(".b-show-files-pane");if(!n||!s){alert("A serious issue has occured, please reload the page. (promptOpenFiles)"),console.error("Err: no btnYou or btnTut found (promptOpenFiles):",n,s);return}let r=s.getBoundingClientRect();if(d.lesson.toggleDisableSyncPos(!0),await Ke(),await Yt(r.x+r.width/2,r.y+r.height/2),await w(300),await Xt(async()=>{d.lesson.tut.toggleShowFilesBtn(!0)},void 0,s),await w(500),d.lesson.toggleDisableSyncPos(!1),!this.ops.tutorOnly&&!d.lesson.isResuming){let a=n.getBoundingClientRect(),o=Te(4,t,"top",{x:a.x+a.width/2+22,y:a.y+a.height/2+15-30}),c=Se.subEvt(new Gt("openShowFiles"));await Se.waitFor(c),qe(o)}await this.finish()}}class rp extends be{constructor(e){super("Prompt Upload File"),this.ops=e??{},this.instantFinish=!0}ops;async start(){await super.start(),console.log("---STARTING UPLOAD FILE"),d.lesson.tut.getCurEditor();let e=this.ops.promptText??"Open yours too.",t=d.lesson.tut.parent.querySelector(".dd-files-pane-options"),s=(r,a)=>r?!0:(alert("A serious issue has occured, please reload the page. (promptUploadFile)"),console.error(`Err: no ${a} found (promptUploadFile):`,r),!1);if(!s(t,"btnTut"))return;let n=t.getBoundingClientRect();if(d.lesson.toggleDisableSyncPos(!0),await Ke(),await Yt(n.x+n.width/2,n.y+n.height/2),await w(300),await Xt(async()=>{let r=new MouseEvent("mousedown");t.dispatchEvent(r),console.log(t)},void 0,t),await w(500),d.lesson.toggleDisableSyncPos(!1),d.lesson.tut.parent.querySelector(".dd-files-pane-options"),d.lesson.p.parent.querySelector(".dd-files-pane-options"),!this.ops.tutorOnly&&!d.lesson.isResuming){let r=d.lesson.p.parent.querySelector(".dd-files-pane-options");if(!s(r,"btnYou"))return;let a=r.getBoundingClientRect(),o=Te(4,e,"top",{x:a.x+a.width/2+22,y:a.y+a.height/2+15-30}),c=Se.subEvt(new Gt("openShowFiles"));await Se.waitFor(c),qe(o)}await this.finish()}}class Kc extends be{constructor(e,t){super("Prompt Create Folder: "+e),this.name=e,this.ops=t??{},this.requiresDoneConfirm=!1,this.instantFinish=!0}name;ops;async start(){await super.start(),this.ops.path==null&&(this.ops.path="");let e=d.lesson.tut.getCurEditor();d.lesson.tut.fileList.parentElement.classList.remove("hide");let t=null;this.ops.path&&(t=d.lesson.tut.getFolderByPath(this.ops.path),t||alert("An error occured and the tutor couldn't find a folder it needed. (promptCreateFolder)")),this.ops.preText!=null&&(await Hi(e,this.ops.preText??"Let's create a folder.","").clickProm,await w(500));let s=this.ops.promptText??"Create a folder named: "+this.name,n=d.lesson.tut.fileList.parentElement.querySelector(".b-new-folder"),r=d.lesson.p.fileList.parentElement.querySelector(".b-new-folder");if(!r||!n){alert("A serious issue has occured, please reload the page. (promptCreateFolder)"),console.error("Err: no btnYou or btnTut found (promptCreateFolder):",r,n);return}let a=n.getBoundingClientRect();if(d.lesson.toggleDisableSyncPos(!0),await Ke(),await Yt(a.x+a.width/2,a.y+a.height/2),await w(300),await Xt(async()=>{d.lesson.tut.lastFolder=t,d.lesson.tut.createFolder(this.name,t)},void 0,n),await w(500),d.lesson.toggleDisableSyncPos(!1),!this.ops.tutorOnly)if(d.lesson.p.toggleShowFilesBtn(!0),d.lesson.p.getFolderByPath(this.ops.path,this.name))await Te(2,`I see you already have the folder h[${this.name}], nice job!`,void 0,{click:!0}).clickProm;else{d.lesson.p.toggleShowFilesBtn(!0);let c=d.lesson.p.lastFolder;if(this.ops.path==""?c!=null:!c||!c.isSame(this.ops.path,"")){let m=Te(2,`Make sure you have the correct folder selected before creating the new folder, so it will into the right spot.
i[The tutor wants you to select the ${this.ops.path==""?"press the h[escape] key to deselect your folders.":`select the h[${this.ops.path}] folder.`}`);if(this.ops.path==""){let g=Se.subEvt(new Gt("deselectFolders",p=>d.lesson.p.lastFolder==null));await Se.waitFor(g)}else{let g=Se.subEvt(new Gt("selectFolder",p=>{let k=p.getPath();return k.length==0?k=p.name:k+="/"+p.name,k==tt(this.ops.path)}));await Se.waitFor(g)}qe(m),await w(500)}let l=r.getBoundingClientRect(),u=Te(4,s,"top",{x:l.x+l.width/2+22,y:l.y+l.height/2+15-30});for(;;){let m=Se.subEvt(new Gt("createFolder")),g=await Se.waitFor(m);if(g){if(g.name!=this.name){await Te(2,`Wrong name, please name your folder: h[${this.name}]
i[It's case sensitive which means the capitalization matters.]`,void 0,{click:!0}).clickProm;continue}if(tt(g.getPath())!=tt(this.ops.path)){await Te(2,`Wrong spot, please try again. 
i[Please create your new folder at the ${this.ops.path!=""?`path: h[${this.ops.path}]].`:"root path."}]]`,void 0,{click:!0}).clickProm,d.lesson.p.deselectSelFolder();continue}break}}qe(u)}await ut(),await this.finish()}}class ap extends be{constructor(e,t){super("Cursor bubble: "+e),this.text=e,this.dir=t??"top",this.requiresDoneConfirm=!1,this.instantFinish=!0}text;dir;async start(){await super.start();let e=d.lesson.tut.getCurEditor();await Hi(e,this.text,this.dir).clickProm,await this.finish()}}class op extends Zc{constructor(){super({preText:null,promptText:null,tutorOnly:!0})}}class lp extends be{constructor(){super("Close Tutor's Files Pane"),this.requiresDoneConfirm=!1,this.instantFinish=!0}async start(){await super.start();let e=d.lesson.tut.d_files.querySelector(".b-show-files-pane");if(!e){alert("A serious issue has occured, please reload the page. (closeFilesPane)"),console.error("Err: no btnTut found (closeFilesPane):",e);return}let t=e.getBoundingClientRect();d.lesson.toggleDisableSyncPos(!0),await Ke(),await Yt(t.x+t.width/2,t.y+t.height/2),await w(300),await Xt(async()=>{d.lesson.tut.toggleShowFilesBtn(!1)},void 0,e),await w(500),d.lesson.toggleDisableSyncPos(!1),await this.finish()}}function Hi(i,e,t,s=!1){i||(i=d.lesson.tut.getCurEditor());let r=vn().getBoundingClientRect();return Te(4,e,t,{x:r.x+r.width/2+17+ye.getBoundingClientRect().width/2,y:r.y+r.height/2-22-_s/2+2,click:!0,inEditor:d.lesson.tut.getCurEditor(),dontCloseOnClick:s})}class wn{async validate(e){return!0}}class cp extends wn{constructor(e){super(),this.expr=e}expr;async validate(e){if(!super.validate(e))return!1;let t=e.p.getFileByPath2("index.html");return t?(e.p.textDecoder.decode(t.buf)??"").match(this.expr)!=null:!1}}class up extends wn{constructor(e){super(),this.href=e}href;async validate(e){return super.validate(e)?(e.dom.querySelector(`style[data-href="${this.href}"]`)??e.dom.querySelector(`link[href="${this.href}"]`))!=null:!1}}class dp extends wn{constructor(e,t){super(),this.selector=e,this.ops=t??{}}selector;ops;getElm(e){return e.querySelector(this.selector)}async validate(e){if(!super.validate(e))return!1;let t=this.getElm(e.dom);if(!t)return!1;let s=this.ops;return!(s.text!=null&&t.textContent!=s.text)}}class hp extends wn{constructor(e,t=!1){super(),this.text=e,this.caseSensitive=t}text;caseSensitive=!1;async validate(e){let t=e.dom.children[0].textContent.trim(),s=this.text.trim();return this.caseSensitive||(t=t.toLowerCase(),s=s.toLowerCase()),t==s}}class fp extends wn{constructor(e){super(),this.quizId=e}quizId;async validate(e){let t=e.quizzes.get(this.quizId);if(!t)return alert("Error: quiz question wasn't loaded properly to check"),!1;let s=e.dom.children[0].textContent.trim()??"";return t.isCorrect(...s.split(`
`).filter(n=>n!=null))}}class Bi extends be{constructor(e){super("Validate Code"),this.parts=e}nextSceneWhenCorrect=!0;correct=!1;async start(){await super.start();let e=await this.finish();return Dr=0,e}async checkValidation(e=!1){await Fc();let t=d.lesson.p.findIFrame();if(!t)return console.warn("check validation failed, couldn't find iframe"),!1;let s=t.contentDocument;for(const n of this.parts)if(!s||!await n.validate({dom:s,quizzes:d.lesson.quizzes,p:d.lesson.p}))return!1;return e&&(this.correct=!0),!0}parts;hasMissed=!1}class pp{constructor(e,t){this.id=e,this.ops=t}id;ops;isCorrect(...e){this.ops.caseSensitive||(e=e.map(t=>t.toLowerCase())),e.length&&(e=[e[0]]);for(let t=0;t<this.ops.options.length;t++){if(!this.ops.options[t].correct)continue;let n=Gc[t];if(this.ops.caseSensitive||(n=n.toLowerCase()),!e.includes(n))return!1}return!0}}const Gc="abcdefghijklmnopqrstuvwxyz";class mp extends be{constructor(e){super("Quiz Question"),e.randomize==null&&(e.randomize=!0),e.randomize&&e.options.sort((t,s)=>Math.random()-.5),this.ops=e}ops;async start(){await super.start();let e=this.ops,t=`#### Question:

### ${e.question}
---

`,s=0;for(const u of e.options){let m=Gc[s];u.lang?(t+=m.toUpperCase()+`. 
`,t+="```"+u.lang+`
`,t+=u.l,t+="\n```\n"):t+=m.toUpperCase()+". "+u.l+`

`,s++}let n=d.lesson,r="q"+n.quizzes.size,a=new pp(r,e);n.quizzes.set(r,a);let o=await n.tut.createFile("quiz."+(this.ops.rawMD?"md":"pmd"),n.tut.textEncoder.encode(t),void 0,void 0);o.open(),this.ops.rawMD&&o.editor.updateOptions({wordWrap:"on"});let c=n.p.files[0],l=`<!-- Type the letter of your answer into this file to answer! -->

`;return c?n.p.textDecoder.decode(c.buf)==""&&c.editor.setValue(l):(c=await n.p.createFile("index.html",n.p.textEncoder.encode(l),void 0,void 0,!0),c.open()),c.editor.updateOptions({wordWrap:"on"}),c.editor.setPosition({column:1,lineNumber:c.editor.getModel().getLineCount()}),this.canBeFinished=!0,this._resFinish(),await this.finish()}}class Ja extends be{constructor(e,t="Let's add some code here."){super("Add Code Parts"),Array.isArray(e)?(this.parts=e,t!=null?typeof t=="string"?(this.text=t,this.ops={}):(this.text=t.text,this.ops=t):this.ops={}):(this.ops=e,this.parts=e.main,this.text=e.text),this.text==""&&(this.text="Let's add some code here."),this.ops.noDoneConfirm&&(this.requiresDoneConfirm=!1,this.instantFinish=!0)}parts;text;ops;dir;curPart;getCompleteness(){return this.curPart?(this.parts.indexOf(this.curPart)+1)/this.parts.length:0}canShowFollowAlong(){return!0}async start(){await super.start();let e=d.lesson.activeFile?.editor??d.lesson.tut.getCurEditor();if(!e){await Te(2,"A critical issue happened and I've lost track of where I have to write code, try to refresh the page.",void 0,{click:!0}).clickProm;return}if(this.ops.pre)for(const n of this.ops.pre)await n.run(e,it(e));let t;for(let n=0;n<this.parts.length;n++){if(n==0){let a=e.getPosition();if(await Ls(a.column,a.lineNumber),this.text!=null){await w(250);let o=this.text??"Let's add some code here.";this.canShowFollowAlong()&&(d.lesson._hasShownFollowAlong||(o+="<br><br>i[Follow along! But feel free to make your own changes and experiment!]",d.lesson._hasShownFollowAlong=!0)),await Hi(e,o,this.dir).clickProm,await w(150)}await w(200),this.text!=null&&(t=Te(5,this.text,this.dir,{click:!1}),await w(400))}let r=this.parts[n];this.curPart=r,d.lesson.updateCurrentProgress(),await r.run(e,it(e))}let s=await this.finish();return qe(t),s}cleanupDelayed(){this.curPart=void 0}}class Xc extends be{constructor(e){super("Add Rush Code Parts"),this.parts=e}parts;async start(){await super.start();let e=d.lesson.activeFile,t=e.editor;for(let s=0;s<this.parts.length;s++){s==0&&await Ls(1,1,!0);let n=this.parts[s],r=it(t);if(n.rushable()){n.noRush=!0;let a=d.lesson,o=a.p.curFile?.editor?.hasTextFocus();Ii(),a.startActiveFileUnlock(),e._back.open(!1),a.endActiveFileUnlock(),await n.run(e._back.editor,e._back.actions);let c=e._back.editor.getPosition().clone();Oi(),a.startActiveFileUnlock(),e.open(!1),a.endActiveFileUnlock(),o&&a.p.curFile.editor.focus(),n.noRush=!1,r.setSpeed(1);let l=n.run(t,r);o&&a.p.curFile.editor.focus(),await n.rushCheck(e,a.p.files.find(g=>g.name==e.name)),await w(100),r.resetSpeed(),gh(),Ii(),await l,Oi(),await w(100);let u=e.editor.getScrollLeft(),m=e.editor.getScrollTop();e.editor.setValue(e._back.editor.getValue()),e.editor.setScrollLeft(u,monaco.editor.ScrollType.Immediate),e.editor.setScrollTop(m,monaco.editor.ScrollType.Immediate),e.editor.setPosition(c)}else{Ii();let a=d.lesson;a.startActiveFileUnlock(),e._back.open(!1),a.endActiveFileUnlock(),await n.run(e._back.editor,e._back.actions),Oi(),a.startActiveFileUnlock(),e.open(!1),a.endActiveFileUnlock(),a.p.curFile?.editor?.focus(),await n.run(t,r)}}return await this.finish()}}class gp extends Ja{constructor(e,t){t||(t={}),t.text=null,super(e,t)}requiresDoneConfirm=!1;skipsRewind(){return!0}canShowFollowAlong(){return!0}}class Qc extends be{constructor(e,t,s=null,n=!0,r=null,a=null,o="top"){super("Add the following code:"),this.code=e,this.lang=t,this.hasPreMsg=n,this.customText=s,this.line=r,this.col=a,this.dir=o}code;lang;hasPreMsg;customText;line;col;dir;async play(){let e=d.lesson,t=e.tut.getCurEditor();e.tut.curFile.blockPosChange=!1;let s=t.getPosition();if(await Ke(),await oi(s.column,s.lineNumber),this.hasPreMsg){await w(250),this.line!=null&&this.col!=null&&(await Ke(),await oi(this.col,this.line),await w(150));let r=ye.getBoundingClientRect(),a=this.customText??"Let's add some code here.";e._hasShownFollowAlong||(a+="<br><br>i[Follow along! But feel free to make your own changes and experiment!]",e._hasShownFollowAlong=!0),await Te(4,a,this.dir,{x:r.x+r.width/2+17,y:r.y+r.height/2-22,click:!0,inEditor:e.tut.getCurEditor()}).clickProm,await w(150)}await ut(),await w(200);let n=document.querySelectorAll(".custom-cursor");for(const r of n)r.style.display="block";for(let r=0;r<this.code.length;r++){let a=this.code.substring(r,r+1);if(a==`
`){let o=t.getPosition().clone();t.setValue(t.getValue()),t.setPosition(o)}if(a==""){await w(250);continue}else if(a==""){let o=t.getPosition();t.setPosition(o.with(o.lineNumber,o.column-1));continue}else if(a==""){let o=t.getPosition();t.setPosition(o.with(o.lineNumber,o.column+1));continue}else if(a==""){let o=t.getPosition();t.setPosition(o.with(o.lineNumber-1,o.column));continue}else if(a==""){let o=t.getPosition();t.setPosition(o.with(o.lineNumber+1,o.column));continue}else if(a==""){t.updateOptions({readOnly:!1}),t.trigger("keyboard","deleteLeft",null),t.updateOptions({readOnly:!0}),await w(Math.ceil(30+Math.random()*100));continue}else if(a=="\x07"){t.updateOptions({readOnly:!1}),t.trigger("keyboard","cursorHome",null),t.updateOptions({readOnly:!0}),await w(Math.ceil(30+Math.random()*100));continue}else if(a=="\b"){t.updateOptions({readOnly:!1}),t.trigger("keyboard","cursorEnd",null),t.updateOptions({readOnly:!0}),await w(Math.ceil(30+Math.random()*100));continue}t.updateOptions({readOnly:!1}),t.trigger("keyboard","type",{text:a}),t.updateOptions({readOnly:!0}),await w(Math.ceil(30+Math.random()*100))}for(const r of n)r.style.display=null;if(s=t.getPosition(),e.tut.curFile.curRow=s.lineNumber,e.tut.curFile.curCol=s.column,e.tut.curFile.blockPosChange=!0,oi(s.column,s.lineNumber),!e._hasShownMarkDoneReminder){e._hasShownMarkDoneReminder=!0;let r=e.tut.curFile,a=r.editor.getPosition(),o=bm(r,`Make sure you click "Mark Done" when you're finished copying the code!`,a.lineNumber,a.column,"top");this._finishBubble=o}}async start(){return await super.start(),await this.play(),await this.finish()}_finishBubble;getSections(){return[new Nc(this.code,this.lang)]}cleanup(){this._finishBubble&&(qe(this._finishBubble),this._finishBubble=null)}}class eo extends be{constructor(e,t){super(t),this.text=e,this.comment=t}text;comment;async start(){await super.start();let e=d.lesson,t=e.tut.getCurEditor();e.tut.curFile.blockPosChange=!1;let s=t.getPosition();await Ke(),await oi(s.column,s.lineNumber),await w(150),await ut(),await w(200);let n=document.querySelectorAll(".custom-cursor");for(const r of n)r.style.display="block";for(let r=0;r<this.text.length;r++){let a=this.text.substring(r,r+1);if(a==""){await w(250);continue}else if(a==""){let o=t.getPosition();t.setPosition(o.with(o.lineNumber,o.column-1));continue}else if(a==""){let o=t.getPosition();t.setPosition(o.with(o.lineNumber,o.column+1));continue}else if(a==""){let o=t.getPosition();t.setPosition(o.with(o.lineNumber-1,o.column));continue}else if(a==""){let o=t.getPosition();t.setPosition(o.with(o.lineNumber+1,o.column));continue}else if(a==""){t.updateOptions({readOnly:!1}),t.trigger("keyboard","deleteLeft",null),t.updateOptions({readOnly:!0}),await w(ui(this.text.length));continue}t.updateOptions({readOnly:!1}),t.trigger("keyboard","type",{text:a}),t.updateOptions({readOnly:!0}),await w(ui(this.text.length))}for(const r of n)r.style.display=null;return s=t.getPosition(),e.tut.curFile.curRow=s.lineNumber,e.tut.curFile.curCol=s.column,e.tut.curFile.blockPosChange=!0,oi(s.column,s.lineNumber),this.canBeFinished=!0,this._resFinish(),await this.finish()}}class Jc extends be{constructor(e,t){super("Move Tutor's Cursor"),this.line=e,this.col=t}line;col;async start(){await super.start();let e=d.lesson.tut.getCurEditor(),t=e.getPosition();return(this.line!=t.lineNumber||this.col!=t.column)&&(await Ke(),d.lesson.tut.curFile.blockPosChange=!1,e.setPosition({lineNumber:this.line,column:this.col}),d.lesson.tut.curFile.blockPosChange=!0,await ws(e),await w(150),await ut(),await w(200)),this.canBeFinished=!0,this._resFinish(),await this.finish()}}class eu extends be{constructor(e,t){t||(t=e),super(t),this.text=e}text;b;async start(){return await super.start(),await w(500),this.b=Te(3,this.text),await ga(li.refresh),this.cleanup(),await this.finish()}cleanup(){qe(this.b)}}class vp extends be{constructor(e,t,s,n){n||(n=t),super(n),this.btn=e,this.dir=s,this.text=t}text;dir;btn;async start(){await super.start();let e=this,t=function(){e._resFinish(),e.btn.removeEventListener("click",t)};return this.btn.addEventListener("click",t),await this.finish()}}class tu extends be{constructor(e,t){super(t),this.bid=e,this.requiresDoneConfirm=!1}bid;async start(){await super.start(),await w(250),await Hi(null,this.title,"top").clickProm;let t=d.lesson.boards.find(r=>r.bid==this.bid);d.lesson.board=t;let s=document.activeElement;s?.tagName.toLowerCase()=="textarea"&&s.blur(),t.initEvents();let n=t.init();t.show(),await n,this.canBeFinished=!0,this._resFinish(),await this.finish()}cleanup(){d.lesson.board&&(d.lesson.board.exit(),d.lesson.board=null)}}class iu extends be{constructor(e,t,s,n="top"){super(e),this.requiresDoneConfirm=!1,this.line=t,this.col=s,this.dir=n}b;line;col;dir;async start(){if(await super.start(),this.line!=null&&this.col!=null){let n=d.lesson.tut.getCurEditor();n.setPosition({column:this.col,lineNumber:this.line}),Qa(n)}await w(250);let t=vn()?.getBoundingClientRect()??ye.getBoundingClientRect();this.b=Te(4,this.title,this.dir,{x:t.x+t.width/2+17+ye.getBoundingClientRect().width/2,y:t.y+t.height/2-22-_s/2+2,click:!0,inEditor:d.lesson.tut.getCurEditor()}),await this.b.clickProm;let s=this.finish();this._resFinish(),await s}cleanup(){qe(this.b)}}class wp extends be{constructor(e,t=2,s){super(e),this.loc=t,this.ops=s??{},this.ops.ops?.click==null&&(this.ops.ops==null?this.ops.ops={click:!0}:this.ops.ops.click=!0),t==6&&this.ops.dir==null&&(this.ops.dir="top"),this.requiresDoneConfirm=!1,this.instantFinish=!0}loc;ops;b;async start(){return await super.start(),this.b=Te(this.loc,this.title,this.ops.dir,this.ops.ops),await this.b.clickProm,this.finish()}cleanup(){qe(this.b)}}class yp extends be{constructor(e){super(e),this.requiresDoneConfirm=!0}b;async start(){await super.start(),await w(250);let t=vn().getBoundingClientRect();this.b=Te(4,this.title,"top",{x:t.x+t.width/2+17+ye.getBoundingClientRect().width/2,y:t.y+t.height/2-22-_s/2+2}),this.b.e.classList.add("type-instruct"),await w(750),await this.finish()}cleanup(){qe(this.b)}}class bp extends be{constructor(){super("Infinite Task")}async start(){await super.start(),await new Promise(e=>{}),await this.finish()}}class su extends be{constructor(){super(""),this.requiresDoneConfirm=!1}async start(){let e=this;return this._prom=new Promise(t=>{this._resFinish=function(s){if(e.canBeFinished)return t(s),1}}),console.log(":::: has started"),await this.finish()}}class _p extends be{constructor(e,t,s={}){super("Change Preview URL"),this.ops=s,this.text=e,this.filename=t,this.requiresDoneConfirm=!1,this.instantFinish=!0}ops;text;filename;b;skipsRewind(){let e=Rt.project.previewURL.split("/");return e[e.length-1]==this.filename}async start(){await super.start(),await w(200);let e=Rt.project.previewURL.split("/");if(e[e.length-1]==this.filename){this.cleanup(),await w(250),await this.finish();return}let t=d.lesson.p.refs.previewUrl;t||console.warn("NOT SURE WHAT TO DO!!! couldn't find preview url elm to put bubble there");let s=t.getBoundingClientRect();this.b=Te(4,this.text,"top",{x:s.x+35,y:s.y+s.height+25-60});let r=bd(d.lesson.p).indexOf(this.filename);for(await ga(li.clickPreviewURL),await w(80),this.b.ops.x=s.x-42+40-this.b.e.getBoundingClientRect().width,this.b.ops.y+=-1+25*(r-1),this.b.e.classList.remove("dir-top"),this.b.e.classList.add("dir-right"),this.b.e.style.transform="translate(-40px,55px)",xu();;){let o=Rt.project.previewURL;if(await ga(li.changePreviewURL)==o){await w(200);continue}break}this.cleanup(),await w(250);let a=d.lesson.tut;if(a){let o=this.ops.tutorUrl?a.getFileByPath2(this.ops.tutorUrl):a.getFileByPath2(this.filename)??a.findFile(this.filename);o?(a.previewURL=o.getSelfPath(),a.refs.previewUrl.value=o.getSelfPath(),Fc(2),console.log("----- refresh tutor's with new url",o.getSelfPath())):console.warn("couldn't switch tutor's preview to the file specified, couldn't find the file",this.filename)}await this.finish()}cleanup(){qe(this.b)}}var to=(i=>(i[i.learn=0]="learn",i[i.practice=1]="practice",i[i.experiment=2]="experiment",i))(to||{});class xp extends be{constructor(e){super("Use Accent"),this.accent=e,this.requiresDoneConfirm=!1,this.instantFinish=!0}accent;async start(){await super.start(),document.body.style.setProperty("--cta-btn-col",`var(--${to[this.accent]}-col)`);let e=document.querySelector("a.nav-link.active");e&&e.classList.remove("active");let t=document.querySelector(`a.nav-link:nth-child(${this.accent+2})`);t&&t.classList.add("active"),await this.finish()}}function kp(i){document.body.style.setProperty("--cta-btn-col",`var(--${to[i]}-col)`);let e=document.querySelector("a.nav-link.active");e&&e.classList.remove("active");let t=document.querySelector(`a.nav-link:nth-child(${i+2})`);t&&t.classList.add("active")}class Sp{constructor(e){this.t=e}t;queue=[];async run(){for(const e of this.queue)await e.load()}}class Ep{constructor(e){this.scene=e}t;scene;events=[];async load(){this.t.wipeScene(),console.log(":: LOADED SCENE:",this.scene.id,this.scene);let e=this.scene;if(e.initial_files){let t=async(s,n,r)=>{for(const a of s.items)if("buf"in a){let o=d.lesson,c=await o.tut.createFile(a.name,a.buf,null,n,!1),l=await o.p.createFile(a.name,a.buf,null,r,!1);o.startActiveFileUnlock(),c.open(),o.endActiveFileUnlock(),l.open()}else{let o=d.lesson.tut.createFolder(a.name,n,!1),c=d.lesson.p.createFolder(a.name,r,!1);await t(a,o,c)}};await t(e.initial_files)}if(e.custom_evts){let t=mo(e.custom_evts);t||alert("A critical error happened; tried to load custom events file but it failed, can't proceed"),this.events=t;let s=d.lesson;s.progress.eventI=-1,s.progress.taskI=-1,s.events,s.events=this.events,await this.events[0].startTask(this.events[0].tasks[0])}await ri(1e7)}}class Cp extends be{constructor(){super("Start Review")}l;queues=[];async start(){await super.start(),this.l=d.lesson;let e=this.l;if(e.info)for(const t of e.info.order){let s=new Sp(this);this.queues.push(s);let n=t.includes.map(r=>e.info.sections.find(a=>a.id==r)).filter(r=>r!=null);for(const r of n){s.queue.push(...r.scenes.map(a=>new Ep(a)));for(const a of s.queue)a.t=this}}for(const t of this.queues)await t.run();await this.finish()}wipeScene(){this.l.tut.wipe(),this.l.p.wipe()}}class Lp extends be{constructor(){super("End"),this.requiresDoneConfirm=!1,this.instantFinish=!0,this.exitLEventAfter=!0}async start(){await super.start(),await w(d.lesson.standardDelay),await this.finish()}}class Fp extends be{constructor(e,t){super("Goto"),this.eventI=e,this.taskI=t,this.requiresDoneConfirm=!1,this.instantFinish=!0,this.noNextTask=!0}eventI;taskI;async start(){await super.start(),await this.finish(),await Sa(this.eventI,this.taskI)}}class Pp extends be{constructor(e){super("Wait for "+(e/1e3).toFixed(1)+"s"),this.delay=e,this.requiresDoneConfirm=!1,this.instantFinish=!0}delay;async start(){await super.start(),await w(this.delay),await this.finish()}}class Tp extends be{constructor(){super(`Wait till "I'm Done"`)}async start(){await super.start(),await w(d.lesson.standardDelay),await this.finish()}}class Ip extends be{constructor(e){super("Toggle Use Lesson Confirm to: "+e),this.use=e,this.requiresDoneConfirm=!1,this.instantFinish=!0}use;async start(){await super.start(),this.use?d.lesson.overrideDisableLessonConfirm--:d.lesson.overrideDisableLessonConfirm++,await this.finish()}}class Op extends be{constructor(e){super("Refresh Tutor Preview"),this.ops=e??{},this.requiresDoneConfirm=!1,this.instantFinish=!0}ops;async start(){await super.start(),this.ops.noTutor||bi(d.lesson.tut),this.ops.meToo&&bi(d.lesson.p),await this.finish()}}class Ap extends ae{constructor(e){super(),this.ops=e??{}}ops;async run(e,t){this.ops.noTutor||bi(d.lesson.tut),this.ops.meToo&&bi(d.lesson.p),await this.waitS()}}const Dp={basicHTMLStructure(i){return new Ja([new Kn("html",!0,!0),new Kn("head",!0,!0),new Hc(1),new Vc(200),new Wc(1),new Kn("body",!0,!0)],i)}};class nu{constructor(){}getTasks(){return[]}getTaskText(){return""}finish(){}_res;_i=-1;async endEvent(e){await w(300);let t=d.lesson,s=t.events.indexOf(this),n=t.events[s+1];t.loadEvent(n),n&&n.run()}async startTask(e){let t=d.lesson;if(e&&(e.state||(e.state=t.getCurrentState())),!t.isQuitting){if(t.loadSubTask(e),await w(300),e==null){this.endEvent(e);return}t.progress.taskI=this.tasks.indexOf(e),e.start()}}tasks;static parse(e){e.id||(e.id="g");let t=e.id,s;return t=="g"&&(s=new yn(e.text,2,e.tasks?.map(n=>be.parse(n))??[])),s}}class yn extends nu{constructor(e,t=2,s=[]){super(),this.ogLines=e;let n=e.join("<br><br>").replaceAll(`
`,"<br><br>");this.text=n,this.loc=t??2,this.tasks=s||[]}ogLines;text;loc;b;finish(){this._res()}async run(){let e=d.lesson;if(e.updateCurrentProgress(),e.isQuitting)return;e.isResuming&&e.resume.taskI==-1&&e.resume.eventI==e.events.indexOf(this)&&await e.finishResume();let t=new Promise(n=>{this._res=n});if(this.text?.length){let n=document.createElement("button");n.innerHTML="<div>Next</div><div class='material-symbols-outlined'>mouse</div>",n.classList.add("b-confirm");let r=Te(this.loc,this.text);this.b=r,r.e.appendChild(document.createElement("br")),r.e.appendChild(document.createElement("br")),r.e.appendChild(n),n.addEventListener("click",a=>{console.log("click"),this._res()})}else this._res();let s=!1;e.isResuming&&(e.resume.taskI!=-1||e.resume.eventI!=e.events.indexOf(this))&&(s=!0),s||await t,this.b&&qe(this.b),this.startTask(this.tasks[0])}getTaskText(){return this.ogLines[this.ogLines.length-1]}}class jp extends yn{constructor(e,t){super(e,2,t)}}class Rp extends yn{constructor(e){super([],2,e)}}class ur extends yn{constructor(e,t){super([],2,t),this.ops=e}ops;async run(){console.log(":: SECTION STARTED: "+this.ops.title),d.lesson.curSection=this,await super.run()}finish(){super.finish(),d.lesson.curSection=void 0}}class Bp extends nu{constructor(e){super(),this.tasks=e}async run(){for(const e of this.tasks)await w(300),await e.start()}}class Mp{constructor(e){this.files=e}files}class Up{constructor(e){this.sects=e}sects}class Np{constructor(){}tutItems;curFile;pos}class io{constructor(e,t,s,n){this.x=e,this.y=t,this.w=s,this.h=n}x;y;w;h;get cx(){return this.x+this.w/2}get cy(){return this.y+this.h/2}get r(){return this.x+this.w}get b(){return this.y+this.h}changeUnits(e,t,s,n){return this.x=this.x/e*s,this.y=this.y/t*n,this.w=this.w/e*s,this.h=this.h/t*n,this}}class so{constructor(e,t){this.x=e,this.y=t,this._storeTags=[]}x=0;y=0;opacity=1;_storeTags;b;extraPad={l:0,r:0,t:0,b:0};hasTag(...e){for(const t of e)if(this._storeTags.includes(t))return!0;return!1}addTag(...e){for(const t of e)this._storeTags.includes(t)||(console.log("TAG:",t),this._storeTags.push(...t.split(" ")))}removeTag(...e){for(const t of e)this._storeTags.splice(this._storeTags.indexOf(t),1)}transferTags(e){for(const t of this._storeTags)e.addTag(t);this.removeAllTags()}removeAllTags(){let e=[...this._storeTags];for(const t of e)this.removeTag(t)}postRender(e,t){}async onAdd(e){}getScreenPos(){let e=this.b,t=this.x*e.can.width+e._rect.x,s=this.y*e.can.height+e._rect.y;return{x:t,y:s}}getRect(){let e=this.b,t=this.x*e.can.width+e._rect.x,s=this.y*e.can.height+e._rect.y,n=0,r=0;return new io(t,s,n,r)}}class jr extends so{constructor(e,t,s,n){super(e,t),this.ha=s,this.va=n}ha;va;getAnchoredPos(e,t){let s=this.b.ctx,n=this.x*s.canvas.width,r=this.y*s.canvas.height;return this.ha==1?n-=e/2:this.ha==2&&(n-=e),this.va==1?r-=t/2:this.va==2&&(r-=t),{x:n,y:r}}}class no{constructor(e){this.ref=e}static fromObj(e){let t=new no(null);return t.obj=e,t}obj;ref;unwrap(e){return this.obj?this.obj:e.objs.find(t=>t.hasTag(this.ref))}}class xs{constructor(...e){this.refs=e}refs;objs;_with;static fromObjs(e){let t=new xs(null);return t.objs=e,t}unwrap(e){let t=0;return this.objs||(this.objs=e.objs.filter(s=>s.hasTag(...this.refs)?(this._with&&this._with(s,t),t++,!0):!1)),this.objs}with(e){return this._with=e,this}}var ru=(i=>(i[i.START=0]="START",i[i.CENTER=1]="CENTER",i[i.END=2]="END",i))(ru||{});class Re{constructor(){}async finish(e=!1){e&&this._resFinish(),await this._prom}start(){this._resFinish&&this._resFinish(),this._prom=new Promise(e=>{this._resFinish=e})}_resFinish;_prom;after(e){return e(this),this}serialize(){}static parse(e){return null}static parseAny(e,t){switch(t.id){case"wait":return zr.parse(t);case"addCode":return Nr.parse2(e,t);case"circleObj":return xn.parse(t);case"endBoard":return ks.parse(t);case"removeObj":return Wr.parse(t);case"setOpacity":return $r.parse(t);default:return qr.parse(t)}}}class ro extends Re{constructor(e,t){super(),this.ha=e,this.va=t}ha;va}class ao{constructor(e,t){this.text=e,this.id=t}text;id}const au={0:"gray",1:"royalblue",2:"dodgerblue",3:"white",4:"#ce9178",5:"#9cdcfe",6:"#569cd6"},zp={gram:0,_:0,tag:6,str:4,attr:5,text:3};function ou(i){let e=0;for(const t of i)e+=t.text.length;return e}function $p(i){let e=0;for(const t of i)t.length>e&&(e=t.length);return e}function qp(i){i=i.join("").split(`
`);let t=0;for(const s of i)s.length>t&&(t=s.length);return t}function lu(i){let e=0;for(const t of i)e+=t.getOffset();return e}function Wp(i,e,t="$",s){let n=i.split(t),r=[],a=0;for(const o of n){let c=new Vi(o,e[a]);r.push(c);let l=a;s&&(c.onAfter=function(){s(l,c)}),a++}return r}function Hp(i){let e="";for(let t=0;t<i;t++)e+=" ";return e}class Rr{constructor(e){this.tasks=e}tasks;async run(){for(const e of this.tasks)await e.run(),e.onAfter&&e.onAfter()}serialize(){return this.tasks.map(e=>e.serialize())}static parse(e){return new Rr(e.map(t=>Fs.parseAny(t)))}}class Fs{constructor(){}partI;b;e;obj;getOffset(){return 0}getText(){return""}onAfter;static parse(e){return null}static parseAny(e){switch(e.id){case"wait":return Br.parse(e);case"move":return Ur.parse(e);case"replaceText":return Mr.parse(e);case"text":return Vi.parse(e)}return null}}class Vp extends Fs{constructor(e,t){super(),this.text=e,this.par=t}text;par;async run(){let{x:e,y:t}=this.par.getScreenPos();await Te(4,this.text,null,{x:e,y:t,click:!0}).clickProm}serialize(){return null}static parse(e){return null}}class Br extends Fs{constructor(e){super(),this.delay=e}delay;async run(){await w(this.delay)}serialize(){return{id:"wait",val:this.delay}}static parse(e){return new Br(e.val)}}class Vi extends Fs{constructor(e,t){super(),this.code=e,this.colId=t,this.tc=new ao(e,t)}code;colId;tc;_preTags;getOffset(){return this.code.length}getText(){return this.code}async run(){let e=new bn(this.tc,this.e.tx,this.e.ty,0,1);this.obj=e;let t=this.b;await t.addObj(e),this._preTags&&e.addTag(...this._preTags);let s=t.baseFontScale*(t.can.height/t.can.width)*this.b._fontWidthScale;this.e.tx+=s*this.code.length}serialize(){return{id:"text",text:this.code,colId:this.colId,tags:this.obj._storeTags}}static parse(e){let t=new Vi(e.text,e.colId);return t._preTags=e.tags,t}}class Mr extends Vi{constructor(e,t,s){super(t,s),this.ref=e}ref;async run(){let e=this.b.getObjByTag(this.ref),t=new bn(this.tc,this.e.tx,this.e.ty,0,1);this.obj=t;let s=this.b;await s.replaceObj(e,t);let n=s.baseFontScale*(s.can.height/s.can.width)*this.b._fontWidthScale;this.e.tx+=n*this.code.length}getOffset(){return 0}serialize(){return{id:"replaceText",tag:this.ref,text:this.code,colId:this.colId}}static parse(e){return new Mr(e.tag,e.text,e.colId)}}class Ur extends Fs{constructor(e,t){super(),this.amtX=e,this.amtY=t}amtX;amtY;async run(){let e=this.b,t=e.baseFontScale*(e.can.height/e.can.width)*this.b._fontWidthScale;this.e.tx+=t*this.amtX,this.e.ty+=t*this.amtY}serialize(){return{id:"move",x:this.amtX,y:this.amtY}}static parse(e){return new Ur(e.x,e.y)}}class Nr extends ro{constructor(e,t,s,n,r,a){super(n,r),this.comment=e,this.x=t,this.y=s,this.anim=a,this.parts=[];for(const o of a.tasks){let c=o.getText();c&&(o.partI=this.parts.length,this.parts.push(c))}}comment;text;delimiter;x;y;anim;parts;tx;ty;serialize(){return{id:"addCode",com:this.comment,x:this.x,y:this.y,ha:this.ha,va:this.va,anim:this.anim.serialize()}}static parse2(e,t){let s=new Nr(t.com,t.x,t.y,t.ha,t.va,Rr.parse(t.anim));return s.finalize(e),s}async run(e){this.start(),this.comment&&await e.waitForBubble(this.comment,0,0);let t=this.x,s=this.y,n=lu(this.anim.tasks.filter(a=>a instanceof Vi)),r=e.baseFontScale*(e.can.height/e.can.width)*e._fontWidthScale;this.ha==1?t-=r*n/2:this.ha==2&&(t-=r*n),this.tx=t,this.ty=s,await this.anim.run(),this._resFinish(),await this.finish()}finalize(e){for(const t of this.anim.tasks)t.b=e,t.e=this;return this}}class Yp extends ro{constructor(e,t,s,n,r,a,o){super(r,a),this.comment=e,this.text=t,this.x=s,this.y=n,this.newOrder=o}comment;text;x;y;newOrder;serialize(){return{}}parse(e){return null}async run(e){this.start(),await e.waitForBubble(this.comment,0,0);let t=this.x,s=this.y,n=ou(this.text),r=e.baseFontScale*(e.can.height/e.can.width)*e._fontWidthScale;this.ha==1?t-=r*n/2:this.ha==2&&(t-=r*n);let a=[...this.text],o=a;this.newOrder&&(a=this.newOrder.map((l,u)=>a[l]));let c=[];for(const l of o){let u=new bn(l,t,s,0,this.va);e.objs.push(u),c.push(u),t+=r*l.text.length}for(const l of this.newOrder)await c[l].onAdd(e);this._resFinish(),await this.finish()}}class bn extends jr{constructor(e,t,s,n,r){super(t,s,n,r),this.d=e,this.text=""}d;text;col;render(e,t){t.font="Roboto Mono",t.applyFont(),e.fillStyle=this.col;let s=this.x*e.canvas.width,n=this.y*e.canvas.height;e.fillStyle=au[this.d.id];let r=e.measureText(this.text),a=t.fontSize;this.ha==1?s-=r.width/2:this.ha==2&&(s-=r.width),this.va==1?n-=a/2:this.va==2&&(n-=a),e.fillText(this.text,s,n)}async onAdd(e){for(const t of this.d.text){this.text+=t;let s=ui(this.d.text.length);t==" "&&(s/=4),await w(s)}}getRect(){let e=this.b,t=e.baseFontScale*(e.can.height/e.can.width)*e._fontWidthScale*e.can.width,s=this.text.length*t,n=e.fontSize;s+=this.extraPad.l+this.extraPad.r,n+=this.extraPad.t+this.extraPad.b;let{x:r,y:a}=this.getAnchoredPos(s,n);return r-=this.extraPad.l,a-=this.extraPad.t,a-=n*.75,new io(r,a,s,n)}}class oo extends jr{constructor(e,t,s,n){super(e,t,s,n),this.can=document.createElement("canvas"),this.ctx=this.can.getContext("2d")}can;ctx;render(e,t){let{x:s,y:n}=this.getAnchoredPos(this.can.width,this.can.height);e.drawImage(this.can,s,n)}}class cu extends oo{constructor(e,t,s){super(e.x,e.y,1,1),this.r=e,this.padX=t,this.padY=s}r;padX;padY;async onAdd(e){let t=this.can,s=this.ctx;this.r=this.r.changeUnits(1,1,e.can.width,e.can.height);let n=this.r;t.width=this.r.w+this.padX*4,t.height=this.r.h+this.padY*4;let r=t.width/2,a=t.height/2;s.lineWidth=e.fontSize/8,s.strokeStyle="white";let o=n.w/2+this.padX,c=n.h/2+this.padY;c*=.5,c+=n.w/8;let l=r+o,u=a,m=30;function g(p,k,D,E){s.beginPath(),s.lineCap="round",s.moveTo(p,k),s.lineTo(D,E),s.stroke()}for(let p=0;p<Math.PI*2;p+=.1){let k=r+Math.cos(p)*o,D=a+Math.sin(p)*c;l==-1&&(l=k,u=D),g(l,u,k,D),l=k,u=D,m*=.9,await w(m)}g(l,u,r+o,a)}render(e,t){if(this.can.width==0||this.can.height==0)return;let{x:s,y:n}=this.getAnchoredPos(this.can.width,this.can.height);e.drawImage(this.can,s+this.r.w/2,n+this.r.h/2)}}class uu extends oo{constructor(e,t,s){super(e.x,e.y,1,1),this.r=e,this.padX=t,this.padY=s}r;padX;padY;async onAdd(e){let t=this.can,s=this.ctx;this.r=this.r.changeUnits(1,1,e.can.width,e.can.height);let n=this.r;t.width=this.r.w+this.padX*4,t.height=this.r.h+this.padY*4;let r=t.width/2,a=t.height/2;s.lineWidth=e.fontSize/8,s.strokeStyle="white",s.lineDashOffset=t.width/70;let o=n.w/2+this.padX+e.fontSize/8,c=n.h/2+this.padY;c*=.5,c+=n.w/8;let l=30;function u(D,E,C,U){s.beginPath(),s.lineCap="round",s.moveTo(D,E),s.lineTo(C,U),s.stroke()}let m=r-o/2,g=a+c/2+e.fontSize/6,p=.1/6.28*o;function k(D){return g+Math.sin(D/o*Math.PI*e.fontSize/7)*e.fontSize/12}for(let D=0;D<o;D+=p)u(m+D,k(D),m+D+p,k(D+p)),l*=.99,await w(l)}render(e,t){if(this.can.width==0||this.can.height==0)return;let{x:s,y:n}=this.getAnchoredPos(this.can.width,this.can.height);e.drawImage(this.can,s+this.r.w/2,n+this.r.h/2)}}class _a extends so{constructor(){super(0,0),this._can=document.createElement("canvas"),this._can.width=1280,this._can.height=720,this._ctx=this._can.getContext("2d"),this._ctx.fillStyle="white",this._ctx.strokeStyle="white"}_can;_ctx;render(e,t){t._rect,e.drawImage(this._can,0,0,e.canvas.width,e.canvas.height)}postRender(e,t){}}class lo extends jr{constructor(e,t,s,n,r){super(e,t,s,n),this.elm=document.createElement(r),this.elm.classList.add("bo-elm")}elm;async onAdd(e){e.cont.appendChild(this.elm)}render(e,t){}}class _n extends Re{constructor(e){super(),this.refs=e instanceof xs?e:new xs(...e),this.objs=[]}refs;objs;_applyToObjs;applyToObjs(e){return this._applyToObjs=e,this}async addObj(e,t){this.objs.push(e),this._applyToObjs&&this._applyToObjs(e),await t.addObj(e)}}class Zp extends Re{constructor(e){super(),this.obj=e}obj;async run(e){this.start(),await e.addObj(this.obj),await this.finish(!0)}serialize(){return{}}static parse(e){return null}}class zr extends Re{constructor(e){super(),this.delay=e}delay;async run(e){this.start(),await w(this.delay),await this.finish(!0)}serialize(){return{id:"wait",val:this.delay}}static parse(e){return new zr(e.val)}}class $r extends _n{constructor(e,t,s=500){super(e),this.opacity=t,this.animTime=s}opacity;animTime;async run(e){this.start();let t=this.refs.unwrap(e);for(let s=0;s<t.length-1;s++)ln(t[s],"opacity",this.opacity,this.animTime);t[0]&&await ln(t.pop(),"opacity",this.opacity,this.animTime),await this.finish(!0)}serialize(){return{id:"setOpacity",refs:this.refs.refs,val:this.opacity,time:this.animTime}}static parse(e){return new $r(new xs(...e.refs),e.val)}}class qr extends Re{constructor(e){super(),this.comment=e}comment;async run(e){this.start(),await e.waitForBubble(this.comment,0,-innerHeight/5,!0),await this.finish(!0)}serialize(){return{com:this.comment}}static parse(e){return new qr(e.com)}}class xn extends _n{constructor(e){super(e)}async run(e){this.start(),e.paint._can,e.paint._ctx;let t=this.refs.unwrap(e);for(const s of t){let n=s.getRect().changeUnits(e.can.width,e.can.height,1,1),r=e.getCharWidthInPX()*2;await this.addObj(new cu(n,r,r),e)}await this.finish(!0)}serialize(){return{id:"circleObj",refs:this.refs.refs}}static parse(e){return new xn(e.refs)}}class Kp extends _n{constructor(e){super(e)}async run(e){this.start(),e.paint._can,e.paint._ctx;let t=this.refs.unwrap(e);for(const s of t){let n=s.getRect().changeUnits(e.can.width,e.can.height,1,1),r=e.getCharWidthInPX()*2;await this.addObj(new uu(n,r,r),e)}await this.finish(!0)}serialize(){return{id:"circleObj",refs:this.refs.refs}}static parse(e){return new xn(e.refs)}}class Wr extends _n{constructor(e,t=!0,s=500){super(e),this.fadeOut=t,this.fadeTime=s}fadeOut;fadeTime;async run(e){this.start();let t=this.refs.unwrap(e);for(let s=0;s<t.length-1;s++){let n=t[s];this.fadeOut&&ln(n,"opacity",0,this.fadeTime)}t[0]&&await ln(t[t.length-1],"opacity",0,this.fadeTime);for(const s of t)await e.removeObj(s);await this.finish(!0)}serialize(){return{id:"removeObj",refs:this.refs.refs,fadeOut:this.fadeOut,fadeTime:this.fadeTime}}static parse(e){return new Wr(e.refs,e.fadeOut,e.fadeTime)}}class ks extends Re{async run(e){this.start(),e&&(e._rect&&await e.waitForBubble("Close Ponder Board...",0,-e._rect.height/2+36,!0),await e.exit()),await this.finish(!0),d.lesson.currentSubTask._resFinish()}serialize(){return{id:"endBoard"}}static parse(e){return new ks}}class Gp extends Re{cont;svg;async run(e){this.start(),console.log("started draw",e.can.width,e.can.height);let t=new lo(0,0,1,1,"div"),s=t.elm;s.classList.add("be_draw-cont");let n=100,r=n*.5625,a=5;s.innerHTML=`
            <svg viewBox="0 0 ${n} ${r}" xmlns="http://www.w3.org/2000/svg">
                <circle cx="${n/2}" cy="${r/2}" r="${n*.4}" fill="blue"></circle>
                <path d="M 20 20 L 40 50 L 60 40" stroke="red" fill="transparent" line-width="${a}"/>
            </svg>
        `,e.addObj(t),e.ctx.fillStyle="red",e.ctx.fillRect(20,20,40,40),console.log(t.elm),await this.finish(!0)}}class du{constructor(e,t){this.x=e,this.y=t}x=0;y=0;speed=1}class hu extends Re{points=[];constructor(e,t){super(),this.mode=e,this.pointSetId=t??"_"}mode;pointSetId;async run(e){this.start();let t=this.pointSetId;e.points.has(t)||e.points.set(t,[]),this.mode==0?e.points.set(t,await this.getPoints()):this.mode==1&&e.points.get(t).push(...await this.getPoints()),await this.finish(!0)}}class Xp extends hu{constructor(e,t,s,n=1,r=1,a=0,o){super(a,o),this.x=e,this.y=t,this.r=s,this.sw=n,this.sh=r}x;y;r;sw;sh;async getPoints(){let e=[];for(let t=0;t<=6.28;t+=6.28/360){let s=Math.cos(t)*this.r*this.sw+this.x,n=Math.sin(t)*this.r*this.sh+this.y;e.push(new du(s,n))}return e}}class Qp extends Re{constructor(e,t=!1){super(),this.pointSetId=e??"_",this.dontRemoveAfter=t}pointSetId;dontRemoveAfter;async run(e){let t=new lo(0,0,1,1,"div"),s=t.elm;s.classList.add("be_draw-cont");let n=100,r=n*.5625,a=5;s.innerHTML=`
            <svg viewBox="0 0 ${n} ${r}" xmlns="http://www.w3.org/2000/svg">
                <circle cx="${n/2}" cy="${r/2}" r="${n*.4}" fill="blue"></circle>
                <!--<path id="path-base" d="" stroke="red" fill="transparent" line-width="${a}"/>-->
                <path id="path-base" d="" stroke="transparent" fill="transparent" line-width="${a}"/>
                <path id="path-final" d="" stroke="green" fill="transparent" line-width="${a}"/>
            </svg>
        `;let o=s.querySelector("#path-base"),c=s.querySelector("#path-final");e.addObj(t);let l=e.points.get(this.pointSetId);console.log("POLY LINE OVER POINTS:...",l),this.dontRemoveAfter||e.points.delete(this.pointSetId);let m=2,g="";for(let A=0;A<l.length;A++){let R=l[A];A==0?g+=`M ${R.x} ${R.y} `:g+=`L ${R.x} ${R.y} `,R.speed=m}o.setAttribute("d",g);let p=0,k=o.getTotalLength(),D=o.getPointAtLength(0);g=`M ${D.x} ${D.y} `;let E=D,C=-1;p+=m;let U=C;for(;p<k;){let A=o.getPointAtLength(Math.min(p+m,k)),R=A.x-E.x,re=A.y-E.y,me=Math.sqrt(R**2+re**2),Y=Math.atan2(re,R);C==-1&&(C=Y),U==-1&&(U=Y),fu(Y,C),U=Y;let O=E.x+Math.cos(U)*me,x=E.y+Math.sin(U)*me;A.x=O,A.y=x,g+=`L ${A.x} ${A.y} `,c.setAttribute("d",g),p+=m,E=A,await w(16.67)}}}function fu(i,e){let t=Math.abs(i-e);return t>Math.PI&&(t=Math.PI*2-t),t}function Jp(i){return i>0?1:-1}async function ln(i,e,t,s){let n=i[e],r=t-n;if(r==0){i[e]=t;return}let a=r/s;a>0&&a<.01?a=.01:a<0&&a>-.01&&(a=-.01);let o=s/(Math.abs(r)/Math.abs(a)),c=r>0;for(let l=n;c?l<=t:l>=t;l+=a)i[e]=l,await w(o);i[e]=t}class pu{constructor(e,t={}){this.id=e,this.root=document.createElement("div"),this.root.className="v3-scene",this.content=document.createElement("div"),this.content.className="v3-scene-content",this.root.appendChild(this.content),t.centered&&this.content.classList.add("centered"),this.arrange()}board;id;x=0;y=0;w=1;h=1;zoom=1;zx=0;zy=0;root;content;objs=[];curEditorId="";curEditor;curEditorActions;editors={};addEditor(e,t){this.editors[e]=t,this.focusEditor(e,t)}getEditor(e){return this.editors[e]}focusEditor(e,t){t||(t=this.getEditor(e)),this.curEditorId=e,this.curEditor=t,this.curEditorActions=new Xa(t),t.focus()}removeEditor(e){delete this.editors[e];let t=Object.keys(this.editors)[0];if(t){this.focusEditor(t);return}this.curEditorId=void 0,this.curEditor=void 0,this.curEditorActions=void 0}addObj(e){console.log("added obj: ",e.id),this.objs.push(e),this.content.appendChild(e.elm),e.update()}removeObj(e){let t=this.objs.indexOf(e);t!=-1&&(console.log("removed obj: ",e.id),this.objs.splice(t,1),e.remove())}getObj(e){return this.objs.find(t=>t.id==e)}arrange(e=this.x,t=this.y,s=this.w,n=this.h){this.x=e,this.y=t,this.w=s,this.h=n,this.root.style.left=`${this.x*100}%`,this.root.style.top=`${this.y*100}%`,this.root.style.width=`${this.w*100}%`,this.root.style.height=`${this.h*100}%`;for(const r of this.objs)r.update()}goto({x:e,y:t,zoom:s,dx:n,dy:r,dzoom:a,mzoom:o},c=!0){c&&(e&&(e=-e),t&&(t=-t),n&&(n=-n),r&&(r=-r)),e??=this.x,t??=this.y,s??=this.zoom,n&&(e+=n),r&&(t+=r),a&&(s+=a),o!=null&&(s*=o),this.x=e,this.y=t,this.zoom=s,this.content.style.scale=s.toString(),this.content.style.left=`${e}px`,this.content.style.top=`${t}px`}}class em extends Re{constructor(e={},t){super(),this.mainSceneOps=t,this.ops=e}mainSceneOps;ops;async run(e){e.v3Ops=this.ops,console.log(":: init Board Draw V3",d.lesson.boards);let t=new pu("main",this.mainSceneOps);e.addScene(t)}}class tm extends Re{constructor(e){super(),this.path=e}path;async run(e){let t=e.extraData.files[this.path];if(!t){console.warn("couldn't get data, path didn't lead to a file",this.path,e.extraData);return}let s=new bn(new ao(t,0),0,0,1,1);await e.addObj(s)}}class im extends Re{constructor(...e){super(),this.args=e}args;async run(e){let t=new pu(...this.args);e.addScene(t)}}class sm extends Re{constructor(e){super(),this.id=e}id;async run(e){let t=e.getScene(this.id);e.selectScene(t)}}class nm extends Re{constructor(e){super(),this.args=e}args;async run(e){for(const t of this.args)e.getScene(t.id).arrange(t.x,t.y,t.w,t.h)}}class rm extends Re{constructor(e,t,s,n=!0){super(),this.args=e,this.delay=t,this.delayAfter=s,this.flipInput=n}args;delay;delayAfter;flipInput;async run(e){this.delay&&await w(this.delay),console.log(":: move scene cam",this.args),e.curScene.goto(this.args,this.flipInput),await w(500),this.delayAfter&&await w(this.delayAfter)}}class am{constructor(e,t,s,n=0,r=0,a=1,o=1){this.id=e,this.x=t,this.y=s,this.w=a,this.h=o,this.ha=n,this.va=r}id;x=0;y=0;w=1;h=1;ha=0;va=0;remove(){}}class mu extends am{elm;update(){let e=this.elm;e.style.left=`${this.x}%`,e.style.top=`${this.y}%`,e.style.translate=`${-this.ha*100}% ${-this.va*100}%`}remove(){super.remove(),this.elm.parentElement&&this.elm.remove()}}class om extends Re{constructor(e,t,...s){super(),this.args=[e,t,...s]}args;async run(e){let[t,s,...n]=this.args,r=new mu(...n);r.elm=document.createElement(t),s.text&&(r.elm.textContent=s.text);for(const a in s.styles)r.elm.style[a]=s.styles[a];if(s.removeAttr)for(const a of s.removeAttr)r.elm.removeAttribute(a);if(s.attr)for(const a in s.attr)r.elm.setAttribute(a,s.attr[a]);if(s.removeClasses)for(const a of s.removeClasses)r.elm.classList.remove(a);if(s.classes)for(const a of s.classes)r.elm.classList.add(a);e.curScene.addObj(r)}}class lm extends Re{constructor(e){super(),this.id=e}id;async run(e){let t=e.curScene.getObj(this.id);if(!t){console.warn("couldn't get obj to remove from scene",this.id),alert("couldn't get obj to remove from scene, try reload the page");return}e.curScene.removeObj(t)}}class cm extends Re{constructor(e,t={}){super(),this.id=e,this.edits=t}id;edits;async run(e){let t=e.curScene.getObj(this.id);if(!t){console.warn("Couldn't find obj to edit, not good!"),alert("Something went wrong, try saving and reloading the page");return}let s=this.edits;if(s.text!=null&&(t.elm.textContent=s.text),s.styles!=null)for(const n in s.styles)t.elm.style[n]=s.styles[n]}}class um extends Re{constructor(e,t){super(),this.id=e,this.parentId=t}id;parentId;async run(e){let t=e.curScene.getObj(this.id),s=e.curScene.getObj(this.parentId);if(!t||!s){console.warn("couldn't find object when trying to appending",this.id,this.parentId,t,s),alert("Something went wrong, try saving and reloading the page");return}s.elm.appendChild(t.elm)}}class co extends Re{constructor(e,t){super(),this.id=e,this.fromSceneId=t}id;fromSceneId;static selectFile(e,t){if(!e.v3Ops.editorFileNames)return;t.startsWith("board/")&&(t=t.substring(6));let s=e.curScene.root.querySelector(".v3-editor-tab");s&&s.remove();let n=document.createElement("div");if(n.className="v3-editor-tab",n.textContent="",n.style.display="none",e.curScene.root.appendChild(n),!t){n.style.display="none",n.textContent="";return}n.style.display="block",n.textContent=t}async run(e){e.curScene.root.style.setProperty("--bg","#1e1e1e");let t=this.fromSceneId?e.scenes[this.fromSceneId]:void 0;if(t){let a=t.editors[this.id];a.layout(),e.curScene.addEditor(this.id,a);return}let s=new mu("editor",0,0);s.elm=document.createElement("div"),e.curScene.addObj(s);let r=monaco.editor.create(s.elm,{value:"",language:"html",theme:"vs-dark",bracketPairColorization:{enabled:!1},minimap:{enabled:!1},contextmenu:!1,readOnly:!1,snippetSuggestions:"none",quickSuggestions:!1});s.elm.style.height="100%",s.elm.style.position="relative",s.elm.style.zIndex="9",s.elm.style.pointerEvents="none",r.layout(),console.log("ponder board EDITOR",r),e.curScene.addEditor(this.id,r)}}class dm extends Re{constructor(e){super(),this.id=e}id;async run(e){e.curScene.focusEditor(this.id)}}class hm extends Re{constructor(e,...t){super(),this.key=e,this.args=t}key;args;async run(e){e.curScene.curEditor.focus(),cr=!0,e.curScene.curEditor.focus(),await e.curScene.curEditorActions[this.key](...this.args),cr=!1}}class fm extends Re{constructor(e,t="",s,n=!0){super(),this.toPath="board/"+e,this.content=t,this.filePath=s,this.endOfFile=n}toPath;content;filePath;endOfFile;getContent(e){return this.filePath?e.extraData.files[this.filePath]??this.content??"":this.content??""}async run(e){let t=monaco.editor.createModel(this.getContent(e),void 0,dc.file(this.toPath));e.curScene.curEditor.setModel(t),e.curScene.curEditor.focus(),this.endOfFile&&new Xa(e.curScene.curEditor).endOfFile(),co.selectFile(e,this.toPath)}}class pm extends Re{constructor(e,t){super(),this.toPath="board/"+e,this.fromPath=t}toPath;fromPath;async run(e){let t=e.extraData.files[this.fromPath];t||(console.warn("WARNING! couldn't find the right file to open, just using blank instead!"),alert("Warning! A needed file couldn't be found, try reloading"),t="");let s=monaco.editor.createModel(t,void 0,dc.file(this.toPath));e.curScene.curEditor.setModel(s),e.curScene.curEditor.focus(),co.selectFile(e,this.toPath)}}class mm extends Re{constructor(e,t){super(),this.prop=e,this.v=t}prop;v;async run(e){e.delays[this.prop]=this.v}}class gm extends Re{async run(e){e.resetDelays()}}class gu{constructor(e){this.bid=e,this.objs=[],this.events=[];let t=new _a;this.objs.push(t),this.paint=t,this.points=new Map,this.points.set("_",[])}bid;isVisible=!1;cont;can;ctx;paint;delays={base:300,after:0,before:0};resetDelays(){let e=this.delays;e.base=300,e.after=0,e.before=0}extraData={files:{}};v3Ops;curScene;scenes={};addScene(e){e.board=this,console.log(":: add scene",e.id,e),this.scenes[e.id]=e,this.selectScene(e),this.cont.appendChild(e.root),this.updateZoom()}selectScene(e){console.log(":: select scene",e.id,e),this.curScene=e}removeScene(e){console.log(":: remove scene",e.id,e),delete this.scenes[e.id],e.root.parentElement&&e.root.remove()}clearScenes(){console.log("cleared scenes");for(const e in this.scenes){let t=this.scenes[e];t.root.parentElement&&t.root.remove()}this.scenes={}}getScene(e){return this.scenes[e]}updateZoom(){for(const e in d.lesson.board.scenes)d.lesson.board.scenes[e].root.style.setProperty("--base-zoom",`${innerWidth/1280}`)}objs;points;getDim(){return{w:100,h:100*this.aspectRatio}}aspectRatio=.5625;_rect;fontSize=16;baseFontScale=1/16;fontScale=1;font="Arial";applyFont(){let e=this.can;this.fontSize=e.height*this.baseFontScale*this.fontScale,this.ctx.font=this.fontSize+"px "+this.font}events;_pb;async exit(){if(!this._pb)return;qe(this._pb),this._pb=null,d.lesson.board==this&&(d.lesson.board=null),await w(2),this.objs=[];let e=document.querySelector(".global-bubble-overlay");e&&e.classList.remove("covered");let t=new _a;this.objs.push(t),this.paint=t}_fontWidthScale=.6;getCharWidth(){let e=this;return e.baseFontScale*(e.can.height/e.can.width)*this._fontWidthScale}getCharWidthInPX(){let e=this;return e.baseFontScale*(e.can.height/e.can.width)*this._fontWidthScale*this.can.width}storeObj(e,t){return t.addTag(e),t}getObjByTag(...e){return this.objs.find(t=>t.hasTag(...e))}getAllObjsByTag(...e){return this.objs.filter(t=>t.hasTag(...e))}async addObj(e){this.objs.push(e),e.b=this,await e.onAdd(this)}async removeObj(e){this.objs.splice(this.objs.indexOf(e),1),e.removeAllTags()}async replaceObj(e,t){this.objs.splice(this.objs.indexOf(e),1),this.objs.push(t),t.b=this,e.transferTags(t),await t.onAdd(this)}async waitForBubble(e,t,s,n=!0){let r=this._rect;r||(r=new DOMRect(0,0,0,0)),n&&(t+=r.width/2,s+=r.height/2),t+=r.x,s+=r.y;let a=Te(4,e,null,{x:t,y:s,click:!0});return n&&a.e.classList.add("centered","no-callout"),await a.clickProm,a}async init(){console.log(":: load extra board data",this.bid,d.lesson.fullMeta.boardExtraData,d.lesson.fullMeta.boardExtraData[this.bid]),this.extraData=d.lesson.fullMeta.boardExtraData[this.bid]??{files:{}},this.can=document.createElement("canvas"),this.ctx=this.can.getContext("2d"),this.render(),this.objs=[],this.drawCan=document.createElement("canvas");let e=this.getDim();this.drawCan.width=e.w,this.drawCan.height=e.h,this.draw=this.drawCan.getContext("2d"),Pr==0?await ri(100):await ri(1500);for(const t of this.events)this.delays.before&&await w(this.delays.before),await t.run(this),await w(this.delays.base),this.delays.after&&await w(this.delays.after)}render(){if(d.lesson.board!=this)return;let e=this;if(requestAnimationFrame(()=>{e.render()}),!this.isVisible)return;let t=this.ctx,s=t.canvas,n=s.getBoundingClientRect();this._rect=n,s.width=n.width,s.height=s.width*this.aspectRatio,t.fillStyle="white",t.strokeStyle="white",this.fontScale=1,this.font="Arial",this.applyFont();for(const r of this.objs)t.globalAlpha=r.opacity,r.render(t,this);for(const r of this.objs)t.globalAlpha=r.opacity,r.postRender(t,this);t.globalAlpha=1}wipe(){this.objs=[]}show(){let e=document.querySelector(".global-bubble-overlay");e&&e.classList.add("covered"),this.isVisible=!0;let t=Te(2,"");t.e.classList.add("board-bubble");let s=document.createElement("div");s.className="board-cont",t.e.innerHTML="",t.e.appendChild(s),s.appendChild(this.can),this.cont=s,this._pb=t}hide(){this.isVisible=!1}save(){let e={events:[]};for(const t of this.events){let s=t.serialize();e.events.push(s)}console.log("Board Data",e)}__data;initEvents(){let e=this.__data,t=this,s=mo(e,{board:t,data:{board:t}});if(!s){alert("critical error happened while trying to load ponder board events file; aborting");return}t.events=s,t.events.length&&(t.events[t.events.length-1]instanceof ks||t.events.push(new ks))}drawCan;draw;clearDraw(){this.draw.clearRect(0,0,this.drawCan.width,this.drawCan.height)}}class uo{constructor(e,t,s,n){this.lid=e,this.p=new ja(t,s),this.tut=new ja("tut_"+t,n,{readonly:!0,disableCopy:!0}),this.p.lesson=this,this.tut.lesson=this,this.p.builtInFileList=!0,this.tut.builtInFileList=!0,this.tut.onopen=(r,a)=>{if(this.isActiveFileUnlocked())this.activeFile=r;else if(this.isTutorEditing())return!1}}postSetup(){}lid;events;p;tut;fullMeta;useLocalRefresh(){return this.info.type==bt.review}get isLive(){return this.lid.startsWith("live-")}bannerSection;finalInstance;_taskNum=0;_subTaskNum=0;_taskCount=0;currentEvent;currentSubTask;_hasShownMarkDoneReminder=!0;_hasShownFollowAlong=!1;board;boards=[];needsSave=!1;hasLoaded=!1;_loadStart=0;info;_restoreData;_clipboardText="";cursorHistory={history:[]};quizzes=new Map;standardDelay=350;getStandardDelay(){return this.standardDelay}_activeFileUnlock=0;activeFile;isActiveFileUnlocked(){return this.activeFile?this._activeFileUnlock>0:!0}startActiveFileUnlock(){this._activeFileUnlock++}endActiveFileUnlock(){this._activeFileUnlock--}_editing=0;isTutorEditing(){return this._editing>0}startEditing(){this._editing++}endEditing(){this._editing--}async goToActiveFile(){if(this.activeFile){if(!this.tut.files.includes(this.activeFile)){this.activeFile=null;return}this.tut.curFile!=this.activeFile&&await this.switchFile(this.activeFile)}}goToActiveFileInstant(){if(this.activeFile){if(!this.tut.files.includes(this.activeFile)){this.activeFile=null;return}this.tut.curFile!=this.activeFile&&(this.startActiveFileUnlock(),this.activeFile.open(),this.endActiveFileUnlock())}}async switchFile(e,t,s){let n=ye.getBoundingClientRect(),r,a=e instanceof ze?e:d.lesson.tut.files.find(l=>l.name==e);if(!a){console.warn("Err: tutor tried to switch to file that didn't exist"),alert("A strange error has occured, please save and then refresh the page."),s&&await s.finish();return}let o="Let's go back",c;if(a){o=t??"Let's go back to "+a.name;let l=a.link;r=l.getBoundingClientRect(),n=r,c=l}if(t!=""){let l=Te(4,o,"top",{x:n.x+n.width/2+17,y:n.y+n.height/2-22,click:!0}),u=Se.subEvt(new Gt("openFile",m=>!(m.name!=e.name||m.getPath()!=e.getPath())));await Promise.any([l.clickProm,Se.waitFor(u)]),qe(l)}this.toggleDisableSyncPos(!0),await Ke(),await Yt(r.x+r.width/2,r.y+r.height/2),await Xt(async()=>{a&&(d.lesson.startActiveFileUnlock(),a.open(),d.lesson.endActiveFileUnlock())},void 0,c),await ut(),this.toggleDisableSyncPos(!1)}async goToNextScene(){if(!this.info?.sections.length)return;if(this.progress.sceneI++,this.progress.sceneI>=this.progress.final_order.length){console.log("> finished review"),this.progress.prog=100,le.emit("finishLesson",this.lid,t=>{t!=0&&alert(`Error ${t} while trying to finish review lesson`),new Jo().load()});return}await new Promise(t=>{le.emit("goToNextScene",{lid:this.lid},s=>{if(s!=0){alert("Error occured while trying to go to the next problem: error code: "+s+`

Please refresh the page.`),t(!1);return}t(!0)})})&&(this.progress.eventI=-1,this.progress.taskI=-1,await Ri(!0),await yu(),await w(500))}sceneContinue(){}sceneReplay(){}sceneReplayLater(){}async replayLater(){console.log(">> REPLAYING LATER");let e=this.progress.sceneI;if(e==-1){console.log("-- failed");return}let t=await new Promise(s=>{le.emit("replaySceneLater",d.lesson.lid,e,n=>{!n||typeof n=="number"?(alert(`Error ${n} while trying to replay problem later`),s(void 0)):s(n)})});t&&(this.currentSubTask instanceof Bi&&(this.currentSubTask.correct=!1),this.progress.final_order=t,await this.goToNextScene())}async saveLesson(e=!1,t={}){await Ri(e,t)}async endLoading(e=!0){if(e){let s=performance.now()-this._loadStart,n=1e3;s<n&&await ri(n-s),Ic.classList.add("done")}console.warn("*** Finished loading lesson"),this.hasLoaded=!0;let t=d.lesson.p.items.find(s=>s.name=="index.html");t?t.open():d.lesson.p.files[0]?.open(),bi(d.lesson.tut),this.info.type==bt.live&&(await Ke(),await Yt(200,200))}progress={eventI:0,taskI:-1,prog:0,sceneI:0,final_order:[],misses:0,lowestMisses:-1,lowestMissN:-1};isResuming=!1;resume={eventI:0,taskI:-1};async finishResume(){console.warn("finish resume"),wt(1),this.isResuming=!1,document.body.classList.remove("hide-bubbles"),await ri(500),ye.style.visibility=null,ct(),d.lesson.tut.curFile?.open(!1),d.lesson.tut.toggleShowFilesBtn(!1),d.lesson.p.toggleShowFilesBtn(!1)}getFilesAsFolder(){let e=new Ie(this.p,"root",null);e.items=this.p.items;let t=s=>{if(s instanceof Ie){let n=new Yn(s.name,[]);return n.items=s.items.map(r=>t(r)),n}else if(s instanceof ze)return new fi(s.name,s.encode())};return t(e)}startEditting(){this.tut.curFile&&(this.tut.curFile.blockPosChange=!1)}async endEditting(){if(this.tut.curFile){this.tut.curFile.blockPosChange=!0;let e=this.tut.getCurEditor();Qa(e);let t=e.getPosition(),s=Pr;wt(0),await Ls(t.column,t.lineNumber,!0),wt(s)}}canLeave(){return!(this.needsSave||this.p.openFiles.some(e=>!e._saved))}isQuitting=!1;async quit(){wt(0),this.isQuitting=!0,ho(),this.currentSubTask&&this.currentSubTask._resFinish&&this.currentSubTask._resFinish(),this.currentEvent&&this.currentEvent._res(),await ri(1),this.currentSubTask&&this.currentSubTask._resFinish&&this.currentSubTask._resFinish(),wt(1);let e=[...this.tut.files];this.tut.files=[],this.tut.items=[],this.tut.curFile=null,this.tut.openFiles=[],this.tut.lastFolder=null;for(let t=0;t<e.length;t++)this.tut.d_files.removeChild(this.tut.d_files.children[0]);this.tut.codeCont.children[0]?.remove()}static parse(e,t,s){let n=new uo(e.lid,e.name,t,s);if(n.fullMeta=e,e.banner&&(n.bannerSection=new Up(e.banner.sections.map(o=>new Sm(o.head,o.text)))),n.finalInstance=new Mp([]),!e.events){alert("There was a problem loading this lesson");return}e.events=e.events.substring(e.events.indexOf(`
`)+1),e.boardData=e.boardData.map(o=>o.substring(o.indexOf(`
`)+1));let r=mo(e.events);if(!r)return;n.events=r,n.boards=e.boards.map(o=>new gu(o));for(let o=0;o<n.boards.length;o++){let c=n.boards[o];c.__data=e.boardData[o]}let a=0;n.totalTasks=0;for(const o of n.events){o._i=a,a++;for(const c of o.tasks)c._i=a,a++,n.totalTasks++}return n.totalParts=a,n.sections=n.events.filter(o=>o instanceof ur),n.initSectionProgressCont(),n}getCurrentState(){let e=new Np;function t(s){let n=[];for(const r of s)r instanceof ze?n.push(new fi(r.name,r.encode())):r instanceof Ie&&n.push(new Yn(r.name,t(r.items)));return n}if(e.tutItems=t(this.tut.items),this.tut.curFile){e.curFile=e.tutItems.find(n=>n.name==this.tut.curFile.name);let s=this.tut.getCurEditor();s&&(e.pos=s.getPosition().clone())}else console.warn("Warn: tut curFile not found");return e}async restoreFromState(e){if(!e){console.warn("Warn: tried to restore from state with no state, not good! but this prevented a crash");return}let t=this.tut,s=e.tutItems;for(const r of s)if(r instanceof fi){let a=t.files.find(o=>o.name==r.name);a&&a.editor&&a.editor.setValue(this.p.textDecoder.decode(r.buf))}let n=[...t.openFiles];for(const r of n)if(!s.some(a=>a.name==r.name)){let a=r.link.children[1],o=a.getBoundingClientRect();await Ke(),await Yt(o.x+o.width/2,o.y+o.height/2),await w(300),await Xt(async()=>{r.softDelete()},void 0,a),await w(500)}for(const r of s)if(r instanceof fi&&!t.openFiles.some(a=>a.name==r.name)){let a=d.lesson.tut.parent.querySelector(".b-add-file"),o=a.getBoundingClientRect();await Ke(),await Yt(o.x+o.width/2,o.y+o.height/2),await w(300),await Xt(async()=>{t.createFile(r.name,r.buf.slice())},void 0,a),await w(500)}if(e.curFile&&e.curFile&&t.curFile&&e.curFile?.name!=t.curFile?.name){let r=t.files.find(c=>c.name==e.curFile.name),a=r.link,o=a.getBoundingClientRect();await Ke(),await Yt(o.x+o.width/2,o.y+o.height/2),await w(300),await Xt(async()=>{r.open()},void 0,a),await w(500)}if(this.tut.curFile){let r=this.tut.getCurEditor();r&&(r.updateOptions({readOnly:!1}),this.tut.curFile.blockPosChange=!1,r.setPosition(e.pos),this.tut.curFile.curRow=e.pos.lineNumber,this.tut.curFile.curCol=e.pos.column,r.updateOptions({readOnly:!0}),this.tut.curFile.blockPosChange=!0)}}totalParts=0;totalTasks=0;sections;curSection;updateCurrentProgress(){if(this.hasLoaded&&(this.needsSave=!0),this.isComplete){ya.textContent="100%",this.updateSectionProgressCont();return}let t=((this.currentSubTask?._i??this.currentEvent?._i??0)+1)/this.totalParts;this.hasSections()?this.progress.prog=parseFloat((this.progress.sceneI/this.progress.final_order.length*100).toFixed(1)):this.progress.prog=parseFloat((t*100).toFixed(1)),ya.textContent=this.progress.prog+"%",this.updateSectionProgressCont()}initSectionProgressCont(){if(qt.textContent="",ss.textContent="",this.info?.type==bt.review)return;let e=this.events,t=200;for(const s of e){let n=document.createElement("div");n.className="section-item",ss.appendChild(n),n.style.setProperty("--prog","0%");let r=n.offsetHeight,a=(s.tasks.length+1)/this.totalTasks,o=Math.max(a*t,r);n.style.width=o+"px"}}updateSectionProgressCont(){if(this.info?.type==bt.review){qt.textContent="",ss.textContent="";return}let e=this.events;if(this.isComplete){for(let s=0;s<e.length;s++)ss.children[s].style.setProperty("--prog","100%");return}let t=this.currentEvent;if(t){if(t instanceof ur){let s=t?.ops.title;s=this.sections.indexOf(this.curSection)+1+": "+s,qt.textContent=s;let r=qt.scrollWidth;qt.style.width=r+"px",qt.classList.add("active")}else qt.textContent="",qt.style.width="0px",qt.classList.remove("active");for(let s=0;s<e.length;s++){let n=ss.children[s],r=e[s];if(!this.currentEvent){this.isComplete?n.style.setProperty("--prog","100%"):n.style.setProperty("--prog","0%");continue}let a=this.events.indexOf(r),o=this.events.indexOf(this.currentEvent);if(a>o){n.style.setProperty("--prog","0%");continue}else if(a<o){n.style.setProperty("--prog","100%");continue}let c=r.tasks.indexOf(this.currentSubTask),l=this.currentSubTask?.getCompleteness()??0,u=(c+l)/r.tasks.length;n.style.setProperty("--prog",u*100+"%")}us.classList.contains("closed")||po()}}_getTotal(){let e=this.currentSubTask;if(!e){let r=this.events.indexOf(this.currentEvent),a=this.events[r-1];a&&(e=a.tasks[a.tasks.length-1])}let t=0,s=0,n=!1;for(const r of this.events)for(const a of r.tasks)a==e?n=!0:n||t++,s++;return{taskI:t,total:s}}async init(){await ec(),this.p.init(),this.tut.init();let e=d.lesson;await e.restoreLessonFiles();let t=e.progress.eventI,s=e.progress.taskI;e.resume.eventI=t,e.resume.taskI=s,t==-1&&s==-1?(this.endLoading(),Em(this),this.finalInstance?.files?.length&&Cm(this)):this.start()}async start(e=!1){this._loadStart=performance.now(),Za.classList.add("closed"),document.body.classList.add("hide-bubbles"),this.updateCurrentProgress(),this._taskNum=0,this.clearAllTasks(),this.currentSubTask=null,e||await w(350);let t=0;for(const a of this.events)for(const o of a.tasks)o.supertask=a;let s=d.lesson;s.resume.eventI==-1&&(s.resume.eventI=0);let n=s.resume.eventI,r=s.resume.taskI;if(n==0&&r==-1){let a=this.events[0];this._subTaskNum=0,this.progress.eventI=this.events.indexOf(a),this.progress.taskI=-1,this.loadEvent(a),t==0&&console.warn("RESUMING",n,r),wt(1),document.body.classList.remove("hide-bubbles"),a.run(),t++,this.endLoading()}else console.log("RESUME",this.resume),ye.style.visibility="hidden",wt(0),this.isResuming=!0,this.loadEvent(this.events[0]),this.events[0].run(),this.endLoading()}hasSections(){return this.info?.sections?this.info?.sections.length!=0:!1}isComplete=!1;loadEvent(e){if(!e){if(this.hasSections()){this.goToNextScene();return}le.emit("finishLesson",this.lid,t=>{t!=0&&alert(`Error ${t} while trying to finish lesson`),new Jo().load()});return}this.currentEvent=e,this.clearAllTasks(),this.currentEvent=e,this.currentSubTask=null,this.progress.eventI=this.events.indexOf(e),this.progress.taskI=-1,lr.innerHTML=`<div>${za(e.getTaskText())}</div>`,this.updateCurrentProgress()}clearAllTasks(){this.currentEvent=null,lr.innerHTML="",ai.innerHTML=""}loadSubTask(e){if(!e)return;this.currentSubTask=e,this.currentEvent||(console.warn("Warning: if this line prints it's not a good sign! but hopefully recovered from a serious error when debug jumping"),this.currentEvent=e.supertask),Dt.disabled=!1,e.hasStarted=!0;let t=this,s=t.tut.getCurEditor(),n=s?.getPosition();e._preVal=s?.getValue()||"",e._preLine=n?.lineNumber||1,e._preCol=n?.column||1,e._prePFile=t.p.curFile,e._preTutFile=t.tut.curFile;let r=document.createElement("div"),a=t.currentEvent.tasks.indexOf(e);r.innerHTML=`<div class="flx-sb c"><div><span class="l-num">#${a+1} </span><span>${e.title}</span></div><div class="material-symbols-outlined cb">check_box_outline_blank</div></div>`;let o=e.getSections();ai.appendChild(r);for(const c of o){let l=document.createElement("div");l.innerHTML=c.get(),e.taskRef=l,r.appendChild(l);let u=l.querySelector("code");if(u){Prism.highlightElement(u,null,null);let m=l.querySelector(".b-mark-done");m.addEventListener("click",async p=>{e._resFinish()&&(m.disabled=!0)}),l.querySelector(".b-replay").addEventListener("click",p=>{e.replay(s)})}}}finishSubTask(e){let t=this.currentEvent.tasks.indexOf(e);if(t!=-1){let n=ai.children[t]?.querySelector(".cb");n&&(n.textContent="select_check_box")}Mc()}showHelp(){let e=this.currentSubTask;if(e instanceof Bi){let t=this.currentEvent.tasks.indexOf(e);this.currentEvent.tasks[t+1]?e._resFinish():alert("Unfortunately this question doesn't have any hints or help yet!")}}overrideDisableLessonConfirm=0;disableSyncPos=0;toggleDisableSyncPos(e){e?this.disableSyncPos++:(this.disableSyncPos--,this.disableSyncPos<0&&(this.disableSyncPos=0))}uploadLessonFiles(e){let t=this,s=[];function n(a){let o=[];for(const c of a)if(c instanceof ze){if((!c._saved||!c.beenUploaded)&&(o.push(new fi(c.name,c.encode())),c.beenUploaded=!0,t.p?.wc?.booted)){let l=c.getPath();t.p.wc.saveFile(l+c.name,c.encode(),e.ignoreInsts)}}else if(c instanceof Ie&&(o.push(new Yn(c.name,n(c.items))),t.p?.wc?.booted)){let l=c.getPath();t.p.wc.saveFolder(l+c.name,!0,e.ignoreInsts)}return o}s=n(Rt.project.items);let r={eventI:t.progress.eventI,taskI:t.progress.taskI,prog:t.progress.prog,sceneI:t.progress.sceneI,misses:t.progress.misses};return new Promise(a=>{console.log(".......uploading"),le.emit("uploadLessonFiles",t.lid,s,r,o=>{o==null&&alert("Unknown error while uploading files"),o&&alert("ERR while uploading files: "+o),a()})})}async restoreLessonFiles(){let e=this,t=e._restoreData,s=e.p;async function n(r,a){Tn(r);let o=[];for(const c of r)if(c.items==null){let l=await s.createFile(c.name,c.buf,null,a);o.push(l)}else if(c.items!=null){let l=s.createFolder(c.name,a,!1);o.push(l),l.items=await n(c.items,l)}return o}await n(t.files,null),t.files.length&&(s.hasSavedOnce=!0),s.files.forEach(r=>r.setSaved(!0)),e.progress.eventI=t.meta.eventI,e.progress.taskI=t.meta.taskI,t.meta.sceneI&&(e.progress.sceneI=t.meta.sceneI),t.meta.final_order&&(e.progress.final_order=t.meta.final_order),e.progress.misses=t.meta.misses,e.progress.lowestMisses=t.meta.lowestMisses,e.progress.lowestMissN=t.meta.lowestMissN,console.log(":::META",t.meta),e.info=t.info,document.title=e.info.name+" - Code Otter Lesson",await w(0);for(const r of e.p.files)r.open(!1);if(e.startActiveFileUnlock(),console.log(">>> opening tut files:",e.tut.files),!e.isLive)for(const r of e.tut.files)r.open();if(e.endActiveFileUnlock(),e.postSetup(),e.info.type==bt.review){kp(1);let r=e.tut.getCurEditor();console.log("tuteditor:",r),r&&r.updateOptions({wordWrap:"on"})}d.triggerLesson()}}function xa(){d.lesson?.p?.hasEditor()&&d.lesson.p.getCurEditor().layout(),d.lesson?.tut?.hasEditor()&&d.lesson.tut.getCurEditor().layout()}function vu(i){i==null?d.usingAltLayout=!d.usingAltLayout:d.usingAltLayout=i,document.body.classList.toggle("alt-layout",d.usingAltLayout),an.children[0].textContent=d.usingAltLayout?"grid_view":"view_week",d.lesson&&xa(),localStorage.setItem("altLayout",""+d.usingAltLayout)}async function ut(){ye.style.opacity!="0"&&(ye.style.opacity="0",await w(350))}async function Ke(i=!1){ye.style.opacity!="1"&&(ye.style.opacity="1",await w(i?75:350))}async function oi(i,e,t=!1){if(d.lesson.tut.curFile){let s=d.lesson.tut.getCurEditor();mt(),s.setPosition({lineNumber:e,column:i}),ct(),ws(s,!0)}t||await w(350)}async function Yt(i,e,t=!1){ye.style.left=i+"px",ye.style.top=e+"px",t||await w(350)}let wu=150;async function vm(){let i=d.lesson;if(!i){console.log("$ no lesson to deload");return}console.trace("$ deloading lesson..."),await i.quit(),await Mc(!0),Zn(0),ji.textContent="",Ye.textContent="",lr.textContent="",ai.textContent="",Va(null)}async function yu(){if(d.lesson&&(!d.lesson.hasLoaded||d.lesson.isResuming)){console.warn("Warn: can't init lesson page when there is a lesson currently resuming.");return}if(await vm(),Ra(ji,_r.tutor),Ra(Ye,_r.self),Jl&&!await Ql()||!ys.loggedIn)return;let i=Tr.currentRoute.value.params.lid;if(!i){console.log("No lid found so no lesson to load");return}let e=await new Promise(s=>{le.emit("getLesson",i,n=>{typeof n=="number"?(alert("Err: while trying to load lesson data, error code: "+n),s(null)):s(n)})});if(!e)return;console.log("TREE LESSON DATA",e);let t=await new Promise(s=>{le.emit("restoreLessonFiles",{lid:i},async n=>{if(!n){console.log("ERR while restoring files"),s(null);return}console.log("LESSON META:",n);async function r(a){for(let o=0;o<a.length;o++){let c=a[o];if("items"in c)await r(c.items);else{let l=c;l.buf=new Uint8Array(l.buf);let u=new fi(l.name,l.buf);a[o]=u}}}await r(n.files??[]),s(n)})});if(!t||typeof t=="number"){alert("Err: while trying to restore lesson files. Error code: "+t);return}if(t.files||(t.files=[],console.warn("...default for files[]")),e.sections!=null){console.warn(">> FOUND SECTIONS. parsing..."),console.log(e);let s=t.meta,n=s.sceneI,r=s.final_order[n];if(!r){console.error("Couldn't find lesson scene to load.","Packed ID: "+r,"Packed I: "+n);return}console.log("packed id: ",r,n);let[a,o]=r.split("^"),c=e.sections.find(u=>u.id==a);if(!c){console.error("Couldn't find section: ",a);return}let l=c.scenes.find(u=>u.id==o);if(!l||!l._data){console.error("Couldn't find scene to load: ",a,o);return}await Go(l._data,t)}else await Go(e,t);d.lesson.tut}async function Go(i,e){if(Va(uo.parse(i,Ye,ji)),!d.lesson)return;if(d.lesson._restoreData=e,window.LS=d,window.BUBBLES=()=>Ge,await d.lesson.init(),wr(d.lesson.p),console.log(">> found initial files:",i.initialFiles),i.initialFiles){let n=function(a,o){for(const c of a.items)if("items"in c){let l=d.lesson.tut.createFolder(c.name,o,!0,!0,!1);n(c,l)}else"buf"in c&&d.lesson.tut.createFile(c.name,c.buf,void 0,o,!0,!r)},r=!0;d.lesson.isLive&&(r=!1),n(i.initialFiles),d.lesson.isLive&&d.lesson.tut.openFiles.length==0&&d.lesson.tut.findFile("index.html")?.open(!0)}if(console.log(">> user files: ",i.userFiles),i.userFiles)for(const n of i.userFiles)await d.lesson.p.createFile(n.name,new Uint8Array(n.data),void 0,void 0,!0);i.userFiles?.length&&await Ri(!0),Lr(!0);let t=d.lesson.p.refs.preview,s=d.lesson.tut.refs.preview;nn["your-preview"]=(n,r)=>{r=Math.min(r,innerHeight-218-40),t.style.setProperty("--h",r+"px"),s?.style.setProperty("--h",r+"px"),xa()},nn["tutor-preview"]=(n,r)=>{r=Math.min(r,innerHeight-218-40),t.style.setProperty("--h",r+"px"),s?.style.setProperty("--h",r+"px"),xa()},ar(t),ar(s),t.style.setProperty("--h",(innerHeight-218)/2+"px"),s?.style.setProperty("--h",(innerHeight-218)/2+"px")}async function wm(){Na(function(i=!1,e){let t=ji;i&&(ji.style.width=innerWidth*.28+"px");let s=innerWidth-t.offsetWidth-15;if(i)Ye.style.width=s/2+"px",rr(t.getBoundingClientRect().width),ms(Ye.getBoundingClientRect().width);else if(Oe){if(Oe.elm==t){let r=t.getBoundingClientRect().width-ic;ms(gs-r/2),Ye.style.width=gs+"px",Ys(as-r/2),rr(t.getBoundingClientRect().width)}else if(Oe.elm==Ye){let r=Ye.getBoundingClientRect().width-gs;Ys(as-r),ms(Ye.getBoundingClientRect().width)}}qa.style.height=innerHeight-60+"px",Rt.project?.hasEditor()&&Rt.project.getCurEditor().layout(),ci==Jt.lesson&&d.lesson?.tut?.hasEditor()&&d.lesson.tut.getCurEditor().layout()}),Lr(),await yu(),d.lesson?.info?.type==bt.review,vu(d.usingAltLayout)}function Yi(i){return"live-"+i==d.lesson.lid}let qs=[];le.on("ll-mouse-move",(i,e,t,s)=>{});le.on("ll-file-text",async(i,e,t,s)=>{Yi(i)});le.on("ll-create-file",async(i,e,t,s)=>{Yi(i)});le.on("ll-create-folder",(i,e,t)=>{Yi(i)});le.on("ll-delete-item",(i,e,t)=>{Yi(i)});le.on("ll-move-item",(i,e,t,s)=>{Yi(i)});le.on("ll-rename-item",(i,e,t,s)=>{Yi(i)});function si(i){qs.push({time:performance.now(),type:i.data.type,data:i.data,...i}),ym()}async function ym(){let i=d.lesson.tut;for(;qs.length!=0;){let e=qs[0],t=qs.indexOf(e);t!=-1&&qs.splice(t,1),await e.evt(i)}}function Ms(){console.warn("FAILED to find item when needed by live lesson tutor")}le.on("ll-action",(i,e,t)=>{if(Yi(i)){if(t.type=="file-text")si({data:t,evt:async s=>{let n=s.getItemByPath2(t.path);if(!n){Ms();return}kr(n)&&(n.editor&&n.editor.setValue(n.p.textDecoder.decode(t.buf)),n.buf=t.buf)}});else if(t.type=="create-file")si({data:t,evt:async s=>{(await s.createFileFromPath(t.path,t.buf)).open(!1)}});else if(t.type=="create-folder")si({data:t,evt:async s=>{s.createFolderFromPath(t.path)}});else if(t.type=="delete-item")si({data:t,evt:async s=>{let n=s.getItemByPath2(t.path);if(!n){console.warn("failed to delete from tutor",t.path,n),Ms();return}await s.deleteFItem(n,!0,void 0,!0)}});else if(t.type=="move-item")si({data:t,evt:async s=>{let n=s.getItemByPath2(t.path1),r=s.getFolderByPath(t.path2);if(!n||!r){Ms();return}await $i(n,r,!0)||console.warn("failed to do ACTUAL MOVE needed by live lesson tutor")}});else if(t.type=="rename-item")si({data:t,evt:async s=>{let n=s.getItemByPath2(t.path);if(!n){Ms();return}s.renameFItem2(n,t.newName)}});else if(t.type=="open-file")si({data:t,evt:async s=>{let n=s.getItemByPath2(t.path);if(!n){Ms();return}kr(n)&&n.open(t.isTemp)}});else if(t.type=="refresh")si({data:t,evt:async s=>{await ls(s)}});else if(t.type=="update-selection")si({data:t,evt:async s=>{let n=s.curFile,r=n.editor;if(!n||!r){console.warn("NOT GOOD, probably out of sync with live lesson's tutor's caret/selection");return}mt(r),r.setSelections(t.secondary.concat(t.sel)),r.focus(),ct(r),r.focus()}});else if(t.type=="update-scroll")return}});let Ge=[];function ho(){let i=[...Ge];for(const e of i)d.lesson.isQuitting?qe(e):e.clickRes?e.clickRes():qe(e)}function qe(i){if(!i)return;let e=Ge.indexOf(i);e!=-1&&(Ge.splice(e,1),i.e.style.animation="RemoveBubble forwards 0.15s ease-out",i.e.onanimationend=function(){i.e.parentElement.removeChild(i.e)})}function bm(i,e="This is a text bubble and some more text here is this and you can do this",t,s,n){t==null&&(t=i.curRow),s==null&&(s=i.curCol);let r=document.createElement("div"),a=document.createElement("div");a.innerHTML=e,i.bubbles_ov.appendChild(r),r.innerHTML="<div class='bg'></div>",r.appendChild(a);let o={e:r,line:t,col:s,loc:0,file:i};return Ge.push(o),r.classList.add("dir-"+n),r.style.position="absolute",r.classList.add("bubble"),fo(Ge.length-1),document.body.classList.contains("hide-bubbles")&&r.remove(),o}var bu=(i=>(i[i.code=0]="code",i[i.add_file=1]="add_file",i[i.global=2]="global",i[i.refresh=3]="refresh",i[i.xy=4]="xy",i[i.tutor_note=5]="tutor_note",i[i.tutor_cursor=6]="tutor_cursor",i))(bu||{});let _u;function ka(){"blur"in document.activeElement&&(document.activeElement.blur(),_u=document.activeElement)}function Xo(){_u&&d.lesson?.p.getCurEditor()?.focus()}function Te(i,e,t,s){let n=document.createElement("div"),r=document.createElement("div");r.innerHTML=`<div>${za(e,s)}</div>`,Rc.appendChild(n),n.innerHTML="<div class='bg'></div>",n.appendChild(r),i==2&&ka(),s?.classes&&n.classList.add(...s.classes);let a={e:n,line:0,col:0,loc:i,file:d.lesson.p.curFile,ops:s};return Ge.push(a),t&&n.classList.add("dir-"+t),s&&s.click&&(a.clickProm=new Promise(async o=>{await new Promise(c=>{a.clickRes=c}),s.dontCloseOnClick||qe(a),o()}),n.onclick=function(){a.clickRes()},n.classList.add("clickable"),d.lesson.isResuming)?(n.remove(),a.clickRes(),qe(a),a):(n.style.position="absolute",n.classList.add("bubble"),fo(Ge.length-1),document.body.classList.contains("hide-bubbles")&&n.remove(),a)}class _m extends Es{constructor(e,t){super("Welcome!"),this.text=e,this.lesson=t}text;lesson;canClose(){return!1}canCloseMenu(){return!0}load(){super.load(),this.menu.classList.add("menu-lesson-banner"),this.menu.style.width="90%",this.menu.style.height="max-content",this.menu.style.maxWidth="600px",this.body.innerHTML=`
            <div>${za(this.text)}</div>
            <div class="d-getting-started"><button class="b-getting-started">Get Started</button></div>
        `;let e=this.body.querySelector(".b-getting-started");return e.onclick=function(){Ua(),d.lesson.start()},this}}function xm(i,e){let t=document.createElement("iframe");i.replaceWith(t),i=t;let s=e.files.find(c=>c.filename=="index.html");if(!s)return;let n=i.contentDocument;n.open(),n.write(s.text);let r=i.contentDocument.scripts,a=[];for(const c of r){let l=document.createElement("div");l.textContent=c.src,c.replaceWith(l),a.push(l)}for(const c of a){let l=document.createElement("script");l.innerHTML=Rt.project.files[2].editor.getValue(),c.replaceWith(l)}let o=i.contentDocument.querySelectorAll("link");for(const c of o){let l=document.createElement("style");l.innerHTML=Rt.project.files[1].editor.getValue(),c.replaceWith(l)}}class km extends Es{constructor(e){super("What We'll Be Making"),this.lesson=e}lesson;load(){super.load(),this.menu.classList.add("menu-banner-preview"),this.body.innerHTML=`
            <iframe></iframe>
        `;let e=this.body.querySelector("iframe");return xm(e,this.lesson.finalInstance),this}}class Sm{constructor(e,t){this.header=e,this.lines=t}header;lines}function Em(i){if(!i.bannerSection){i.start();return}let e=i.bannerSection,t="";for(const s of e.sects){t+="<div class='section'>",t+=`<h3>${s.header}</h3><br>`;for(const n of s.lines)t+=`<div>${n}</div><br>`;t+="</div>"}new _m(t,i).load()}function Cm(i){new km(i).load()}function xu(){for(let i=0;i<Ge.length;i++)fo(i)}function fo(i){let e=Ge[i],t=0,s=0;if(e.loc==0){t=e.col*Vo,s=e.line*_s,t-=e.file.scrollOffsetX,s-=e.file.scrollOffset,s+=88;let n=86-Vo;t+=n}else if(e.loc==2)t=innerWidth*.5,s=innerHeight*.45-100,e.e.classList.add("centered"),e.e.classList.add("no-callout"),e.e.classList.add("global");else if(e.loc==1){let r=d.lesson.p.parent.querySelector(".pane-code .b-add-file").getBoundingClientRect();t=r.x+10,s=r.y+r.height+15-60,e.e.classList.add("dir-top2")}else if(e.loc==3){let n=d.lesson.p.refs.b_refresh;n||console.warn("not sure what to do here!!! agh! couldn't find b-refresh to put bubble here");let r=n.getBoundingClientRect();t=r.x+11,s=r.y+r.height+15-60,e.e.classList.add("dir-top2")}else if(e.loc==4)t=e.ops.x,s=e.ops.y-60;else if(e.loc==5){let n=ji.getBoundingClientRect();e.e.style.translate=null,e.e.classList.add("no-callout"),e.e.style.minWidth=n.width-40+"px",t=20,s=n.height-e.e.offsetHeight-5}else if(e.loc==6){let r=vn()?.getBoundingClientRect()??ye.getBoundingClientRect();t=r.x+r.width/2+17+ye.getBoundingClientRect().width/2,s=r.y+r.height/2-22-_s/2+2}e.e.style.left=t+"px",e.e.style.top=s+"px"}function po(){let i=Ka,e=d.lesson;if(!e)return;let t=i.querySelectorAll(".cur");for(const r of t)r.classList.remove("cur");let s=[...i.querySelectorAll(".ev-cont")][e.events.indexOf(e.currentEvent)];if(!s)return;let n=[...s.querySelectorAll(".task-cont")][e.currentEvent.tasks.indexOf(e.currentSubTask)];s.classList.add("cur"),n&&n.classList.add("cur"),s.classList.contains("open")&&(n?(n.scrollIntoView({behavior:"smooth",inline:"start",block:"center"}),scrollTo(0,0)):(s.scrollIntoView({behavior:"smooth",inline:"start"}),scrollTo(0,0)))}function Qo(){let i=Ka;i.innerHTML="";let e=d.lesson;if(e){for(let t=0;t<e.events.length;t++){let s=e.events[t],n=document.createElement("div");n.classList.add("ev-cont"),i.appendChild(n);let r=`Event ${t} - ${s.constructor.name}`;s instanceof ur&&s.ops.title&&(r=`Section ${t}: `+s.ops.title),n.innerHTML=`
            <h4>
                <div class="material-symbols-outlined icon">chevron_right</div>
                <div>${r}</div>
                <div class="material-symbols-outlined icon2">flag</div>
                <div style="margin-left:auto">
                    <button class="accent b-jump-start">Jump Start</button>
                </div>
            </h4>
            <ol></ol>
        `,n.querySelector("h4").addEventListener("click",l=>{n.classList.toggle("open")});let o=n.querySelector("ol");n.appendChild(o),n.querySelector(".b-jump-start").addEventListener("click",l=>{l.stopImmediatePropagation(),l.stopPropagation(),l.preventDefault(),Sa(t,-1)});for(let l=0;l<s.tasks.length;l++){let u=s.tasks[l],m=document.createElement("li");m.classList.add("task-cont"),o.appendChild(m),m.innerHTML=`
                <div class="l-title">
                    <div class="material-symbols-outlined icon3">flag</div>
                    <div>Task: ${u.title}</div>
                    <div class="btn-cont">
                        <button class="b-jump">Jump</button>
                    </div>
                </div>
                <div class="l-info">${"text"in u?`<div>${u.text}</div>`:""}</div>
            `;let g=m.querySelector(".l-info");Prism.highlightElement(g,"markdown",null),m.querySelector(".b-jump").addEventListener("click",k=>{Sa(t,l)})}}po()}}async function Sa(i,e){Ii(),await ri(100);let t=d.lesson;if(t.isResuming=!1,await ku(i,e),t.currentEvent=t.events[i],t.currentSubTask=t.currentEvent?t.currentEvent.tasks[e]:null,t.progress.eventI=i,t.progress.taskI=e,t.hasSections())t.progress.prog=parseFloat((t.progress.sceneI/t.progress.final_order.length*100).toFixed(1));else{let n=((t.currentSubTask?._i??t.currentEvent?._i??0)+1)/t.totalParts;t.progress.prog=parseFloat((n*100).toFixed(1))}Ii(),await ut(),Oi(),Oi(),po(),t.updateCurrentProgress()}async function ku(i,e){if(i==-1&&e==-1)return;let t=d.lesson;if(t.isResuming||t.isQuitting||!t.hasLoaded){console.warn("Woah, too fast there");return}t.isQuitting=!0,ho(),ac(),t.currentSubTask?._resFinish&&t.currentSubTask._resFinish(),await ri(100),t.isQuitting=!1;let s=t.events[i],n=s,r=s.tasks[e];if(e==-1){if(s.tasks.length?r=s.tasks[0]:(s=t.events[i-1],r=s.tasks[s.tasks.length-1]),!r){console.warn("[1] can't go to this point because the task doesn't exist");return}await t.restoreFromState(r.state),t.loadEvent(n),n.run();return}if(!r){console.warn("[2] can't go to this point because the task doesn't exist");return}let a=s.tasks.indexOf(r);await t.restoreFromState(r.state);let o=[...ai.children];for(let c=a;c<o.length;c++)ai.removeChild(o[c]),s.tasks[c]&&(s.tasks[c].taskRef=null);s.startTask(r)}class Jo extends Es{constructor(){super(" Lesson Complete!")}load(e){super.load(e),Ri(!0),this.menu.classList.add("menu-lesson-complete");let t=d.lesson,s=!0;t.info.type==bt.review&&(s=!1),t.currentEvent=null,t.clearAllTasks(),t.isComplete=!0;let n=document.createElement("div");if(n.className="d-lesson-complete",n.innerHTML=`
            <button class="icon-btn co-item" co-label="Copy into new project">
                <div class="material-symbols-outlined">auto_stories</div>
                <div>
                    <div>Return Home</div>
                    <span>Go back to look at some more lessons!</span>
                </div>
            </button>
            <button class="icon-btn co-item" co-label="Copy into new project">
                <div class="material-symbols-outlined">undo</div>
                <div>
                    <div>Play Again</div>
                    <span>Reset and go through this lesson again.</span>
                </div>
            </button>
            ${s?`<button class="icon-btn co-item" co-label="Copy into new project">
                <div class="material-symbols-outlined">folder_copy</div>
                <div>
                    <div>Clone Files</div>
                    <!--<span>Create a new project to experiment in from the files you created in this lesson.</span>-->
                    <span>Copy your files from this lesson into a new project.</span>
                </div>
            </button>`:""}
        `,this.body.appendChild(n),t.info.type==bt.review){let r=Math.max(50,Math.floor((t.progress.final_order.length-t.progress.misses/2)/t.progress.final_order.length*100)),a=t.progress.lowestMisses==-1?r:Math.max(50,Math.floor((t.progress.lowestMissN-t.progress.lowestMisses/2)/t.progress.lowestMissN*100)),o=document.createElement("div");o.className="lesson-review-stats",o.innerHTML=`
                <h3>Stats</h3>
                <hr>
            `,t.progress.misses==0;{let l=document.createElement("div");l.className="icon-line",l.innerHTML=`
                    <!--<div class="material-symbols-outlined" style="color:var(--correct-bg)">check</div>-->
                    <!--<div>100% no misses!</div>-->
                    ${t.progress.misses==0?'<div class="material-symbols-outlined" style="color:var(--correct-bg)">check</div>':'<div class="material-symbols-outlined">sports_score</div>'}
                    <div>${r}% Accuracy</div>
                `,o.appendChild(l)}this.body.appendChild(o);let c=document.createElement("div");c.textContent=t.progress.lowestMisses==-1&&t.progress.misses==0?"First try? Impressive!":t.progress.misses<t.progress.lowestMisses?"New highscore! Previous: "+a+"%":"Current highscore: "+a+"%",o.appendChild(c)}return n.children[0]?.addEventListener("click",async r=>{await Ri(!0),Tr.push({path:"/learn"})}),n.children[1]?.addEventListener("click",r=>{new qi("Delete Progress",'Are you sure you want<br> to restart lesson progress for this lesson?<br><br><span class="note">Your files created during this lesson will be deleted</span>',()=>{le.emit("deleteLessonProgress",t.lid,a=>{a==0?le.emit("startLesson",t.lid,0,o=>{o==0?tc():alert(`Error ${o} while trying to start lesson`)}):alert("Err: while deleting lesson progress, error code: "+a)})},()=>{}).load()}),n.children[2]?.addEventListener("click",async r=>{let a=await new Promise(o=>{let c=new bs("Project Name","Name",l=>{o(l)},()=>{o(null)},null,null,"Name your new project to put the files into.");c._newLayer=!0,c.load()});nf(d.lesson,a)}),t.updateCurrentProgress(),this}}function Lm(i,e={}){const t=Object.freeze({...e});window.BOB=i;const s=`
        return (() => {
            with (arg) {
                ${i}
            }
        })();
    `;try{return new Function("arg",s)(t)}catch(n){throw console.error("Script Error:",n),console.log("script parse error info",i),n}}async function Fm(i,e={}){const t=Object.freeze({...e}),s=`
        return (async () => {
            with (arguments[0]) {
                ${i}
            }
        })();
    `;try{return await new Function(s)(t)}catch(n){throw console.error("Script Error:",n),n}}const Pm={Board:gu,Rect:io,BoardObj:so,AnchoredBoardObj:jr,BORef:no,MultiBORef:xs,Anchor:ru,BoardEvent:Re,AnchoredBoardEvent:ro,TC:ao,TC_Cols:au,COL:zp,getLenTC:ou,getLongestLineLen:$p,getLongestLineLenSum:qp,getLinesOffset:lu,parseCodeStr:Wp,emptyStr:Hp,TypeAnim:Rr,TA_Task:Fs,TA_ObjBubble:Vp,TA_Wait:Br,TA_Text:Vi,TA_ReplaceText:Mr,TA_Move:Ur,BE_AddCode:Nr,BE_AddText:Yp,BoardRenderObj:oo,BO_Text:bn,BO_Circle:cu,BO_Underline:uu,BO_Paint:_a,BO_Elm:lo,ObjRefBoardEvent:_n,BE_AddObj:Zp,BE_Wait:zr,BE_SetOpacity:$r,BE_GlobalBubble:qr,BE_CircleObj:xn,BE_UnderlineObj:Kp,BE_RemoveObj:Wr,BE_EndPonder:ks,BE_Draw:Gp,BE_Point:du,BE_PointList:hu,BE_PointEllipse:Xp,BE_PolyLine:Qp,getAngDiff:fu,getAngDir:Jp,animateVal:ln,BE_InitDrawV3:em,BE_SimpleWriteText:tm,BE_AddScene:im,BE_SelectScene:sm,BE_ArrangeScenes:nm,BE_SceneCam:rm,BE_AddElement:om,BE_RemoveElement:lm,BE_EditElement:cm,BE_AppendElement:um,BE_AddCodeEditor:co,BE_FocusEditor:dm,BE_CodeAction:hm,BE_AddFile:fm,BE_OpenFile:pm,BE_SetDelay:mm,BE_ResetDelay:gm},Su={...Pm,serverURL:os,LE_AddGBubble:yn,LE_Bubble:jp,LE_Tasks:Rp,LE_SectionStart:ur,RunTasksLEvent:Bp,BubbleLoc:bu,snips:Dp,TaskSection:Ga,TextTaskSection:df,CodeTaskSection:Nc,Task:be,SwitchFileTask:hf,AddFileTask:Li,ShowHoverTask:If,AddCode:Ja,AddRushCode:Xc,AddIgnoreCode:gp,AddGenericCodeTask:Qc,AddTutorSideText:eo,MoveCursorTo:Jc,DoRefreshTask:eu,ClickButtonTask:vp,PonderBoardTask:tu,BubbleTask:iu,InstructTask:yp,InfiniteTask:bp,TmpTask:su,ChangePreviewURLTask:_p,T_CancelSelection:Rf,T_PromptOpenFiles:Zc,T_PromptCreateFolder:Kc,T_PromptUploadFile:rp,T_CursorBubble:ap,T_OpenFilesPane:op,T_CloseFilesPane:lp,T_Bubble:wp,T_UseAccent:xp,T_StartReview:Cp,T_EndEvent:Lp,T_Goto:Fp,T_Wait:Pp,T_WaitTillImDone:Tp,T_ToggleUseLessonConfirm:Ip,T_RefreshTutorPreview:Op,CodePart:ae,CP_LineBelow:Wc,CP_LineAbove:ff,CP_DeleteLines:pf,CP_EditorAction:mf,CP_Suggestions:gf,CP_Home:vf,CP_End:wf,CP_BreakOut:yf,CP_MoveBy:bf,CP_MoveTo:_f,CP_Text:xf,CP_EnsureIndent:kf,CP_Comment:Sf,CP_StartOfFile:Wf,CP_EndOfFile:Hf,CP_GoToPattern:Ef,CP_HTML:Kn,CP_EmmetOG:Kf,CP_Emmet:Jf,CP_NextSnippetLoc:ep,CP_Open:tp,CP_StyleRule:Vf,CP_CSS:Yf,CP_CSS_Rule:Zf,CP_JS_Class:Cf,CP_GoToFree:Lf,CP_Bubble:Ff,CP_ShowHover:Pf,CP_HideHover:Tf,CP_Delete:Of,CP_Delete2:Af,CP_MoveByX:Df,CP_MoveByY:Hc,CP_CancelSelection:jf,CP_Wait:Vc,CP_Select:Bf,CP_Copy:Mf,CP_Paste:Uf,CP_Cut:Nf,CP_CopyLinesDown:zf,CP_CopyLinesUp:$f,CP_ScrollTo:ip,CP_PushCursorLoc:sp,CP_PopCursorLoc:np,CP_SwitchFile:qf,CP_RefreshTutorPreview:Ap,ValidateCode:Bi,AddQuizQuestion:mp,VP_Select:dp,VP_Text:hp,VP_QuizAns:fp,VP_HasLink:up,VP_Regex:cp};function mo(i,e={}){let t=Lm(i,{...Su,...e,console:{log:(...s)=>console.log("[sandbox]",...s),error:(...s)=>console.error("[sandbox error]",...s)}});return t?(console.log(":: successfully loaded lesson events file"),t):null}window.TEST={getLesson:()=>d.lesson,getPRISM:()=>Prism,AddFileTask:Li,testAgainst(i){return i instanceof Li},testInternal(){return Li instanceof Li},getScope(){return globalThis},runTestAsync:async i=>{let t=await Fm(i??`
            // User-written script
            const t = new AddFileTask();
            console.log("All done!",t);
            return [1,2,3];
        `,{...Su,console:{log:(...s)=>console.log("[sandbox]",...s),error:(...s)=>console.error("[sandbox error]",...s)}}).catch(s=>{console.log("Script failed:",s.message)});console.log("Script completed:",t)}};function Xw(){ot?.classList.add("none"),ji.textContent="",Ye.textContent="",ye&&(document.body.removeChild(ye),ye=void 0),Wa(void 0),nc(void 0),Fr(void 0),an&&(an.onclick=void 0),rc(1),vh(1),Dt&&(Dt.onclick=void 0),rn&&(rn.onclick=void 0),Di&&(Di.onclick=void 0),hh(),Hv(),fh(),Qv(),cf(),window.removeEventListener("beforeunload",Bc),Na(function(i,e){}),Va(null),wr(null),document.body.classList.remove("hide-bubbles")}var ei=0,Tm=1,dr=2,Im=3,pt=4,el=5,He=0,mi=1,Om=2,Tt=-2,Am=-3,Xn=-5,Eu=-1,Dm=1,Nn=2,jm=3,Cu=4,Rm=0,tl=0,il=1,Lu=2,Hr=8;function Bm(i,e){return Object.prototype.hasOwnProperty.call(i,e)}function Fu(i){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(var s in t)Bm(t,s)&&(i[s]=t[s])}}return i}function hr(i,e){return i.length===e?i:i.subarray?i.subarray(0,e):(i.length=e,i)}var kn={arraySet:function(i,e,t,s,n){if(e.subarray&&i.subarray){i.set(e.subarray(t,t+s),n);return}for(var r=0;r<s;r++)i[n+r]=e[t+r]},flattenChunks:function(i){var e,t,s,n,r,a;for(s=0,e=0,t=i.length;e<t;e++)s+=i[e].length;for(a=new Uint8Array(s),n=0,e=0,t=i.length;e<t;e++)r=i[e],a.set(r,n),n+=r.length;return a},Buf8:function(i){return new Uint8Array(i)},Buf16:function(i){return new Uint16Array(i)},Buf32:function(i){return new Int32Array(i)}},Sn={arraySet:function(i,e,t,s,n){for(var r=0;r<s;r++)i[n+r]=e[t+r]},flattenChunks:function(i){return[].concat.apply([],i)},Buf8:function(i){return new Array(i)},Buf16:function(i){return new Array(i)},Buf32:function(i){return new Array(i)}},Ps=function(){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";return Ps=function(){return i},i},Et=function(i,e,t,s,n){return Et=Ps()?kn.arraySet:Sn.arraySet,Et(i,e,t,s,n)},fr=function(i){return fr=Ps()?kn.flattenChunks:Sn.flattenChunks,fr(i)},ti=function(i){return ti=Ps()?kn.Buf8:Sn.Buf8,ti(i)},yt=function(i){return yt=Ps()?kn.Buf16:Sn.Buf16,yt(i)},Ss=function(i){return Ss=Ps()?kn.Buf32:Sn.Buf32,Ss(i)},Pu=function(){var i=!0;try{String.fromCharCode.apply(null,[0])}catch{i=!1}return Pu=function(){return i},i},Tu=function(){var i=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{i=!1}return Tu=function(){return i},i},go=function(i){for(var e=ti(256),t=0;t<256;t++)e[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;return e[254]=e[254]=1,go=function(s){return e[s]},e[i]};function Vr(i){var e,t,s,n,r,a=i.length,o=0;for(n=0;n<a;n++)t=i.charCodeAt(n),(t&64512)===55296&&n+1<a&&(s=i.charCodeAt(n+1),(s&64512)===56320&&(t=65536+(t-55296<<10)+(s-56320),n++)),o+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(o),r=0,n=0;r<o;n++)t=i.charCodeAt(n),(t&64512)===55296&&n+1<a&&(s=i.charCodeAt(n+1),(s&64512)===56320&&(t=65536+(t-55296<<10)+(s-56320),n++)),t<128?e[r++]=t:t<2048?(e[r++]=192|t>>>6,e[r++]=128|t&63):t<65536?(e[r++]=224|t>>>12,e[r++]=128|t>>>6&63,e[r++]=128|t&63):(e[r++]=240|t>>>18,e[r++]=128|t>>>12&63,e[r++]=128|t>>>6&63,e[r++]=128|t&63);return e}function Iu(i,e){if(e<65534&&(i.subarray&&Tu()||!i.subarray&&Pu()))return String.fromCharCode.apply(null,hr(i,e));for(var t="",s=0;s<e;s++)t+=String.fromCharCode(i[s]);return t}function Mm(i){return Iu(i,i.length)}function Um(i){for(var e=new Uint8Array(i.length),t=0,s=e.length;t<s;t++)e[t]=i.charCodeAt(t);return e}function Nm(i,e){var t,s,n,r,a=e||i.length,o=new Array(a*2);for(s=0,t=0;t<a;){if(n=i[t++],n<128){o[s++]=n;continue}if(r=go(n),r>4){o[s++]=65533,t+=r-1;continue}for(n&=r===2?31:r===3?15:7;r>1&&t<a;)n=n<<6|i[t++]&63,r--;if(r>1){o[s++]=65533;continue}n<65536?o[s++]=n:(n-=65536,o[s++]=55296|n>>10&1023,o[s++]=56320|n&1023)}return Iu(o,s)}function zm(i,e){var t;for(e=e||i.length,e>i.length&&(e=i.length),t=e-1;t>=0&&(i[t]&192)===128;)t--;return t<0||t===0?e:t+go(i[t])>e?t:e}function cn(i,e,t,s){for(var n=i&65535|0,r=i>>>16&65535|0,a=0;t!==0;){a=t>2e3?2e3:t,t-=a;do n=n+e[s++]|0,r=r+n|0;while(--a);n%=65521,r%=65521}return n|r<<16|0}function $m(){for(var i,e=[],t=0;t<256;t++){i=t;for(var s=0;s<8;s++)i=i&1?3988292384^i>>>1:i>>>1;e[t]=i}return e}var Ou=function(){var i=$m();return Ou=function(){return i},i};function et(i,e,t,s){var n=Ou(),r=s+t;i^=-1;for(var a=s;a<r;a++)i=i>>>8^n[(i^e[a])&255];return i^-1}var zn=30,qm=12;function Wm(i,e){var t,s,n,r,a,o,c,l,u,m,g,p,k,D,E,C,U,A,R,re,me,Y,O,x,te;t=i.state,s=i.next_in,x=i.input,n=s+(i.avail_in-5),r=i.next_out,te=i.output,a=r-(e-i.avail_out),o=r+(i.avail_out-257),c=t.dmax,l=t.wsize,u=t.whave,m=t.wnext,g=t.window,p=t.hold,k=t.bits,D=t.lencode,E=t.distcode,C=(1<<t.lenbits)-1,U=(1<<t.distbits)-1;e:do{k<15&&(p+=x[s++]<<k,k+=8,p+=x[s++]<<k,k+=8),A=D[p&C];t:for(;;){if(R=A>>>24,p>>>=R,k-=R,R=A>>>16&255,R===0)te[r++]=A&65535;else if(R&16){re=A&65535,R&=15,R&&(k<R&&(p+=x[s++]<<k,k+=8),re+=p&(1<<R)-1,p>>>=R,k-=R),k<15&&(p+=x[s++]<<k,k+=8,p+=x[s++]<<k,k+=8),A=E[p&U];i:for(;;){if(R=A>>>24,p>>>=R,k-=R,R=A>>>16&255,R&16){if(me=A&65535,R&=15,k<R&&(p+=x[s++]<<k,k+=8,k<R&&(p+=x[s++]<<k,k+=8)),me+=p&(1<<R)-1,me>c){i.msg="invalid distance too far back",t.mode=zn;break e}if(p>>>=R,k-=R,R=r-a,me>R){if(R=me-R,R>u&&t.sane){i.msg="invalid distance too far back",t.mode=zn;break e}if(Y=0,O=g,m===0){if(Y+=l-R,R<re){re-=R;do te[r++]=g[Y++];while(--R);Y=r-me,O=te}}else if(m<R){if(Y+=l+m-R,R-=m,R<re){re-=R;do te[r++]=g[Y++];while(--R);if(Y=0,m<re){R=m,re-=R;do te[r++]=g[Y++];while(--R);Y=r-me,O=te}}}else if(Y+=m-R,R<re){re-=R;do te[r++]=g[Y++];while(--R);Y=r-me,O=te}for(;re>2;)te[r++]=O[Y++],te[r++]=O[Y++],te[r++]=O[Y++],re-=3;re&&(te[r++]=O[Y++],re>1&&(te[r++]=O[Y++]))}else{Y=r-me;do te[r++]=te[Y++],te[r++]=te[Y++],te[r++]=te[Y++],re-=3;while(re>2);re&&(te[r++]=te[Y++],re>1&&(te[r++]=te[Y++]))}}else if((R&64)===0){A=E[(A&65535)+(p&(1<<R)-1)];continue i}else{i.msg="invalid distance code",t.mode=zn;break e}break}}else if((R&64)===0){A=D[(A&65535)+(p&(1<<R)-1)];continue t}else if(R&32){t.mode=qm;break e}else{i.msg="invalid literal/length code",t.mode=zn;break e}break}}while(s<n&&r<o);re=k>>3,s-=re,k-=re<<3,p&=(1<<k)-1,i.next_in=s,i.next_out=r,i.avail_in=s<n?5+(n-s):5-(s-n),i.avail_out=r<o?257+(o-r):257-(r-o),t.hold=p,t.bits=k}var Qi=15,sl=852,nl=592,rl=0,ia=1,al=2,Hm=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Vm=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Ym=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Zm=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function Xs(i,e,t,s,n,r,a,o){var c=o.bits,l=0,u=0,m=0,g=0,p=0,k=0,D=0,E=0,C=0,U=0,A,R,re,me,Y,O=null,x=0,te,se=yt(Qi+1),st=yt(Qi+1),fe=null,xe=0,dt,Nt,Me;for(l=0;l<=Qi;l++)se[l]=0;for(u=0;u<s;u++)se[e[t+u]]++;for(p=c,g=Qi;g>=1&&se[g]===0;g--);if(p>g&&(p=g),g===0)return n[r++]=1<<24|64<<16|0,n[r++]=1<<24|64<<16|0,o.bits=1,0;for(m=1;m<g&&se[m]===0;m++);for(p<m&&(p=m),E=1,l=1;l<=Qi;l++)if(E<<=1,E-=se[l],E<0)return-1;if(E>0&&(i===rl||g!==1))return-1;for(st[1]=0,l=1;l<Qi;l++)st[l+1]=st[l]+se[l];for(u=0;u<s;u++)e[t+u]!==0&&(a[st[e[t+u]]++]=u);if(i===rl?(O=fe=a,te=19):i===ia?(O=Hm,x-=257,fe=Vm,xe-=257,te=256):(O=Ym,fe=Zm,te=-1),U=0,u=0,l=m,Y=r,k=p,D=0,re=-1,C=1<<p,me=C-1,i===ia&&C>sl||i===al&&C>nl)return 1;for(;;){dt=l-D,a[u]<te?(Nt=0,Me=a[u]):a[u]>te?(Nt=fe[xe+a[u]],Me=O[x+a[u]]):(Nt=96,Me=0),A=1<<l-D,R=1<<k,m=R;do R-=A,n[Y+(U>>D)+R]=dt<<24|Nt<<16|Me|0;while(R!==0);for(A=1<<l-1;U&A;)A>>=1;if(A!==0?(U&=A-1,U+=A):U=0,u++,--se[l]===0){if(l===g)break;l=e[t+a[u]]}if(l>p&&(U&me)!==re){for(D===0&&(D=p),Y+=m,k=l-D,E=1<<k;k+D<g&&(E-=se[k+D],!(E<=0));)k++,E<<=1;if(C+=1<<k,i===ia&&C>sl||i===al&&C>nl)return 1;re=U&me,n[re]=p<<24|k<<16|Y-r|0}}return U!==0&&(n[Y+U]=l-D<<24|64<<16|0),o.bits=p,0}var Km=0,Au=1,Du=2,ol=4,Mi=0,Gm=1,Xm=2,It=-2,ju=-3,Ru=-4,Qm=-5,ll=8,Bu=1,cl=2,ul=3,dl=4,hl=5,fl=6,pl=7,ml=8,gl=9,vl=10,pr=11,ni=12,sa=13,wl=14,na=15,yl=16,bl=17,_l=18,xl=19,$n=20,qn=21,kl=22,Sl=23,El=24,Cl=25,Ll=26,ra=27,Fl=28,Pl=29,Ne=30,Mu=31,Jm=32,eg=852,tg=592;function Tl(i){return(i>>>24&255)+(i>>>8&65280)+((i&65280)<<8)+((i&255)<<24)}function ig(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=yt(320),this.work=yt(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function sg(i){var e;return!i||!i.state?It:(e=i.state,i.total_in=i.total_out=e.total=0,i.msg="",e.wrap&&(i.adler=e.wrap&1),e.mode=Bu,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=Ss(eg),e.distcode=e.distdyn=Ss(tg),e.sane=1,e.back=-1,Mi)}function ng(i){var e;return!i||!i.state?It:(e=i.state,e.wsize=0,e.whave=0,e.wnext=0,sg(i))}function rg(i,e){var t,s;return!i||!i.state||(s=i.state,e<0?(t=0,e=-e):(t=(e>>4)+1,e<48&&(e&=15)),e&&(e<8||e>15))?It:(s.window!==null&&s.wbits!==e&&(s.window=null),s.wrap=t,s.wbits=e,ng(i))}function ag(i,e){var t,s;return i?(s=new ig,i.state=s,s.window=null,t=rg(i,e),t!==Mi&&(i.state=null),t):It}var Il=!0,aa,oa;function og(i){if(Il){var e;for(aa=Ss(512),oa=Ss(32),e=0;e<144;)i.lens[e++]=8;for(;e<256;)i.lens[e++]=9;for(;e<280;)i.lens[e++]=7;for(;e<288;)i.lens[e++]=8;for(Xs(Au,i.lens,0,288,aa,0,i.work,{bits:9}),e=0;e<32;)i.lens[e++]=5;Xs(Du,i.lens,0,32,oa,0,i.work,{bits:5}),Il=!1}i.lencode=aa,i.lenbits=9,i.distcode=oa,i.distbits=5}function Uu(i,e,t,s){var n,r=i.state;return r.window===null&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=ti(r.wsize)),s>=r.wsize?(Et(r.window,e,t-r.wsize,r.wsize,0),r.wnext=0,r.whave=r.wsize):(n=r.wsize-r.wnext,n>s&&(n=s),Et(r.window,e,t-s,n,r.wnext),s-=n,s?(Et(r.window,e,t-s,s,0),r.wnext=s,r.whave=r.wsize):(r.wnext+=n,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=n))),0}function lg(i,e){var t,s,n,r,a,o,c,l,u,m,g,p,k,D,E=0,C,U,A,R,re,me,Y,O,x=ti(4),te,se,st=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!i||!i.state||!i.output||!i.input&&i.avail_in!==0)return It;t=i.state,t.mode===ni&&(t.mode=sa),a=i.next_out,n=i.output,c=i.avail_out,r=i.next_in,s=i.input,o=i.avail_in,l=t.hold,u=t.bits,m=o,g=c,O=Mi;e:for(;;)switch(t.mode){case Bu:if(t.wrap===0){t.mode=sa;break}for(;u<16;){if(o===0)break e;o--,l+=s[r++]<<u,u+=8}if(t.wrap&2&&l===35615){t.check=0,x[0]=l&255,x[1]=l>>>8&255,t.check=et(t.check,x,2,0),l=0,u=0,t.mode=cl;break}if(t.flags=0,t.head&&(t.head.done=!1),!(t.wrap&1)||(((l&255)<<8)+(l>>8))%31){i.msg="incorrect header check",t.mode=Ne;break}if((l&15)!==ll){i.msg="unknown compression method",t.mode=Ne;break}if(l>>>=4,u-=4,Y=(l&15)+8,t.wbits===0)t.wbits=Y;else if(Y>t.wbits){i.msg="invalid window size",t.mode=Ne;break}t.dmax=1<<Y,i.adler=t.check=1,t.mode=l&512?vl:ni,l=0,u=0;break;case cl:for(;u<16;){if(o===0)break e;o--,l+=s[r++]<<u,u+=8}if(t.flags=l,(t.flags&255)!==ll){i.msg="unknown compression method",t.mode=Ne;break}if(t.flags&57344){i.msg="unknown header flags set",t.mode=Ne;break}t.head&&(t.head.text=l>>8&1),t.flags&512&&(x[0]=l&255,x[1]=l>>>8&255,t.check=et(t.check,x,2,0)),l=0,u=0,t.mode=ul;case ul:for(;u<32;){if(o===0)break e;o--,l+=s[r++]<<u,u+=8}t.head&&(t.head.time=l),t.flags&512&&(x[0]=l&255,x[1]=l>>>8&255,x[2]=l>>>16&255,x[3]=l>>>24&255,t.check=et(t.check,x,4,0)),l=0,u=0,t.mode=dl;case dl:for(;u<16;){if(o===0)break e;o--,l+=s[r++]<<u,u+=8}t.head&&(t.head.xflags=l&255,t.head.os=l>>8),t.flags&512&&(x[0]=l&255,x[1]=l>>>8&255,t.check=et(t.check,x,2,0)),l=0,u=0,t.mode=hl;case hl:if(t.flags&1024){for(;u<16;){if(o===0)break e;o--,l+=s[r++]<<u,u+=8}t.length=l,t.head&&(t.head.extra_len=l),t.flags&512&&(x[0]=l&255,x[1]=l>>>8&255,t.check=et(t.check,x,2,0)),l=0,u=0}else t.head&&(t.head.extra=null);t.mode=fl;case fl:if(t.flags&1024&&(p=t.length,p>o&&(p=o),p&&(t.head&&(Y=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Array(t.head.extra_len)),Et(t.head.extra,s,r,p,Y)),t.flags&512&&(t.check=et(t.check,s,p,r)),o-=p,r+=p,t.length-=p),t.length))break e;t.length=0,t.mode=pl;case pl:if(t.flags&2048){if(o===0)break e;p=0;do Y=s[r+p++],t.head&&Y&&t.length<65536&&(t.head.name+=String.fromCharCode(Y));while(Y&&p<o);if(t.flags&512&&(t.check=et(t.check,s,p,r)),o-=p,r+=p,Y)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=ml;case ml:if(t.flags&4096){if(o===0)break e;p=0;do Y=s[r+p++],t.head&&Y&&t.length<65536&&(t.head.comment+=String.fromCharCode(Y));while(Y&&p<o);if(t.flags&512&&(t.check=et(t.check,s,p,r)),o-=p,r+=p,Y)break e}else t.head&&(t.head.comment=null);t.mode=gl;case gl:if(t.flags&512){for(;u<16;){if(o===0)break e;o--,l+=s[r++]<<u,u+=8}if(l!==(t.check&65535)){i.msg="header crc mismatch",t.mode=Ne;break}l=0,u=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),i.adler=t.check=0,t.mode=ni;break;case vl:for(;u<32;){if(o===0)break e;o--,l+=s[r++]<<u,u+=8}i.adler=t.check=Tl(l),l=0,u=0,t.mode=pr;case pr:if(t.havedict===0)return i.next_out=a,i.avail_out=c,i.next_in=r,i.avail_in=o,t.hold=l,t.bits=u,Xm;i.adler=t.check=1,t.mode=ni;case ni:case sa:if(t.last){l>>>=u&7,u-=u&7,t.mode=ra;break}for(;u<3;){if(o===0)break e;o--,l+=s[r++]<<u,u+=8}switch(t.last=l&1,l>>>=1,u-=1,l&3){case 0:t.mode=wl;break;case 1:og(t),t.mode=$n;break;case 2:t.mode=bl;break;case 3:i.msg="invalid block type",t.mode=Ne}l>>>=2,u-=2;break;case wl:for(l>>>=u&7,u-=u&7;u<32;){if(o===0)break e;o--,l+=s[r++]<<u,u+=8}if((l&65535)!==(l>>>16^65535)){i.msg="invalid stored block lengths",t.mode=Ne;break}t.length=l&65535,l=0,u=0,t.mode=na;case na:t.mode=yl;case yl:if(p=t.length,p){if(p>o&&(p=o),p>c&&(p=c),p===0)break e;Et(n,s,r,p,a),o-=p,r+=p,c-=p,a+=p,t.length-=p;break}t.mode=ni;break;case bl:for(;u<14;){if(o===0)break e;o--,l+=s[r++]<<u,u+=8}if(t.nlen=(l&31)+257,l>>>=5,u-=5,t.ndist=(l&31)+1,l>>>=5,u-=5,t.ncode=(l&15)+4,l>>>=4,u-=4,t.nlen>286||t.ndist>30){i.msg="too many length or distance symbols",t.mode=Ne;break}t.have=0,t.mode=_l;case _l:for(;t.have<t.ncode;){for(;u<3;){if(o===0)break e;o--,l+=s[r++]<<u,u+=8}t.lens[st[t.have++]]=l&7,l>>>=3,u-=3}for(;t.have<19;)t.lens[st[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,te={bits:t.lenbits},O=Xs(Km,t.lens,0,19,t.lencode,0,t.work,te),t.lenbits=te.bits,O){i.msg="invalid code lengths set",t.mode=Ne;break}t.have=0,t.mode=xl;case xl:for(;t.have<t.nlen+t.ndist;){for(;E=t.lencode[l&(1<<t.lenbits)-1],C=E>>>24,U=E>>>16&255,A=E&65535,!(C<=u);){if(o===0)break e;o--,l+=s[r++]<<u,u+=8}if(A<16)l>>>=C,u-=C,t.lens[t.have++]=A;else{if(A===16){for(se=C+2;u<se;){if(o===0)break e;o--,l+=s[r++]<<u,u+=8}if(l>>>=C,u-=C,t.have===0){i.msg="invalid bit length repeat",t.mode=Ne;break}Y=t.lens[t.have-1],p=3+(l&3),l>>>=2,u-=2}else if(A===17){for(se=C+3;u<se;){if(o===0)break e;o--,l+=s[r++]<<u,u+=8}l>>>=C,u-=C,Y=0,p=3+(l&7),l>>>=3,u-=3}else{for(se=C+7;u<se;){if(o===0)break e;o--,l+=s[r++]<<u,u+=8}l>>>=C,u-=C,Y=0,p=11+(l&127),l>>>=7,u-=7}if(t.have+p>t.nlen+t.ndist){i.msg="invalid bit length repeat",t.mode=Ne;break}for(;p--;)t.lens[t.have++]=Y}}if(t.mode===Ne)break;if(t.lens[256]===0){i.msg="invalid code -- missing end-of-block",t.mode=Ne;break}if(t.lenbits=9,te={bits:t.lenbits},O=Xs(Au,t.lens,0,t.nlen,t.lencode,0,t.work,te),t.lenbits=te.bits,O){i.msg="invalid literal/lengths set",t.mode=Ne;break}if(t.distbits=6,t.distcode=t.distdyn,te={bits:t.distbits},O=Xs(Du,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,te),t.distbits=te.bits,O){i.msg="invalid distances set",t.mode=Ne;break}t.mode=$n;case $n:t.mode=qn;case qn:if(o>=6&&c>=258){i.next_out=a,i.avail_out=c,i.next_in=r,i.avail_in=o,t.hold=l,t.bits=u,Wm(i,g),a=i.next_out,n=i.output,c=i.avail_out,r=i.next_in,s=i.input,o=i.avail_in,l=t.hold,u=t.bits,t.mode===ni&&(t.back=-1);break}for(t.back=0;E=t.lencode[l&(1<<t.lenbits)-1],C=E>>>24,U=E>>>16&255,A=E&65535,!(C<=u);){if(o===0)break e;o--,l+=s[r++]<<u,u+=8}if(U&&(U&240)===0){for(R=C,re=U,me=A;E=t.lencode[me+((l&(1<<R+re)-1)>>R)],C=E>>>24,U=E>>>16&255,A=E&65535,!(R+C<=u);){if(o===0)break e;o--,l+=s[r++]<<u,u+=8}l>>>=R,u-=R,t.back+=R}if(l>>>=C,u-=C,t.back+=C,t.length=A,U===0){t.mode=Ll;break}if(U&32){t.back=-1,t.mode=ni;break}if(U&64){i.msg="invalid literal/length code",t.mode=Ne;break}t.extra=U&15,t.mode=kl;case kl:if(t.extra){for(se=t.extra;u<se;){if(o===0)break e;o--,l+=s[r++]<<u,u+=8}t.length+=l&(1<<t.extra)-1,l>>>=t.extra,u-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=Sl;case Sl:for(;E=t.distcode[l&(1<<t.distbits)-1],C=E>>>24,U=E>>>16&255,A=E&65535,!(C<=u);){if(o===0)break e;o--,l+=s[r++]<<u,u+=8}if((U&240)===0){for(R=C,re=U,me=A;E=t.distcode[me+((l&(1<<R+re)-1)>>R)],C=E>>>24,U=E>>>16&255,A=E&65535,!(R+C<=u);){if(o===0)break e;o--,l+=s[r++]<<u,u+=8}l>>>=R,u-=R,t.back+=R}if(l>>>=C,u-=C,t.back+=C,U&64){i.msg="invalid distance code",t.mode=Ne;break}t.offset=A,t.extra=U&15,t.mode=El;case El:if(t.extra){for(se=t.extra;u<se;){if(o===0)break e;o--,l+=s[r++]<<u,u+=8}t.offset+=l&(1<<t.extra)-1,l>>>=t.extra,u-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){i.msg="invalid distance too far back",t.mode=Ne;break}t.mode=Cl;case Cl:if(c===0)break e;if(p=g-c,t.offset>p){if(p=t.offset-p,p>t.whave&&t.sane){i.msg="invalid distance too far back",t.mode=Ne;break}p>t.wnext?(p-=t.wnext,k=t.wsize-p):k=t.wnext-p,p>t.length&&(p=t.length),D=t.window}else D=n,k=a-t.offset,p=t.length;p>c&&(p=c),c-=p,t.length-=p;do n[a++]=D[k++];while(--p);t.length===0&&(t.mode=qn);break;case Ll:if(c===0)break e;n[a++]=t.length,c--,t.mode=qn;break;case ra:if(t.wrap){for(;u<32;){if(o===0)break e;o--,l|=s[r++]<<u,u+=8}if(g-=c,i.total_out+=g,t.total+=g,g&&(i.adler=t.check=t.flags?et(t.check,n,g,a-g):cn(t.check,n,g,a-g)),g=c,(t.flags?l:Tl(l))!==t.check){i.msg="incorrect data check",t.mode=Ne;break}l=0,u=0}t.mode=Fl;case Fl:if(t.wrap&&t.flags){for(;u<32;){if(o===0)break e;o--,l+=s[r++]<<u,u+=8}if(l!==(t.total&4294967295)){i.msg="incorrect length check",t.mode=Ne;break}l=0,u=0}t.mode=Pl;case Pl:O=Gm;break e;case Ne:O=ju;break e;case Mu:return Ru;case Jm:default:return It}return i.next_out=a,i.avail_out=c,i.next_in=r,i.avail_in=o,t.hold=l,t.bits=u,(t.wsize||g!==i.avail_out&&t.mode<Ne&&(t.mode<ra||e!==ol))&&Uu(i,i.output,i.next_out,g-i.avail_out),m-=i.avail_in,g-=i.avail_out,i.total_in+=m,i.total_out+=g,t.total+=g,t.wrap&&g&&(i.adler=t.check=t.flags?et(t.check,n,g,i.next_out-g):cn(t.check,n,g,i.next_out-g)),i.data_type=t.bits+(t.last?64:0)+(t.mode===ni?128:0)+(t.mode===$n||t.mode===na?256:0),(m===0&&g===0||e===ol)&&O===Mi&&(O=Qm),O}function cg(i){if(!i||!i.state)return It;var e=i.state;return e.window&&(e.window=null),i.state=null,Mi}function ug(i,e){var t;return!i||!i.state||(t=i.state,(t.wrap&2)===0)?It:(t.head=e,e.done=!1,Mi)}function Nu(i,e){var t=e.length,s,n,r;return!i||!i.state||(s=i.state,s.wrap!==0&&s.mode!==pr)?It:s.mode===pr&&(n=1,n=cn(n,e,t,0),n!==s.check)?ju:(r=Uu(i,e,t,t),r?(s.mode=Mu,Ru):(s.havedict=1,Mi))}var un={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function zu(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function dg(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Ea=Object.prototype.toString,Yr=function i(e){if(!(this instanceof i))return new i(e);this.options=Fu({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(e&&e.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15)===0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zu,this.strm.avail_out=0;var s=ag(this.strm,t.windowBits);if(s!==He)throw new Error(un[s]);if(this.header=new dg,ug(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=Vr(t.dictionary):Ea.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(s=Nu(this.strm,t.dictionary),s!==He)))throw new Error(un[s])};Yr.prototype.push=function(e,t){var s=this.strm,n=this.options.chunkSize,r=this.options.dictionary,a,o,c,l,u,m,g=!1;if(this.ended)return!1;o=t===~~t?t:t===!0?pt:ei,typeof e=="string"?s.input=Um(e):Ea.call(e)==="[object ArrayBuffer]"?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(s.avail_out===0&&(s.output=ti(n),s.next_out=0,s.avail_out=n),a=lg(s,ei),a===Om&&r&&(typeof r=="string"?m=Vr(r):Ea.call(r)==="[object ArrayBuffer]"?m=new Uint8Array(r):m=r,a=Nu(this.strm,m)),a===Xn&&g===!0&&(a=He,g=!1),a!==mi&&a!==He)return this.onEnd(a),this.ended=!0,!1;s.next_out&&(s.avail_out===0||a===mi||s.avail_in===0&&(o===pt||o===dr))&&(this.options.to==="string"?(c=zm(s.output,s.next_out),l=s.next_out-c,u=Nm(s.output,c),s.next_out=l,s.avail_out=n-l,l&&Et(s.output,s.output,c,l,0),this.onData(u)):this.onData(hr(s.output,s.next_out))),s.avail_in===0&&s.avail_out===0&&(g=!0)}while((s.avail_in>0||s.avail_out===0)&&a!==mi);return a===mi&&(o=pt),o===pt?(a=cg(this.strm),this.onEnd(a),this.ended=!0,a===He):(o===dr&&(this.onEnd(He),s.avail_out=0),!0)};Yr.prototype.onData=function(e){this.chunks.push(e)};Yr.prototype.onEnd=function(e){e===He&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=fr(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function Ji(i){for(var e=i.length;--e>=0;)i[e]=0}var hg=0,$u=1,fg=2,pg=3,mg=258,Ca=29,En=256,Qs=En+1+Ca,ns=30,vo=19,qu=2*Qs+1,Pi=15,la=16,gg=7,wo=256,Wu=16,Hu=17,Vu=18,La=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Qn=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],vg=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Yu=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],wg=512,Wt,rs,ds,hs,Jn,Ws;function ca(i,e,t,s,n){this.static_tree=i,this.extra_bits=e,this.extra_base=t,this.elems=s,this.max_length=n,this.has_stree=i&&i.length}var Zu,Ku,Gu;function ua(i,e){this.dyn_tree=i,this.max_code=0,this.stat_desc=e}function Xu(i){return i<256?ds[i]:ds[256+(i>>>7)]}function dn(i,e){i.pending_buf[i.pending++]=e&255,i.pending_buf[i.pending++]=e>>>8&255}function xt(i,e,t){i.bi_valid>la-t?(i.bi_buf|=e<<i.bi_valid&65535,dn(i,i.bi_buf),i.bi_buf=e>>la-i.bi_valid,i.bi_valid+=t-la):(i.bi_buf|=e<<i.bi_valid&65535,i.bi_valid+=t)}function Zt(i,e,t){xt(i,t[e*2],t[e*2+1])}function Qu(i,e){var t=0;do t|=i&1,i>>>=1,t<<=1;while(--e>0);return t>>>1}function yg(i){i.bi_valid===16?(dn(i,i.bi_buf),i.bi_buf=0,i.bi_valid=0):i.bi_valid>=8&&(i.pending_buf[i.pending++]=i.bi_buf&255,i.bi_buf>>=8,i.bi_valid-=8)}function bg(i,e){var t=e.dyn_tree,s=e.max_code,n=e.stat_desc.static_tree,r=e.stat_desc.has_stree,a=e.stat_desc.extra_bits,o=e.stat_desc.extra_base,c=e.stat_desc.max_length,l,u,m,g,p,k,D=0;for(g=0;g<=Pi;g++)i.bl_count[g]=0;for(t[i.heap[i.heap_max]*2+1]=0,l=i.heap_max+1;l<qu;l++)u=i.heap[l],g=t[t[u*2+1]*2+1]+1,g>c&&(g=c,D++),t[u*2+1]=g,!(u>s)&&(i.bl_count[g]++,p=0,u>=o&&(p=a[u-o]),k=t[u*2],i.opt_len+=k*(g+p),r&&(i.static_len+=k*(n[u*2+1]+p)));if(D!==0){do{for(g=c-1;i.bl_count[g]===0;)g--;i.bl_count[g]--,i.bl_count[g+1]+=2,i.bl_count[c]--,D-=2}while(D>0);for(g=c;g!==0;g--)for(u=i.bl_count[g];u!==0;)m=i.heap[--l],!(m>s)&&(t[m*2+1]!==g&&(i.opt_len+=(g-t[m*2+1])*t[m*2],t[m*2+1]=g),u--)}}function Ju(i,e,t){var s=new Array(Pi+1),n=0,r,a;for(r=1;r<=Pi;r++)s[r]=n=n+t[r-1]<<1;for(a=0;a<=e;a++){var o=i[a*2+1];o!==0&&(i[a*2]=Qu(s[o]++,o))}}function _g(){var i,e,t,s,n,r=new Array(Pi+1);for(Wt=new Array((Qs+2)*2),Ji(Wt),rs=new Array(ns*2),Ji(rs),ds=new Array(wg),Ji(ds),hs=new Array(mg-pg+1),Ji(hs),Jn=new Array(Ca),Ji(Jn),Ws=new Array(ns),Ji(Ws),t=0,s=0;s<Ca-1;s++)for(Jn[s]=t,i=0;i<1<<La[s];i++)hs[t++]=s;for(hs[t-1]=s,n=0,s=0;s<16;s++)for(Ws[s]=n,i=0;i<1<<Qn[s];i++)ds[n++]=s;for(n>>=7;s<ns;s++)for(Ws[s]=n<<7,i=0;i<1<<Qn[s]-7;i++)ds[256+n++]=s;for(e=0;e<=Pi;e++)r[e]=0;for(i=0;i<=143;)Wt[i*2+1]=8,i++,r[8]++;for(;i<=255;)Wt[i*2+1]=9,i++,r[9]++;for(;i<=279;)Wt[i*2+1]=7,i++,r[7]++;for(;i<=287;)Wt[i*2+1]=8,i++,r[8]++;for(Ju(Wt,Qs+1,r),i=0;i<ns;i++)rs[i*2+1]=5,rs[i*2]=Qu(i,5);Zu=new ca(Wt,La,En+1,Qs,Pi),Ku=new ca(rs,Qn,0,ns,Pi),Gu=new ca(new Array(0),vg,0,vo,gg)}function ed(i){var e;for(e=0;e<Qs;e++)i.dyn_ltree[e*2]=0;for(e=0;e<ns;e++)i.dyn_dtree[e*2]=0;for(e=0;e<vo;e++)i.bl_tree[e*2]=0;i.dyn_ltree[wo*2]=1,i.opt_len=i.static_len=0,i.last_lit=i.matches=0}function td(i){i.bi_valid>8?dn(i,i.bi_buf):i.bi_valid>0&&(i.pending_buf[i.pending++]=i.bi_buf),i.bi_buf=0,i.bi_valid=0}function xg(i,e,t,s){td(i),dn(i,t),dn(i,~t),Et(i.pending_buf,i.window,e,t,i.pending),i.pending+=t}function Ol(i,e,t,s){var n=e*2,r=t*2;return i[n]<i[r]||i[n]===i[r]&&s[e]<=s[t]}function da(i,e,t){for(var s=i.heap[t],n=t<<1;n<=i.heap_len&&(n<i.heap_len&&Ol(e,i.heap[n+1],i.heap[n],i.depth)&&n++,!Ol(e,s,i.heap[n],i.depth));)i.heap[t]=i.heap[n],t=n,n<<=1;i.heap[t]=s}function Al(i,e,t){var s,n,r=0,a,o;if(i.last_lit!==0)do s=i.pending_buf[i.d_buf+r*2]<<8|i.pending_buf[i.d_buf+r*2+1],n=i.pending_buf[i.l_buf+r],r++,s===0?Zt(i,n,e):(a=hs[n],Zt(i,a+En+1,e),o=La[a],o!==0&&(n-=Jn[a],xt(i,n,o)),s--,a=Xu(s),Zt(i,a,t),o=Qn[a],o!==0&&(s-=Ws[a],xt(i,s,o)));while(r<i.last_lit);Zt(i,wo,e)}function Fa(i,e){var t=e.dyn_tree,s=e.stat_desc.static_tree,n=e.stat_desc.has_stree,r=e.stat_desc.elems,a,o,c=-1,l;for(i.heap_len=0,i.heap_max=qu,a=0;a<r;a++)t[a*2]!==0?(i.heap[++i.heap_len]=c=a,i.depth[a]=0):t[a*2+1]=0;for(;i.heap_len<2;)l=i.heap[++i.heap_len]=c<2?++c:0,t[l*2]=1,i.depth[l]=0,i.opt_len--,n&&(i.static_len-=s[l*2+1]);for(e.max_code=c,a=i.heap_len>>1;a>=1;a--)da(i,t,a);l=r;do a=i.heap[1],i.heap[1]=i.heap[i.heap_len--],da(i,t,1),o=i.heap[1],i.heap[--i.heap_max]=a,i.heap[--i.heap_max]=o,t[l*2]=t[a*2]+t[o*2],i.depth[l]=(i.depth[a]>=i.depth[o]?i.depth[a]:i.depth[o])+1,t[a*2+1]=t[o*2+1]=l,i.heap[1]=l++,da(i,t,1);while(i.heap_len>=2);i.heap[--i.heap_max]=i.heap[1],bg(i,e),Ju(t,c,i.bl_count)}function Dl(i,e,t){var s,n=-1,r,a=e[0*2+1],o=0,c=7,l=4;for(a===0&&(c=138,l=3),e[(t+1)*2+1]=65535,s=0;s<=t;s++)r=a,a=e[(s+1)*2+1],!(++o<c&&r===a)&&(o<l?i.bl_tree[r*2]+=o:r!==0?(r!==n&&i.bl_tree[r*2]++,i.bl_tree[Wu*2]++):o<=10?i.bl_tree[Hu*2]++:i.bl_tree[Vu*2]++,o=0,n=r,a===0?(c=138,l=3):r===a?(c=6,l=3):(c=7,l=4))}function jl(i,e,t){var s,n=-1,r,a=e[0*2+1],o=0,c=7,l=4;for(a===0&&(c=138,l=3),s=0;s<=t;s++)if(r=a,a=e[(s+1)*2+1],!(++o<c&&r===a)){if(o<l)do Zt(i,r,i.bl_tree);while(--o!==0);else r!==0?(r!==n&&(Zt(i,r,i.bl_tree),o--),Zt(i,Wu,i.bl_tree),xt(i,o-3,2)):o<=10?(Zt(i,Hu,i.bl_tree),xt(i,o-3,3)):(Zt(i,Vu,i.bl_tree),xt(i,o-11,7));o=0,n=r,a===0?(c=138,l=3):r===a?(c=6,l=3):(c=7,l=4)}}function kg(i){var e;for(Dl(i,i.dyn_ltree,i.l_desc.max_code),Dl(i,i.dyn_dtree,i.d_desc.max_code),Fa(i,i.bl_desc),e=vo-1;e>=3&&i.bl_tree[Yu[e]*2+1]===0;e--);return i.opt_len+=3*(e+1)+5+5+4,e}function Sg(i,e,t,s){var n;for(xt(i,e-257,5),xt(i,t-1,5),xt(i,s-4,4),n=0;n<s;n++)xt(i,i.bl_tree[Yu[n]*2+1],3);jl(i,i.dyn_ltree,e-1),jl(i,i.dyn_dtree,t-1)}function Eg(i){var e=4093624447,t;for(t=0;t<=31;t++,e>>>=1)if(e&1&&i.dyn_ltree[t*2]!==0)return tl;if(i.dyn_ltree[9*2]!==0||i.dyn_ltree[10*2]!==0||i.dyn_ltree[13*2]!==0)return il;for(t=32;t<En;t++)if(i.dyn_ltree[t*2]!==0)return il;return tl}var Rl=!1;function Cg(i){Rl||(_g(),Rl=!0),i.l_desc=new ua(i.dyn_ltree,Zu),i.d_desc=new ua(i.dyn_dtree,Ku),i.bl_desc=new ua(i.bl_tree,Gu),i.bi_buf=0,i.bi_valid=0,ed(i)}function id(i,e,t,s){xt(i,(hg<<1)+(s?1:0),3),xg(i,e,t)}function Lg(i){xt(i,$u<<1,3),Zt(i,wo,Wt),yg(i)}function Fg(i,e,t,s){var n,r,a=0;i.level>0?(i.strm.data_type===Lu&&(i.strm.data_type=Eg(i)),Fa(i,i.l_desc),Fa(i,i.d_desc),a=kg(i),n=i.opt_len+3+7>>>3,r=i.static_len+3+7>>>3,r<=n&&(n=r)):n=r=t+5,t+4<=n&&e!==-1?id(i,e,t,s):i.strategy===Cu||r===n?(xt(i,($u<<1)+(s?1:0),3),Al(i,Wt,rs)):(xt(i,(fg<<1)+(s?1:0),3),Sg(i,i.l_desc.max_code+1,i.d_desc.max_code+1,a+1),Al(i,i.dyn_ltree,i.dyn_dtree)),ed(i),s&&td(i)}function yi(i,e,t){return i.pending_buf[i.d_buf+i.last_lit*2]=e>>>8&255,i.pending_buf[i.d_buf+i.last_lit*2+1]=e&255,i.pending_buf[i.l_buf+i.last_lit]=t&255,i.last_lit++,e===0?i.dyn_ltree[t*2]++:(i.matches++,e--,i.dyn_ltree[(hs[t]+En+1)*2]++,i.dyn_dtree[Xu(e)*2]++),i.last_lit===i.lit_bufsize-1}var Pg=9,Tg=29,Ig=256,Pa=Ig+1+Tg,Og=30,Ag=19,Dg=2*Pa+1,jg=15,we=3,gi=258,Bt=gi+we+1,Rg=32,Zr=42,Ta=69,er=73,tr=91,ir=103,Ti=113,Hs=666,Qe=1,Cn=2,Ui=3,Ts=4,Bg=3;function vi(i,e){return i.msg=un[e],e}function Bl(i){return(i<<1)-(i>4?9:0)}function pi(i){for(var e=i.length;--e>=0;)i[e]=0}function hi(i){var e=i.state,t=e.pending;t>i.avail_out&&(t=i.avail_out),t!==0&&(Et(i.output,e.pending_buf,e.pending_out,t,i.next_out),i.next_out+=t,e.pending_out+=t,i.total_out+=t,i.avail_out-=t,e.pending-=t,e.pending===0&&(e.pending_out=0))}function rt(i,e){Fg(i,i.block_start>=0?i.block_start:-1,i.strstart-i.block_start,e),i.block_start=i.strstart,hi(i.strm)}function Ee(i,e){i.pending_buf[i.pending++]=e}function Us(i,e){i.pending_buf[i.pending++]=e>>>8&255,i.pending_buf[i.pending++]=e&255}function Mg(i,e,t,s){var n=i.avail_in;return n>s&&(n=s),n===0?0:(i.avail_in-=n,Et(e,i.input,i.next_in,n,t),i.state.wrap===1?i.adler=cn(i.adler,e,n,t):i.state.wrap===2&&(i.adler=et(i.adler,e,n,t)),i.next_in+=n,i.total_in+=n,n)}function sd(i,e){var t=i.max_chain_length,s=i.strstart,n,r,a=i.prev_length,o=i.nice_match,c=i.strstart>i.w_size-Bt?i.strstart-(i.w_size-Bt):0,l=i.window,u=i.w_mask,m=i.prev,g=i.strstart+gi,p=l[s+a-1],k=l[s+a];i.prev_length>=i.good_match&&(t>>=2),o>i.lookahead&&(o=i.lookahead);do if(n=e,!(l[n+a]!==k||l[n+a-1]!==p||l[n]!==l[s]||l[++n]!==l[s+1])){s+=2,n++;do;while(l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&s<g);if(r=gi-(g-s),s=g-gi,r>a){if(i.match_start=e,a=r,r>=o)break;p=l[s+a-1],k=l[s+a]}}while((e=m[e&u])>c&&--t!==0);return a<=i.lookahead?a:i.lookahead}function Ni(i){var e=i.w_size,t,s,n,r,a;do{if(r=i.window_size-i.lookahead-i.strstart,i.strstart>=e+(e-Bt)){Et(i.window,i.window,e,e,0),i.match_start-=e,i.strstart-=e,i.block_start-=e,s=i.hash_size,t=s;do n=i.head[--t],i.head[t]=n>=e?n-e:0;while(--s);s=e,t=s;do n=i.prev[--t],i.prev[t]=n>=e?n-e:0;while(--s);r+=e}if(i.strm.avail_in===0)break;if(s=Mg(i.strm,i.window,i.strstart+i.lookahead,r),i.lookahead+=s,i.lookahead+i.insert>=we)for(a=i.strstart-i.insert,i.ins_h=i.window[a],i.ins_h=(i.ins_h<<i.hash_shift^i.window[a+1])&i.hash_mask;i.insert&&(i.ins_h=(i.ins_h<<i.hash_shift^i.window[a+we-1])&i.hash_mask,i.prev[a&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=a,a++,i.insert--,!(i.lookahead+i.insert<we)););}while(i.lookahead<Bt&&i.strm.avail_in!==0)}function Ug(i,e){var t=65535;for(t>i.pending_buf_size-5&&(t=i.pending_buf_size-5);;){if(i.lookahead<=1){if(Ni(i),i.lookahead===0&&e===ei)return Qe;if(i.lookahead===0)break}i.strstart+=i.lookahead,i.lookahead=0;var s=i.block_start+t;if((i.strstart===0||i.strstart>=s)&&(i.lookahead=i.strstart-s,i.strstart=s,rt(i,!1),i.strm.avail_out===0)||i.strstart-i.block_start>=i.w_size-Bt&&(rt(i,!1),i.strm.avail_out===0))return Qe}return i.insert=0,e===pt?(rt(i,!0),i.strm.avail_out===0?Ui:Ts):(i.strstart>i.block_start&&(rt(i,!1),i.strm.avail_out===0),Qe)}function ha(i,e){for(var t,s;;){if(i.lookahead<Bt){if(Ni(i),i.lookahead<Bt&&e===ei)return Qe;if(i.lookahead===0)break}if(t=0,i.lookahead>=we&&(i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+we-1])&i.hash_mask,t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),t!==0&&i.strstart-t<=i.w_size-Bt&&(i.match_length=sd(i,t)),i.match_length>=we)if(s=yi(i,i.strstart-i.match_start,i.match_length-we),i.lookahead-=i.match_length,i.match_length<=i.max_lazy_match&&i.lookahead>=we){i.match_length--;do i.strstart++,i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+we-1])&i.hash_mask,t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart;while(--i.match_length!==0);i.strstart++}else i.strstart+=i.match_length,i.match_length=0,i.ins_h=i.window[i.strstart],i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+1])&i.hash_mask;else s=yi(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++;if(s&&(rt(i,!1),i.strm.avail_out===0))return Qe}return i.insert=i.strstart<we-1?i.strstart:we-1,e===pt?(rt(i,!0),i.strm.avail_out===0?Ui:Ts):i.last_lit&&(rt(i,!1),i.strm.avail_out===0)?Qe:Cn}function es(i,e){for(var t,s,n;;){if(i.lookahead<Bt){if(Ni(i),i.lookahead<Bt&&e===ei)return Qe;if(i.lookahead===0)break}if(t=0,i.lookahead>=we&&(i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+we-1])&i.hash_mask,t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),i.prev_length=i.match_length,i.prev_match=i.match_start,i.match_length=we-1,t!==0&&i.prev_length<i.max_lazy_match&&i.strstart-t<=i.w_size-Bt&&(i.match_length=sd(i,t),i.match_length<=5&&(i.strategy===Dm||i.match_length===we&&i.strstart-i.match_start>4096)&&(i.match_length=we-1)),i.prev_length>=we&&i.match_length<=i.prev_length){n=i.strstart+i.lookahead-we,s=yi(i,i.strstart-1-i.prev_match,i.prev_length-we),i.lookahead-=i.prev_length-1,i.prev_length-=2;do++i.strstart<=n&&(i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+we-1])&i.hash_mask,t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart);while(--i.prev_length!==0);if(i.match_available=0,i.match_length=we-1,i.strstart++,s&&(rt(i,!1),i.strm.avail_out===0))return Qe}else if(i.match_available){if(s=yi(i,0,i.window[i.strstart-1]),s&&rt(i,!1),i.strstart++,i.lookahead--,i.strm.avail_out===0)return Qe}else i.match_available=1,i.strstart++,i.lookahead--}return i.match_available&&(s=yi(i,0,i.window[i.strstart-1]),i.match_available=0),i.insert=i.strstart<we-1?i.strstart:we-1,e===pt?(rt(i,!0),i.strm.avail_out===0?Ui:Ts):i.last_lit&&(rt(i,!1),i.strm.avail_out===0)?Qe:Cn}function Ng(i,e){for(var t,s,n,r,a=i.window;;){if(i.lookahead<=gi){if(Ni(i),i.lookahead<=gi&&e===ei)return Qe;if(i.lookahead===0)break}if(i.match_length=0,i.lookahead>=we&&i.strstart>0&&(n=i.strstart-1,s=a[n],s===a[++n]&&s===a[++n]&&s===a[++n])){r=i.strstart+gi;do;while(s===a[++n]&&s===a[++n]&&s===a[++n]&&s===a[++n]&&s===a[++n]&&s===a[++n]&&s===a[++n]&&s===a[++n]&&n<r);i.match_length=gi-(r-n),i.match_length>i.lookahead&&(i.match_length=i.lookahead)}if(i.match_length>=we?(t=yi(i,1,i.match_length-we),i.lookahead-=i.match_length,i.strstart+=i.match_length,i.match_length=0):(t=yi(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++),t&&(rt(i,!1),i.strm.avail_out===0))return Qe}return i.insert=0,e===pt?(rt(i,!0),i.strm.avail_out===0?Ui:Ts):i.last_lit&&(rt(i,!1),i.strm.avail_out===0)?Qe:Cn}function zg(i,e){for(var t;;){if(i.lookahead===0&&(Ni(i),i.lookahead===0)){if(e===ei)return Qe;break}if(i.match_length=0,t=yi(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++,t&&(rt(i,!1),i.strm.avail_out===0))return Qe}return i.insert=0,e===pt?(rt(i,!0),i.strm.avail_out===0?Ui:Ts):i.last_lit&&(rt(i,!1),i.strm.avail_out===0)?Qe:Cn}function $t(i,e,t,s,n){this.good_length=i,this.max_lazy=e,this.nice_length=t,this.max_chain=s,this.func=n}var yo=function(){var i=[new $t(0,0,0,0,Ug),new $t(4,4,8,4,ha),new $t(4,5,16,8,ha),new $t(4,6,32,32,ha),new $t(4,4,16,16,es),new $t(8,16,32,32,es),new $t(8,16,128,128,es),new $t(8,32,128,256,es),new $t(32,128,258,1024,es),new $t(32,258,258,4096,es)];return yo=function(){return i},i};function $g(i){i.window_size=2*i.w_size,pi(i.head);var e=yo();i.max_lazy_match=e[i.level].max_lazy,i.good_match=e[i.level].good_length,i.nice_match=e[i.level].nice_length,i.max_chain_length=e[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=we-1,i.match_available=0,i.ins_h=0}function qg(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Hr,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=yt(Dg*2),this.dyn_dtree=yt((2*Og+1)*2),this.bl_tree=yt((2*Ag+1)*2),pi(this.dyn_ltree),pi(this.dyn_dtree),pi(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=yt(jg+1),this.heap=yt(2*Pa+1),pi(this.heap),this.heap_len=0,this.heap_max=0,this.depth=yt(2*Pa+1),pi(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Wg(i){var e;return!i||!i.state?vi(i,Tt):(i.total_in=i.total_out=0,i.data_type=Lu,e=i.state,e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?Zr:Ti,i.adler=e.wrap===2?0:1,e.last_flush=ei,Cg(e),He)}function Hg(i){var e=Wg(i);return e===He&&$g(i.state),e}function Vg(i,e){return!i||!i.state||i.state.wrap!==2?Tt:(i.state.gzhead=e,He)}function Yg(i,e,t,s,n,r){if(!i)return Tt;var a=1;if(e===Eu&&(e=6),s<0?(a=0,s=-s):s>15&&(a=2,s-=16),n<1||n>Pg||t!==Hr||s<8||s>15||e<0||e>9||r<0||r>Cu)return vi(i,Tt);s===8&&(s=9);var o=new qg;return i.state=o,o.strm=i,o.wrap=a,o.gzhead=null,o.w_bits=s,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=n+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+we-1)/we),o.window=ti(o.w_size*2),o.head=yt(o.hash_size),o.prev=yt(o.w_size),o.lit_bufsize=1<<n+6,o.pending_buf_size=o.lit_bufsize*4,o.pending_buf=ti(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=e,o.strategy=r,o.method=t,Hg(i)}function Zg(i,e){var t,s,n,r;if(!i||!i.state||e>el||e<0)return i?vi(i,Tt):Tt;if(s=i.state,!i.output||!i.input&&i.avail_in!==0||s.status===Hs&&e!==pt)return vi(i,i.avail_out===0?Xn:Tt);if(s.strm=i,t=s.last_flush,s.last_flush=e,s.status===Zr)if(s.wrap===2)i.adler=0,Ee(s,31),Ee(s,139),Ee(s,8),s.gzhead?(Ee(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),Ee(s,s.gzhead.time&255),Ee(s,s.gzhead.time>>8&255),Ee(s,s.gzhead.time>>16&255),Ee(s,s.gzhead.time>>24&255),Ee(s,s.level===9?2:s.strategy>=Nn||s.level<2?4:0),Ee(s,s.gzhead.os&255),s.gzhead.extra&&s.gzhead.extra.length&&(Ee(s,s.gzhead.extra.length&255),Ee(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(i.adler=et(i.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=Ta):(Ee(s,0),Ee(s,0),Ee(s,0),Ee(s,0),Ee(s,0),Ee(s,s.level===9?2:s.strategy>=Nn||s.level<2?4:0),Ee(s,Bg),s.status=Ti);else{var a=Hr+(s.w_bits-8<<4)<<8,o=-1;s.strategy>=Nn||s.level<2?o=0:s.level<6?o=1:s.level===6?o=2:o=3,a|=o<<6,s.strstart!==0&&(a|=Rg),a+=31-a%31,s.status=Ti,Us(s,a),s.strstart!==0&&(Us(s,i.adler>>>16),Us(s,i.adler&65535)),i.adler=1}if(s.status===Ta)if(s.gzhead.extra){for(n=s.pending;s.gzindex<(s.gzhead.extra.length&65535)&&!(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>n&&(i.adler=et(i.adler,s.pending_buf,s.pending-n,n)),hi(i),n=s.pending,s.pending===s.pending_buf_size));)Ee(s,s.gzhead.extra[s.gzindex]&255),s.gzindex++;s.gzhead.hcrc&&s.pending>n&&(i.adler=et(i.adler,s.pending_buf,s.pending-n,n)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=er)}else s.status=er;if(s.status===er)if(s.gzhead.name){n=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>n&&(i.adler=et(i.adler,s.pending_buf,s.pending-n,n)),hi(i),n=s.pending,s.pending===s.pending_buf_size)){r=1;break}s.gzindex<s.gzhead.name.length?r=s.gzhead.name.charCodeAt(s.gzindex++)&255:r=0,Ee(s,r)}while(r!==0);s.gzhead.hcrc&&s.pending>n&&(i.adler=et(i.adler,s.pending_buf,s.pending-n,n)),r===0&&(s.gzindex=0,s.status=tr)}else s.status=tr;if(s.status===tr)if(s.gzhead.comment){n=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>n&&(i.adler=et(i.adler,s.pending_buf,s.pending-n,n)),hi(i),n=s.pending,s.pending===s.pending_buf_size)){r=1;break}s.gzindex<s.gzhead.comment.length?r=s.gzhead.comment.charCodeAt(s.gzindex++)&255:r=0,Ee(s,r)}while(r!==0);s.gzhead.hcrc&&s.pending>n&&(i.adler=et(i.adler,s.pending_buf,s.pending-n,n)),r===0&&(s.status=ir)}else s.status=ir;if(s.status===ir&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&hi(i),s.pending+2<=s.pending_buf_size&&(Ee(s,i.adler&255),Ee(s,i.adler>>8&255),i.adler=0,s.status=Ti)):s.status=Ti),s.pending!==0){if(hi(i),i.avail_out===0)return s.last_flush=-1,He}else if(i.avail_in===0&&Bl(e)<=Bl(t)&&e!==pt)return vi(i,Xn);if(s.status===Hs&&i.avail_in!==0)return vi(i,Xn);if(i.avail_in!==0||s.lookahead!==0||e!==ei&&s.status!==Hs){var c=s.strategy===Nn?zg(s,e):s.strategy===jm?Ng(s,e):yo()[s.level].func(s,e);if((c===Ui||c===Ts)&&(s.status=Hs),c===Qe||c===Ui)return i.avail_out===0&&(s.last_flush=-1),He;if(c===Cn&&(e===Tm?Lg(s):e!==el&&(id(s,0,0,!1),e===Im&&(pi(s.head),s.lookahead===0&&(s.strstart=0,s.block_start=0,s.insert=0))),hi(i),i.avail_out===0))return s.last_flush=-1,He}return e!==pt?He:s.wrap<=0?mi:(s.wrap===2?(Ee(s,i.adler&255),Ee(s,i.adler>>8&255),Ee(s,i.adler>>16&255),Ee(s,i.adler>>24&255),Ee(s,i.total_in&255),Ee(s,i.total_in>>8&255),Ee(s,i.total_in>>16&255),Ee(s,i.total_in>>24&255)):(Us(s,i.adler>>>16),Us(s,i.adler&65535)),hi(i),s.wrap>0&&(s.wrap=-s.wrap),s.pending!==0?He:mi)}function Kg(i){var e;return!i||!i.state?Tt:(e=i.state.status,e!==Zr&&e!==Ta&&e!==er&&e!==tr&&e!==ir&&e!==Ti&&e!==Hs?vi(i,Tt):(i.state=null,e===Ti?vi(i,Am):He))}function Gg(i,e){var t=e.length,s,n,r,a,o,c,l,u;if(!i||!i.state||(s=i.state,a=s.wrap,a===2||a===1&&s.status!==Zr||s.lookahead))return Tt;for(a===1&&(i.adler=cn(i.adler,e,t,0)),s.wrap=0,t>=s.w_size&&(a===0&&(pi(s.head),s.strstart=0,s.block_start=0,s.insert=0),u=ti(s.w_size),Et(u,e,t-s.w_size,s.w_size,0),e=u,t=s.w_size),o=i.avail_in,c=i.next_in,l=i.input,i.avail_in=t,i.next_in=0,i.input=e,Ni(s);s.lookahead>=we;){n=s.strstart,r=s.lookahead-(we-1);do s.ins_h=(s.ins_h<<s.hash_shift^s.window[n+we-1])&s.hash_mask,s.prev[n&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=n,n++;while(--r);s.strstart=n,s.lookahead=we-1,Ni(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=we-1,s.match_available=0,i.next_in=c,i.input=l,i.avail_in=o,s.wrap=a,He}var nd=Object.prototype.toString,Kr=function(e){this.options=Fu({level:Eu,method:Hr,chunkSize:16384,windowBits:15,memLevel:8,strategy:Rm,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zu,this.strm.avail_out=0;var s=Yg(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(s!==He)throw new Error(un[s]);if(t.header&&Vg(this.strm,t.header),t.dictionary){var n;if(typeof t.dictionary=="string"?n=Vr(t.dictionary):nd.call(t.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(t.dictionary):n=t.dictionary,s=Gg(this.strm,n),s!==He)throw new Error(un[s]);this._dict_set=!0}};Kr.prototype.push=function(e,t){var s=this.strm,n=this.options.chunkSize,r,a;if(this.ended)return!1;a=t===~~t?t:t===!0?pt:ei,typeof e=="string"?s.input=Vr(e):nd.call(e)==="[object ArrayBuffer]"?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(s.avail_out===0&&(s.output=ti(n),s.next_out=0,s.avail_out=n),r=Zg(s,a),r!==mi&&r!==He)return this.onEnd(r),this.ended=!0,!1;(s.avail_out===0||s.avail_in===0&&(a===pt||a===dr))&&(this.options.to==="string"?this.onData(Mm(hr(s.output,s.next_out))):this.onData(hr(s.output,s.next_out)))}while((s.avail_in>0||s.avail_out===0)&&r!==mi);return a===pt?(r=Kg(this.strm),this.onEnd(r),this.ended=!0,r===He):(a===dr&&(this.onEnd(He),s.avail_out=0),!0)};Kr.prototype.onData=function(e){this.chunks.push(e)};Kr.prototype.onEnd=function(e){e===He&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=fr(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Qt={Promise},at={base64:!0,array:!0,string:!0,nodebuffer:!1,nodestream:!1,get arraybuffer(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"},get uint8array(){return typeof Uint8Array<"u"},get blob(){return rd()}},rd=function(){var i;if(typeof ArrayBuffer>"u")i=!1;else{var e=new ArrayBuffer(0);try{i=new Blob([e],{type:"application/zip"}).size===0}catch{i=!1}}return rd=function(){return i},i},Ht="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Xg=function(i){for(var e=[],t,s,n,r,a,o,c,l=0,u=i.length,m=u,g=typeof i!="string";l<i.length;)m=u-l,g?(t=i[l++],s=l<u?i[l++]:0,n=l<u?i[l++]:0):(t=i.charCodeAt(l++),s=l<u?i.charCodeAt(l++):0,n=l<u?i.charCodeAt(l++):0),r=t>>2,a=(t&3)<<4|s>>4,o=m>1?(s&15)<<2|n>>6:64,c=m>2?n&63:64,e.push(Ht.charAt(r)+Ht.charAt(a)+Ht.charAt(o)+Ht.charAt(c));return e.join("")},Qg=function(i){var e,t,s,n,r,a,o,c=0,l=0,u="data:";if(i.substr(0,u.length)===u)throw new Error("Invalid base64 input, it looks like a data url.");i=i.replace(/[^A-Za-z0-9\+\/\=]/g,"");var m=i.length*3/4;if(i.charAt(i.length-1)===Ht.charAt(64)&&m--,i.charAt(i.length-2)===Ht.charAt(64)&&m--,m%1!==0)throw new Error("Invalid base64 input, bad content length.");var g;for(at.uint8array?g=new Uint8Array(m|0):g=new Array(m|0);c<i.length;)n=Ht.indexOf(i.charAt(c++)),r=Ht.indexOf(i.charAt(c++)),a=Ht.indexOf(i.charAt(c++)),o=Ht.indexOf(i.charAt(c++)),e=n<<2|r>>4,t=(r&15)<<4|a>>2,s=(a&3)<<6|o,g[l++]=e,a!==64&&(g[l++]=t),o!==64&&(g[l++]=s);return g};function Jg(i){var e=null;return at.uint8array?e=new Uint8Array(i.length):e=new Array(i.length),Ia(i,e)}var ev=function(i,e){return Ln("blob"),new Blob([i],{type:e})};function Wn(i){return i}function Ia(i,e){for(var t=0;t<i.length;++t)e[t]=i.charCodeAt(t)&255;return e}function tv(i,e,t){var s=[],n=0,r=i.length;if(r<=t)return String.fromCharCode.apply(null,i);for(;n<r;)e==="array"?s.push(String.fromCharCode.apply(null,i.slice(n,Math.min(n+t,r)))):s.push(String.fromCharCode.apply(null,i.subarray(n,Math.min(n+t,r)))),n+=t;return s.join("")}function iv(i){for(var e="",t=0;t<i.length;t++)e+=String.fromCharCode(i[t]);return e}var ad=function(){var i;try{i=at.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{i=!1}return ad=function(){return i},i};function sr(i){var e=65536,t=Zi(i),s=!0;if(t==="uint8array"&&(s=ad()),s)for(;e>1;)try{return tv(i,t,e)}catch{e=Math.floor(e/2)}return iv(i)}var sv=sr;function Ml(i,e){for(var t=0;t<i.length;t++)e[t]=i[t];return e}var od={string:{string:Wn,array:function(i){return Ia(i,new Array(i.length))},arraybuffer:function(i){return od.string.uint8array(i).buffer},uint8array:function(i){return Ia(i,new Uint8Array(i.length))}},array:{string:sr,array:Wn,arraybuffer:function(i){return new Uint8Array(i).buffer},uint8array:function(i){return new Uint8Array(i)}},arraybuffer:{string:function(i){return sr(new Uint8Array(i))},array:function(i){return Ml(new Uint8Array(i),new Array(i.byteLength))},arraybuffer:Wn,uint8array:function(i){return new Uint8Array(i)}},uint8array:{string:sr,array:function(i){return Ml(i,new Array(i.length))},arraybuffer:function(i){return i.buffer},uint8array:Wn}},Je=function(i,e){if(e||(e=""),!i)return e;Ln(i);var t=Zi(e),s=od[t][i](e);return s},nv=function(i){for(var e=i.split("/"),t=[],s=0;s<e.length;s++){var n=e[s];n==="."||n===""&&s!==0&&s!==e.length-1||(n===".."?t.pop():t.push(n))}return t.join("/")},Zi=function(i){if(typeof i=="string")return"string";if(Object.prototype.toString.call(i)==="[object Array]")return"array";if(at.uint8array&&i instanceof Uint8Array)return"uint8array";if(at.arraybuffer&&i instanceof ArrayBuffer)return"arraybuffer"},Ln=function(i){var e=at[i.toLowerCase()];if(!e)throw new Error(i+" is not supported by this platform")},Hn=65535,fs=-1,Oa=function(i){var e="",t,s;for(s=0;s<(i||"").length;s++)t=i.charCodeAt(s),e+="\\x"+(t<16?"0":"")+t.toString(16).toUpperCase();return e},mr=function(i,e,t){setTimeout(function(){i.apply(t||null,e||[])},0)},bo=function(){var i=arguments,e={},t,s;for(t=0;t<arguments.length;t++)for(s in arguments[t])Object.hasOwnProperty.call(i[t],s)&&typeof e[s]>"u"&&(e[s]=i[t][s]);return e},ld=function(i,e,t,s,n){var r=Qt.Promise.resolve(e).then(function(a){var o=at.blob&&(a instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(a))!==-1);return o&&typeof FileReader<"u"?new Qt.Promise(function(c,l){var u=new FileReader;u.onload=function(m){c(m.target.result)},u.onerror=function(m){l(m.target.error)},u.readAsArrayBuffer(a)}):a});return r.then(function(a){var o=Zi(a);return o?(o==="arraybuffer"?a=Je("uint8array",a):o==="string"&&(n?a=Qg(a):t&&s!==!0&&(a=Jg(a))),a):Qt.Promise.reject(new Error("Can't read the data of '"+i+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})},Fe=function(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null};Fe.prototype.push=function(e){this.emit("data",e)};Fe.prototype.end=function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0};Fe.prototype.error=function(e){return this.isFinished?!1:(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)};Fe.prototype.on=function(e,t){return this._listeners[e].push(t),this};Fe.prototype.cleanUp=function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]};Fe.prototype.emit=function(e,t){if(this._listeners[e])for(var s=0;s<this._listeners[e].length;s++)this._listeners[e][s].call(this,t)};Fe.prototype.pipe=function(e){return e.registerPrevious(this)};Fe.prototype.registerPrevious=function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",function(s){t.processChunk(s)}),e.on("end",function(){t.end()}),e.on("error",function(s){t.error(s)}),this};Fe.prototype.pause=function(){return this.isPaused||this.isFinished?!1:(this.isPaused=!0,this.previous&&this.previous.pause(),!0)};Fe.prototype.resume=function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var e=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e};Fe.prototype.flush=function(){};Fe.prototype.processChunk=function(e){this.push(e)};Fe.prototype.withStreamInfo=function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this};Fe.prototype.mergeStreamInfo=function(){for(var e in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(e)&&(this.streamInfo[e]=this.extraStreamInfo[e])};Fe.prototype.lock=function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()};Fe.prototype.toString=function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e};var _o=function(i){for(var e=new Array(256),t=0;t<256;t++)e[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;return e[254]=e[254]=1,_o=function(s){return e[s]},e[i]},rv=function(i){var e,t,s,n,r,a=i.length,o=0;for(n=0;n<a;n++)t=i.charCodeAt(n),(t&64512)===55296&&n+1<a&&(s=i.charCodeAt(n+1),(s&64512)===56320&&(t=65536+(t-55296<<10)+(s-56320),n++)),o+=t<128?1:t<2048?2:t<65536?3:4;for(at.uint8array?e=new Uint8Array(o):e=new Array(o),r=0,n=0;r<o;n++)t=i.charCodeAt(n),(t&64512)===55296&&n+1<a&&(s=i.charCodeAt(n+1),(s&64512)===56320&&(t=65536+(t-55296<<10)+(s-56320),n++)),t<128?e[r++]=t:t<2048?(e[r++]=192|t>>>6,e[r++]=128|t&63):t<65536?(e[r++]=224|t>>>12,e[r++]=128|t>>>6&63,e[r++]=128|t&63):(e[r++]=240|t>>>18,e[r++]=128|t>>>12&63,e[r++]=128|t>>>6&63,e[r++]=128|t&63);return e},av=function(i,e){var t;for(e=e||i.length,e>i.length&&(e=i.length),t=e-1;t>=0&&(i[t]&192)===128;)t--;return t<0||t===0?e:t+_o(i[t])>e?t:e},ov=function(i){var e,t,s,n,r=i.length,a=new Array(r*2);for(t=0,e=0;e<r;){if(s=i[e++],s<128){a[t++]=s;continue}if(n=_o(s),n>4){a[t++]=65533,e+=n-1;continue}for(s&=n===2?31:n===3?15:7;n>1&&e<r;)s=s<<6|i[e++]&63,n--;if(n>1){a[t++]=65533;continue}s<65536?a[t++]=s:(s-=65536,a[t++]=55296|s>>10&1023,a[t++]=56320|s&1023)}return a.length!==t&&(a.subarray?a=a.subarray(0,t):a.length=t),sv(a)},Js=function(e){return rv(e)},zi=function(e){return e=Je(at.uint8array?"uint8array":"array",e),ov(e)},lv=function(i){function e(){i.call(this,"utf-8 decode"),this.leftOver=null}return e.__proto__=i,e.prototype=Object.create(i.prototype),e.prototype.constructor=e,e.prototype.processChunk=function(s){var n=Je(at.uint8array?"uint8array":"array",s.data);if(this.leftOver&&this.leftOver.length){if(at.uint8array){var r=n;n=new Uint8Array(r.length+this.leftOver.length),n.set(this.leftOver,0),n.set(r,this.leftOver.length)}else n=this.leftOver.concat(n);this.leftOver=null}var a=av(n),o=n;a!==n.length&&(at.uint8array?(o=n.subarray(0,a),this.leftOver=n.subarray(a,n.length)):(o=n.slice(0,a),this.leftOver=n.slice(a,n.length))),this.push({data:zi(o),meta:s.meta})},e.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:zi(this.leftOver),meta:{}}),this.leftOver=null)},e}(Fe),cd=function(i){function e(){i.call(this,"utf-8 encode")}return e.__proto__=i,e.prototype=Object.create(i.prototype),e.prototype.constructor=e,e.prototype.processChunk=function(s){this.push({data:Js(s.data),meta:s.meta})},e}(Fe),cv=function(i){function e(t){i.call(this,"ConvertWorker to "+t),this.destType=t}return e.__proto__=i,e.prototype=Object.create(i.prototype),e.prototype.constructor=e,e.prototype.processChunk=function(s){this.push({data:Je(this.destType,s.data),meta:s.meta})},e}(Fe);function uv(i,e,t){switch(i){case"blob":return ev(Je("arraybuffer",e),t);case"base64":return Xg(e);default:return Je(i,e)}}function dv(i,e){var t,s=0,n=null,r=0;for(t=0;t<e.length;t++)r+=e[t].length;switch(i){case"string":return e.join("");case"array":return Array.prototype.concat.apply([],e);case"uint8array":for(n=new Uint8Array(r),t=0;t<e.length;t++)n.set(e[t],s),s+=e[t].length;return n;default:throw new Error("concat : unsupported type '"+i+"'")}}function hv(i,e){return new Qt.Promise(function(t,s){var n=[],r=i._internalType,a=i._outputType,o=i._mimeType;i.on("data",function(c,l){n.push(c),e&&e(l)}).on("error",function(c){n=[],s(c)}).on("end",function(){try{var c=uv(a,dv(r,n),o);t(c)}catch(l){s(l)}n=[]}).resume()})}var Is=function(e,t,s){var n=t;switch(t){case"blob":case"arraybuffer":n="uint8array";break;case"base64":n="string";break}try{this._internalType=n,this._outputType=t,this._mimeType=s,Ln(n),this._worker=e.pipe(new cv(n)),e.lock()}catch(r){this._worker=new Fe("error"),this._worker.error(r)}};Is.prototype.accumulate=function(e){return hv(this,e)};Is.prototype.on=function(e,t){var s=this;return e==="data"?this._worker.on(e,function(n){t.call(s,n.data,n.meta)}):this._worker.on(e,function(){mr(t,arguments,s)}),this};Is.prototype.resume=function(){return mr(this._worker.resume,[],this._worker),this};Is.prototype.pause=function(){return this._worker.pause(),this};var fv=!1,pv=!1,mv=!1,ud=!0,gv=null,vv=null,wv=null,yv=null,bv=null,_v=null,dd=Object.freeze({__proto__:null,base64:fv,binary:pv,comment:yv,compression:vv,compressionOptions:wv,createFolders:ud,date:gv,dir:mv,dosPermissions:_v,unixPermissions:bv}),xv=16*1024,xo=function(i){function e(t){i.call(this,"DataWorker");var s=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,t.then(function(n){s.dataIsReady=!0,s.data=n,s.max=n&&n.length||0,s.type=Zi(n),s.isPaused||s._tickAndRepeat()},function(n){s.error(n)})}return e.__proto__=i,e.prototype=Object.create(i.prototype),e.prototype.constructor=e,e.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},e.prototype.resume=function(){return i.prototype.resume.call(this)?(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,mr(this._tickAndRepeat,[],this)),!0):!1},e.prototype._tickAndRepeat=function(){this._tickScheduled=!1,!(this.isPaused||this.isFinished)&&(this._tick(),this.isFinished||(mr(this._tickAndRepeat,[],this),this._tickScheduled=!0))},e.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var s=xv,n=null,r=Math.min(this.max,this.index+s);if(this.index>=this.max)return this.end();switch(this.type){case"string":n=this.data.substring(this.index,r);break;case"uint8array":n=this.data.subarray(this.index,r);break;case"array":n=this.data.slice(this.index,r);break}return this.index=r,this.push({data:n,meta:{percent:this.max?this.index/this.max*100:0}})},e}(Fe),Aa=function(i){function e(t){i.call(this,"DataLengthProbe for "+t),this.propName=t,this.withStreamInfo(t,0)}return e.__proto__=i,e.prototype=Object.create(i.prototype),e.prototype.constructor=e,e.prototype.processChunk=function(s){if(s){var n=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=n+s.data.length}i.prototype.processChunk.call(this,s)},e}(Fe),ko=function(){for(var i=[],e=0;e<256;e++){for(var t=e,s=0;s<8;s++)t=t&1?3988292384^t>>>1:t>>>1;i[e]=t}return ko=function(){return i},i};function kv(i,e,t,s){var n=ko(),r=s+t;i=i^-1;for(var a=s;a<r;a++)i=i>>>8^n[(i^e[a])&255];return i^-1}function Sv(i,e,t,s){var n=ko(),r=s+t;i=i^-1;for(var a=s;a<r;a++)i=i>>>8^n[(i^e.charCodeAt(a))&255];return i^-1}function hn(i,e){if(typeof i>"u"||!i.length)return 0;var t=Zi(i)!=="string";return t?kv(e|0,i,i.length,0):Sv(e|0,i,i.length,0)}var hd=function(i){function e(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}return e.__proto__=i,e.prototype=Object.create(i.prototype),e.prototype.constructor=e,e.prototype.processChunk=function(s){this.streamInfo.crc32=hn(s.data,this.streamInfo.crc32||0),this.push(s)},e}(Fe),di=function(e,t,s,n,r){this.compressedSize=e,this.uncompressedSize=t,this.crc32=s,this.compression=n,this.compressedContent=r};di.prototype.getContentWorker=function(){var e=new xo(Qt.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new Aa("data_length")),t=this;return e.on("end",function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),e};di.prototype.getCompressedWorker=function(){return new xo(Qt.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)};di.createWorkerFrom=function(e,t,s){return e.pipe(new hd).pipe(new Aa("uncompressedSize")).pipe(t.compressWorker(s)).pipe(new Aa("compressedSize")).withStreamInfo("compression",t)};var Fn=function(e,t,s){this.name=e,this.dir=s.dir,this.date=s.date,this.comment=s.comment,this.unixPermissions=s.unixPermissions,this.dosPermissions=s.dosPermissions,this._data=t,this._dataBinary=s.binary,this.options={compression:s.compression,compressionOptions:s.compressionOptions}};Fn.prototype.internalStream=function(e){var t=null,s="string";try{if(!e)throw new Error("No output type specified.");s=e.toLowerCase();var n=s==="string"||s==="text";(s==="binarystring"||s==="text")&&(s="string"),t=this._decompressWorker();var r=!this._dataBinary;r&&!n&&(t=t.pipe(new cd)),!r&&n&&(t=t.pipe(new lv))}catch(a){t=new Fe("error"),t.error(a)}return new Is(t,s,"")};Fn.prototype.async=function(e,t){return this.internalStream(e).accumulate(t)};Fn.prototype._compressWorker=function(e,t){if(this._data instanceof di&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var s=this._decompressWorker();return this._dataBinary||(s=s.pipe(new cd)),di.createWorkerFrom(s,e,t)};Fn.prototype._decompressWorker=function(){return this._data instanceof di?this._data.getContentWorker():this._data instanceof Fe?this._data:new xo(this._data)};var fd=function(){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",e=i?"uint8array":"array";fd=function(){return e}},Ul=function(i){function e(t,s){i.call(this,"FlateWorker/"+t),this._pako=null,this._pakoAction=t,this._pakoOptions=s,this.meta={}}return e.__proto__=i,e.prototype=Object.create(i.prototype),e.prototype.constructor=e,e.prototype.processChunk=function(s){this.meta=s.meta,this._pako===null&&this._createPako(),this._pako.push(Je(fd(),s.data),!1)},e.prototype.flush=function(){i.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},e.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this._pako=null},e.prototype._createPako=function(){var s=this,n={raw:!0,level:this._pakoOptions.level||-1};this._pako=this._pakoAction==="Deflate"?new Kr(n):new Yr(n),this._pako.onData=function(r){s.push({data:r,meta:s.meta})}},e}(Fe),Ev={magic:"\b\0",compressWorker:function(i){return new Ul("Deflate",i)},uncompressWorker:function(){return new Ul("Inflate",{})}},Cv={magic:"\0\0",compressWorker:function(){return new Fe("STORE compression")},uncompressWorker:function(){return new Fe("STORE decompression")}},Vs={STORE:Cv,DEFLATE:Ev},So="PK",Eo="PK",Da="PK",Nl="PK\x07",fa="PK",Lv="PK\x07\b",Be=function(i,e){var t="",s;for(s=0;s<e;s++)t+=String.fromCharCode(i&255),i=i>>>8;return t},Fv=function(i,e){var t=i;return i||(t=e?16893:33204),(t&65535)<<16},Pv=function(i,e){return(i||0)&63},zl=function(i,e,t,s,n,r){var a=i.file,o=i.compression,c=r!==Js,l=Je("string",r(a.name)),u=Je("string",Js(a.name)),m=a.comment,g=Je("string",r(m)),p=Je("string",Js(m)),k=u.length!==a.name.length,D=p.length!==m.length,E,C,U="",A="",R="",re=a.dir,me=a.date,Y={crc32:0,compressedSize:0,uncompressedSize:0};(!e||t)&&(Y.crc32=i.crc32,Y.compressedSize=i.compressedSize,Y.uncompressedSize=i.uncompressedSize);var O=0;e&&(O|=8),!c&&(k||D)&&(O|=2048);var x=0,te=0;re&&(x|=16),n==="UNIX"?(te=798,x|=Fv(a.unixPermissions,re)):(te=20,x|=Pv(a.dosPermissions)),E=me.getUTCHours(),E=E<<6,E=E|me.getUTCMinutes(),E=E<<5,E=E|me.getUTCSeconds()/2,C=me.getUTCFullYear()-1980,C=C<<4,C=C|me.getUTCMonth()+1,C=C<<5,C=C|me.getUTCDate(),k&&(A=Be(1,1)+Be(hn(l),4)+u,U+="up"+Be(A.length,2)+A),D&&(R=Be(1,1)+Be(hn(g),4)+p,U+="uc"+Be(R.length,2)+R);var se="";se+=`
\0`,se+=Be(O,2),se+=o.magic,se+=Be(E,2),se+=Be(C,2),se+=Be(Y.crc32,4),se+=Be(Y.compressedSize,4),se+=Be(Y.uncompressedSize,4),se+=Be(l.length,2),se+=Be(U.length,2);var st=So+se+l+U,fe=Eo+Be(te,2)+se+Be(g.length,2)+"\0\0\0\0"+Be(x,4)+Be(s,4)+l+U+g;return{fileRecord:st,dirRecord:fe}},Tv=function(i,e,t,s,n){var r="",a=Je("string",n(s));return r=Da+"\0\0\0\0"+Be(i,2)+Be(i,2)+Be(e,4)+Be(t,4)+Be(a.length,2)+a,r},Iv=function(i){var e="";return e=Lv+Be(i.crc32,4)+Be(i.compressedSize,4)+Be(i.uncompressedSize,4),e},Ov=function(i){function e(t,s,n,r){i.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=s,this.zipPlatform=n,this.encodeFileName=r,this.streamFiles=t,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}return e.__proto__=i,e.prototype=Object.create(i.prototype),e.prototype.constructor=e,e.prototype.push=function(s){var n=s.meta.percent||0,r=this.entriesCount,a=this._sources.length;this.accumulate?this.contentBuffer.push(s):(this.bytesWritten+=s.data.length,i.prototype.push.call(this,{data:s.data,meta:{currentFile:this.currentFile,percent:r?(n+100*(r-a-1))/r:100}}))},e.prototype.openedSource=function(s){this.currentSourceOffset=this.bytesWritten,this.currentFile=s.file.name;var n=this.streamFiles&&!s.file.dir;if(n){var r=zl(s,n,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:r.fileRecord,meta:{percent:0}})}else this.accumulate=!0},e.prototype.closedSource=function(s){this.accumulate=!1;var n=this.streamFiles&&!s.file.dir,r=zl(s,n,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(r.dirRecord),n)this.push({data:Iv(s),meta:{percent:100}});else for(this.push({data:r.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},e.prototype.flush=function(){for(var s=this.bytesWritten,n=0;n<this.dirRecords.length;n++)this.push({data:this.dirRecords[n],meta:{percent:100}});var r=this.bytesWritten-s,a=Tv(this.dirRecords.length,r,s,this.zipComment,this.encodeFileName);this.push({data:a,meta:{percent:100}})},e.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},e.prototype.registerPrevious=function(s){this._sources.push(s);var n=this;return s.on("data",function(r){n.processChunk(r)}),s.on("end",function(){n.closedSource(n.previous.streamInfo),n._sources.length?n.prepareNextSource():n.end()}),s.on("error",function(r){n.error(r)}),this},e.prototype.resume=function(){if(!i.prototype.resume.call(this))return!1;if(!this.previous&&this._sources.length)return this.prepareNextSource(),!0;if(!this.previous&&!this._sources.length&&!this.generatedError)return this.end(),!0},e.prototype.error=function(s){var n=this._sources;if(!i.prototype.error.call(this,s))return!1;for(var r=0;r<n.length;r++)try{n[r].error(s)}catch{}return!0},e.prototype.lock=function(){i.prototype.lock.call(this);for(var s=this._sources,n=0;n<s.length;n++)s[n].lock()},e}(Fe),Av=function(i,e){var t=i||e,s=Vs[t];if(!s)throw new Error(t+" is not a valid compression method !");return s},Dv=function(i,e,t){var s=new Ov(e.streamFiles,t,e.platform,e.encodeFileName),n=0;try{i.forEach(function(r,a){n++;var o=Av(a.options.compression,e.compression),c=a.options.compressionOptions||e.compressionOptions||{},l=a.dir,u=a.date;a._compressWorker(o,c).withStreamInfo("file",{name:r,dir:l,date:u,comment:a.comment||"",unixPermissions:a.unixPermissions,dosPermissions:a.dosPermissions}).pipe(s)}),s.entriesCount=n}catch(r){s.error(r)}return s},Ct=function(e){this.data=e,this.length=e.length,this.index=0,this.zero=0};Ct.prototype.checkOffset=function(e){this.checkIndex(this.index+e)};Ct.prototype.checkIndex=function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")};Ct.prototype.setIndex=function(e){this.checkIndex(e),this.index=e};Ct.prototype.skip=function(e){this.setIndex(this.index+e)};Ct.prototype.byteAt=function(e){};Ct.prototype.readInt=function(e){var t=0,s;for(this.checkOffset(e),s=this.index+e-1;s>=this.index;s--)t=(t<<8)+this.byteAt(s);return this.index+=e,t};Ct.prototype.readString=function(e){return Je("string",this.readData(e))};Ct.prototype.readData=function(e){};Ct.prototype.lastIndexOfSignature=function(e){};Ct.prototype.readAndCheckSignature=function(e){};Ct.prototype.readDate=function(){var e=this.readInt(4);return new Date(Date.UTC((e>>25&127)+1980,(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(e&31)<<1))};var pd=function(i){function e(t){i.call(this,t);for(var s=0;s<this.data.length;s++)t[s]=t[s]&255}return e.__proto__=i,e.prototype=Object.create(i.prototype),e.prototype.constructor=e,e.prototype.byteAt=function(s){return this.data[this.zero+s]},e.prototype.lastIndexOfSignature=function(s){for(var n=s.charCodeAt(0),r=s.charCodeAt(1),a=s.charCodeAt(2),o=s.charCodeAt(3),c=this.length-4;c>=0;--c)if(this.data[c]===n&&this.data[c+1]===r&&this.data[c+2]===a&&this.data[c+3]===o)return c-this.zero;return-1},e.prototype.readAndCheckSignature=function(s){var n=s.charCodeAt(0),r=s.charCodeAt(1),a=s.charCodeAt(2),o=s.charCodeAt(3),c=this.readData(4);return n===c[0]&&r===c[1]&&a===c[2]&&o===c[3]},e.prototype.readData=function(s){if(this.checkOffset(s),s===0)return[];var n=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,n},e}(Ct),jv=function(i){function e(t){i.call(this,t)}return e.__proto__=i,e.prototype=Object.create(i.prototype),e.prototype.constructor=e,e.prototype.byteAt=function(s){return this.data.charCodeAt(this.zero+s)},e.prototype.lastIndexOfSignature=function(s){return this.data.lastIndexOf(s)-this.zero},e.prototype.readAndCheckSignature=function(s){var n=this.readData(4);return s===n},e.prototype.readData=function(s){this.checkOffset(s);var n=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,n},e}(Ct),Rv=function(i){function e(t){i.call(this,t)}return e.__proto__=i,e.prototype=Object.create(i.prototype),e.prototype.constructor=e,e.prototype.readData=function(s){if(this.checkOffset(s),s===0)return new Uint8Array(0);var n=this.data.subarray(this.zero+this.index,this.zero+this.index+s);return this.index+=s,n},e}(pd);function Gr(i){var e=Zi(i);return Ln(e),e==="string"&&!at.uint8array?new jv(i):at.uint8array?new Rv(Je("uint8array",i)):new pd(Je("array",i))}var Bv=0,Mv=3,Uv=function(i){for(var e in Vs)if(Vs.hasOwnProperty(e)&&Vs[e].magic===i)return Vs[e];return null},Mt=function(e,t){this.options=e,this.loadOptions=t};Mt.prototype.isEncrypted=function(){return(this.bitFlag&1)===1};Mt.prototype.useUTF8=function(){return(this.bitFlag&2048)===2048};Mt.prototype.readLocalPart=function(e){var t,s;if(e.skip(22),this.fileNameLength=e.readInt(2),s=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(s),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(t=Uv(this.compressionMethod),t===null)throw new Error("Corrupted zip : compression "+Oa(this.compressionMethod)+" unknown (inner file : "+Je("string",this.fileName)+")");this.decompressed=new di(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))};Mt.prototype.readCentralPart=function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)};Mt.prototype.processAttributes=function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(this.externalFileAttributes&16),e===Bv&&(this.dosPermissions=this.externalFileAttributes&63),e===Mv&&(this.unixPermissions=this.externalFileAttributes>>16&65535),!this.dir&&this.fileNameStr.slice(-1)==="/"&&(this.dir=!0)};Mt.prototype.parseZIP64ExtraField=function(e){if(this.extraFields[1]){var t=Gr(this.extraFields[1].value);this.uncompressedSize===fs&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===fs&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===fs&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===fs&&(this.diskNumberStart=t.readInt(4))}};Mt.prototype.readExtraFields=function(e){var t=e.index+this.extraFieldsLength,s,n,r;for(this.extraFields||(this.extraFields={});e.index<t;)s=e.readInt(2),n=e.readInt(2),r=e.readData(n),this.extraFields[s]={id:s,length:n,value:r}};Mt.prototype.handleUTF8=function(){var e=at.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=zi(this.fileName),this.fileCommentStr=zi(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(t!==null)this.fileNameStr=t;else{var s=Je(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(s)}var n=this.findExtraFieldUnicodeComment();if(n!==null)this.fileCommentStr=n;else{var r=Je(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(r)}}};Mt.prototype.findExtraFieldUnicodePath=function(){var e=this.extraFields[28789];if(e){var t=Gr(e.value);return t.readInt(1)!==1||hn(this.fileName)!==t.readInt(4)?null:zi(t.readData(e.length-5))}return null};Mt.prototype.findExtraFieldUnicodeComment=function(){var e=this.extraFields[25461];if(e){var t=Gr(e.value);return t.readInt(1)!==1||hn(this.fileComment)!==t.readInt(4)?null:zi(t.readData(e.length-5))}return null};var Ut=function(e){this.files=[],this.loadOptions=e};Ut.prototype.checkSignature=function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+Oa(t)+", expected "+Oa(e)+")")}};Ut.prototype.isSignature=function(e,t){var s=this.reader.index;this.reader.setIndex(e);var n=this.reader.readString(4),r=n===t;return this.reader.setIndex(s),r};Ut.prototype.readBlockEndOfCentral=function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=at.uint8array?"uint8array":"array",s=Je(t,e);this.zipComment=this.loadOptions.decodeFileName(s)};Ut.prototype.readBlockZip64EndOfCentral=function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e=this.zip64EndOfCentralSize-44,t=0,s,n,r;t<e;)s=this.reader.readInt(2),n=this.reader.readInt(4),r=this.reader.readData(n),this.zip64ExtensibleData[s]={id:s,length:n,value:r}};Ut.prototype.readBlockZip64EndOfCentralLocator=function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")};Ut.prototype.readLocalFiles=function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(So),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()};Ut.prototype.readCentralDir=function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(Eo);)e=new Mt({zip64:this.zip64},this.loadOptions),e.readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)};Ut.prototype.readEndOfCentral=function(){var e=this.reader.lastIndexOfSignature(Da);if(e<0){var t=!this.isSignature(0,So);throw t?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory")}this.reader.setIndex(e);var s=e;if(this.checkSignature(Da),this.readBlockEndOfCentral(),this.diskNumber===Hn||this.diskWithCentralDirStart===Hn||this.centralDirRecordsOnThisDisk===Hn||this.centralDirRecords===Hn||this.centralDirSize===fs||this.centralDirOffset===fs){if(this.zip64=!0,e=this.reader.lastIndexOfSignature(Nl),e<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(Nl),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,fa)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(fa),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(fa),this.readBlockZip64EndOfCentral()}var n=this.centralDirOffset+this.centralDirSize;this.zip64&&(n+=20,n+=12+this.zip64EndOfCentralSize);var r=s-n;if(r>0)this.isSignature(s,Eo)||(this.reader.zero=r);else if(r<0)throw new Error("Corrupted zip: missing "+Math.abs(r)+" bytes.")};Ut.prototype.prepareReader=function(e){this.reader=Gr(e)};Ut.prototype.load=function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()};function Nv(i){return new Qt.Promise(function(e,t){var s=i.decompressed.getContentWorker().pipe(new hd);s.on("error",function(n){t(n)}).on("end",function(){s.streamInfo.crc32!==i.decompressed.crc32?t(new Error("Corrupted zip : CRC32 mismatch")):e()}).resume()})}function zv(i,e){var t=this;return e=bo(e||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:zi}),ld("the loaded zip file",i,!0,e.optimizedBinaryString,e.base64).then(function(s){var n=new Ut(e);return n.load(s),n}).then(function(n){var r=[Qt.Promise.resolve(n)],a=n.files;if(e.checkCRC32)for(var o=0;o<a.length;o++)r.push(Nv(a[o]));return Qt.Promise.all(r)}).then(function(n){for(var r=n.shift(),a=r.files,o=0;o<a.length;o++){var c=a[o],l=c.fileNameStr,u=nv(c.fileNameStr);t.file(u,c.decompressed,{binary:!0,optimizedBinaryString:!0,date:c.date,dir:c.dir,comment:c.fileCommentStr.length?c.fileCommentStr:null,unixPermissions:c.unixPermissions,dosPermissions:c.dosPermissions,createFolders:e.createFolders}),c.dir||(t.file(u).unsafeOriginalName=l)}return r.zipComment.length&&(t.comment=r.zipComment),t})}var md=function(i,e,t){var s=Zi(e),n,r=bo(t||{},dd);r.date=r.date||new Date,r.compression!==null&&(r.compression=r.compression.toUpperCase()),typeof r.unixPermissions=="string"&&(r.unixPermissions=parseInt(r.unixPermissions,8)),r.unixPermissions&&r.unixPermissions&16384&&(r.dir=!0),r.dosPermissions&&r.dosPermissions&16&&(r.dir=!0),r.dir&&(i=gd(i)),r.createFolders&&(n=$v(i))&&vd.call(this,n,!0);var a=s==="string"&&r.binary===!1&&r.base64===!1;(!t||typeof t.binary>"u")&&(r.binary=!a);var o=e instanceof di&&e.uncompressedSize===0;(o||r.dir||!e||e.length===0)&&(r.base64=!1,r.binary=!0,e="",r.compression="STORE",s="string");var c=null;e instanceof di||e instanceof Fe?c=e:c=ld(i,e,r.binary,r.optimizedBinaryString,r.base64);var l=new Fn(i,c,r);this.files[i]=l},$v=function(i){i.slice(-1)==="/"&&(i=i.substring(0,i.length-1));var e=i.lastIndexOf("/");return e>0?i.substring(0,e):""},gd=function(i){return i.slice(-1)!=="/"&&(i+="/"),i},vd=function(i,e){return e=typeof e<"u"?e:ud,i=gd(i),this.files[i]||md.call(this,i,null,{dir:!0,createFolders:e}),this.files[i]};function wd(i){return Object.prototype.toString.call(i)==="[object RegExp]"}var kt=function i(){if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var e=new i;for(var t in this)typeof this[t]!="function"&&(e[t]=this[t]);return e}},Pn={support:{configurable:!0},defaults:{configurable:!0},version:{configurable:!0},external:{configurable:!0}};kt.prototype.load=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")};kt.prototype.forEach=function(e){var t,s,n;for(t in this.files)n=this.files[t],s=t.slice(this.root.length,t.length),s&&t.slice(0,this.root.length)===this.root&&e(s,n)};kt.prototype.filter=function(e){var t=[];return this.forEach(function(s,n){e(s,n)&&t.push(n)}),t};kt.prototype.file=function(e,t,s){if(arguments.length===1)if(wd(e)){var n=e;return this.filter(function(a,o){return!o.dir&&n.test(a)})}else{var r=this.files[this.root+e];return r&&!r.dir?r:null}else e=this.root+e,md.call(this,e,t,s);return this};kt.prototype.folder=function(e){if(!e)return this;if(wd(e))return this.filter(function(r,a){return a.dir&&e.test(r)});var t=this.root+e,s=vd.call(this,t),n=this.clone();return n.root=s.name,n};kt.prototype.remove=function(e){e=this.root+e;var t=this.files[e];if(t||(e.slice(-1)!=="/"&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var s=this.filter(function(r,a){return a.name.slice(0,e.length)===e}),n=0;n<s.length;n++)delete this.files[s[n].name];return this};kt.prototype.generate=function(e){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")};kt.prototype.generateInternalStream=function(e){var t,s={};try{if(s=bo(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:Js}),s.type=s.type.toLowerCase(),s.compression=s.compression.toUpperCase(),s.type==="binarystring"&&(s.type="string"),!s.type)throw new Error("No output type specified.");Ln(s.type),(s.platform==="darwin"||s.platform==="freebsd"||s.platform==="linux"||s.platform==="sunos")&&(s.platform="UNIX"),s.platform==="win32"&&(s.platform="DOS");var n=s.comment||this.comment||"";t=Dv(this,s,n)}catch(r){t=new Fe("error"),t.error(r)}return new Is(t,s.type||"string",s.mimeType)};kt.prototype.generateAsync=function(e,t){return this.generateInternalStream(e).accumulate(t)};kt.prototype.loadAsync=function(e,t){return zv.apply(this,[e,t])};kt.loadAsync=function(e,t){return new kt().loadAsync(e,t)};Pn.support.get=function(){return at};Pn.defaults.get=function(){return dd};Pn.version.get=function(){return"3.2.2-esm"};Pn.external.get=function(){return Qt};Object.defineProperties(kt,Pn);const q=Ir(),Co=gn(),gr=Vh(),vr=Yh();function wr(i){q.project&&i==null&&(gr?.booted&&gr?.$reset(),vr.booted&&vr.$reset()),q.project=i}const qv=fn(),{g_user:pa}=Er(qv);function yr(){ci==Jt.lesson?Co.triggerLesson():q.triggerProject()}class ja{constructor(e,t,s={}){this.title=e,this.items=[],this.files=[],this.openFiles=[],this.hlItems=[],this.parent=t,this.readonly=s.readonly||!1,this.disableCopy=s.disableCopy||!1,this.textEncoder=new TextEncoder,this.textDecoder=new TextDecoder,s.readonly&&(this.hasSavedOnce=!0)}get wc(){return this.isTutor?gr:vr}meta;pid;title;items;files;openFiles;curFile;lastFolder;desc;isPublic;wordWrap=!1;live;emitLLAction(e){this.live&&le.emit("ll-action",this.live.code,performance.now(),e)}builtInFileList=!1;fileList;findIFrame(){return this.refs.iframe}refreshState=jt(!0);getRefreshType(){return this.isTutor?"local":"normal"}refs={icon_refresh:void 0,b_refresh:void 0,iframe:void 0,preview:void 0,previewUrl:void 0,overPreview:!1};get canEdit(){return ci==Jt.lesson?!0:this.meta?.canEdit}get isOwner(){return ci==Jt.lesson?!0:this.meta?.isOwner}parent;d_files;codeCont;lesson;hlItems;readonly=!1;disableCopy=!1;hasSavedOnce=!1;needsSave=!1;setPublished(e){this.meta&&(this.meta.submitted=e)}isPublished(){return this.meta?.submitted}canLeave(){return!(this.needsSave||this.openFiles.some(e=>!e._saved))}wipe(){let e=t=>{for(const s of t)s instanceof Ie?e(s.items):s instanceof ze&&s.close()};e(this.items),this.hlItems=[],this.files=[],this.items=[],this.curFile=null,this.lastFolder=null,this.openFiles=[],this.fileList.textContent=""}deselectSelFolder(){let e=q.project.fileList.querySelectorAll(".folder-item.sel");this.lastFolder=null;for(const t of e)t.classList.remove("sel");Se.exec("deselectFolders",null)}isCompiling={value:!1};usesCompiling={value:!1};enableCompile(){this.items.some(e=>e.name=="package.json")||this.usesCompiling.value||(this.usesCompiling.value=!0,yr(),console.log(":: ENABLED LOCAL COMPILING"))}disableCompile(){this.usesCompiling.value=!1,yr(),console.log(":: DISABLED LOCAL COMPILING")}isFSSyncing=!1;fsSyncTick=0;fsHandle;async startFSSync(){if(!Mo()){alert(`Your browser doesn't support the File System Access API which is required for this feature to work.

Compatible browsers include up-to-date versions of Chrome, Microsoft Edge, and other Chromium based browsers.

Firefox is not supported.`);return}if(this.isFSSyncing)return;this.isFSSyncing=!0;let e=this.pid??nr(),t=await showDirectoryPicker({mode:"readwrite",startIn:"documents",id:e.replace(/\-/g,"")});await t.requestPermission({mode:"readwrite"})!="denied"&&(this.fsHandle=t,await this.fsWrite(),alert("connected"),await this.fsTick())}endFSSync(){if(this.isFSSyncing){if(this.isFSSyncing=!1,!Mo()){alert(`Your browser doesn't support the FileSystem Access API which is required for this feature to work.

Compatible browsers include up-to-date versions of Chrome, Microsoft Edge, and other Chromium based browsers.

Firefox is not supported.`);return}this.fsHandle&&(this.fsHandle=null)}}async fsRead(){if(!this.fsHandle)return;let e=async(s,n)=>{for await(const[r,a]of s.entries())if(a.kind=="directory"){let o=await s.getDirectoryHandle(a.name),c=n.items.find(l=>l.name==a.name);c||(c=this.createFolder(r,n.name=="___CO_root"?null:n,!0)),await e(o,c)}else{let o=n.items.find(g=>g.name==r);o||(o=await this.createFile(r,new Uint8Array,void 0,n.name=="___CO_root"?null:n,!0));let c=o._fsLastModified??new Date(o.p.meta.meta.wls).getTime(),l=await a.getFile(),u=l.lastModified-c,m=!1;u>0&&(o.buf=new Uint8Array(await l.arrayBuffer()),o._fsLastModified=l.lastModified,m=!0),m&&(o.reopen(),o.setSaved(!1))}},t=new Ie(this,"___CO_root",null);t.items=this.items,await e(this.fsHandle,t),this.items=t.items,console.log(":: done (fs read)")}async fsWrite(){if(!this.fsHandle)return;let e=async(s,n)=>{for(const r of s.items)if(r instanceof Ie)await e(r,await n.getDirectoryHandle(r.name,{create:!0}));else if(r instanceof ze){let a=await n.getFileHandle(r.name,{create:!0});if((await a.getFile()).lastModified-r._fsLastModified==0)continue;let l=await a.createWritable();await l.write(r.buf),await l.close();let u=await a.getFile();r._fsLastModified=u.lastModified}},t=new Ie(this,"root",null);t.items=this.items,await e(t,this.fsHandle),console.log(":: done (fs write)")}async fsTick(){this.isFSSyncing&&(this.fsSyncTick++,this.fsSyncTick>5&&(this.fsSyncTick=0,await this.fsRead()),await w(300),await this.fsTick())}onopen;renameFItem(e,t){if(!e||!e.p.canEdit)return;let s=e.name,n=new bs("Rename File","New name",r=>{if(s=r,s==e.name||s==null||s==""){t&&t();return}if(s.includes("/")||s.includes("..")){alert("Invalid file/folder name"),t&&t();return}this.renameFItem2(e,s)},()=>{console.log("Canceled file rename")},"Rename file","",`Old name: ${e.name.substring(0,30)+(e.name.length>30?"...":"")}`).load();n.inp.placeholder=e.name,n.inp.value=e.name,n.inp.spellcheck=!1,n.inp.focus(),n.inp.setSelectionRange(0,n.inp.value.lastIndexOf("."))}renameFItem2(e,t){let s=e.name;Vv(e.p.pid,xr(e.folder),e.name,t,nr(),n=>{if(n!=0)return;let r=Zs(e.name).replace(/\s/g,"_");e._fi.classList.remove("lang-"+r),e.name=t,e instanceof ze?(e.link&&(e.link.children[0].textContent=t),e._fi&&(e._fi.children[0].textContent=t),e.updateLang()):e._fi&&(e._fi.children[0].children[2].textContent=t),e._fi.classList.add("lang-"+r),this.wc.moveItem(e.getPath()+s,e.getPath()+t),this.emitLLAction({type:"rename-item",path:e.getSelfPath(),newName:t}),close&&close()})}async deleteFItem(e,t=!1,s,n=!1){if(!e||!e.p.canEdit)return;let r=[];if(e.p.hlItems.length)for(const c of e.p.hlItems)r.push(c);else r.push(e);let a=r.map(c=>c.name);if(await new Promise(c=>{if(t){c(0);return}new qi("Delete Item","Are you sure you want to delete: ["+a.join(", ")+"] ?<br><br>There is no reversing this option!",()=>{c(0)},()=>{c(1)}).load()})==0){for(const c of r){let l=await new Promise(u=>{le.emit("deleteFItem",c.p.pid,xr(c.folder),c.name,nr(),m=>{console.log("RES delete: ",m),u(m)})});if(n&&l==5&&(l=0),l==0){let u=c.folder?c.folder.items:c.p.items;u.splice(u.indexOf(c),1);let m=this.files.findIndex(g=>g==c);m!=-1&&this.files.splice(m,1),c._fi.remove(),c instanceof ze?(this.openFiles.includes(c)&&c.close(),this.wc.booted&&this.wc.deleteFile(c.getPath()+c.name,s)):c instanceof Ie&&this.wc.booted&&this.wc.deleteFolder(c.getPath()+c.name,s),this.emitLLAction({type:"delete-item",path:e.getSelfPath()})}await w(100)}e.p.deselectHLItems(),e instanceof ze&&this.openFiles.includes(e)&&(e._saved=!0,e.close())}}cutFItems(e){if(e&&e.p.canEdit){if(je.files=[],e.p.hlItems.length)for(const t of e.p.hlItems)je.files.push(t);else je.files.push(e);je.action="cut",e.p.deselectHLItems(),console.log("Cut "+je.files.length+" items into the clipboard")}}copyFItems(e){if(e&&e.p.canEdit){if(je.files=[],e.p.hlItems.length)for(const t of e.p.hlItems)je.files.push(t);else je.files.push(e);je.action="copy",e.p.deselectHLItems(),console.log("Copied "+je.files.length+" items into the clipboard")}}async duplicateItems(e,t){this.startSkipSave();let s=je.files;je.files=[...t],je.action="copy",await this.pasteFItems(this,e,n=>{},()=>{Wi()},(n,r)=>{let a=0,o=m=>{(n?n.items:this.items).find(p=>p.name==m[0]+(a==0?"":" ("+a+")")+m[1])&&(a++,o(m))},c=r,l="";if(r.includes(".")){let m=r.split(".");l=m.pop(),c=m.join(".")}let u=[c,l];return o(u),a==0?r:u[0]+" ("+a+")"+u[1]}),je.files=[...s],this.endSkipSave(),await lt()}get _skipSave(){return this._skipSaveCnt>0}_skipSaveCnt=0;startSkipSave(){this._skipSaveCnt++}endSkipSave(){this._skipSaveCnt--}async pasteFItems(e,t,s,n,r){if(this.startSkipSave(),!e||!e.canEdit||!je.files.length)return;let a=t instanceof Ie?t:t?.folder,o=je.files.length,c=[];for(const l of je.files){let u;if(je.action=="cut")await $i(l,a,!0)&&(u=l,c.push(l));else if(je.action=="copy"){let m=l.name;if(r&&(m=r(a,m)),l instanceof ze)u=await e.createFile(m,l.buf?.slice(),null,a,!0);else if(l instanceof Ie){async function g(p,k,D){let E=e.createFolder(p,k,!0);for(const C of D.items){let U=r?r(E,C.name):C.name;C instanceof Ie?await g(U,E,C):C instanceof ze&&await e.createFile(U,C.buf?.slice(),null,E,!0)}}await g(m,a,l)}c.push(u)}u&&(e.hlItems.push(u),u._fi.classList.add("hl2"))}n&&n(),this.endSkipSave(),await lt(),e.deselectHLItems();for(const l of c)l&&l.p.flashAddHLItem(l);je.action=="cut"&&(je.files=[],je.action=null),console.log("Pasted "+o+" items from the clipboard"),s&&s(c)}addHLItem(e){this.hlItems.includes(e)||(this.hlItems.push(e),e._fi.classList.add("hl2"))}removeHLItem(e){let t=this.hlItems.indexOf(e);t!=-1&&(this.hlItems.splice(t,1),e._fi.classList.remove("hl2"))}async flashAddHLItem(e){this.addHLItem(e),await w(500),this.removeHLItem(e)}deselectHLItems(){for(const e of this.hlItems)e._fi.classList.remove("hl2");this.hlItems=[]}refreshedOnce=!1;previewURL="index.html";getURLRoot(){return $e.getURLRoot?$e.getURLRoot(!0,this,""):(this.previewURL=this.previewURL??"index.html",this.meta?this.canEdit?os+"/project/"+pa.value.data.uid+"/"+le.id+"/"+this.meta.owner+"/"+this.pid+"/":os+"/public/"+this.meta.owner+"/"+this.pid+"/":"")}getURL(){this.previewURL=this.previewURL??"index.html";let e=this.previewURL;if(e.startsWith("localhost:")&&this.wc.booted){let s=e.match(/localhost\:\d+\/(.+)/)?.at(1)??"";console.log("PATH FOR URL:",s);let n=e.match(/localhost\:(\d+)/)[1];return e=this.wc.previewURLs.find(r=>r.includes(`--${n}--`)),e+(e.endsWith("/")?"":s?"/":"")+s}let t=this.previewURL;return $e.getURLRoot?$e.getURLRoot(!1,this,t):this.canEdit?os+"/project/"+pa.value.data.uid+"/"+le.id+"/"+this.meta.owner+"/"+this.pid+"/"+t:os+"/public/"+this.meta.owner+"/"+this.pid+"/"+t}getExternalURL(){this.previewURL=this.previewURL??"index.html";let e=this.previewURL;if(e.startsWith("localhost:")&&this.wc.booted){let t=e.match(/localhost\:\d+\/(.+)/)?.at(1)??"",s=e.match(/localhost\:(\d+)/)[1],r=this.wc.previewURLs.find(c=>c.includes(`--${s}--`)).match(/https:\/\/(.+)--\d+--(\d+)\./),a=r[1],o=r[2];return`/webcontainer/connect/${a}/${s}/${o}/${t}`}return $e.getExternalURL?$e.getExternalURL(!0,this,e):!this.canEdit||this.meta.isPublic?location.origin+"/viewer/?a="+this.meta.owner+"&b="+this.pid+"/"+e:location.origin+`/viewer/?t=p&a=${pa.value.data.uid}&b=${le.id}&c=${this.meta.owner}&d=${this.pid}/`+e}findFile(e){return this.files.find(t=>t.name==e)}findAllFiles(e){return this.files.filter(t=>t.name==e)}getFolderByPath(e,t){e=tt(e),t&&(e.length!=0?e+="/"+t:e=t);let s=e==""?[]:e.split("/"),n=this.items,r=null;for(const a of s){let o=n.find(c=>c.name==a);if(!o||!(o instanceof Ie))return;n=o.items,r=o}return r}getFileByPath(e,t){e=tt(e);let s=e==""?[]:e.split("/"),n=this.items;for(const a of s){let o=n.find(c=>c.name==a);if(!o||!(o instanceof Ie))return;n=o.items}let r=n.find(a=>a.name==t);if(r instanceof ze)return r}getFileByPath2(e){let t=e.split("/"),s=t.pop(),n=t.join("/");return this.getFileByPath(n,s)}getItemByPath(e,t){e=tt(e);let s=e==""?[]:e.split("/"),n=this.items;for(const a of s){let o=n.find(c=>c.name==a);if(!o||!(o instanceof Ie))return;n=o.items}return n.find(a=>a.name==t)}getItemByPath2(e){let t=e.split("/"),s=t.pop(),n=t.join("/");return this.getItemByPath(n,s)}hasFileWrongPath(e,t){let s=this.findAllFiles(t);if(s.length==0)return;let n=tt(e);return!s.map(r=>r.getPath()).some(r=>tt(r)==n)}textEncoder;textDecoder;toggleShowFilesBtn(e){let t=this.d_files.querySelector(".b-show-files-pane");!this.fileList.parentElement.classList.contains("hide")!=e&&t?.click()}getFilesPane(){return this.fileList.parentElement}async createFile(e,t,s,n,r=!1,a=!1,o=!0){n?.isRoot&&(n=void 0);let c,l=(n?n.items:this.items).find(m=>m.name==e);if(l){l instanceof ze?await Ed(null,e,t,l):l instanceof Ie&&alert("There is already a folder in this location with the name: "+e+", skipping...");return}if(Cs(li.addFile,e)==1){console.warn("Failed creation prevented from hook");return}return c=new ze(this,e,t,n,s),r&&(c.beenUploaded=!1),this.files.push(c),n?n.items.push(c):this.items.push(c),Kv(c),r?a||c.open(!1):c.setSaved(!0),r&&o&&(r&&(!this.lesson||this.lesson.info.type!=bt.review)&&lt(),r&&!this.isTutor&&(Se.exec("createFile",c),this.emitLLAction({type:"create-file",path:c.getSelfPath(),buf:c.buf}))),e.endsWith(".ts")&&this.enableCompile(),e=="package.json"&&this.disableCompile(),c}createFolder(e,t,s=!0,n=!1,r=!0){t?.isRoot&&(t=void 0),e.includes(".")&&console.info("Folder names now support having '.' characters in them :)");let a=(t?t.items:this.items).find(c=>c.name==e);if(a){if(a instanceof ze){this.isTutor||alert("There is already a file in this folder with the name: "+e+", skipping...");return}else if(a instanceof Ie){this==q.project&&Se.exec("createFolderAny",a),this.isTutor||alert("There is already a folder in this location with the name: "+e+", skipping...");return}}let o=new Ie(this,e,t);if(t?t.items.push(o):this.items.push(o),Xv(o),s&&!n?(o._fiLabel.click(),!this.isTutor&&r&&lt()):o._fi.classList.toggle("close"),s&&!n&&o._fi){let c=function(l){l&&(l._fiLabel.parentElement.classList.contains("close")&&(l._fiLabel.click(),l.p.lastFolder=null,l._fiLabel.parentElement.classList.remove("sel")),l.folder&&c(l.folder))};o._fi.classList.add("sel"),c(o.folder),this.deselectHLItems(),o._fi.classList.add("sel"),this._selectFolder(o)}return s&&o.p==q.project&&(Se.exec("createFolder",o),Se.exec("createFolderAny",o),this.emitLLAction({type:"create-folder",path:o.getSelfPath()})),o}createFolderFromPath(e){e=tt(e);let t=e.split("/"),s=this.getRootFolder();t=t.filter(n=>n!="");for(const n of t){let r=s.items.find(a=>a.name==n&&a instanceof Ie);if(r||(r=this.createFolder(n,s,!0,!0,!1)),!r){console.warn("failed to create/find folder");return}s=r}return s}async createFileFromPath(e,t){e=tt(e);let s=e.split("/"),n=s.pop();s=s.filter(c=>c!="");let r=s.join("/"),a=this.createFolderFromPath(r);if(!a){console.warn("wasn't able to create/find the parent path");return}return await this.createFile(n,t,void 0,a,!0,!0,!1)}hasEditor(){return this.curFile?.curEditor!=null}getCurEditor(){return this.curFile?.curEditor}init(e=!1){yd(this,!this.isTutor,e)}get isTutor(){return this.disableCopy}async uploadFiles(){let e=document.createElement("input");e.type="file",e.multiple=!0;let t=1e7;e.addEventListener("input",async s=>{let n=s.target.files;for(const r of n){if(r.size>t){alert("The file: "+r.name+" was too large. Max file size is: "+Intl.NumberFormat().format(t)+" B, but the file's size was: "+Intl.NumberFormat().format(r.size)+" B");continue}await this.createFile(r.name,new Uint8Array(await r.arrayBuffer()),void 0,this.lastFolder,!0)}await lt()}),e.click()}async downloadAsZip(){const e=new kt;this.loopAllFiles({forFile:(r,a)=>{e.file(a+r.name,r.buf,{binary:!0,createFolders:!0})},forFolder:(r,a)=>{r.items.length==0&&e.file(a+r.name,null,{createFolders:!0,dir:!0})}},(r,a)=>r==null?"":r+a.name+"/");let t=await e.generateAsync({type:"blob"});q.lastDownloadZIPURL&&URL.revokeObjectURL(q.lastDownloadZIPURL);let s=URL.createObjectURL(t);q.lastDownloadZIPURL=s;let n=document.createElement("a");n.href=s,n.download=this.meta.name.replace(/[^[a-zA-Z0-9\_\-\.]]/g,"_")+".zip",n.click()}getRootFolder(){let e=new Ie(this,"root",void 0);return e.isRoot=!0,e.items=[...this.items],e}loopAllFiles(e,t){function s(n,r){r=t(r,n);for(const a of n.items)a instanceof ze?e.forFile&&e.forFile(a,r):a instanceof Ie&&(e.forFolder&&e.forFolder(a,r),s(a,r))}s(this.getRootFolder(),void 0)}_selectFolder(e){e.p.lastFolder=e,Se.exec("selectFolder",e)}uploadProjectFiles(e={}){let t=[],s=this;function n(r){let a=[];for(const o of r)if(o instanceof ze){if((!o._saved||!o.beenUploaded)&&(a.push(new fi(o.name,o.encode())),o.beenUploaded=!0,s.wc.booted)){let c=o.getPath();s.wc.saveFile(c+o.name,o.encode(),e.ignoreInsts)}}else if(o instanceof Ie&&(a.push(new Yn(o.name,n(o.items))),s.wc.booted)){let c=o.getPath();s.wc.saveFolder(c+o.name,!0,e.ignoreInsts)}return a}return t=n(q.project.items),new Promise(r=>{le.emit("uploadProjectFiles",q.project.meta.owner,q.project.pid||"tmp_project",t,a=>{a&&console.log("ERR while uploading files:",a),r()})})}}let br;function Wv(i){br=i}function Hv(){br=null}function nr(){return br?br():null}function Vv(i,e,t,s,n,r){le.emit("renameFItem",i,e,t,s,n,r)}async function Yv(i,e){let t=await new Promise(s=>{le.emit("restoreProjectFiles",i,e,async(n,r,a)=>{if(console.warn("CAN EDIT THIS PROJECT: ",a),n==null){console.log("ERR while restoring files","code",r,{pid:e,uid:i}),r==-2&&alert("You don't have permission to view this project"),s(null);return}async function o(c){for(let l=0;l<c.length;l++){let u=c[l];if("items"in u)await o(u.items);else{let m=u;m.buf=new Uint8Array(m.buf);let g=new fi(m.name,m.buf);c[l]=g}}}await o(n.items),s({meta:n,canEdit:a})})});return t||(console.log("ERR: couldn't get data when restoring project files"),{meta:null,canEdit:!1})}var _r=(i=>(i[i.none=0]="none",i[i.self=1]="self",i[i.tutor=2]="tutor",i))(_r||{});function Ra(i,e,t=!1){if(!i){console.error("FAILED TO SETUP EDITOR, there was no parent",i,e,t);return}let s=document.createElement("div");s.className="d-open-files pane";let n=document.createElement("div");if(n.className="cont-js cont pane",i.appendChild(s),i.appendChild(n),!t){let r=document.createElement("button");r.className="b-add-file",r.innerHTML="<div class='material-symbols-outlined'>add</div>",s.appendChild(r)}if(e!=0){let r=document.createElement("div");r.innerHTML=`<!--<div class="material-symbols-outlined">menu</div>--><div>${e==2?"TUTOR":"YOU"}</div>`,r.className=e==2?"editor-type-tutor":"editor-type-self",s.appendChild(r)}}function yd(i,e=!0,t=!1){let s=i.parent;if(!s){alert("No parent was found while trying to post setup the editor. This usually means something just errored while loading, try refreshing the page.");return}if(i.d_files=s.querySelector(".d-open-files"),i.codeCont=s.querySelector(".cont-js"),!t){let r;if(i.builtInFileList){let a=document.createElement("button");a.className="b-show-files-pane",a.innerHTML="<div class='material-symbols-outlined'>menu</div>",a.addEventListener("click",o=>{a.classList.toggle("f-hover");let c=s.querySelector(".file-list");c.parentElement.classList.toggle("hide"),c.parentElement.classList.contains("hide")||Se.exec("openShowFiles",!0)}),i.d_files.insertBefore(a,i.d_files.children[0]),r=document.createElement("div"),r.className="pane-files pane hide",s.insertBefore(r,s.children[0]),i.codeCont.addEventListener("click",o=>{i.fileList.parentElement.classList.contains("hide")||a.click()})}else r=document.querySelector(".pane-files");Zv(r)}i.d_files.addEventListener("wheel",r=>{r.preventDefault();let a=Math.abs(r.deltaX)>Math.abs(r.deltaY)?r.deltaX:r.deltaY;i.d_files.scrollBy({left:a/2,top:0,behavior:"instant"})});let n=s.querySelector(".b-add-file");n&&n.addEventListener("click",r=>{if(i.canEdit){if(i.isTutor){alert("Sorry! You can't add files to the tutor's project!");return}Cs(li.clickAddFile,null),new Xr().load()}}),i.meta?i.setPublished(i.meta.submitted):i.setPublished(!1),i.fileList=i.builtInFileList?i.parent.querySelector(".file-list"):Vt?Vt.querySelector(".file-list"):document.querySelector(".file-list"),Gv(i),i.fileList.addEventListener("mousedown",r=>{Wi()}),i.fileList.addEventListener("click",r=>{!r.ctrlKey&&!r.shiftKey&&i.deselectHLItems()})}function Zv(i){i.innerHTML=`
        <div class="header flx-sb">
            <div>Files</div>
            <div>
                <button class="icon-btn-single b-new-file co-item" co-label="Create file">
                    <div class="material-symbols-outlined">note_add</div>
                </button>
                <button class="icon-btn-single b-new-folder co-item" co-label="Create folder">
                    <div class="material-symbols-outlined">create_new_folder</div>
                </button>
                <button class="icon-btn-single dd-files-pane-options">
                    <div class="material-symbols-outlined">more_vert</div>
                </button>
            </div>
        </div>
        <div class="file-list">
            <!-- <div class="file-item">index.html</div> -->
            <!-- <div class="file-item">style.css</div> -->
            <!-- <div class="file-item">script.js</div> -->
        </div>
        <div class="file-ops">
            <button class="icon-btn-single ops-rename">
                <div class="material-symbols-outlined">edit</div>
            </button>
            <button class="icon-btn-single ops-delete">
                <div class="material-symbols-outlined">delete</div>
            </button>
            <button class="icon-btn-single ops-cut">
                <div class="material-symbols-outlined">content_cut</div>
            </button>
            <button class="icon-btn-single ops-copy">
                <div class="material-symbols-outlined">content_copy</div>
            </button>
            <button class="icon-btn-single ops-paste">
                <div class="material-symbols-outlined">content_paste</div>
            </button>
        </div>
    `;const e=i.querySelector(".b-new-folder"),t=i.querySelector(".b-new-file"),s=i.querySelector(".dd-files-pane-options");s.addEventListener("mousedown",l=>{$a(s,()=>["Upload File(s)","Download as Zip","Use your own IDE"],u=>{if(u==0)q.project?.uploadFiles();else if(u==1)q.project?.downloadAsZip();else if(u==2){async function m(){await Uo("External IDE","This is a very experimental feature and only supported on newer chromium based browsers. There is a chance some of your files could get lost if something goes wrong.<br><br>If you wish to proceed please provide feedback if it's working, not working, should be improved, or just simply if you like the feature!")&&await Uo("External IDE","Quick guide on how to use:<br><br>A folder picker will appear and you can navigate to, create a new folder with a name you'd like, select and confirm, and now Code Otter will be linked to that folder.<br><br>We'll first copy all your files from Code Otter that were stored online and save them to your folder you selected (meaning the folder's files will get overridden so be careful!)<br><br>Then open your favorite IDE to that folder and every time you save we'll sync those changes back to Code Otter's servers, easy peasy :)")&&q.project.startFSSync()}m()}},{getIcons(){return["upload","package_2","terminal"]},onopen(u){if(!q.project||q.project?.readonly||q.project?.isPublished()){u.children[0].classList.add("disabled"),u.children[1].classList.add("disabled"),u.children[2].classList.add("disabled");return}}})}),e.addEventListener("click",l=>{q.project&&q.project.canEdit&&new To().load()}),t.addEventListener("click",l=>{new Xr().load()});const n=i.querySelector(".ops-rename"),r=i.querySelector(".ops-delete"),a=i.querySelector(".ops-cut"),o=i.querySelector(".ops-copy"),c=i.querySelector(".ops-paste");if(n){async function l(u){if(!u)return;let m=u instanceof Ie?u._fiLabel:u._fi;m&&(m.classList.add("hl"),await w(200),m.classList.remove("hl"))}n.addEventListener("click",u=>{q.project&&q.project.renameFItem(q.project.lastFolder??q.project.curFile)}),r.addEventListener("click",u=>{q.project&&q.project.deleteFItem(q.project.lastFolder??q.project.curFile)}),a.addEventListener("click",u=>{if(!q.project)return;let m=q.project.hlItems.length?q.project.hlItems:[q.project.lastFolder??q.project.curFile];for(const g of m)l(g);q.project.cutFItems(q.project.lastFolder??q.project.curFile)}),o.addEventListener("click",u=>{if(!q.project)return;let m=q.project.hlItems.length?q.project.hlItems:[q.project.lastFolder??q.project.curFile];for(const g of m)l(g);q.project.copyFItems(q.project.lastFolder??q.project.curFile)}),c.addEventListener("click",u=>{if(!q.project)return;let m=q.project.lastFolder??q.project.curFile;q.project.pasteFItems(q.project,m,g=>{})})}}function bd(i){let e=[];function t(n,r=""){for(const a of n)a instanceof ze?a.name.endsWith(".html")&&e.push(r+a.name):a instanceof Ie&&t(a.items,r+a.name+"/")}t(i.items);function s(n){return n?n=="index.html"?-999:n.match(/\//g)?.length||0:0}if(e=e.sort((n,r)=>n=="index.html"?-1:r=="index.html"?1:s(n)-s(r)||n.localeCompare(r)),i.wc.booted){let n=i.wc.previewURLs.map(r=>`localhost:${r.match(/--(\d+)--/)?.at(1)}`);e.unshift(...n.filter(r=>!!r))}return e}function Qw(i,e){let t=[];i.addEventListener("mousedown",async s=>{e.isTutor||Cs(li.clickPreviewURL,null),t=bd(e),await $a(i,()=>t,n=>{t.length&&(e.previewURL=t[n],bi(e))},{getIcons(){let n=["home"];for(let r=0;r<t.length;r++)t[r].startsWith("localhost:")&&(n[r]="terminal");return n},noOverHalfYAdjust:!0,isCur:(n,r)=>Lo(n,e.previewURL)})}),i.addEventListener("blur",s=>{(!kh||t.length==0)&&Wi(!0)})}function Jw(i){}async function bi(i){i.files.some(e=>e.name=="index.html")&&(Wi(),i.isTutor||Cs(li.changePreviewURL,i.previewURL),$e.onRefresh?await new Promise(e=>{$e.onRefresh(i,()=>{e()})}):await Po(i))}function Ba(i,e){return i.files.find(t=>{let s=t.getPath();return s+t.name==e?!0:Lo(s,e)})}function Lo(i,e){return i=i.replace(/index\.html/,""),e=e.replace(/index\.html/,""),i.endsWith("/")&&(i=i.substring(0,i.length-1)),e.endsWith("/")&&(e=e.substring(0,e.length-1)),i==e}async function Ma(i,e=!1){let t=i.refs.iframe;if(!t)return;let s=i.previewURL;if(s.includes("..")){t.contentDocument.body.parentElement.innerHTML="Invalid path";return}let n=Ba(i,s);if(!n)return;if(!n.editor){console.warn("editor hasn't loaded yet",n);return}let r=n.editor.getValue(),a=r.matchAll(/\<link\s.*href="(?<name>.+)".*\>/g);for(const c of a){if(!c.groups?.name)continue;let l=Ba(i,c.groups.name);if(!l){console.warn("couldn't find css file to link while trying to build local preview");continue}let u=`<style data-href=${c.groups.name}>${l.editor.getValue()}</style>`;r=r.substring(0,c.index)+u+r.substring(c.index+c[0].length)}r=r.replace(/\<img/g,"$& crossorigin");let o=new Promise(c=>{t.onload=l=>{c(),console.log("loaded local");let u=t.contentDocument.querySelectorAll("a");for(const m of u)m.addEventListener("click",g=>{g.preventDefault(),alert("Sorry, we're still working on adding support for links in the Tutor's preview!")})},t.onerror=l=>{c()}});return t.srcdoc=r,await o,i.files.find(c=>{let l=c.getPath();return l+c.name==s?!0:Lo(l,s)})}async function ey(i,e,t=!0){await lt(!0);let s=await new Promise(n=>{le.emit("submitChallenge",i,e,r=>{n(r)})});if(s!=0){s==5?alert("The submission deadline has already closed"):alert("Failed to submit challenge, error code: "+s);return}console.log(">> submitted challenge"),t&&(q.project.setPublished(!0),q.project.meta.isPublic=!1,location.href=`/practice/submissions/?cid=${q.project.meta.cid}&pid=${q.project.meta.pid}`)}async function ty(i){await lt(!0);let e=await new Promise(t=>{le.emit("unsubmitChallenge",i,s=>{t(s)})});if(e!=0){alert("Failed to unsubmit challenge, error code: "+e);return}console.log(">> unsubmitted challenge"),q.project.setPublished(!1),q.project.meta.isPublic=!0,location.reload()}let Kt=[];function Tn(i){i.sort((e,t)=>{let s=kr(e)&&$l(t)?1:$l(e)&&kr(t)?-1:0;return s==0&&(s=e.name.localeCompare(t.name)),s})}function xr(i){if(!i)return"";let e=[];function t(n){e.push(n),n.folder&&t(n.folder)}t(i);let s="";for(let n=e.length-1;n>=0;n--)s+=e[n].name+"/";return s}let je={files:[],action:null};function _d(i,e){let t=i.shiftKey||i.ctrlKey,s=e.p.hlItems;if(s.length&&e.folder!=s[0].folder)return!0;if(i.shiftKey){let n=e.folder?e.folder.items:e.p.items,r=s[0]??e.p.curFile,a=n.indexOf(r),o=n.indexOf(e),c=a,l=Math.abs(a-o),u=o>a?1:-1;for(const m of[...s])m._fi.classList.remove("hl2");e.p.hlItems=[],s=e.p.hlItems;for(let m=0;u==1?m<=l:m>=-l;m+=u){let g=n[c+m];g&&(s.includes(g)||(s.push(g),g._fi.classList.add("hl2")))}return}if(t&&s.length==0){let n=e.p.lastFolder??e.p.curFile;if(n?.folder==e.folder){if(!s.includes(n)&&(s.push(n),n._fi.classList.add("hl2"),e==n))return!0}else return!0}return s.includes(e)?(s.splice(s.indexOf(e),1),e._fi.classList.remove("hl2")):(s.length==0&&e.folder,s.push(e),e._fi.classList.add("hl2")),!0}function Kv(i){if(i.isTMPFile())return;let e=i.p.fileList;if(!e){console.log("ERR: couldn't find file list...");return}let t=document.createElement("div");t.className="file-item",t.innerHTML=`
        <span>${i.name}</span>
        <span class="ic"></span>
    `,t.classList.add("lang-"+Zs(i.name).replace(/\s/g,"_"));let s=[...i.folder?.items??i.p.items];s.includes(i)&&s.splice(s.indexOf(i),1),s.push(i),Tn(s);let n=s.indexOf(i),r;i.folder?r=i.folder._fiList:r=e,r.insertBefore(t,r.children[n]),Fo(i,t),i._fi=t,t.addEventListener("click",a=>{!a.ctrlKey&&!a.shiftKey&&i.p.deselectHLItems()}),t.addEventListener("mousedown",a=>{if(!i.p.hlItems.includes(i)&&i.p.hlItems.length&&!a.ctrlKey&&!a.shiftKey&&i.p.deselectHLItems(),a.button==0){if(a.ctrlKey||a.shiftKey){_d(a,i);return}i.open(),tn(new sn(a,o=>t.cloneNode(!0),async o=>{let c=Kt[Kt.length-1];if(c==o.folder)return;let l=[];if(i.p.hlItems.length)for(const u of i.p.hlItems)await $i(u,c,!0)&&l.push(u);else await $i(i,c,!0)&&l.push(i);for(const u of l)u.p.flashAddHLItem(u);l.length&&await lt()})),wi.down=i}}),t.addEventListener("mouseenter",a=>{i.folder||Kt.push(null)}),t.addEventListener("mouseleave",a=>{i.folder||Kt.splice(Kt.indexOf(null),1)})}function Gv(i){if(i.readonly)return;let e=["new_file","new_folder","-","paste"],t=i.fileList;cc(t,()=>{let s="Paste";return je.files.length&&(s+=" ("+je.files.length+" items)"),["Create file","Create folder","<hr>",s]},s=>{let n=e[s];n=="new_file"?new Xr({rootFolder:!0}).load():n=="new_folder"?new To({rootFolder:!0}).load():n=="paste"&&i.pasteFItems(i,null,r=>{},()=>{Wi()})},{onopen:s=>{t.classList.add("hl"),je.files.length||s.children[e.indexOf("paste")].classList.add("disabled")},onclose:()=>{t.classList.remove("hl")},getIcons:()=>["note_add","create_new_folder",null,"content_paste"]})}function Fo(i,e){if(i instanceof ze&&i.isReadOnly(!0))return;let t=["new_file","new_folder","-","rename","delete","cut","copy","duplicate","paste"],s=i.p;cc(e,()=>{let n="Delete",r="Copy",a="Cut",o="Duplicate",c="Paste";if(s.hlItems.length){let l=" ("+s.hlItems.length+" items)";n+=l,r+=l,a+=l,o+=l}return je.files.length&&(c+=" ("+je.files.length+" items)"),["Create file","Create folder","<hr>","Rename",n,a,r,o,c]},async n=>{function r(){Wi()}r();let a=t[n];a=="new_file"?new Xr({folder:i instanceof Ie?i:i.folder}).load():a=="new_folder"?new To({folder:i instanceof Ie?i:i.folder}).load():a=="rename"?s.renameFItem(i,r):a=="delete"?await s.deleteFItem(i):a=="cut"?s.cutFItems(i):a=="copy"?s.copyFItems(i):a=="duplicate"?s.duplicateItems(i.folder,s.hlItems.length?s.hlItems:[i]):a=="paste"&&await s.pasteFItems(s,i,()=>{},r)},{onopen:n=>{e.classList.add("hl"),je.files.length||n.children[t.indexOf("paste")].classList.add("disabled")},onclose:()=>{e.classList.remove("hl")},getIcons:()=>["note_add","create_new_folder",null,"edit","delete","content_cut","content_copy","dynamic_feed","content_paste"],isRightClick:!0})}async function $i(i,e,t=!1,s){e?.isRoot&&(e=void 0);let n=i.getSelfPath(),r=(e?.getSelfPath()??"")+i.name;console.log("...move item:",n,r);let a=i;if(i==e||e==a.folder)return;let o=[],c;e?(o=e.items,c=e._fiList):(o=i.p.items,c=i.p.fileList);let l=0,u=a.folder;if(i instanceof ze){let D=(e?e.items:i.p.items).find(E=>E.name==i.name&&E instanceof ze);if(D){await Ed(i,i.name,i.buf,D),t||await lt();return}}else if(i instanceof Ie){let D=(e?e.items:i.p.items).find(E=>E.name==i.name&&E instanceof Ie);if(D){await rw(i,D);return}}if(await new Promise(D=>{le.emit("moveFiles",i.p.pid,[i.name],xr(u),xr(e),nr(),E=>{D(E)})})!=0){console.warn("failed to move files/folders");return}let g=[...o];g.includes(i)&&g.splice(g.indexOf(i),1),g.push(i),Tn(g),l=g.indexOf(i),c.insertBefore(a._fi,c.children[l]),a.folder=e;let p=u?.items??i.p.items,k=e?.items??i.p.items;return p.splice(p.indexOf(i),1),k.push(i),e&&e._fi.classList.contains("close")&&e._fi.classList.remove("close"),t||lt(),Se.exec("moveItem",i),i instanceof ze?Se.exec("moveFile",i):Se.exec("moveFolder",i),i.p.emitLLAction({type:"move-item",path1:n,path2:r}),i.p.wc.booted&&i.p.wc.moveItem(n,r,s),!0}function Xv(i){let e=i.p.fileList;if(!e){console.log("ERR: couldn't find file list...");return}let t=document.createElement("div");t.className="folder-item",t.innerHTML=`
        <div class=fi-label>
            <div class="material-symbols-outlined b-expand">expand_more</div>
            <div class="ic-folder"></div>
            <div>${i.name}</div>
        </div>
        <div class="fi-list"></div>
    `;let s=[...i.folder?.items??i.p.items];s.includes(i)&&s.splice(s.indexOf(i),1),s.push(i),Tn(s);let n=s.indexOf(i),r;i.folder?r=i.folder._fiList:r=e,r.insertBefore(t,r.children[n]),i._fiLabel=t.querySelector(".fi-label"),i._fiList=t.querySelector(".fi-list"),i._fiLabel.addEventListener("click",a=>{a.shiftKey||a.ctrlKey||(t.classList.toggle("close"),i.p.lastFolder&&i.p.lastFolder._fiLabel.parentElement.classList.remove("sel"),t.classList.add("sel"),i.p._selectFolder(i))}),i._fi=t,Fo(i,i._fiLabel),i._fiLabel.addEventListener("click",a=>{!a.ctrlKey&&!a.shiftKey&&i.p.deselectHLItems()}),i._fiLabel.addEventListener("mousedown",a=>{if(!i.p.hlItems.includes(i)&&i.p.hlItems.length&&!a.ctrlKey&&!a.shiftKey&&i.p.deselectHLItems(),a.button==0){if(a.ctrlKey||a.shiftKey){_d(a,i);return}tn(new sn(a,o=>i._fiLabel.cloneNode(!0),async o=>{let c=Kt[Kt.length-1];if(c==o.folder)return;let l=[];if(i.p.hlItems.length)for(const u of i.p.hlItems)await $i(u,c,!0)&&l.push(u);else await $i(i,c,!0)&&l.push(i);for(const u of l)u.p.flashAddHLItem(u);l.length&&await lt()})),wi.down=i}}),t.addEventListener("mouseenter",a=>{Kt.push(i)}),t.addEventListener("mouseleave",a=>{Kt.splice(Kt.indexOf(i),1)})}let ts;class xd{constructor(e,t,s){this.p=e,this.name=t,this.folder=s}p;name;folder;_fi;getPath(){let e="",t=this;for(;t.folder;)e=t.folder.name+"/"+e,t=t.folder;return e}getSelfPath(){return this.getPath()+this.name}}class Ie extends xd{constructor(e,t,s){super(e,t,s),this.items=[]}items;_fiList;_fiLabel;isRoot=!1;isSame(e,t){e+="/"+t;let s=this.getPath()+"/"+this.name;return tt(e)==tt(s)}getSelfPath(){return this.getPath()+this.name+"/"}}function kr(i){return!("items"in i)}function $l(i){return"items"in i}function ql(i,e){if(!e)return;let t=Ba(i.p,e);t?(i.p.curFile.setTemp(!1),t.open()):console.warn("couldn't find file to navigate to")}class ze extends xd{constructor(e,t,s,n,r){super(e,t,n),this.buf=s,this.marks=new yh}_fsLastModified;marks;_back;isTextFile(){return bh(Zs(this.name))}encode(){return this.editor?this.p.textEncoder.encode(this.editor.getValue()):this.buf}isSame(e,t=""){if(e!=this.name)return!1;t||(t=""),t=tt(t);let s=tt(this.getPath());return t==s}buf;get lang(){let e=Zs(this.name);return{html:"html",css:"css",js:"javascript",ts:"typescript",rs:"rust",md:"markdown",pmd:"markdown",java:"java",json:"json",vue:"html",svg:"svg",".gitignore":"markdown"}[e]||"text"}updateLang(){this.editor&&monaco.editor.setModelLanguage(this.editor.getModel(),this.lang)}path="";link;cont;editor;curEditor;editorHandle;scrollOffset=0;scrollOffsetX=0;bubbles_ov;curRow=0;curCol=0;curI=0;_mouseOver=!1;blockPosChange=!0;_lastSavedText;_saved=!0;beenUploaded=!0;setSaved(e,t=!1){this._saved,!this._saved&&e&&(this._fsLastModified=new Date().getTime()),this._saved=e,e&&this.isTextFile()&&this.editor&&(this.buf=this.p.textEncoder.encode(this.editor.getValue())),this.link&&(e?this.link.classList.remove("unsaved"):(this.link.classList.add("unsaved"),this.setTemp(!1))),t||this.isTextFile()&&this.editor&&(this._lastSavedText=this.editor.getValue())}type(e,t,s){this.editor.trigger("keyboard","type",{text:s})}close(){if(this.bypassUnsupportedFormat=!1,this.actions){for(const e of this.actions._listeners)e.dispose();this.actions=null}if(this.p.openFiles.includes(this)){this._saved,this._saved,this.link?.remove();let e=this.p.openFiles.indexOf(this);if(e!=-1&&this.p.openFiles.splice(e,1),this.cont.parentElement&&this.cont.parentElement.removeChild(this.cont),this.cont=null,this.link=null,this.p.curFile==this){let t=this.p.openFiles[e];if(t)t.open(!1);else if(this.p.openFiles.length)this.p.openFiles[e-1].open(!1);else{this.p.curFile=null;let s=this.p.fileList.querySelectorAll(".file-item.sel");for(const n of s)n.classList.remove("sel")}}return this.editor&&(this.editor.dispose(),this.editor=null,this.actions=null,this._back&&(this._back.editor?.dispose(),this._back=null)),1}}async softDelete(){this.close()==1&&(this.p.files.includes(this)&&this.p.files.splice(this.p.files.indexOf(this),1),this.p.items.includes(this)&&this.p.items.splice(this.p.items.indexOf(this),1))}isTemp=!0;setTemp(e){this.isTemp=e,this.link&&(this.isTemp?this.link.classList.add("is-tmp"):this.link.classList.remove("is-tmp"))}isTMPFile(){return this.name.startsWith("__tmp")}isReadOnly(e=!1){return!this.p.canEdit||this.p.isTutor||(e?!1:!this.isTextFile())}reopen(e=!0){let t=this.bypassUnsupportedFormat;this.link&&this.close(),t&&(this.bypassUnsupportedFormat=!0),this.editor&&monaco.editor.setModelLanguage(this.editor.getModel(),this.lang),this.open(e)}bypassUnsupportedFormat=!1;open(e=!0){if(this.p.isTutor&&this.p.codeCont.querySelector(".suggest-widget.visible")||(ci==Jt.lesson&&(Co.lesson?.isLive||this.p.isTutor&&(e=!1)),this.p.onopen&&this.p.onopen(this,e)===!1))return;if(this.p.openFiles.includes(this))this.setTemp(!1),this.link&&this.link.scrollIntoView({behavior:"smooth"});else{for(const u of this.p.openFiles)u.isTemp&&u._saved&&u.close();let r=document.createElement("div");this.link=r;let a=document.createElement("div");a.textContent=this.name,r.appendChild(a);let o=document.createElement("button");if(o.innerHTML="<div class='material-symbols-outlined'>close</div>",o.classList.add("file-close"),o.addEventListener("click",u=>{if(!this.p.isTutor){if(this.p.readonly){this.close();return}this._saved?this.close():new qi("Unsaved file","This file is unsaved, are you sure you want to close it?",()=>{this.close()},()=>{console.log("File close canceled")}).load()}}),r.appendChild(o),r.className="file-link",!this.isTMPFile()){let u=[...this.p.d_files.children],m=u.length;u.some(g=>g.classList.contains("b-add-file"))&&m--,u.some(g=>g.className.includes("editor-type-"))&&m--,this.p.d_files.insertBefore(r,this.p.d_files.children[m])}this.p.openFiles.push(this);let c=this;a.addEventListener("mousedown",u=>{if(u.button==1){u.stopPropagation(),o.click();return}c.open()}),this.setTemp(e),r.addEventListener("mousedown",u=>{if(u.button==1){u.stopPropagation(),o.click();return}u.button==0&&(tn(new sn(u,m=>m.link.cloneNode(!0),m=>{if(!ts)return;let g=0,p=0,k=0;for(const D of this.p.d_files.children)D==m.link?g=k:D==ts.link&&(p=k),k++;g>=p?this.p.d_files.insertBefore(m.link,ts.link):this.p.d_files.insertBefore(m.link,ts.link.nextElementSibling)})),wi.down=this)}),r.addEventListener("mouseenter",u=>{ts=this}),r.addEventListener("mouseleave",u=>{ts=null}),Fo(this,r);let l=document.createElement("div");if(l.className="js-cont cont",this.cont=l,this.isTextFile()||this.bypassUnsupportedFormat){monaco.languages.typescript.typescriptDefaults.setCompilerOptions({allowSyntheticDefaultImports:!0,moduleResolution:monaco.languages.typescript.ModuleResolutionKind.NodeJs,allowNonTsExtensions:!0,target:monaco.languages.typescript.ScriptTarget.ES2020});let u=monaco.editor.create(l,{value:[this.p.textDecoder.decode(this.buf)].join(`
`),language:this.lang,theme:"vs-"+Th[uc].style,bracketPairColorization:{enabled:!1},minimap:{enabled:!1},contextmenu:!this.p.isTutor,readOnly:this.isReadOnly(),snippetSuggestions:"none"});u.onDidChangeModelContent(p=>{this.p.live&&(console.log("changed content",u.getValue()),this.p.emitLLAction({type:"file-text",path:this.getSelfPath(),buf:this.p.textEncoder.encode(u.getValue())}))}),u.onDidChangeCursorSelection(p=>{if(!this.p.live)return;let k={pos:p.selection,secondary:p.secondarySelections};console.log("SEL changed",k),this.p.emitLLAction({type:"update-selection",sel:p.selection,secondary:p.secondarySelections})}),u.onDidScrollChange(p=>{this.p.live&&this.p.emitLLAction({type:"update-scroll",scrollTop:p.scrollTop,scrollLeft:p.scrollLeft,scrollWidth:p.scrollWidth,scrollHeight:p.scrollHeight})}),l.addEventListener("click",p=>{let k=p.target;k.hasAttribute("data-href")?ql(this,k.getAttribute("data-href")):k.classList.contains("detected-link-active")&&ql(this,k.textContent)}),this.p.lesson&&this.p.lesson.info?.type==bt.rush&&this.p.isTutor&&(this.name.startsWith("__tmpFile")||(async()=>this._back=await this.p.createFile("__tmpFile-"+this.name,this.buf.slice(),null,null,!1))()),u.getDomNode().addEventListener("mouseleave",p=>{p.stopImmediatePropagation(),p.stopPropagation(),p.preventDefault()}),this.curEditor=u,this.editor=u,this.p.curFile=this,this.p.isTutor&&$e.setupTutorEditor(this),this.p.disableCopy&&u.onKeyDown(p=>{p.ctrlKey&&p.keyCode==monaco.KeyCode.KeyC&&(alert("Please don't try to copy and paste from the tutor's code"),p.preventDefault())});let m=l.querySelector("textarea"),g=l.querySelector(".overflow-guard");m.oninput=function(){g.scrollTo({top:0,left:0,behavior:"instant"})},$e.onOpenFile&&$e.onOpenFile(this)}else{let u=Zs(this.name);switch(u){case"pmd":{let m=this.p.textDecoder.decode(this.buf),g=Ih.render(m),p=document.createElement("pre");p.className="markdown-cont noformat",p.innerHTML=g,l.appendChild(p);let k=l.querySelectorAll(".language-css"),D=l.querySelectorAll(".language-javascript"),E=l.querySelectorAll(".language-html");for(const U of k)Prism.highlightElement(U,"css",null);for(const U of D)Prism.highlightElement(U,"javascript",null);for(const U of E)Prism.highlightElement(U,"html",null);let C=p.children[0];C.tagName.startsWith("H")&&C.tagName.length==2&&C.classList.add("mtk4")}break;case"png":case"jpg":case"jpeg":case"bmp":case"gif":case"jfif":{let m=new Blob([this.buf]),g=URL.createObjectURL(m),p=document.createElement("img");p.addEventListener("load",k=>{let D=document.createElement("div");D.classList.add("editor-img-cont");let E=m.size,C="B";E>=1e3&&(E/=1e3,C="KB",E>=1e3&&(E/=1e3,C="MB")),D.innerHTML=`
                                <div>
                                    <div>Dimensions: ${p.width} x ${p.height} PX</div>
                                    <div>Size: ${E.toFixed(2)} ${C}</div>
                                </div>
                                <div class="view"></div>
                            `,D.querySelector(".view").appendChild(p),l.appendChild(D),p.width>=p.height/2?p.style.width="75%":p.style.height="75%",URL.revokeObjectURL(g)}),p.addEventListener("error",k=>{alert("Failed to load img: "+k.message)}),p.src=g}break;default:{let m=document.createElement("div");m.className="editor-unsupported-file-cont",m.innerHTML=`
                            <div class="flx-v view">
                                <div>
                                    The file type <span>.${u}</span> is unsupported at this time.
                                </div>
                                <div>
                                    Opening unsupported files in the editor can potentially corrupt them, open at your own risk.
                                </div>
                                <br><br>
                                <div class="flx-c" style="gap:15px;padding:15px;border-radius:5px;width:max-content;height:max-content;background-color:var(--bg)">
                                    <button class="accent icon-btn b-open-as-text">
                                        <div>download</div>
                                        <div>Open As Text</div>
                                    </button>
                                    <button class="normal icon-btn b-download">
                                        <div>download</div>
                                        <div>Download</div>
                                    </button>
                                </div>
                            </div>
                        `,m.style.display="flex",m.style.justifyContent="center",m.style.alignItems="center",l.appendChild(m);let g=m.querySelector(".b-open-as-text"),p=m.querySelector(".b-download");g.addEventListener("click",k=>{this.bypassUnsupportedFormat=!0,this.reopen()}),p.addEventListener("click",k=>{this.download()})}}}this.setSaved(this._saved)}for(const r of this.p.d_files.children)r.classList.remove("cur");this.link.classList.add("cur");for(const r of this.p.codeCont.children)this.p.codeCont.removeChild(r);this.p.codeCont.appendChild(this.cont),this.editor&&this.editor.layout(),Oh();let t=this.p.curFile;this.p.curFile=this,this.p.lastFolder&&(this.p.lastFolder._fiLabel.parentElement.classList.remove("sel"),this.p.lastFolder=null);let s=this.p.fileList.querySelectorAll(".file-item.sel");for(const r of s)r.classList.remove("sel");let n=!0;if(ci==Jt.lesson&&(this.p.lesson?.hasLoaded||(n=!1)),n&&this._fi){let r=function(a){a&&(a._fiLabel.parentElement.classList.contains("close")&&(a._fiLabel.click(),a.p.lastFolder=null,a._fiLabel.parentElement.classList.remove("sel")),a.folder&&r(a.folder))};this._fi.classList.add("sel"),r(this.folder)}t?.editor&&this.editor&&(t.editor.focus(),this.editor.focus()),this.p.lesson?.info?.type==bt.rush&&this.actions.startInputListener(r=>{for(const a of r.changes){a.range.startLineNumber,a.range.startColumn;let o=a.range;o.startColumn==o.endColumn&&o.startLineNumber==o.endLineNumber,a.text.includes(`
`)?this.marks.add(o.startLineNumber,o.startColumn,o.endLineNumber,o.endColumn,0,a.text.match(/\n/g).length):this.marks.add(o.startLineNumber,o.startColumn,o.endLineNumber,o.endColumn,a.text.length,0)}this.marks.updateAll(this.actions.editor)}),Se.exec("openFile",this),this.p.live&&this.p.emitLLAction({type:"open-file",path:this.getSelfPath(),isTemp:e})}actions;download(){let e=new Blob([this.buf]),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=this.name,s.click(),URL.revokeObjectURL(t)}}const $e={onOpenFile:void 0,getURLRoot:void 0,getExternalURL:void 0,onRefresh:void 0,setupTutorEditor:void 0,onOpenCreateFileMenu:void 0,onOpenCreateFolderMenu:void 0};function Qv(){let i=Object.keys($e);for(const e of i)$e[e]=void 0}async function Po(i){if(Co.lesson?.info.type==bt.review&&i.isTutor||!i)return;(i.needsSave||i.files.some(a=>!a._saved)||!i.hasSavedOnce)&&(i.usesCompiling.value?await Or(i,!0):await lt(!0),i.needsSave=!1);let e=i.items.find(a=>a.name=="index.html");if(!e||!i.hasSavedOnce){console.warn("no index.html",e,i.hasSavedOnce,i),alert("No index.html file found! Please create a new file called index.html in the outer most folder of your project, this file will be used in the preview.");return}let t=i.findIFrame();if(!t){console.warn("no iframe could be found to refresh");return}let s,n=new Promise(a=>{s=a});t.onload=()=>{s()},t.onerror=()=>{s()};let r=i.getRefreshType();if(r=="normal"){let a=i.getURL();t.contentWindow?.location.replace(a)}else r=="local"&&await Ma(i,!0);if(await n,i.refreshState.value=!i.refreshState.value,i.refreshedOnce=!0,ci==Jt.editor)q.triggerProject();else{let a=gn();a&&(a.triggerLesson(),console.log(":: triggered lesson update"))}Cs(li.refresh,null),i.emitLLAction({type:"refresh"})}async function lt(i=!1,e={}){if(ci==Jt.lesson){await q.project.lesson?.saveLesson(i,e);return}let t=q.project,s=performance.now();if(t&&!t._skipSave&&!vs.value&&t.canEdit&&!t.isPublished()){if(vs.value=!0,await t.uploadProjectFiles(e),t.hasSavedOnce=!0,t.files.forEach(n=>n.setSaved(!0)),!i){let n=performance.now()-s;await w(Math.max(0,300-n))}vs.value=!1}}function kd(i){if(!i.key)return;if(i.key.toLowerCase()=="z"&&i.altKey){let t=q.project;if(!t)return;let s=t.getCurEditor();s&&(t.wordWrap=!t.wordWrap,s.updateOptions({wordWrap:t.wordWrap?"on":"off"}),console.log("toggle word wrap"))}}function Sd(i){let e=q.project?.curFile;if(!e||!e._saved)return;function t(){if(e.isReadOnly()||!e.editor)return;let s=e.editor.getValue();e._lastSavedText!=s&&e.setSaved(!1)}requestAnimationFrame(t)}function Jv(){document.addEventListener("keydown",kd)}function ew(){document.removeEventListener("keydown",kd)}function tw(){document.addEventListener("keyup",Sd)}function iw(){document.removeEventListener("keyup",Sd)}class Xr extends bs{constructor(e={}){e.buf==null&&(e.buf=new Uint8Array),e.rootFolder||e.folder==null&&(e.folder=q.project?.lastFolder??q.project?.curFile?.folder),super("New File","Enter file name",t=>{if(lc(_h(t)))return 1;q.project.createFile(t,e.buf,null,e.folder,!0)},e.onCancel)}load(){if(q.project&&q.project.canEdit&&!(q.project.readonly||q.project.isPublished()))return super.load(),$e.onOpenCreateFileMenu&&$e.onOpenCreateFileMenu(this),setTimeout(()=>{this.inp.focus()},50),this}}class To extends bs{constructor(e={}){e.rootFolder||e.folder==null&&(e.folder=q.project.lastFolder??q.project.curFile?.folder),super("New Folder","Enter folder name",t=>{if(lc(xh(t)))return 1;q.project.createFolder(t,e.folder,!0),e.onConfirm&&e.onConfirm(t)},e.onCancel)}load(){if(q.project&&q.project.canEdit&&!(q.project.readonly||q.project.isPublished()))return super.load(),$e.onOpenCreateFolderMenu&&$e.onOpenCreateFolderMenu(this),setTimeout(()=>{this.inp.focus()},50),this}}class sw extends qi{constructor(e,t,s,n,r){super("File already exists","There is already a file in this folder with the name: "+t+".<br><br>Do you want to override it?",async()=>{n&&(n instanceof ze&&(n.editor&&n.editor.setValue(n.p.textDecoder.decode(s)),n.buf=s.slice(),n.setSaved(!1),n.link&&n.reopen(!1)),e&&await e.p.deleteFItem(e,!0),r&&r(!0))},()=>{console.log("File override canceled"),r&&r(!1)})}}class nw extends qi{constructor(e,t,s){super("Folder already exists","There is already a folder in this folder with the name: "+e.name+".<br><br>Do you want to merge contents?",async()=>{let n=[...e.items];for(const r of n)await $i(r,t,!0);e.items.length==0?await e.p.deleteFItem(e,!0):alert("Something went wrong and not all the files were transfered from the original folder."),await lt(),s&&s(!0)},()=>{console.log("File override canceled"),s&&s(!1)})}}async function Ed(i,e,t,s){return s?await new Promise(r=>{new sw(i,e,t,s,a=>{r(a)}).load()}):0}async function rw(i,e){return e?(console.log(i.name,e?.name,i,e),await new Promise(s=>{new nw(i,e,n=>{s(n)}).load()})):0}function iy(){ew(),iw(),gr.$reset(),vr.$reset()}function sy(){tw(),Jv()}const aw=["opened"],ow={class:"menu-header"},lw={class:"menu-title"},cw={class:"material-symbols-outlined"},uw={class:"l-menu-title"},dw={class:"menu-body"},hw=Sr({__name:"Menu",props:Do({title:{},icon:{},isInternal:{type:Boolean},noExtras:{type:Boolean},width:{},height:{},newLayer:{type:Boolean},customOnClose:{type:Function}},{opened:{default:!1},openedModifiers:{}}),emits:Do(["onClose"],["update:opened"]),setup(i,{emit:e}){const t=i,s=e;let n;Yl(()=>{let c=r.value;if(!c)return;let l=new Sh("General","public").loadWithCustomCont(c,t.newLayer);if(n=l,l.isVueMenu=!0,t.width&&(l.outerMenu.style.width=t.width),t.height&&(l.outerMenu.style.height=t.height),l.onClose=()=>{o.value=!1},o.value=!0,!t.noExtras){if(t.isInternal||(l.head.remove(),l.body.remove()),!l.outerMenu.querySelector(".before.pse-bg")){let u=document.createElement("div");u.className="before pse-bg loaded",l.outerMenu.appendChild(u)}if(!l.outerMenu.querySelector(".after.pse-bg")){let u=document.createElement("div");u.className="after pse-bg loaded",l.outerMenu.appendChild(u)}l.hasOpenAnim&&(l.outerMenu.addEventListener("animationend",u=>{l.outerMenu.classList.remove("menu-bubble-anim"),l.outerMenu.classList.add("menu-open-post")}),l.outerMenu.classList.add("menu-bubble-anim"))}});const r=Zl("menu");function a(){t.customOnClose&&!t.customOnClose()||(s("onClose"),n?.close())}const o=Kd(i,"opened");return(c,l)=>(Xe(),ft("div",{class:Kl(["menu","menu-"+c.title.replace(/\s/g,"-").toLowerCase(),"menu-anim","menu-bubble-anim","vue-menu"]),ref_key:"menu",ref:r,opened:o.value},[l[0]||(l[0]=De("div",{class:"menu-sub-cont"},null,-1)),De("div",ow,[De("div",lw,[De("div",cw,Ei(c.icon),1),De("div",uw,Ei(c.title),1)]),(Xe(),ft("div",{key:0,class:"material-symbols-outlined b-close",onClick:a},"close"))]),De("div",dw,[Ci(c.$slots,"default",{},void 0,!0)])],10,aw))}}),fw=mn(hw,[["__scopeId","data-v-54c59ef5"]]),pw=Sr({__name:"Icon",props:{loading:{type:Boolean},fill:{type:Boolean}},setup(i){return(e,t)=>{const s=Gl("Icon",!0);return Xe(),ft("div",{class:Kl([e.fill?"material-icons":"material-symbols-outlined","icon",{loading:e.loading}])},[Ci(e.$slots,"default",{},()=>[e.loading?(Xe(),Vn(s,{key:0},{default:Si(()=>t[0]||(t[0]=[is("progress_activity")])),_:1,__:[0]})):ki("",!0)],!0)],2)}}}),mw=mn(pw,[["__scopeId","data-v-4afcfe2d"]]),gw={},vw={class:"badge"};function ww(i,e){return Xe(),ft("div",vw,[Ci(i.$slots,"default",{},void 0,!0)])}const Wl=mn(gw,[["render",ww],["__scopeId","data-v-1215e026"]]),yw=["page-type"],bw={key:0,class:"logo"},_w={class:"editor-menu-bar"},xw={class:"cur-project-controls"},kw={class:"b-alt-layout icon-div co-item","co-label":"Switch Layout"},Sw={class:"feedback-item-list"},Ew={key:0},Cw={class:"feedback-item"},Lw={class:"flx-c",style:{gap:"5px"}},Fw={style:{"margin-left":"auto"}},Pw={class:"feedback-question feedback-message"},Tw={class:"sub feedback-dev-cont",style:{"margin-left":"1em"}},Iw={class:"feedback-message dev-message"},Ow={class:"dev-who"},Aw={class:"dev-text"},Dw={key:1},jw={class:"nav-links"},Rw={class:"feedback-btn-cont b-feedback-btn"},Bw=Sr({__name:"Header",props:{btnIndex:{},notCompact:{type:Boolean},pageId:{},noLogo:{type:Boolean},noColor:{type:Boolean}},setup(i){const e=fn(),{loggedIn:t}=Er(e),s=Qd(),n=gn();function r(u,m=!0,g){a.noColor&&document.body.classList.add("no-color");let p=document.querySelector(".navCont");if(!p){console.error("no header nav cont found, aborting...");return}m&&p.classList.add("compact");let k=p.querySelectorAll(".nav-link");k[u]&&k[u].classList.add("active"),document.body.classList.add(["learn-page","practice-page","experiment-page","profile-page"][u]),document.querySelector(".b-feedback")?.addEventListener("click",E=>{c.value=!0,new Ch().load(),e.getFeedbackUpdates(),e.feedback.storeLastRead=localStorage.getItem("lastGotFB")??new Date().toISOString(),localStorage.setItem("lastGotFB",new Date().toISOString()),scrollTo({top:0,left:0,behavior:"instant"})})}const a=i;Yl(()=>{r(a.btnIndex,!a.notCompact,a.pageId),setTimeout(()=>{console.log("run scroll to fix when refreshing"),scrollTo(0,0)},20);let u=document.querySelector(".h-profile");u?.addEventListener("mousedown",m=>{let g=[t.value?"View Profile":" --- ",t.value?"Classes (Coming soon)":" --- ",t.value?"Switch Account":"Log In",t.value?"Log Out":" --- ",t.value?"<Top Secret>":" --- ","Switch Theme","Reconnect to Server"];$a(u,()=>g,async p=>{if(g[p],p==0&&t.value&&s.push({name:"profile"}),p!=1){if(p==2&&Lh(),p==3&&t.value&&Fh(),p==4&&t.value&&new Ph().load(),p==5){Ah(uc=="dark"?"light":"dark");return}else p==6&&(le.disconnect(),await w(500),le.connect());Wi()}},{openToLeft:!0,getIcons(){return["person","group","switch_account","logout","deployed_code","light","wifi"]},useHold:!1,onopen(p){}})}),setTimeout(()=>{Eh()},100)});const o=Gd();Zl("feedback-menu-2");const c=jt(!1);function l(){return!!n.lesson?.info}return(u,m)=>{const g=Gl("RouterLink");return Xe(),ft("div",{class:"navCont nav-container main-header",role:"navigation","page-type":At(o).meta.type},[u.noLogo?ki("",!0):(Xe(),ft("div",bw,m[1]||(m[1]=[De("a",{href:"/"},null,-1)]))),Qr(De("div",_w,[Ci(u.$slots,"home-btn",{},void 0,!0)],512),[[Jr,u.pageId=="editor"||u.pageId=="lesson"]]),Qr(De("div",xw,[Ci(u.$slots,"current-project",{},void 0,!0),Ci(u.$slots,"actions",{},void 0,!0),Qr(De("div",kw,m[2]||(m[2]=[De("div",{class:"material-symbols-outlined"},"view_week",-1)]),512),[[Jr,u.pageId=="lesson"&&l()]]),Ci(u.$slots,"actions2",{},void 0,!0),m[3]||(m[3]=De("div",{class:"icon-div hide"},[De("div",{class:"material-symbols-outlined"},"play_arrow")],-1))],512),[[Jr,u.pageId=="editor"||u.pageId=="lesson"]]),m[10]||(m[10]=Xd('<div class="d-lesson-confirm none" data-v-8296819a><div class="lesson-confirm-text" data-v-8296819a>Press &quot;I&#39;m Done&quot; to let the Tutor know when you&#39;re done with this step.</div><button class="b-im-done icon-btn" data-v-8296819a><div class="material-symbols-outlined" data-v-8296819a>done</div><div class="lesson-confirm-submit" data-v-8296819a>I&#39;m Done</div></button><button class="b-replay no-bg" data-v-8296819a><div class="material-symbols-outlined" data-v-8296819a>replay</div></button><button class="b-go-back-step no-bg hide" data-v-8296819a><div class="material-symbols-outlined" data-v-8296819a>keyboard_double_arrow_left</div></button><div class="extra-lesson-confirm-btns" data-v-8296819a></div></div>',1)),c.value?(Xe(),Vn(fw,{key:1,ref:"feedback-menu-2",title:"From the Dev Team",opened:c.value,"onUpdate:opened":m[0]||(m[0]=p=>c.value=p),icon:"terminal",width:"500px",height:"max-content"},{default:Si(()=>[De("div",Sw,[At(e).feedback.fetching?(Xe(),ft("div",Ew,[Bs(mw,{loading:At(e).feedback.fetching},null,8,["loading"])])):ki("",!0),(Xe(!0),ft(jo,null,Ro(At(e).feedback.items,p=>(Xe(),ft("div",Cw,[De("div",Lw,[m[5]||(m[5]=De("div",null,"A User",-1)),At(e).isNew(p.date)?(Xe(),Vn(Wl,{key:0,style:{"background-color":"var(--incorrect-bg)","font-size":"13px","font-weight":"bold"}},{default:Si(()=>m[4]||(m[4]=[is("UPDATED")])),_:1,__:[4]})):ki("",!0),De("div",Fw,Ei(new Date(p.date).toLocaleString([],{dateStyle:"short",timeStyle:"short"})),1)]),De("h3",Pw,Ei(p.desc),1),De("div",Tw,[(Xe(!0),ft(jo,null,Ro(p.messages,k=>(Xe(),ft("div",Iw,[De("div",Ow,Ei(k.who??"The Dev Team "),1),De("div",Aw,Ei(k.text),1)]))),256))])]))),256)),At(e).feedback.items.length==0?(Xe(),ft("h3",Dw," Nothing yet! ")):ki("",!0)])]),_:1},8,["opened"])):ki("",!0),De("div",jw,[De("div",Rw,[m[6]||(m[6]=De("button",{class:"icon-btn-single co-item b-feedback","co-label":"Send Feedback"},[De("div",{class:"material-symbols-outlined"},"forum")],-1)),At(e).getNewFeedbackNoti?(Xe(),Vn(Wl,{key:0},{default:Si(()=>[is(Ei(At(e).getNewFeedbackNoti),1)]),_:1})):ki("",!0)]),Bs(g,{to:"/learn",class:"nav-link learn-link"},{default:Si(()=>m[7]||(m[7]=[is("Learn "),De("span",{class:"material-symbols-outlined"},"Auto_stories",-1)])),_:1,__:[7]}),Bs(g,{to:"/practice",class:"nav-link practice-link"},{default:Si(()=>m[8]||(m[8]=[is("Practice "),De("span",{class:"material-symbols-outlined"},"Checkbook",-1)])),_:1,__:[8]}),Bs(g,{to:"/editor",class:"nav-link experiment-link"},{default:Si(()=>m[9]||(m[9]=[is("Experiment "),De("span",{class:"material-symbols-outlined"},"Experiment",-1)])),_:1,__:[9]}),Bs(Mh)])],8,yw)}}}),ny=mn(Bw,[["__scopeId","data-v-8296819a"]]);export{$i as A,bi as B,Qw as C,Po as D,_r as E,ze as F,Wl as G,ny as H,mw as I,fw as M,ja as P,yd as a,qo as b,Vw as c,Ww as d,iy as e,Ba as f,Hw as g,Yw as h,sy as i,lt as j,ey as k,ty as l,Tn as m,gn as n,Xh as o,Jw as p,uf as q,Zw as r,Ra as s,yr as t,Ir as u,Gw as v,Kw as w,Xw as x,Or as y,Vv as z};
